"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[5096],{19114:function(e,t,s){s.d(t,{c:function(){return C}});var n=s(46709),o=s(68248),a=s(27757),l=s(79081),i=s(66916),r=s(74060),d=s(43617),c=s(90061),u=s(40724),m=s(52849),p=s(72607),g=s(72150),v=s(76118);var f=s(61077),h=s(61060);var y=s(32874),x=s(49708),b=s(69986),w=s(34599);var I=s(73408);const S=[{id:"name",accessorKey:"name",header:"Name"}];var T={name:"tardml",styles:"height:500px;overflow:hidden"},A={name:"82a6rk",styles:"flex:1"};const Y=({experimentId:e,visible:t,setVisible:s,selectedTraceInfos:Y})=>{const{theme:C}=(0,a.u)(),[_,R]=(0,n.useState)(""),[E,N]=(0,n.useState)(_),M=Y.map((e=>(0,g.getModelTraceId)({info:e,data:{spans:[]}}))),{data:k,isLoading:F}=(({traceIds:e})=>(0,x.I)({queryKey:[w.lA,e],queryFn:async({queryKey:[,e]})=>{const t=(0,v.chunk)(e,20),s=[];for(const n of t){const e=await Promise.all(n.map(b.U));s.push(...e)}return s}}))({traceIds:M}),D=(e=>{const t=e.map((e=>{var t;const s=e.data.spans.find((e=>!(0,g.getModelTraceSpanParentId)(e)));if((0,v.isNil)(s))return null;const n={};if((0,g.isV3ModelTraceInfo)(e.info))for(const l of null!==(o=e.info.assessments)&&void 0!==o?o:[]){var o;if("expectation"in l)if("serialized_value"in l.expectation){const e=l.expectation.serialized_value.value;try{n[l.assessment_name]=JSON.parse(e)}catch(a){n[l.assessment_name]=e}}else n[l.assessment_name]=l.expectation.value}return{inputs:(0,g.isV3ModelTraceSpan)(s)?(0,g.tryDeserializeAttribute)(null===(t=s.attributes)||void 0===t?void 0:t["mlflow.spanInputs"]):s.inputs,expectations:n,source:{source_type:"TRACE",source_data:{trace_id:(0,g.getModelTraceId)(e)}}}}));return(0,v.compact)(t)})((0,v.compact)(k)),{data:O,isLoading:H,isFetching:V,fetchNextPage:L,hasNextPage:B}=(0,p.J)({experimentId:e,nameFilter:_}),$=H||F,U=(0,m.v)({isFetching:V,hasNextPage:null!==B&&void 0!==B&&B,fetchNextPage:L}),z=(0,d.N4)({columns:S,getRowId:e=>e.dataset_id,data:null!==O&&void 0!==O?O:[],getCoreRowModel:(0,c.HT)(),enableColumnResizing:!1}),P=z.getSelectedRowModel().rows.map((e=>e.original)),{upsertDatasetRecordsMutation:j,isLoading:q}=(({onSuccess:e,onError:t})=>{const{mutate:s,isLoading:n}=(0,h.n)({mutationFn:async({datasetId:e,records:t})=>{const s={dataset_id:e,records:t};return await(0,f.ff)((0,f.we)(`ajax-api/3.0/mlflow/datasets/${e}/records`),"POST",s)},onSuccess:()=>{null===e||void 0===e||e()},onError:e=>{null===t||void 0===t||t(e)}});return{upsertDatasetRecordsMutation:s,isLoading:n}})({onSuccess:()=>{s(!1)}}),K=(0,n.useCallback)((()=>{Promise.all(P.map((e=>j({datasetId:e.dataset_id,records:JSON.stringify(D)}))))}),[P,j,D]);return(0,I.Y)(l.d,{componentId:"mlflow.export-traces-to-dataset-modal",visible:t,onCancel:()=>s(!1),okText:(0,I.Y)(u.A,{id:"a1liZ7",defaultMessage:"Export"}),okButtonProps:{disabled:F||0===P.length,loading:q},onOk:K,title:(0,I.Y)(u.A,{id:"ZBRK9J",defaultMessage:"Export traces to datasets"}),children:(0,I.FD)("div",{css:T,children:[(0,I.FD)("div",{css:(0,o.AH)({display:"flex",gap:C.spacing.sm,alignItems:"center",marginBottom:C.spacing.sm},""),children:[(0,I.Y)(i.I,{allowClear:!0,placeholder:"Search by dataset name",value:E,onChange:e=>{N(e.target.value),e.target.value||R(e.target.value)},onClear:()=>{N(""),R("")},onPressEnter:()=>R(E),componentId:"mlflow.eval-datasets.search-input",css:A,prefix:(0,I.Y)(i.S,{})}),(0,I.Y)(y.Z,{experimentId:e})]}),(0,I.FD)(r.Table,{scrollable:!0,onScroll:e=>U(e.currentTarget),someRowsSelected:z.getIsSomeRowsSelected()||z.getIsAllRowsSelected(),empty:!H&&!V&&0===O.length&&(0,I.Y)(r.Empty,{description:(0,I.Y)(u.A,{id:"F4K195",defaultMessage:"No evaluation datasets found"})}),children:[(0,I.FD)(r.TableRow,{isHeader:!0,children:[(0,I.Y)(r.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.header-checkbox",checked:z.getIsAllRowsSelected(),indeterminate:z.getIsSomeRowsSelected(),onChange:z.getToggleAllRowsSelectedHandler()}),z.getLeafHeaders().map((e=>(0,I.Y)(r.TableHeader,{componentId:`mlflow.eval-datasets.${e.column.id}-header`,header:e,column:e.column,css:(0,o.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.header,e.getContext())},e.id)))]}),!$&&z.getRowModel().rows.map((e=>(0,I.FD)(r.TableRow,{children:[(0,I.Y)("div",{children:(0,I.Y)(r.TableRowSelectCell,{componentId:"mlflow.export-traces-to-dataset-modal.row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler()})}),e.getVisibleCells().map((e=>(0,I.Y)(r.TableCell,{css:(0,o.AH)({width:e.column.columnDef.size,maxWidth:e.column.columnDef.maxSize},""),children:(0,d.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))]},e.id))),($||V)&&(0,I.Y)(r.TableSkeletonRows,{table:z})]})]})})},C=({experimentId:e})=>{const[t,s]=(0,n.useState)(!1),o=(0,n.useCallback)((({selectedTraceInfos:n})=>(0,I.Y)(Y,{experimentId:e,visible:t,setVisible:s,selectedTraceInfos:n})),[e,t,s]);return{showExportTracesToDatasetsModal:t,setShowExportTracesToDatasetsModal:s,renderExportTracesToDatasetsModal:o}}},40720:function(e,t,s){s.d(t,{C:function(){return i}});var n=s(39595),o=s(61060),a=s(12803),l=s(92831);const i=()=>{const e=(0,n.jE)();return(0,o.n)({mutationFn:async({experimentId:e,traceRequestIds:t})=>{const s=[];for(let o=0;o<t.length;o+=100)s.push(t.slice(o,o+100));const n=s.map((t=>a.x.deleteTracesV3(e,t)));return{traces_deleted:(await Promise.all(n)).reduce(((e,t)=>e+t.traces_deleted),0)}},onSuccess:()=>(0,l.BL)({queryClient:e})})}},69986:function(e,t,s){s.d(t,{R:function(){return a},U:function(){return o}});var n=s(12803);async function o(e){var t;if(!e)return;const[s,o]=await Promise.all([n.x.getExperimentTraceInfoV3(e),n.x.getExperimentTraceData(e)]);return o?{info:(null===s||void 0===s||null===(t=s.trace)||void 0===t?void 0:t.trace_info)||{},data:o}:void 0}async function a(e){if(!e)return;const[t,s]=await Promise.all([n.x.getExperimentTraceInfo(e).then((e=>e.trace_info||{})),n.x.getExperimentTraceData(e)]);return s?{info:t,data:s}:void 0}},72150:function(e,t,s){s.d(t,{AssessmentSchemaContextProvider:function(){return i.I},ExpectationValuePreview:function(){return o.S},ModelTraceExplorer:function(){return n.a},ModelTraceExplorerSkeleton:function(){return a.F},ModelTraceSpanType:function(){return r.VZ},getModelTraceId:function(){return l.MF},getModelTraceSpanParentId:function(){return l.cp},isV3ModelTraceInfo:function(){return l.gD},isV3ModelTraceSpan:function(){return l.UZ},tryDeserializeAttribute:function(){return l.xD}});var n=s(5169),o=s(777),a=s(15929);s(46709),s(42747);var l=s(86125),i=s(57248),r=s(94664)},82636:function(e,t,s){s.d(t,{l:function(){return o}});var n=s(92831);const o=e=>{let t=!1,s=!1,o=!1;for(const i of e){var a,l;const e=i.traceInfo;e&&((0,n.h)(e)&&(s=!0),(0,n.Mq)(e)&&(t=!0),null!==(a=i.traceInfo)&&void 0!==a&&null!==(l=a.trace_metadata)&&void 0!==l&&l["mlflow.trace.tokenUsage"]&&(o=!0))}return{responseHasContent:t,inputHasContent:s,tokensHasContent:o}}},88525:function(e,t,s){s.d(t,{$:function(){return i}});var n=s(27042),o=s(12803),a=s(46709),l=s(181);const i=({onSuccess:e,existingTagKeys:t=[],useV3Apis:s})=>{const{showEditTagsModal:i,EditTagsModal:r}=(0,n.Q)({saveTagsHandler:async(e,t,n)=>{if(!e.traceRequestId)return;const a=e.traceRequestId,l=n.filter((({key:e,value:s})=>!t.some((({key:t,value:n})=>t===e&&s===n)))),i=t.filter((({key:e})=>!n.some((({key:t})=>e===t))));return Promise.all([...l.map((({key:e,value:t})=>s?o.x.setExperimentTraceTagV3(a,e,t):o.x.setExperimentTraceTag(a,e,t))),...i.map((({key:e})=>s?o.x.deleteExperimentTraceTagV3(a,e):o.x.deleteExperimentTraceTag(a,e)))])},valueRequired:!0,allAvailableTags:t.filter((e=>e&&!e.startsWith(l.nt))),onSuccess:e});return{showEditTagsModalForTrace:(0,a.useCallback)((e=>{var t;if(!e.request_id)return;const s=(null===(t=e.tags)||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(l.nt))))||[];i({traceRequestId:e.request_id,tags:s||[]})}),[i]),EditTagsModal:r}}},92831:function(e,t,s){s.d(t,{WB:function(){return to},tj:function(){return j},_p:function(){return ua},sG:function(){return M},w_:function(){return ra},o8:function(){return o},tU:function(){return Qs.v},js:function(){return Ao},Te:function(){return P},Rl:function(){return U},TH:function(){return ko},$W:function(){return q},Pn:function(){return W},YO:function(){return X},XQ:function(){return z},$6:function(){return H},pR:function(){return F},h:function(){return he},Mq:function(){return ye},d9:function(){return pe},BL:function(){return Fo},R7:function(){return pa},Xz:function(){return Co},Ie:function(){return Mo},KW:function(){return Do},Zn:function(){return Oo},K0:function(){return ya},GY:function(){return S}});var n=s(76118);let o=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),a=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),l=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({});const i=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[a.IS_OVERALL_ASSESSMENT])},r=e=>{var t;return(0,n.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[a.CHUNK_INDEX])},d=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),c=e=>Object.values(e||{}).find(d),u=(e,t,s)=>{const o=c(e)||[],l=c(t);return o.map(((e,t)=>{const o=null===l||void 0===l?void 0:l[t],i=(s||[]).filter((e=>(e.metadata||{})[a.CHUNK_INDEX]===t)),r=(0,n.groupBy)(i,"name");return Object.keys(r).forEach((e=>{r[e]=(0,n.orderBy)(r[e],"timestamp","desc")})),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:r,target:null===o||void 0===o?void 0:o.content}}))};function m(e){if(!e)return;const{columns:t,data:s,filename:o}=e;if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!s||!Array.isArray(s))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const a=t.map(((e,t)=>null!==e&&void 0!==e?e:`column_${t}`));return s.map((e=>(0,n.zipObject)(a,e)))}var p=s(9858),g=s(46709),v=s(27637);const f=v.ok,h=v.N_,y="assessmentFilter";function x(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function b(e,t){if("pass-fail"===e.dtype){if("undefined"===t)return;return t}return"boolean"===e.dtype?"true"===t||"false"!==t&&void 0:t}function w(e){return void 0===e||null===e?"undefined":`${e}`}var I=s(90448);const S=(e,t)=>{const[s,n]=(0,g.useState)(t&&e.find((e=>e.id===t.key))?t:void 0);return[(0,g.useMemo)((()=>{if(s&&e.find((e=>e.id===s.key)))return s}),[s,e]),n]};var T=s(68248),A=s(27757),Y=s(74060),C=s(66916),_=s(79081),R=s(42747),E=s(73408);const N=(0,g.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),M=({children:e})=>{const[t,s]=(0,g.useState)(),[n,o]=(0,g.useState)([]),a=(0,g.useMemo)((()=>({table:t,setTable:s,selectedRowIds:n,setSelectedRowIds:o})),[t,n]);return(0,E.Y)(N.Provider,{value:a,children:e})},k=({experimentIds:e,visible:t,selectedTraces:s,handleClose:n,deleteTraces:o})=>{const a=(0,R.tz)(),[l,i]=(0,g.useState)(""),[r,d]=(0,g.useState)(!1),c=s.map((e=>e.evaluationId));return(0,E.FD)(_.d,{componentId:"eval-tab.delete_traces-modal",title:(0,E.Y)(R.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:t,onCancel:n,okText:(0,E.Y)(R.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var t;await o(null!==(t=e[0])&&void 0!==t?t:"",c),n()}catch(s){i(a.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:r,danger:!0},children:[l&&(0,E.Y)(A.T.Paragraph,{color:"error",children:l}),(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)(R.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})},F=()=>1e3;var D=s(72150);let O=function(e){return e.EQUALS="=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e}({}),H=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),V=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const L={[V.ASSESSMENT]:"Assessments",[V.EXPECTATION]:"Expectations",[V.TAG]:"Tags",[V.INFO]:"\xa0"},B="user",$="session",U="response",z="trace_id",P="request_time",j="execution_duration",q="state",K="source",W="tags",Q="trace_name",G="request",J="run_name",Z="logged_model",X="tokens",ee="custom_metadata",te=[j,P,$],se=[j,P],ne=[l.CHUNK_RELEVANCE,l.TOTAL_INPUT_TOKEN_COUNT,l.TOTAL_OUTPUT_TOKEN_COUNT,l.TOTAL_TOKEN_COUNT,l.DOCUMENT_RECALL,l.DOCUMENT_RATINGS];function oe(e){return e+"_assessment_column"}function ae(e){return e+"_expectation_column"}const le=(e,t,s,o,a,l)=>(0,g.useMemo)((()=>{const i=null!==l&&void 0!==l?l:ve(t);let r=[];if(i)r=[{id:G,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:H.INPUT,group:V.INFO}];else{let e=new Set,s=new Set;t.forEach((t=>{const{inputs:n}=t;e=new Set([...e,...Object.keys(n||{})]),s=new Set([...s,...Object.keys(t.traceInfo||{})])})),r=[...e].map((e=>({id:e,label:e,type:H.INPUT})))}const d=s.map((e=>({id:oe(e.name),label:e.displayName,type:H.ASSESSMENT,assessmentInfo:e,group:V.ASSESSMENT}))).filter((e=>!e.assessmentInfo.isRetrievalAssessment&&!ne.includes(e.assessmentInfo.name)));let c;const u={};if(i){c=[{id:z,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:H.TRACE_INFO,group:V.INFO},{id:Q,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:H.TRACE_INFO,group:V.INFO},{id:U,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:H.TRACE_INFO,group:V.INFO},{id:B,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:H.TRACE_INFO,group:V.INFO},{id:$,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:H.TRACE_INFO,group:V.INFO},{id:j,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),type:H.TRACE_INFO,group:V.INFO},{id:P,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:H.TRACE_INFO,group:V.INFO},{id:q,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:H.TRACE_INFO,group:V.INFO},{id:K,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:H.TRACE_INFO,group:V.INFO},{id:Z,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:H.TRACE_INFO,group:V.INFO},{id:X,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:H.TRACE_INFO,group:V.INFO},(0,n.isNil)(o)&&{id:J,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:H.TRACE_INFO,group:V.INFO},!1];const s=[...t,...a||[]],l={};s.forEach((e=>{var t;const s=null===(t=e.traceInfo)||void 0===t?void 0:t.trace_metadata;s&&Object.keys(s).forEach((e=>{e.startsWith(re)||l[e]||(l[e]={id:me(e),label:e,type:H.TRACE_INFO,group:V.INFO})}));const n=e.targets;n&&Object.keys(n).forEach((e=>{u[e]||(u[e]={id:ae(e),label:e,type:H.EXPECTATION,group:V.EXPECTATION,expectationName:e})}))})),c=[...c,...Object.values(l)];{const e={};s.map((e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.tags})).forEach((t=>{Object.keys(t||{}).forEach((t=>{t.startsWith(re)||e[t]||(e[t]={id:ue(t),label:t,type:H.TRACE_INFO,group:V.TAG})}))}));const t=Object.values(e);c=[...c,...t]}}else c=t.some((e=>!(0,n.isNil)(e.requestTime)))?[{id:P,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:H.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...r,...c,...d,...Object.values(u)].filter((e=>Boolean(e)))}),[t,e,s,o,a,l]),ie="mlflow.sourceRun",re="mlflow.",de=e=>(null===e||void 0===e?void 0:e.trace_id)||"",ce=e=>e.split(":").pop(),ue=e=>`${W}:${e}`,me=e=>`${ee}:${e}`,pe=e=>(0,n.uniq)(e.map((e=>Object.keys(e.tags||{}).filter((e=>e&&!e.startsWith(re))))).flat()),ge=e=>{var t;var s;return{request_id:null!==(t=e.client_request_id)&&void 0!==t?t:e.trace_id,tags:(s=e.tags,s?Object.entries(s).map((([e,t])=>({key:e,value:t}))):void 0)}},ve=e=>e.length>0&&Boolean(e[0].traceInfo),fe=e=>{try{return JSON.parse(e)}catch{return e}},he=e=>{var t;return e.request_preview||e.request||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceInputs"])||""},ye=e=>{var t;return e.response_preview||e.response||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceOutputs"])||""},xe=["agent/latency_seconds"];const be=e=>{var t,s,n,o,a;const i=null===(t=e.feedback)||void 0===t?void 0:t.value,r=e.assessment_name===l.OVERALL_ASSESSMENT,d=(e=>{var t,s,n;if(null===(t=e.source)||void 0===t||!t.source_type)return;const o=null===(s=e.source)||void 0===s?void 0:s.source_type;let a;return a="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:a,sourceId:(null===(n=e.source)||void 0===n?void 0:n.source_id)||"",metadata:{}}})(e),c=(null===(s=e.feedback)||void 0===s?void 0:s.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof i?i:void 0,booleanValue:"boolean"===typeof i?i:void 0,numericValue:"number"===typeof i?i:void 0,errorCode:null===c||void 0===c?void 0:c.error_code,errorMessage:null===c||void 0===c?void 0:c.error_message,rationale:(null===(n=e.metadata)||void 0===n?void 0:n.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:r?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(a=e.metadata)||void 0===a?void 0:a.suggested_action}:void 0,metadata:e.metadata}},we=e=>{var t;const s=de(e),o=[],a={},i={};null===(t=e.assessments)||void 0===t||t.forEach((e=>{const t=e.assessment_name;xe.includes(t)||((e=>Boolean(e.expectation))(e)?function(e,t){var s,n,o;const a=e.assessment_name,l=(null===(s=e.expectation)||void 0===s?void 0:s.value)||(null===(n=e.expectation)||void 0===n||null===(o=n.serialized_value)||void 0===o?void 0:o.value);Array.isArray(l)&&l.length>0?t[a]=l.map((e=>fe(e))):t[a]="string"===typeof l?fe(l):l}(e,i):function(e,t,s){const n=e.assessment_name,o=be(e);n===l.OVERALL_ASSESSMENT&&t.push(o),s[n]||(s[n]=[]),s[n].push(o)}(e,o,a))}));const r=he(e),d=ye(e);let c=r,u={},m={};try{var p;u=JSON.parse(r);const e=u.messages;var g;if(Array.isArray(e)&&!(0,n.isNil)(null===(p=e[0])||void 0===p?void 0:p.content))c=null===(g=e[e.length-1])||void 0===g?void 0:g.content;else c=(0,I.ng)(u)}catch{u={request:r}}try{m={response:JSON.parse(d)}}catch{m={response:d}}return{evaluationId:s,requestId:e.client_request_id||s,inputsId:s,inputsTitle:c,inputs:u,outputs:m,targets:i,overallAssessments:o,responseAssessmentsByName:a,metrics:{},traceInfo:e}},Ie=e=>ve(e)?e.map((e=>{if(!e.traceInfo)return e;const t=we(e.traceInfo);return{...e,...t}})):e;const Se=(e,t)=>Object.fromEntries(Object.entries(e).map((([e,s])=>[e,s.filter((e=>{var s;return Number(null===e||void 0===e||null===(s=e.metadata)||void 0===s?void 0:s.span_output_key)===t}))])).filter((([e,t])=>t.length>0))),Te=e=>{const{traceActions:t,experimentId:s,selectedTraces:o,traceInfos:a,setRowSelection:l}=e,{table:i,selectedRowIds:r}=(0,g.useContext)(N),d=(0,g.useMemo)((()=>Ie(r.map((e=>{const t=null===a||void 0===a?void 0:a.find((t=>de(t)===e));if(t)return{evaluationId:t.trace_id,requestId:t.client_request_id||t.trace_id,inputsId:t.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:t}})).filter((e=>!(0,n.isNil)(e))))),[r,a]),c=o||d;return(0,E.Y)(Ae,{experimentId:s,selectedTraces:c,traceActions:t,setRowSelection:null!==l&&void 0!==l?l:null===i||void 0===i?void 0:i.setRowSelection})},Ae=e=>{var t,s,o;const{experimentId:a,selectedTraces:l,traceActions:i,setRowSelection:r}=e,d=(0,R.tz)(),[c,u]=(0,g.useState)(!1),m=(0,g.useCallback)((()=>{if(1===l.length&&l[0].traceInfo&&null!==i&&void 0!==i&&i.editTags){const e=ge(l[0].traceInfo);i.editTags.showEditTagsModalForTrace(e)}}),[l,i]),p=(0,g.useCallback)((()=>{u(!0)}),[]),v=(0,g.useCallback)((async(e,t)=>{var s;await(null===i||void 0===i||null===(s=i.deleteTracesAction)||void 0===s?void 0:s.deleteTraces(e,t)),null===r||void 0===r||r({})}),[r,i]),f=Boolean(null===i||void 0===i?void 0:i.exportToEvals),h=Boolean(null===i||void 0===i?void 0:i.editTags),y=Boolean(null===i||void 0===i?void 0:i.deleteTracesAction),x=(0,g.useCallback)((()=>{var e;null===i||void 0===i||null===(e=i.exportToEvals)||void 0===e||e.setShowExportTracesToDatasetsModal(!0)}),[null===i||void 0===i?void 0:i.exportToEvals]),b=null===i||void 0===i||null===(t=i.exportToEvals)||void 0===t?void 0:t.showExportTracesToDatasetsModal,w=l.length>1,I=0===l.length;if(!f&&!h&&!y)return null;const S=(0,E.Y)(A.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:I,type:"primary",endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),children:d.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:I?"":` (${l.length})`})});return(0,E.FD)(E.FK,{children:[(0,E.FD)(Y.DropdownMenu.Root,{children:[I?(0,E.Y)(_.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:d.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,E.Y)("div",{children:(0,E.Y)(Y.DropdownMenu.Trigger,{asChild:!0,children:S})})}):(0,E.Y)(Y.DropdownMenu.Trigger,{asChild:!0,children:S}),(0,E.FD)(Y.DropdownMenu.Content,{children:[f&&(0,E.Y)(E.FK,{children:(0,E.FD)(Y.DropdownMenu.Group,{children:[(0,E.Y)(Y.DropdownMenu.Label,{children:d.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,E.Y)(Y.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:x,children:d.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(h||y)&&(0,E.FD)(E.FK,{children:[f&&(0,E.Y)(Y.DropdownMenu.Separator,{}),(0,E.FD)(Y.DropdownMenu.Group,{children:[(0,E.Y)(Y.DropdownMenu.Label,{children:d.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),h&&(0,E.Y)(Y.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:m,disabled:w,children:d.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),y&&(0,E.Y)(Y.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:p,children:d.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===i||void 0===i||null===(s=i.editTags)||void 0===s?void 0:s.EditTagsModal,b&&(null===i||void 0===i||null===(o=i.exportToEvals)||void 0===o?void 0:o.renderExportTracesToDatasetsModal({selectedTraceInfos:(0,n.compact)(l.map((e=>e.traceInfo)))})),c&&(null===i||void 0===i?void 0:i.deleteTracesAction)&&(0,E.Y)(k,{experimentIds:[a],visible:c,selectedTraces:l,handleClose:()=>u(!1),deleteTraces:v})]})},Ye=[V.INFO,V.ASSESSMENT,V.EXPECTATION,V.TAG],Ce=[z,G,U,$,B,Q,Z,X],_e=[l.OVERALL_ASSESSMENT],Re=Object.fromEntries(Ye.map(((e,t)=>[e,t]))),Ee=Object.fromEntries(Ce.map(((e,t)=>[e,t]))),Ne=Object.fromEntries(_e.map(((e,t)=>[e,t])));function Me(e,t){return[...e].sort(((e,s)=>{var n,o;if(t){if(e.id===G)return-1;if(s.id===G)return 1}const a=null!==(n=e.group)&&void 0!==n?n:V.INFO,l=null!==(o=s.group)&&void 0!==o?o:V.INFO,i=Re[a]-Re[l];if(0!==i)return i;if(a===V.INFO){var r,d;const t=null!==(r=Ee[e.id])&&void 0!==r?r:1/0,n=null!==(d=Ee[s.id])&&void 0!==d?d:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}if(a===V.ASSESSMENT){var c,u;const t=null!==(c=Ne[e.id])&&void 0!==c?c:1/0,n=null!==(u=Ne[s.id])&&void 0!==u?u:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}return V.EXPECTATION,e.label.localeCompare(s.label)}))}const ke=(e,t)=>e.sort(((e,s)=>{const n=e=>{var s;const n=null===(s=t.find((t=>t.id===e.id)))||void 0===s?void 0:s.type;return n===H.INPUT?1:e.id===Q?2:n===H.TRACE_INFO?3:n===H.INTERNAL_MONITOR_REQUEST_TIME?4:n===H.ASSESSMENT?5:999},o=n(e)-n(s);if(0!==o)return o;const a=t.find((t=>t.id===e.id)),i=t.find((e=>e.id===s.id));return(null===a||void 0===a?void 0:a.type)===H.ASSESSMENT&&(null===i||void 0===i?void 0:i.type)===H.ASSESSMENT?a.id===l.OVERALL_ASSESSMENT?-1:i.id===l.OVERALL_ASSESSMENT?1:(a.label||"").localeCompare(i.label||""):0})),Fe=(e,t)=>{var s;switch(t){case P:case j:case W:case q:return e[t];case K:return e.tags;case z:return e.trace_id;case $:return null===(s=e.tags)||void 0===s?void 0:s["mlflow.trace.session"];default:throw new Error(`Unknown column id: ${t}`)}};function De(e){const t=new Map,s=new Map;return null===e||void 0===e||e.forEach((e=>{let n=ve([e])?he(e.traceInfo):e.inputsId;if(t.has(n)){const t=(s.get(e.inputsId)||0)+1;s.set(e.inputsId,t),n=`${e.inputsId}_${t}`}t.set(n,e)})),t}function Oe(e,t){if((0,n.isNil)(t))return e.map((e=>({currentRunValue:e})));const s=De(t),o=De(e),a=new Set([...o.keys(),...s.keys()]);return Array.from(a).map((e=>({currentRunValue:o.get(e),otherRunValue:s.get(e)})))}var He=s(43617),Ve=s(90061),Le=s(49460),Be=s(49708);const $e=()=>{const{theme:e}=(0,A.u)();return(0,E.FD)("span",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,E.Y)(A.k,{css:(0,T.AH)({color:e.colors.textValidationWarning},"")}),(0,E.Y)(R.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var Ue={name:"rhxkjj",styles:"height:20px"};const ze=({isComparing:e})=>{const{theme:t}=(0,A.u)();return(0,E.Y)("span",{css:Ue,children:e&&(0,E.Y)("span",{css:(0,T.AH)({fontStyle:"italic",color:t.colors.textSecondary},""),children:"null"})})},Pe=e=>{const{first:t,second:s,gap:n,borderRadius:o,marginY:a}=e,{theme:l}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:n||l.spacing.sm,borderRadius:o||l.legacyBorders.borderRadiusMd,marginTop:a||"auto",marginBottom:a||"auto"},""),children:[t,s]})};var je=s(61077),qe=s(36476);const Ke=fetch,We=async(e,t,s)=>{const n={method:t,headers:{...s?{"Content-Type":"application/json"}:{},...(0,je.KZ)(document.cookie)}};s&&(n.body=JSON.stringify(s));const o=await Ke(e,n);if(!o.ok){const e=(0,qe.a$)(o);try{const t=await(await o.json()).message;t&&(e.message=t)}catch{}throw e}return o.json()};class Qe{static getEntryPointName(e){const t=e[Qe.entryPointTag];return t?t.value:""}static getSourceType(e){const t=e[Qe.sourceTypeTag];return t?t.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const t=e.split("/");return t[t.length-1]}static formatSource(e){const t=Qe.getSourceName(e),s=Qe.getSourceType(e),n=Qe.getEntryPointName(e);if("PROJECT"===s){let e=Qe.dropExtension(Qe.baseName(t));return n&&"main"!==n&&(e+=":"+n),e}if("JOB"===s){const s="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[s]&&e[s].value,a=e&&e[n]&&e[n].value;return o&&a?Qe.getDefaultJobRunName(o,a):t}return Qe.baseName(t)}static getDefaultJobRunName(e,t,s=null){if(!e)return"-";let n=`job ${e}`;return t&&(n=`run ${t} of `+n),s&&(n=`workspace ${s}: `+n),n}static getSourceName(e){const t=e[Qe.sourceNameTag];return t?t.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getRunPageRoute(e,t){return`/experiments/${e}/runs/${t}`}static getLoggedModelPageRoute(e,t){return`/experiments/${e}/models/${t}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,t="master"){const s=e.match(Qe.getGitHubRegex()),n=e.match(Qe.getGitLabRegex()),o=e.match(Qe.getBitbucketRegex()),a=e.match(Qe.getGitRegex());let l=null;if(s)l=`https://github.com/${s[1]}/${s[2].replace(/.git/,"")}`,s[3]&&(l+=`/tree/${t}/${s[3]}`);else if(n)l=`https://gitlab.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(l+=`/-/tree/${t}/${n[3]}`);else if(o)l=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(l+=`/src/${t}/${o[3]}`);else if(a){const[,e,s,n]=a;l=e.replace(/git@/,"https://")+"/"+s.replace(/.git/,""),n&&(l+=`/tree/${t}/${n}`)}return l}static getNotebookRevisionId(e){const t="mlflow.databricks.notebookRevisionID";return e&&e[t]&&e[t].value}static getNotebookId(e){const t="mlflow.databricks.notebookID";return e&&e[t]&&e[t].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,t,s=null){if(!e)return"-";let n=`notebook ${e}`;return t&&(n=`revision ${t} of `+n),s&&(n=`workspace ${s}: `+n),n}static ensureUrlScheme(e,t="https"){return e?e.match(/^:\/\//i)?`${t}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${t}://${e}`:e}static setQueryParams(e,t){const s=new URL(Qe.ensureUrlScheme(e));return s.search=t||"",s.toString()}static getNotebookSourceUrl(e,t,s,n,o=null){let a=Qe.setQueryParams(o||window.location.origin,e);return a+=`#notebook/${t}`,s&&(a+=`/revision/${s}`,n&&(a+=`/mlflow/run/${n}`)),a}static renderNotebookSource(e,t,s,n,o,a=null,l=null){const i=o?Qe.baseName(o):Qe.getDefaultNotebookRevisionName(t,s),r=l||i;if(t){const l=Qe.getNotebookSourceUrl(e,t,s,n,a);return(0,E.Y)("a",{title:o||Qe.getDefaultNotebookRevisionName(t,s),href:l,target:"_top",children:r})}return r}static addQueryParams(e,t){if(!t||0===Object.keys(t).length)return e;const s=new URLSearchParams(e);Object.entries(t).forEach((([e,t])=>Boolean(e)&&Boolean(t)&&s.set(e,t)));const n=s.toString();return""===n||n.includes("?")?n:`?${n}`}static getJobSourceUrl(e,t,s,n=null){let o=Qe.setQueryParams(n||window.location.origin,e);return o+=`#job/${t}`,s&&(o+=`/run/${s}`),o}static renderJobSource(e,t,s,n,o=null,a=null){const l=n||Qe.getDefaultJobRunName(t,s),i=a||l;if(t){const n=Qe.getJobSourceUrl(e,t,s,o);return(0,E.Y)("a",{title:l,href:n,target:"_top",children:i})}return i}static renderSource(e,t,s,n="master"){const o=Qe.getSourceName(e);let a=Qe.formatSource(e);const l=Qe.getGitRepoUrl(o,n);l&&(a=(0,E.Y)("a",{target:"_top",href:l,children:a}));const i=Qe.getSourceType(e);if("NOTEBOOK"===i){const n=Qe.getNotebookRevisionId(e),a=Qe.getNotebookId(e),l="mlflow.databricks.workspaceID",i=e&&e[l]&&e[l].value;if(Qe.isCurrentWorkspace(i))return Qe.renderNotebookSource(t,a,n,s,o,null);{const l="mlflow.databricks.workspaceURL",r=e&&e[l]&&e[l].value,d=Qe.addQueryParams(t,{o:i});return Qe.renderNotebookSource(d,a,n,s,o,r)}}if("JOB"===i){const s="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[s]&&e[s].value,l=e&&e[n]&&e[n].value,i="mlflow.databricks.workspaceID",r=e&&e[i]&&e[i].value;if(Qe.isCurrentWorkspace(r))return Qe.renderJobSource(t,o,l,a,null);{const s="mlflow.databricks.workspaceURL",n=e&&e[s]&&e[s].value,i=Qe.addQueryParams(t,{o:r});return Qe.renderJobSource(i,o,l,a,n)}}return a}static renderSourceFromMetadata(e){var t,s,n,o,a;const l=null===(t=e.trace_metadata)||void 0===t?void 0:t[Qe.sourceNameTag],i=null===(s=e.trace_metadata)||void 0===s?void 0:s[Qe.sourceTypeTag];let r=l?Qe.baseName(l):"";const d=null===(n=e.trace_metadata)||void 0===n?void 0:n["mlflow.source.git.repoURL"],c=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],u=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(d){const e=d.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),t=u||c||"master",s=l?`/${l}`:"";let n=e;n=e.includes("github.com")?`${e}/tree/${t}${s}`:e.includes("gitlab.com")?`${e}/-/tree/${t}${s}`:e.includes("bitbucket.org")?`${e}/src/${t}${s}`:`${e}/tree/${t}${s}`,r=(0,E.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:n,children:r})}if("NOTEBOOK"===i){var m,p,g;const t=null===(m=e.trace_metadata)||void 0===m?void 0:m["mlflow.databricks.notebookRevisionID"],s=null===(p=e.trace_metadata)||void 0===p?void 0:p["mlflow.databricks.notebookID"],n=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.workspaceID"];if(Qe.isCurrentWorkspace(n))return Qe.renderNotebookSource(null,s,t,null,l,null);{var v;const o="mlflow.databricks.workspaceURL",a=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,i=Qe.addQueryParams(null,{o:n});return Qe.renderNotebookSource(i,s,t,null,l,a)}}if("JOB"===i){var f,h,y;const t=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.jobID"],s=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.jobRunID"],n=null===(y=e.trace_metadata)||void 0===y?void 0:y["mlflow.databricks.workspaceID"];if(Qe.isCurrentWorkspace(n))return Qe.renderJobSource(null,t,s,r,null);{var x;const o="mlflow.databricks.workspaceURL",a=(null===(x=e.trace_metadata)||void 0===x?void 0:x[o])||void 0,l=Qe.addQueryParams(null,{o:n});return Qe.renderJobSource(l,t,s,r,a)}}return r}}Qe.runNameTag="mlflow.runName",Qe.sourceNameTag="mlflow.source.name",Qe.sourceTypeTag="mlflow.source.type",Qe.entryPointTag="mlflow.project.entryPoint";var Ge=Qe;const Je=e=>{var t,s;const{experimentId:n,currentTraceInfo:o,otherTraceInfo:a,isComparing:l}=e,i=null===o||void 0===o||null===(t=o.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"],r=null===a||void 0===a||null===(s=a.trace_metadata)||void 0===s?void 0:s["mlflow.modelId"];return(0,E.Y)(Pe,{first:i?(0,E.Y)(tt,{experimentId:n,modelId:i,isComparing:l}):(0,E.Y)(ze,{isComparing:l}),second:l&&(r?(0,E.Y)(tt,{experimentId:n,modelId:r,isComparing:l}):(0,E.Y)(ze,{isComparing:l}))})};var Ze={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},Xe={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},et={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const tt=e=>{var t;const{experimentId:s,modelId:n,isComparing:o}=e,{theme:a}=(0,A.u)(),{data:l,isLoading:i,error:r}=st({loggedModelId:n}),d=null===l||void 0===l||null===(t=l.info)||void 0===t?void 0:t.name;return i?(0,E.Y)(Y.ParagraphSkeleton,{}):r?(0,E.Y)($e,{}):d?(0,E.Y)(_.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,E.Y)(Y.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:Ze,children:(0,E.Y)(h,{to:Ge.getLoggedModelPageRoute(s,n),target:"_blank",css:Xe,title:d,children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs,maxWidth:"100%"},""),children:[(0,E.Y)(Y.ModelsIcon,{css:(0,T.AH)({color:a.colors.textPrimary,fontSize:16},"")}),(0,E.Y)(A.T.Text,{css:et,children:d})]})})})}):(0,E.Y)(ze,{isComparing:o})},st=({loggedModelId:e})=>{const{data:t,isLoading:s,isFetching:o,refetch:a,error:l}=(0,Be.I)({queryKey:["loggedModelName",e],queryFn:async()=>await We(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,n.isNil)(e)});return{isLoading:s,isFetching:o,data:null===t||void 0===t?void 0:t.model,refetch:a,error:l}};var nt={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const ot=e=>{var t,s,n;const{experimentId:o,runUuid:a}=e,{data:l,isLoading:i,error:r}=at(o,a),d=null===l||void 0===l||null===(t=l.runs)||void 0===t||null===(s=t[0])||void 0===s||null===(n=s.info)||void 0===n?void 0:n.run_name;return i?(0,E.Y)(Y.ParagraphSkeleton,{}):r?(0,E.Y)($e,{}):d?(0,E.Y)(h,{css:nt,to:Ge.getRunPageRoute(o,a),title:d,children:d}):(0,E.Y)(ze,{})},at=(e,t)=>(0,Be.I)({queryKey:["runName",e,t],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const s=`run_id IN ('${t}')`;return await We("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:s})}});var lt=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(lt||{});const it=({sourceType:e,className:t})=>e===lt.NOTEBOOK?(0,E.Y)(Y.NotebookIcon,{className:t}):e===lt.LOCAL?(0,E.Y)(Y.HomeIcon,{className:t}):e===lt.PROJECT?(0,E.Y)(Y.FolderBranchIcon,{className:t}):e===lt.JOB?(0,E.Y)(Y.WorkflowsIcon,{className:t}):null;var rt={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const dt=e=>{var t;const s=e.traceInfo.tags,{theme:n}=(0,A.u)();if(!s)return(0,E.Y)(ze,{isComparing:e.isComparing});const o=null===(t=e.traceInfo.trace_metadata)||void 0===t?void 0:t[Ge.sourceTypeTag],a=Ge.renderSourceFromMetadata(e.traceInfo);return a&&o?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,E.Y)(it,{sourceType:o,css:(0,T.AH)({color:n.colors.textSecondary},"")}),(0,E.Y)("span",{css:rt,children:a})]}):(0,E.Y)(ze,{isComparing:e.isComparing})},ct={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,R.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,R.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,R.zR)({id:"igK5Su",defaultMessage:"Error"})},ut=(e,t)=>"IN_PROGRESS"===e?(0,E.Y)(C.C,{css:(0,T.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,E.Y)(Y.CheckCircleIcon,{css:(0,T.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,E.Y)(Y.XCircleIcon,{css:(0,T.AH)({color:t.colors.textValidationDanger},"")}):null,mt=({original:e,isComparing:t})=>{const{theme:s}=(0,A.u)(),n=(0,R.tz)(),o=ct[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center"},""),children:[ut((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",s),o?n.formatMessage(o):""]}):(0,E.Y)(ze,{isComparing:t})};var pt=s(16333);const{Paragraph:gt}=A.T;var vt={name:"s5xdrg",styles:"display:flex;align-items:center"},ft={name:"1ff36h2",styles:"flex-grow:1"};const ht=g.memo((e=>{const{theme:t}=(0,A.u)();return(0,E.Y)(_.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,E.FD)("div",{css:vt,children:[(0,E.Y)(gt,{css:ft,children:(0,E.Y)("pre",{css:(0,T.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,E.Y)("div",{css:(0,T.AH)({marginBottom:t.spacing.md},""),children:(0,E.Y)(pt.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})}));function yt(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const xt=({isClosable:e=!1,onClose:t,tag:s,enableFullViewModal:n=!1,charLimit:o=30,maxWidth:a=300,className:l})=>{const i=(0,R.tz)(),[r,d]=(0,g.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,t=30){const{key:s,value:n}=e,o=s.length+n.length,a=s.length>n.length,l=a?n.length:s.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:l>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(s,o),m=n&&(c||u),p=i.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,E.FD)("div",{children:[(0,E.Y)(Y.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:s.key,className:l,children:(0,E.Y)(_.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:m?(0,E.Y)("span",{children:p}):void 0,children:(0,E.FD)("span",{css:(0,T.AH)({maxWidth:a,display:"inline-flex"},""),onClick:()=>m?d(!0):void 0,children:[(0,E.Y)(A.T.Text,{bold:!0,title:s.key,css:yt(c),children:s.key}),s.value&&(0,E.FD)(A.T.Text,{title:s.value,css:yt(u),children:[": ",s.value]})]})})}),(0,E.Y)("div",{children:r&&(0,E.Y)(ht,{tagKey:s.key,tagValue:s.value,isKeyValueTagFullViewModalVisible:r,setIsKeyValueTagFullViewModalVisible:d})})]})};var bt={name:"1wcfv52",styles:"margin-right:0"},wt={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const It=({onAddEditTags:e,tags:t,baseComponentId:s})=>{const{theme:n}=(0,A.u)(),o=(null===t||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(re))))||[],a=o.length>0;return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:n.spacing.xs,rowGap:n.spacing.xs},""),children:[o.map((e=>(0,E.Y)(xt,{tag:e,css:bt,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key))),e&&(0,E.Y)(A.B,{componentId:`${s}.traces_table.edit_tag`,size:"small",icon:a?(0,E.Y)(Y.PencilIcon,{}):void 0,onClick:e,children:a?void 0:(0,E.Y)(R.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:wt,type:"tertiary"})]})};const St=e=>{const{currentTraceInfo:t,otherTraceInfo:s,isComparing:n}=e;return(0,E.Y)(Pe,{first:(0,E.Y)(kt,{traceInfo:t,isComparing:n}),second:n&&(0,E.Y)(kt,{traceInfo:s,isComparing:n})})};var Tt={name:"58t467",styles:"width:fit-content;max-width:100%"},At={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Yt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Ct={name:"ho1qnd",styles:"display:flex;flex-direction:row"},_t={name:"i9sky5",styles:"width:35%"},Rt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Et={name:"i9sky5",styles:"width:35%"},Nt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Mt={name:"i9sky5",styles:"width:35%"};const kt=e=>{var t;const{traceInfo:s,isComparing:n}=e,o=null===s||void 0===s||null===(t=s.trace_metadata)||void 0===t?void 0:t["mlflow.trace.tokenUsage"],a=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),l=a.total_tokens,i=a.input_tokens,r=a.output_tokens,d=(0,R.tz)();return l?(0,E.Y)(Y.HoverCard,{trigger:(0,E.Y)(Y.Tag,{css:Tt,componentId:"mlflow.genai-traces-table.tokens",children:(0,E.Y)("span",{css:At,children:l})}),content:(0,E.FD)("div",{css:Yt,children:[l&&(0,E.FD)("div",{css:Ct,children:[(0,E.Y)("div",{css:_t,children:(0,E.Y)(A.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Text,{color:"secondary",children:l})})]}),i&&(0,E.FD)("div",{css:Rt,children:[(0,E.Y)("div",{css:Et,children:(0,E.Y)(A.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Text,{color:"secondary",children:i})})]}),r&&(0,E.FD)("div",{css:Nt,children:[(0,E.Y)("div",{css:Mt,children:(0,E.Y)(A.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Text,{color:"secondary",children:r})})]})]})}):(0,E.Y)(ze,{isComparing:n})};var Ft=s(10708);var Dt={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},Ot={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const Ht=g.memo((({color:e,hidden:t})=>(0,E.Y)("label",{css:Dt,style:{backgroundColor:e,display:t?"none":""},children:(0,E.Y)("span",{css:Ot,children:e})})));var Vt=s(90081),Lt=s(87879);var Bt={name:"6dhm9o",styles:"visibility:hidden"};const $t=(e,t,s,o,a)=>{var l,i,r,d,c,u,m,p,g,v,f,h,y,x;const b=o.name,w={currentValue:(0,n.first)(null===(l=a.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[b]),otherValue:(0,n.first)(null===(i=a.otherRunValue)||void 0===i?void 0:i.responseAssessmentsByName[b])},S=(0,Vt.Yl)(o,(null===(r=a.currentRunValue)||void 0===r?void 0:r.responseAssessmentsByName[b])||[]),A=(null===(d=a.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===b,C=(null===(m=a.otherRunValue)||void 0===m||null===(p=m.overallAssessments[0])||void 0===p||null===(g=p.rootCauseAssessment)||void 0===g?void 0:g.assessmentName)===b,_=w.currentValue?(0,I.Zh)(w.currentValue):void 0,R=w.otherValue?(0,I.Zh)(w.otherValue):void 0,N=function(e,t,s){if("pass-fail"===e.dtype)return t===s?"equal":t===I.gZ.YES?"greater":t===I.gZ.NO?"less":(0,n.isNil)(s)?"equal":"less";if("boolean"===e.dtype)return t===s?"equal":!0===t?"greater":!1===t?"less":(0,n.isNil)(s)?"equal":"less";if("string"===e.dtype){if(t===s)return"equal";if(null===t)return"less";if(null===s)return"greater";const e=t,o=s;return(0,n.isNil)(e)?"less":(0,n.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(t===s)return"equal";if(null===t)return"less";if(null===s)return"greater";return t>s?"greater":"less"}return"equal"}(o,(0,n.isNil)(_)?void 0:_,(0,n.isNil)(R)?void 0:R),M=R!==_,k=I.jr[b];return(0,E.Y)("div",{css:(0,T.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:s?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Ft.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:w.currentValue,isRootCauseAssessment:A,assessmentInfo:o,type:"value"},`tag_${null===(v=a.currentRunValue)||void 0===v?void 0:v.evaluationId}_${null===(f=w.currentValue)||void 0===f?void 0:f.name}`),M&&(0,E.Y)(Y.ArrowRightIcon,{css:(0,T.AH)({transform:"greater"===N?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Ft.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:w.otherValue,isRootCauseAssessment:C,assessmentInfo:o,type:"value"},`tag_${null===(h=a.otherRunValue)||void 0===h?void 0:h.evaluationId}_${null===(y=w.currentValue)||void 0===y?void 0:y.name}`),M&&(0,E.Y)(Y.ArrowRightIcon,{css:Bt})]})]}):w.currentValue?(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:S.map((e=>{const t=e.latestAssessment,s=e.count;return(0,E.Y)(Ft.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:t,isRootCauseAssessment:A,assessmentInfo:o,type:"value",count:s},`tag_${e.latestAssessment.name}_${e.value}`)}))}):(0,E.Y)(Ft.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:A,assessmentInfo:o,assessment:{name:b,rationale:k?t.formatMessage(k):t.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${b}_${null===(x=a.currentRunValue)||void 0===x?void 0:x.evaluationId}`)})};var Ut={name:"36bnqj",styles:"display:flex;flex:1"},zt={name:"36bnqj",styles:"display:flex;flex:1"};var Pt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},jt={name:"1jwcxx3",styles:"font-style:italic"},qt={name:"zjik7",styles:"display:flex"},Kt={name:"1suksrg",styles:"width:12px;height:12px"},Wt={name:"zjik7",styles:"display:flex"},Qt={name:"1suksrg",styles:"width:12px;height:12px"};var Gt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Jt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Zt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Xt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},es={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},ts={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ss={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ns={name:"58t467",styles:"width:fit-content;max-width:100%"},os={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},as={name:"58t467",styles:"width:fit-content;max-width:100%"},ls={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},is={name:"58t467",styles:"width:fit-content;max-width:100%"},rs={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ds={name:"58t467",styles:"width:fit-content;max-width:100%"},cs={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},us={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ms={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ps={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},gs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},vs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const hs=120,ys=120;const xs=e=>{let t=e;try{var s,o;const i=JSON.parse(e).response.choices;var a,l;if(Array.isArray(i)&&!(0,n.isNil)(null===(s=i[0])||void 0===s||null===(o=s.message)||void 0===o?void 0:o.content))t=null===(a=i[0])||void 0===a||null===(l=a.message)||void 0===l?void 0:l.content;else t=(0,I.ng)(e)}catch{t=(0,I.ng)(e)}return t},bs=(e,{evaluationInputs:t,isComparing:s,theme:o,intl:a,experimentId:l,onChangeEvaluationId:i,onTraceTagsEdit:r})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case H.INPUT:return{...d,sortingFn:(t,s)=>{var n,o,a,l,i,r,d,c;const u=t.getValue(e.id),m=s.getValue(e.id),p={request:(null===(n=u.currentRunValue)||void 0===n?void 0:n.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(a=u.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(l=u.otherRunValue)||void 0===l?void 0:l.evaluationId)||""},g={request:(null===(i=m.currentRunValue)||void 0===i?void 0:i.inputs[e.id])||(null===(r=m.otherRunValue)||void 0===r?void 0:r.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/t.length,minSize:120,cell:t=>{var n;return((e,t,s,n,o,a)=>{var l,i,r,d,c,u,m,g;const v=t.getValue(),f=(null===(l=v.currentRunValue)||void 0===l?void 0:l.evaluationId)||(null===(i=v.otherRunValue)||void 0===i?void 0:i.evaluationId),h=null===(r=v.currentRunValue)||void 0===r||null===(d=r.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[ie],y=null===(u=v.otherRunValue)||void 0===u||null===(m=u.traceInfo)||void 0===m||null===(g=m.trace_metadata)||void 0===g?void 0:g[ie],x=a&&h?a(h):p.IX,b=a&&y?a(y):p.OV,w=v.currentRunValue?(0,I.Qq)(v.currentRunValue,o):void 0,S=v.otherRunValue?(0,I.Qq)(v.otherRunValue,o):void 0,Y=w||S;return(0,E.FD)("div",{css:(0,T.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:n.spacing.sm},""),children:[(0,E.Y)(A.T.Link,{css:Pt,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e(f),children:Y||(0,E.Y)("span",{css:jt,children:"null"})}),s&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,E.Y)("div",{css:qt,children:h?(0,E.Y)(Ht,{color:x}):(0,E.Y)("div",{css:Kt})}),(0,E.Y)("div",{css:Wt,children:y?(0,E.Y)(Ht,{color:b}):(0,E.Y)("div",{css:Qt})})]})]})})(i,t,s,o,e.id,null===(n=t.table.options.meta)||void 0===n?void 0:n.getRunColor)}};case H.ASSESSMENT:return{...d,accessorFn:t=>({isComparing:s,assessmentInfo:e.assessmentInfo,comparisonEntry:t}),sortingFn:(t,s)=>{const{comparisonEntry:o}=t.getValue(e.id),{comparisonEntry:a}=s.getValue(e.id);if(e.assessmentInfo){var l,i,r,d,c,u,m,p;const t={currentValue:null===(l=o.currentRunValue)||void 0===l||null===(i=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===i?void 0:i[0],otherValue:null===(r=o.otherRunValue)||void 0===r||null===(d=r.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},s={currentValue:null===(c=a.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=a.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,t,s){const o=t.currentValue?(0,I.Zh)(t.currentValue):void 0,a=s.currentValue?(0,I.Zh)(s.currentValue):void 0,l=t.otherValue?(0,I.Zh)(t.otherValue):void 0,i=s.otherValue?(0,I.Zh)(s.otherValue):void 0;if("pass-fail"===e.dtype){const e=l===I.gZ.YES&&o===I.gZ.NO,n=i===I.gZ.YES&&a===I.gZ.NO,r=l===I.gZ.NO&&o===I.gZ.YES,d=i===I.gZ.NO&&a===I.gZ.YES,c=l===I.gZ.NO&&o===I.gZ.NO,u=i===I.gZ.NO&&a===I.gZ.NO,m=l===I.gZ.YES&&o===I.gZ.YES,p=i===I.gZ.YES&&a===I.gZ.YES;return e&&!n?-1:!e&&n?1:c&&!u?-1:!c&&u?1:r&&!d?-1:!r&&d?1:m&&!p?-1:!m&&p?1:function(e,t){if(!e&&t)return 1;if(e&&!t)return-1;if(!e||!t)return 0;const s=e.stringValue===I.gZ.YES||e.stringValue!==I.gZ.NO&&void 0,n=t.stringValue===I.gZ.YES||t.stringValue!==I.gZ.NO&&void 0;if(s===n)return 0;if(void 0===s)return 1;if(void 0===n)return-1;return s?1:-1}(t.currentValue,s.currentValue)}return o===a?0:(0,n.isNil)(o)||(0,n.isNil)(a)?(0,n.isNil)(o)?-1:1:o>a?1:-1}(e.assessmentInfo,t,s)}return 0},maxSize:200,size:s?ys:hs,minSize:s?ys:hs,cell:e=>{const{isComparing:t,assessmentInfo:s,comparisonEntry:n}=e.getValue();return $t(o,a,t,s,n)}};case H.EXPECTATION:return{...d,accessorFn:t=>({isComparing:s,expectationName:e.expectationName,comparisonEntry:t}),maxSize:200,size:s?ys:hs,minSize:s?ys:hs,cell:e=>{const{isComparing:t,expectationName:s,comparisonEntry:n}=e.getValue();return((e,t,s,n,o)=>{var a,l,i,r;const d=null===(a=o.currentRunValue)||void 0===a||null===(l=a.targets)||void 0===l?void 0:l[n],c=null===(i=o.otherRunValue)||void 0===i||null===(r=i.targets)||void 0===r?void 0:r[n],u=d?(0,E.Y)(D.ExpectationValuePreview,{parsedValue:d,singleLine:!0}):(0,E.Y)(ze,{isComparing:s}),m=c?(0,E.Y)(D.ExpectationValuePreview,{parsedValue:c,singleLine:!0}):(0,E.Y)(ze,{isComparing:s});return s?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,E.Y)("div",{css:Ut,children:u}),(0,E.Y)("div",{css:zt,children:m})]}):u})(o,0,t,s,n)}};case H.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:s,comparisonEntry:e}),sortingFn:(t,s)=>{var n,o;const{comparisonEntry:a}=t.getValue(e.id),{comparisonEntry:l}=s.getValue(e.id);return((e,t,s)=>{var n,o;if(!te.includes(s))return 0;const a=String(null!==(n=Fe(e,s))&&void 0!==n?n:""),l=String(null!==(o=Fe(t,s))&&void 0!==o?o:"");return a.localeCompare(l,void 0,{numeric:!0})})(null===a||void 0===a||null===(n=a.currentRunValue)||void 0===n?void 0:n.traceInfo,null===l||void 0===l||null===(o=l.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===U?300:100,minSize:e.id===U?120:100,cell:t=>{const{isComparing:s,comparisonEntry:n}=t.getValue();return((e,t,s,n,o,a,l)=>{var i,r;const d=null===(i=n.currentRunValue)||void 0===i?void 0:i.traceInfo,c=t?null===(r=n.otherRunValue)||void 0===r?void 0:r.traceInfo:void 0;if(s===P){const e=null!==d&&void 0!==d&&d.request_time?new Date(d.request_time):void 0,s=null!==c&&void 0!==c&&c.request_time?new Date(c.request_time):void 0;return(0,E.Y)(Pe,{first:e?(0,E.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,E.Y)("span",{css:Gt,children:(0,Lt.Pt)(e)})}):(0,E.Y)(ze,{isComparing:t}),second:t&&(s?(0,E.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:s.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,E.Y)("span",{css:Jt,children:(0,Lt.Pt)(s)})}):(0,E.Y)(ze,{isComparing:t}))})}if(s===q)return(0,E.Y)(Pe,{first:(0,E.Y)(mt,{original:d,isComparing:t}),second:t&&(c?(0,E.Y)(mt,{original:c,isComparing:t}):(0,E.Y)(ze,{isComparing:t}))});if(s===K)return(0,E.Y)(Pe,{first:d?(0,E.Y)(dt,{traceInfo:d,isComparing:t}):(0,E.Y)(ze,{isComparing:t}),second:t&&(c?(0,E.Y)(dt,{traceInfo:c,isComparing:t}):(0,E.Y)(ze,{isComparing:t}))});if(s===W){const e=Object.entries((null===d||void 0===d?void 0:d.tags)||{}).map((([e,t])=>({key:e,value:t}))),s=Object.entries((null===c||void 0===c?void 0:c.tags)||{}).map((([e,t])=>({key:e,value:t}))),n=c?void 0:()=>null===l||void 0===l?void 0:l(d?ge(d):{});return(0,E.Y)(Pe,{first:(0,E.Y)(It,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:n}),second:t&&(c?(0,E.Y)(It,{baseComponentId:"tags-cell-renderer-other",tags:s}):(0,E.Y)(ze,{isComparing:t}))})}if(s.startsWith(W)){var u,m;const e=s.split(":").pop();if(!e)return(0,E.Y)(ze,{isComparing:t});const n=null===d||void 0===d||null===(u=d.tags)||void 0===u?void 0:u[e],o=null===c||void 0===c||null===(m=c.tags)||void 0===m?void 0:m[e];return(0,E.Y)(Pe,{first:n?(0,E.Y)("span",{title:n,css:Zt,children:n}):(0,E.Y)(ze,{isComparing:t}),second:t&&(o?(0,E.Y)("span",{title:n,css:Xt,children:o}):(0,E.Y)(ze,{isComparing:t}))})}if(s===Q){var p,g,v,f,h;const e=null===(p=n.currentRunValue)||void 0===p?void 0:p.evaluationId,s=null===d||void 0===d||null===(g=d.tags)||void 0===g?void 0:g["mlflow.traceName"],a=null===c||void 0===c||null===(v=c.tags)||void 0===v?void 0:v["mlflow.traceName"];return(0,E.Y)(Pe,{first:s?t?(0,E.Y)("div",{children:null===d||void 0===d||null===(h=d.tags)||void 0===h?void 0:h["mlflow.traceName"]}):(0,E.Y)(A.T.Link,{css:es,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e&&o(e),children:null===d||void 0===d||null===(f=d.tags)||void 0===f?void 0:f["mlflow.traceName"]}):(0,E.Y)(ze,{isComparing:t}),second:t&&(a?(0,E.Y)("div",{children:a}):(0,E.Y)(ze,{isComparing:t}))})}if(s===J){var y;const t=null===d||void 0===d||null===(y=d.trace_metadata)||void 0===y?void 0:y[ie];return t?(0,E.Y)(ot,{experimentId:e,runUuid:t}):(0,E.Y)(ze,{})}if(s===B){var x,b,w,S;const e=(null===d||void 0===d||null===(x=d.trace_metadata)||void 0===x?void 0:x["mlflow.trace.user"])||(null===d||void 0===d||null===(b=d.tags)||void 0===b?void 0:b["mlflow.user"]),s=(null===c||void 0===c||null===(w=c.trace_metadata)||void 0===w?void 0:w["mlflow.trace.user"])||(null===c||void 0===c||null===(S=c.tags)||void 0===S?void 0:S["mlflow.user"]);return(0,E.Y)(Pe,{first:e?(0,E.FD)("span",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:e,children:[(0,E.Y)(Y.UserIcon,{css:(0,T.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,E.Y)("span",{css:ts,children:e})]}):(0,E.Y)(ze,{isComparing:t}),second:t&&(s?(0,E.FD)("span",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:s,children:[(0,E.Y)(Y.UserIcon,{css:(0,T.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,E.Y)("span",{css:ss,children:s})]}):(0,E.Y)(ze,{isComparing:t}))})}if(s===z){const e=null===d||void 0===d?void 0:d.trace_id,s=null===c||void 0===c?void 0:c.trace_id;return(0,E.Y)(Pe,{first:e?(0,E.Y)(Y.Tag,{css:ns,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:e,onClick:()=>o(e),children:(0,E.Y)("span",{css:os,children:e})}):(0,E.Y)(ze,{isComparing:t}),second:t&&(s?(0,E.Y)(Y.Tag,{css:as,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:s,onClick:()=>o(s),children:(0,E.Y)("span",{css:ls,children:s})}):(0,E.Y)(ze,{isComparing:t}))})}if(s===$){var C,R;const e=null===d||void 0===d||null===(C=d.trace_metadata)||void 0===C?void 0:C["mlflow.trace.session"],s=null===c||void 0===c||null===(R=c.trace_metadata)||void 0===R?void 0:R["mlflow.trace.session"];return(0,E.Y)(Pe,{first:e?(0,E.Y)(Y.Tag,{css:is,componentId:"mlflow.genai-traces-table.session",title:e,children:(0,E.Y)("span",{css:rs,children:e})}):(0,E.Y)(ze,{isComparing:t}),second:t&&(s?(0,E.Y)(Y.Tag,{css:ds,componentId:"mlflow.genai-traces-table.session",title:s,children:(0,E.Y)("span",{css:cs,children:s})}):(0,E.Y)(ze,{isComparing:t}))})}if(s===U){const e=d?xs(ye(d)):"",s=c?xs(ye(c)):"";return(0,E.Y)(Pe,{first:e?(0,E.Y)("div",{css:us,title:e,children:e}):(0,E.Y)(ze,{isComparing:t}),second:t&&(s?(0,E.Y)("div",{css:ms,title:s,children:s}):(0,E.Y)(ze,{isComparing:t}))})}if(s===Z)return(0,E.Y)(Je,{experimentId:e,currentTraceInfo:d,otherTraceInfo:c,isComparing:t});if(s===X)return(0,E.Y)(St,{currentTraceInfo:d,otherTraceInfo:c,isComparing:t});if(s.startsWith(ee)){var N,M;const e=ce(s);if(!e)return(0,E.Y)(ze,{isComparing:t});const n=null===d||void 0===d||null===(N=d.trace_metadata)||void 0===N?void 0:N[e],o=null===c||void 0===c||null===(M=c.trace_metadata)||void 0===M?void 0:M[e];return(0,E.Y)(Pe,{first:n?(0,E.Y)("div",{css:ps,title:n,children:n}):(0,E.Y)(ze,{isComparing:t}),second:t&&(o?(0,E.Y)("div",{css:gs,title:o,children:o}):(0,E.Y)(ze,{isComparing:t}))})}const k=d?(0,I.ng)(Fe(d,s)):"",F=c?(0,I.ng)(Fe(c,s)):"";return(0,E.Y)(Pe,{first:k?(0,E.Y)("div",{css:vs,title:k,children:k}):(0,E.Y)(ze,{isComparing:t}),second:t&&(F?(0,E.Y)("div",{css:fs,title:F,children:F}):(0,E.Y)(ze,{isComparing:t}))})})(l,s,e.id,n,i,o,r)}};case H.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var t;return null===(t=e.currentRunValue)||void 0===t?void 0:t.requestTime},sortingFn:(t,s)=>{const n=t.getValue(e.id),o=s.getValue(e.id);return JSON.stringify(n).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const t=e.getValue();if(!t)return null;const s=new Date(t);return(0,E.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:s.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,E.Y)("span",{children:(0,Lt.Pt)(s)})})}};default:return d}};const ws=g.memo((({rows:e,isComparing:t,enableRowSelection:s,virtualItems:n,virtualizerTotalSize:o,virtualizerMeasureElement:a,selectedColumns:l})=>(0,E.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:n.map((n=>{const o=e[n.index],i=o.original.currentRunValue&&!t;return(0,E.Y)("div",{"data-index":n.index,ref:e=>a(e),style:{position:"absolute",transform:`translate3d(0, ${n.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,E.Y)(Ss,{row:o,exportableTrace:i,enableRowSelection:s,isSelected:s?o.getIsSelected():void 0,isComparing:t,selectedColumns:l})},n.key)}))}))),Is=g.memo(ws),Ss=g.memo((({row:e,exportableTrace:t,enableRowSelection:s,isComparing:n,isSelected:o,selectedColumns:a})=>{const l=e.getVisibleCells(),i=(0,R.tz)();return(0,E.Y)(E.FK,{children:(0,E.FD)(Y.TableRow,{children:[s&&(0,E.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:n?i.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):t?null:i.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,E.Y)(Y.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&t,onChange:e.getToggleSelectedHandler(),isDisabled:n||!t})}),l.map((e=>(0,E.Y)(Ts,{cell:e},e.id)))]})})})),Ts=g.memo((({cell:e})=>{const{theme:t}=(0,A.u)();return(0,E.Y)(Y.TableCell,{style:{flex:`1 1 var(--col-${(0,Lt.Mr)(e.column.id)}-size)`},css:(0,T.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${t.spacing.xs}px 0px`,width:"100%"}},""),children:(0,He.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}));const As=({overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{const l=(0,R.tz)(),{theme:i}=(0,A.u)(),r=(0,g.useMemo)((()=>function(e,t,s,n,o,a,l){var i,r;if(Object.values(t).every((e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0))))return[];const d=Object.values(t).filter((e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0)).sort(((e,t)=>t.currentNumRootCause-e.currentNumRootCause)),c=Math.max((null===(i=d[0])||void 0===i?void 0:i.currentNumRootCause)||0,(null===(r=d[0])||void 0===r?void 0:r.otherNumRootCause)||0);return d.map((t=>{var i;const r=null===(i=I.yQ[t.assessmentInfo.name])||void 0===i?void 0:i[I.gZ.NO],d=r?e.formatMessage(r):t.assessmentInfo.name,u=t.currentCounts,m=(null===u||void 0===u?void 0:u.get(I.gZ.YES))||0,p=(null===u||void 0===u?void 0:u.get(I.gZ.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,v=t.currentNumRootCause,f=m+p+g,h=t.otherCounts;let y;if(void 0!==t.otherCounts){y=((null===h||void 0===h?void 0:h.get(I.gZ.YES))||0)+((null===h||void 0===h?void 0:h.get(I.gZ.NO))||0)+((null===h||void 0===h?void 0:h.get(void 0))||0)}const x=t.otherNumRootCause||0,b=v/f,w=x/(y||1),S=(0,Lt.$h)(b),T=(0,Lt.$h)(w);return{assessment:t.assessmentInfo.name,title:d,currentInfo:{count:v,fraction:v/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:v,numEvals:f,percentage:S,assessment:t.assessmentInfo.name,currentRun:a}),toggleFilter:()=>n(t.assessmentInfo.name,"failing_root_cause","current"),isSelected:s.some((e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:S},otherInfo:o?{count:x,fraction:x/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:x,numEvals:y,percentage:T,assessment:t.assessmentInfo.name,otherRunDisplayName:l}),toggleFilter:()=>n(t.assessmentInfo.name,"rca","other"),isSelected:s.some((e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:T}:void 0,icon:(0,E.Y)(C.X,{})}}))}(l,t,s,n,Boolean(a),o,a)),[l,t,s,n,a,o]);return 0===r.length?(0,E.Y)(E.FK,{}):(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:[(0,E.Y)("div",{css:(0,T.AH)({fontWeight:i.typography.typographyBoldFontWeight},""),children:l.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:(0,E.Y)(Cs,{overallAssessmentInfo:e,rcaData:r,run:"current",runColor:a?p.IX:void 0})}),a&&(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:(0,E.Y)(Cs,{overallAssessmentInfo:e,rcaData:r,run:"other",runColor:p.OV})})]})};var Ys={name:"zjik7",styles:"display:flex"};const Cs=({rcaData:e,run:t,runColor:s,overallAssessmentInfo:n})=>{const{theme:o}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[s&&(0,E.Y)("div",{css:Ys,children:(0,E.Y)(Ht,{color:s})}),(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map(((e,s)=>{const a="current"===t?e.currentInfo:e.otherInfo;if(!a)return(0,E.Y)(E.FK,{});const l=(0,p.x2)(o,n,{stringValue:"no"});return(0,E.Y)(_.T,{content:a.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,E.Y)(E.FK,{children:(0,E.FD)("div",{style:{border:a.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,T.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:a.isSelected?(0,I.fu)(l,1):(0,I.fu)(l,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[a.count,(0,E.Y)("div",{children:e.title.toLocaleLowerCase()})]},s)})},s)}))})]})};var _s={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Rs=({assessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{var i,r;const{theme:d}=(0,A.u)(),c=(0,R.tz)();return(0,E.Y)(E.FK,{children:(0,E.FD)("div",{css:(0,T.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,E.Y)(Y.NumbersIcon,{}):"boolean"===e.dtype?(0,E.Y)(Y.BinaryIcon,{}):(0,E.Y)(E.FK,{}),(0,E.Y)(A.T.Title,{level:4,css:(0,T.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(i=e.source)||void 0===i?void 0:i.sourceType)&&(0,E.Y)(Y.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,E.Y)(Y.SparkleDoubleIcon,{css:(0,T.AH)({color:d.colors.textSecondary},"")}),(0,E.Y)(A.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(r=e.source)||void 0===r?void 0:r.sourceType)&&(0,E.Y)(Y.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,E.Y)(Y.UserIcon,{}),(0,E.Y)(A.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,E.Y)(Y.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,E.Y)(A.T.Hint,{children:(0,E.Y)(Y.BracketsXIcon,{})}),(0,E.Y)(A.T.Hint,{children:e.metricName})]})})]}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Hint,{children:e.name})})]})}),(0,E.Y)("div",{children:(0,E.Y)("span",{css:_s,children:e.description})}),e.name===l.OVERALL_ASSESSMENT&&o?(0,E.Y)("div",{children:(0,E.Y)(As,{overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})}):(0,E.Y)(E.FK,{})]})})};var Es={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Ns=g.memo((({theme:e,intl:t,assessmentInfo:s,assessmentAggregates:n,allAssessmentFilters:o,toggleAssessmentFilter:a,currentRunDisplayName:l,compareToRunDisplayName:i})=>{const r=(0,g.useMemo)((()=>(0,Vt.SA)(t,e,s,o,a,n,l,i)),[t,e,s,o,a,n,l,i]),d=(0,g.useMemo)((()=>"pass-fail"===s.dtype||"boolean"===s.dtype?r:r.map(((e,t)=>({...e,originalIndex:t}))).sort(((e,t)=>{const s="null"===e.name||e.name===Vt.J,n="null"===t.name||t.name===Vt.J;if(s&&!n)return 1;if(n&&!s)return-1;if(!s&&!n){var o,a;const s=((null===(o=t.current)||void 0===o?void 0:o.value)||0)-((null===(a=e.current)||void 0===a?void 0:a.value)||0);if(0!==s)return s}return e.originalIndex-t.originalIndex}))),[r,s]),c=d.length>4?d.slice(0,3):d,u=d.length>4?d.slice(3):[],m=u.length>0,p=e.colors.actionDefaultBackgroundHover,v=e.colors.actionDefaultBackgroundPress;return(0,E.Y)("table",{children:(0,E.FD)("tbody",{children:[c.map((t=>(0,E.Y)(Fs,{barData:t,theme:e,hoverBarColor:p,selectedBarColor:v,assessmentInfo:s},t.name))),m&&(0,E.Y)("tr",{children:(0,E.Y)("td",{colSpan:2,children:(0,E.FD)(A.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,E.Y)(A.aw.Trigger,{asChild:!0,children:(0,E.Y)("div",{css:(0,T.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:p},borderRadius:e.general.borderRadiusBase},""),children:t.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:u.length})})}),(0,E.Y)(A.aw.Content,{align:"start",side:"bottom",css:Es,children:(0,E.Y)("table",{children:(0,E.Y)("tbody",{children:u.map((t=>(0,E.Y)(Fs,{barData:t,theme:e,hoverBarColor:p,selectedBarColor:v,assessmentInfo:s},t.name)))})})})]})})})]})})}));var Ms={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},ks={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const Fs=({barData:e,theme:t,hoverBarColor:s,selectedBarColor:o,assessmentInfo:a})=>{const l=e.name===Vt.J,i="null"===e.name;return l||i?(0,E.FD)("tr",{css:(0,T.AH)({cursor:e.name!==Vt.J?"pointer":"not-allowed",":hover":{backgroundColor:s},color:e.name===Vt.J?t.colors.textValidationWarning:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm},""),onClick:e.name!==Vt.J?e.current.toggleFilter:void 0,children:[(0,E.Y)("td",{css:(0,T.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:e.name===Vt.J?"normal":"italic"},""),children:(0,E.Y)("span",{css:(0,T.AH)({lineHeight:`${t.typography.fontSizeSm}px`},""),children:e.name})}),(0,E.Y)("td",{css:(0,T.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:"normal"},""),children:(0,E.Y)("span",{css:(0,T.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?e.current.value:(0,Lt.n0)(a,e.scoreChange,!1)})})]},e.name):(0,E.FD)("tr",{css:(0,T.AH)({cursor:"pointer",":hover":{backgroundColor:s}},""),onClick:e.current.toggleFilter,children:[(0,E.Y)("td",{css:(0,T.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,E.FD)("div",{css:Ms,children:[(0,E.Y)("span",{css:(0,T.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:t.colors.textSecondary},""),children:e.name}),(0,E.Y)("div",{css:ks,children:(0,E.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,T.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,E.Y)("td",{css:(0,T.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,E.Y)("span",{css:(0,T.AH)({color:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?(0,Lt.vw)(a,e.current.fraction):(0,Lt.n0)(a,e.scoreChange)})})]},e.name)};var Ds={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Os={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},Hs={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Vs={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ls={name:"18ubt2d",styles:"width:25%"},Bs={name:"ho1qnd",styles:"display:flex;flex-direction:row"},$s={name:"18ubt2d",styles:"width:25%"};const Us=g.memo((({numericAggregate:e})=>{const{theme:t}=(0,A.u)(),s=(0,R.tz)();return(0,E.FD)("div",{css:Ds,children:[(0,E.Y)("div",{css:Os,children:e.counts.map(((n,o)=>(0,E.Y)(Y.HoverCard,{content:(0,E.FD)("div",{css:Hs,children:[(0,E.FD)("div",{css:Vs,children:[(0,E.Y)("div",{css:Ls,children:(0,E.Y)(A.T.Text,{children:s.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Text,{color:"secondary",children:(0,Lt.BM)(n.lower,2)===(0,Lt.BM)(n.upper,2)?(0,Lt.BM)(n.lower,2):`${(0,Lt.BM)(n.lower,2)} - ${(0,Lt.BM)(n.upper,2)}`})})]}),(0,E.FD)("div",{css:Bs,children:[(0,E.Y)("div",{css:$s,children:(0,E.Y)(A.T.Text,{children:s.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,E.Y)("div",{children:(0,E.Y)(A.T.Text,{color:"secondary",children:n.count})})]})]}),trigger:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:(0,E.Y)("div",{css:(0,T.AH)({height:n.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:t.colors.blue400,borderTopRightRadius:t.general.borderRadiusBase,borderTopLeftRadius:t.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o)))}),e.min===e.max?(0,E.Y)("div",{css:(0,T.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:(0,Lt.BM)(e.min,2)}):(0,E.FD)("div",{css:(0,T.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[(0,E.Y)("div",{children:(0,Lt.BM)(e.min,2)}),(0,E.Y)("div",{children:(0,Lt.BM)(e.max,2)})]})]})})),zs=g.memo((({theme:e,intl:t,assessmentInfo:s,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r,collapsedHeader:d})=>{const c=(0,g.useMemo)((()=>"pass-fail"===s.dtype?t.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===s.dtype?t.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===s.dtype?t.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===s.dtype?t.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0),[s,t]),{displayScore:u,displayScoreChange:m,changeDirection:v}=(0,g.useMemo)((()=>(0,Lt.p$)(t,s,o)),[t,s,o]);return"unknown"===s.dtype?null:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,E.Y)("div",{css:(0,T.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,E.Y)("div",{css:(0,T.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:u}),!(0,n.isNil)(m)&&r&&(0,E.Y)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:p.G8,backgroundColor:"none"===v?"":"up"===v?p.YH.up:"down"===v?p.YH.down:(0,I.fu)(e.colors.textSecondary,.1)},""),children:m})]})]}),!d&&((0,n.isNil)(o.currentNumericAggregate)?(0,E.Y)(Ns,{theme:e,intl:t,assessmentInfo:s,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r}):(0,E.Y)(Us,{numericAggregate:o.currentNumericAggregate}))]})}));var Ps={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},js={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},qs={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const Ks=g.memo((({enableRowSelection:e,enableGrouping:t,selectedAssessmentInfos:s,assessmentNameToAggregates:o,assessmentFilters:a,toggleAssessmentFilter:l,runDisplayName:i,compareToRunUuid:r,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:m,isComparing:p,headerGroups:v,allRowSelected:f,someRowSelected:h,toggleAllRowsSelectedHandler:y,setColumnSizing:x})=>{const{theme:b}=(0,A.u)(),w=(0,R.tz)(),[I,S]=(0,g.useState)(!1),C=t?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${b.colors.border}`}}:{};return(0,E.Y)(E.FK,{children:v.map(((g,A)=>(0,E.FD)(Y.TableRow,{isHeader:!0,css:(0,T.AH)({position:"sticky",top:40*A,zIndex:100,...t&&{"& > *":{borderBottom:0===A?"none":void 0}},...A===v.length-1&&{borderBottom:`1px solid ${I?b.colors.blue500:b.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,E.Y)("div",{css:0===s.length&&1===A?{}:C,children:(0,E.Y)(Y.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:f,indeterminate:h,onChange:y(),checkboxLabel:w.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===A,isDisabled:p})}),g.headers.map((e=>{if(e.isPlaceholder)return null;const m=s.find((t=>oe(t.name)===e.id)),p=e.isPlaceholder?null:(0,E.Y)("div",{css:Ps,title:String((0,He.Kv)(e.column.columnDef.header,e.getContext())),children:(0,He.Kv)(e.column.columnDef.header,e.getContext())}),g=m&&!c?(0,E.Y)(Y.HoverCard,{content:(0,E.Y)(E.FK,{children:(0,E.Y)(Rs,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,runUuid:i,compareToRunUuid:r?d:void 0})}),trigger:p},e.id):(0,n.isNil)(p)?null:p;return(0,E.Y)(Y.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,T.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===s.length&&1===A?{}:C},""),style:{flex:`${e.colSpan} 1 var(--header-${(0,Lt.Mr)(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:x,children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs},""),children:[g,(0,E.Y)("div",{css:(0,T.AH)({borderTop:!t&&s.length>0?`1px solid ${b.colors.border}`:"",width:"100%"},""),children:m&&(0,E.Y)(zs,{theme:b,intl:w,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r?d:void 0,collapsedHeader:u})})]})},e.column.id)})),A===v.length-1&&(0,E.FD)("div",{css:js,children:[(0,E.Y)("div",{css:(0,T.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:b.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,E.Y)("div",{css:qs,onClick:()=>m(!u),onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:(0,E.Y)("div",{css:(0,T.AH)({width:"22px",height:"22px",borderRadius:"50%",background:b.colors.backgroundPrimary,border:`2px solid ${b.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:b.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:I?1:.5},""),children:(0,E.Y)(Y.ChevronDownIcon,{css:(0,T.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:b.colors.textSecondary},"")})})})]})]},g.id)))})})),Ws=e=>{const{theme:t}=(0,A.u)(),s=(0,R.tz)(),{groupId:n,visibleCount:o,totalCount:a,enableGrouping:l}=e.column.columnDef.meta;if(!l)return L[n];const i=L[n];return(0,E.FD)("div",{css:(0,T.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:t.spacing.sm},""),children:[(0,E.Y)("div",{children:i}),n===V.INFO?null:o===a?(0,E.FD)("div",{css:(0,T.AH)({color:t.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",a,")"]}):(0,E.Y)(Y.HoverCard,{trigger:(0,E.FD)("div",{css:(0,T.AH)({color:t.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",a,")"]}),content:s.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:a,groupName:i}),align:"start"})]})};var Qs=s(38086);var Gs={name:"49aokf",styles:"display:contents"};const Js=({history:e,alwaysExpanded:t=!1})=>{const{theme:s}=(0,A.u)(),o=(0,R.tz)(),[a,l]=(0,g.useState)(new Date);(0,g.useEffect)((()=>{const e=setInterval((()=>{l(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);const i=(0,g.useMemo)((()=>e.reduce(((t,s,n)=>{const o=e[n+1];return o?[...t,[s,o]]:t}),[])),[e]),{makeHTML:r}=(0,Qs.N)(),d=(0,g.useMemo)((()=>{var t;const s=null===(t=(0,n.first)(e))||void 0===t?void 0:t.rationale;return(0,n.isString)(s)?r(s):null}),[e,r]);var c,u,m;if(!i.length)return null!==(c=(0,n.first)(e))&&void 0!==c&&c.rationale?(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:(0,E.Y)("span",{css:Gs,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,n.first)(e))&&void 0!==u&&u.errorMessage?(0,E.Y)(E.FK,{children:(0,E.Y)(A.T.Text,{color:"error",children:null===(m=(0,n.first)(e))||void 0===m?void 0:m.errorMessage})}):(0,E.Y)(E.FK,{children:!t&&(0,E.FD)("div",{children:[(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)(A.T.Hint,{children:(0,E.Y)(R.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const p=e=>{const t=(0,I.Zh)(e),s=I.yQ[e.name];if(s&&!(0,n.isNil)(t)){var o;const e=null!==(o=s[t.toString()])&&void 0!==o?o:s.default;if(e)return(0,E.Y)(R.sA,{...e,values:{value:t}})}return t};return(0,E.FD)(E.FK,{children:[(0,E.Y)(_.S,{size:"sm"}),i.map((([e,n],l)=>{var i,r;const d=p(n),c=p(e),u=d===c,m=(0,I.CH)(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):(0,Lt.Pt)(e.timestamp,a);return(0,E.FD)("div",{css:(0,T.AH)({marginBottom:t?void 0:s.spacing.md},""),children:[(0,E.FD)(A.T.Hint,{css:(0,T.AH)({marginBottom:s.spacing.xs},""),children:[d&&c&&(0,E.FD)(E.FK,{children:[(0,E.Y)("code",{children:p(n)})," \u2192 ",(0,E.Y)("code",{children:p(e)})," "]}),u?(0,E.Y)(R.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(i=e.source)||void 0===i?void 0:i.sourceId}}):(0,E.Y)(R.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(r=e.source)||void 0===r?void 0:r.sourceId}})]}),e.rationale&&(0,E.Y)(A.T.Text,{children:e.rationale})]},`${e.timestamp}-${l}`)}))]})},Zs=({assessmentHistory:e,children:t,disable:s=!1})=>{const o=(0,R.tz)(),a=(0,g.useMemo)((()=>e.some(I.hG)),[e]),[l,i]=(0,g.useState)(new Date);(0,g.useEffect)((()=>{const e=setInterval((()=>{i(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);return(0,E.Y)(_.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:s?void 0:(0,E.Y)("span",{children:(()=>{const t=(0,n.first)(e);if(!t)return;if((0,I.w_)(t)){var s,i;const n=e[1],a=n?null===(s=(0,I.Zh)(n))||void 0===s?void 0:s.toString():void 0,c=(0,I.CH)(t)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):(0,Lt.Pt)(t.timestamp,l);if(a){var r,d;const e=null===(r=I.yQ[t.name])||void 0===r?void 0:r[a],s=e?o.formatMessage(e):a;return(0,E.Y)(R.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===t||void 0===t||null===(d=t.source)||void 0===d?void 0:d.sourceId,value:s}})}return(0,E.Y)(R.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===t||void 0===t||null===(i=t.source)||void 0===i?void 0:i.sourceId}})}return a?(0,E.Y)(R.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==t&&void 0!==t&&t.errorMessage?null===t||void 0===t?void 0:t.errorMessage:(0,E.Y)(R.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:t})},Xs=({editedAssessment:e,valueSuggestions:t,onSave:s,onCancel:n,readOnly:o=!1})=>{var a;const{theme:l}=(0,A.u)(),i=(0,R.tz)(),[r,d]=(0,g.useState)((()=>(null===e||void 0===e?void 0:e.rationale)||void 0)),[c,u]=(0,g.useState)(""),[m,p]=(0,g.useState)((()=>{if(e){var s;const o=null===(s=(0,I.Zh)(e))||void 0===s?void 0:s.toString();var n;return o?null!==(n=t.find((e=>e.key===o)))&&void 0!==n?n:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}})),[v,f]=(0,g.useState)(!1),h=(0,g.useMemo)((()=>t.filter((e=>e.label.toLowerCase().includes(c.toLowerCase())))),[c,t]),y=v?t:h,x=c||y.length>0,b=(0,Y.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:t,items:y,setItems:()=>{},setInputValue:e=>{f(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:m,initialSelectedItem:m,initialInputValue:null!==(a=null===m||void 0===m?void 0:m.label)&&void 0!==a?a:"",formOnChange:e=>{(null===m||void 0===m?void 0:m.label)!==e&&p("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&f(!0)}}),w=i.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,E.FD)("div",{children:[(0,E.FD)(Y.TypeaheadComboboxRoot,{comboboxState:b,children:[(0,E.Y)(Y.TypeaheadComboboxInput,{readOnly:o,css:(0,T.AH)({width:300,backgroundColor:l.colors.backgroundPrimary},""),placeholder:i.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===b.highlightedIndex&&"Enter"===e.key&&b.closeMenu()},comboboxState:b,formOnChange:e=>{p(e)}}),x&&(0,E.Y)(Y.TypeaheadComboboxMenu,{comboboxState:b,emptyText:w,matchTriggerWidth:!0,children:y.map(((e,t)=>(0,E.Y)(Y.TypeaheadComboboxMenuItem,{item:e,index:t,comboboxState:b,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${t}`)))})]}),(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)("div",{css:(0,T.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.general.borderRadiusBase},""),children:(0,E.Y)(C.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==r&&void 0!==r?r:"",onChange:e=>d(e.target.value),placeholder:i.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,E.Y)(_.S,{size:"sm"}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:l.spacing.xs},""),children:[(0,E.Y)(A.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var t,n;if(!m)return;const o=null!==(t=null!==(n=m.rootAssessmentName)&&void 0!==n?n:null===e||void 0===e?void 0:e.name)&&void 0!==t?t:m.key,a=o===m.key||m.key;s({value:a,rationale:r,assessmentName:o})},disabled:!(null!==m&&void 0!==m&&m.key),children:(0,E.Y)(R.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,E.Y)(A.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:n,children:(0,E.Y)(R.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},en=(e,t)=>{const s=(0,R.tz)(),[n,o]=(0,g.useState)(void 0),[a,l]=(0,g.useState)(!1),[i,r]=(0,g.useState)([]),d=(0,g.useCallback)(((n,a)=>{o(a),l(n),r((0,I.rU)(s,a,e,t))}),[s,t,e]),c=(0,g.useCallback)((e=>d(!0,e)),[d]);return{suggestions:i,editingAssessment:n,showUpsertForm:a,addAssessment:(0,g.useCallback)((()=>d(!0,void 0)),[d]),editAssessment:c,closeForm:(0,g.useCallback)((()=>{o(void 0),l(!1)}),[])}};var tn={name:"49aokf",styles:"display:contents"};const sn=({assessmentsType:e,assessmentName:t,assessmentHistory:s,rootCauseAssessment:o,onUpsertAssessment:a,allowEditing:l=!1,options:i,inputs:r,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,A.u)(),m=(0,R.tz)(),p="overall"===e,{suggestions:v,editingAssessment:f,showUpsertForm:h,editAssessment:y,closeForm:x}=en(s,c);(0,g.useEffect)((()=>{x()}),[r,x]);const b=(0,n.first)(s),w=I.c9[t],S=w?m.formatMessage(w):t,C=Boolean(b&&(0,I.Zh)(b)),_=Boolean(b&&(0,I.CH)(b)),N=l&&(C||_),{makeHTML:M}=(0,Qs.N)(),k=(0,g.useMemo)((()=>{var e;const t=null===b||void 0===b||null===(e=b.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,n.isString)(t)?M(t):null}),[b,M]);return(0,E.FD)("div",{css:(0,T.AH)({display:"block",marginBottom:p?void 0:u.spacing.md},""),children:[!h&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[t!==I._1.OVERALL_ASSESSMENT&&(0,E.Y)("div",{css:(0,T.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,E.Y)(Ft.m,{assessment:b,"aria-label":S,disableJudgeTypeIcon:(0,I.xO)(b),onEdit:N?()=>{const e=(0,n.first)(s);e&&y(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,E.Y)(Js,{history:s,alwaysExpanded:p}),o&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.BugIcon,{color:"danger"}),(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,E.Y)(Ft.m,{assessment:o,isRootCauseAssessment:!0,"aria-label":S,assessmentInfo:d,type:"assessment-value"})]}),(0,E.Y)(Js,{history:[o],alwaysExpanded:p}),k&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.AssistantIcon,{color:"ai"}),(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,E.Y)("span",{css:tn,dangerouslySetInnerHTML:{__html:k}})]})]})]}),h&&(0,E.Y)(E.FK,{children:(0,E.Y)(Xs,{editedAssessment:f,valueSuggestions:v,onCancel:x,onSave:({value:e,rationale:t,assessmentName:s})=>{var n;const o=p?I._1.OVERALL_ASSESSMENT:"",l=(0,I.aj)({name:null!==(n=null!==s&&void 0!==s?s:null===f||void 0===f?void 0:f.name)&&void 0!==n?n:o,isOverallAssessment:p,value:e,rationale:t});a(l),x()}},null===f||void 0===f?void 0:f.name)})]},t)};var nn={name:"eivff4",styles:"display:none"};const on=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,options:l,inputs:i,assessmentInfos:r})=>{const{theme:d}=(0,A.u)(),c="overall"===e,u=t.filter((([e,t])=>t.length>0)),{suggestions:m,editingAssessment:p,showUpsertForm:v,addAssessment:f,closeForm:h}=en(u.flatMap((([e,t])=>t)),r);(0,g.useEffect)((()=>{h()}),[i,h]);const y=Object.keys(u).length>0,x=o&&(a||!y);return(0,E.FD)(E.FK,{children:[(0,E.FD)("div",{css:(0,T.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map((([t,a])=>{const d=r.find((e=>e.name===t));return d?(0,E.Y)(sn,{assessmentsType:e,assessmentName:t,assessmentHistory:a,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o,options:l,inputs:i,assessmentInfo:d,assessmentInfos:r},t):(0,E.Y)("div",{css:nn},t)})),x&&(0,E.Y)(A.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:f,icon:(0,E.Y)(Y.PlusIcon,{}),size:"small",children:(0,E.Y)(R.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,E.FD)(E.FK,{children:[(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)(Xs,{valueSuggestions:m,onCancel:h,onSave:({value:e,rationale:t,assessmentName:s})=>{var o;const a=c?I._1.OVERALL_ASSESSMENT:s||"",l=(0,I.aj)({name:null!==(o=null!==s&&void 0!==s?s:null===p||void 0===p?void 0:p.name)&&void 0!==o?o:a,isOverallAssessment:c,value:e,rationale:t});n(l),h()}})]})]})};var an={name:"49aokf",styles:"display:contents"};const ln=({assessmentsType:e,assessmentsByName:t,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:a=!1,options:l,inputs:i,assessmentInfos:r})=>{const{theme:d}=(0,A.u)(),c=(0,R.tz)(),u="overall"===e,{suggestions:m,editingAssessment:p,showUpsertForm:v,addAssessment:f,editAssessment:h,closeForm:y}=en(t.flatMap((([e,t])=>t)),r);(0,g.useEffect)((()=>{y()}),[i,y]);const x=t.filter((([e,t])=>t.length>0)),b=Object.keys(x).length>0,w=o&&(a||!b);return(0,E.FD)(E.FK,{children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[x.map((([e,t])=>{const s=(0,n.first)(t),a=r.find((t=>t.name===e));if(!a)return(0,E.Y)(E.FK,{});const l=I.c9[e],i=l?c.formatMessage(l):e,d=Boolean(s&&(0,I.Zh)(s)),u=Boolean(s&&(0,I.CH)(s)),m=o&&(d||u)&&a.isEditable;return(0,E.Y)("div",{css:an,children:(0,E.Y)(Zs,{assessmentHistory:t,children:(0,E.Y)(Ft.m,{assessment:s,"aria-label":i,active:(null===p||void 0===p?void 0:p.name)===e&&v,disableJudgeTypeIcon:(0,I.xO)(s),onEdit:m?()=>{const e=(0,n.first)(t);e&&h(e)}:void 0,assessmentInfo:a,type:"assessment-value"})})},e)})),w&&(0,E.Y)(A.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:f,icon:(0,E.Y)(Y.PlusIcon,{}),size:"small",children:(0,E.Y)(R.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,E.FD)(E.FK,{children:[(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)(Xs,{editedAssessment:p,valueSuggestions:m,onCancel:y,onSave:({value:e,rationale:t,assessmentName:n})=>{var o;const a=u?I._1.OVERALL_ASSESSMENT:n||"",l=(0,I.aj)({name:null!==(o=null!==n&&void 0!==n?n:null===p||void 0===p?void 0:p.name)&&void 0!==o?o:a,isOverallAssessment:u,value:e,rationale:t});s(l),y()}},null===p||void 0===p?void 0:p.name)]})]})},rn=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,alwaysExpanded:l=!1,options:i,inputs:r,assessmentInfos:d})=>{const[c,u]=(0,g.useState)(!1),m=l||c,p=t.filter((([e,t])=>t.length>0));let v=t;"overall"!==e&&(v=t.filter((([e,t])=>e!==I._1.OVERALL_ASSESSMENT)));const f=Object.keys(p).length>0;return(0,E.FD)(E.FK,{children:[m&&(0,E.Y)(on,{assessmentsType:e,assessmentsByName:v,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:r,assessmentInfos:d}),!m&&(0,E.Y)(ln,{assessmentsType:e,assessmentsByName:v,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:r,assessmentInfos:d}),f&&!l&&(0,E.FD)(E.FK,{children:[(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)(A.B,{size:"small",type:"tertiary",componentId:`mlflow.evaluations_review.see_assessment_details_${e}_button`,icon:m?(0,E.Y)(Y.ChevronUpIcon,{}):(0,E.Y)(A.o,{}),onClick:()=>u((e=>!e)),children:m?(0,E.Y)(R.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,E.Y)(R.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},dn=({toBeReviewed:e,containsOverallAssessment:t,isNextResultAvailable:s,overridingExistingReview:n,hasPendingAssessments:o,onClickNext:a,onSave:l,onCancelOverride:i})=>e?o?(0,E.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:l,children:(0,E.Y)(R.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):n?(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:i,children:(0,E.Y)(R.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,E.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:l,disabled:!t,children:(0,E.Y)(R.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,E.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:a,endIcon:(0,E.Y)(A.o,{}),disabled:!s,children:(0,E.Y)(R.sA,{id:"CBnbqy",defaultMessage:"Next"})}),cn=()=>{const{theme:e}=(0,A.u)();return(0,E.Y)("div",{css:(0,T.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var un={name:"1d3w5wq",styles:"width:100%"},mn={name:"82a6rk",styles:"flex:1"};const pn=({evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i=!1,pendingAssessments:r=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:p}=(0,A.u)(),g=(0,R.tz)();if(!e)return null;const v=(0,n.first)(e.overallAssessments),f=null===v||void 0===v||null===(m=v.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,h=f?(0,n.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[f]):void 0,y=!c&&(!(0,I.vP)(e)||i),x=g.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),b=[[I._1.OVERALL_ASSESSMENT,e.overallAssessments]],w=u.find((e=>e.name===I._1.OVERALL_ASSESSMENT));return(0,E.FD)("div",{css:un,children:[(0,E.FD)("div",{css:(0,T.AH)({width:"100%",paddingLeft:p.spacing.md,paddingRight:p.spacing.md},""),children:[(0,E.FD)("div",{css:(0,T.AH)({backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:[w&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:p.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.SparkleDoubleIcon,{color:"ai"}),(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,E.Y)(Ft.m,{assessment:v,"aria-label":I._1.OVERALL_ASSESSMENT,disableJudgeTypeIcon:(0,I.xO)(v),assessmentInfo:w,type:"assessment-value"})]}),(0,E.Y)(rn,{assessmentsType:"overall",assessmentsByName:b,rootCauseAssessment:h,onUpsertAssessment:t,allowEditing:y,alwaysExpanded:!0,options:[I._1.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,E.FD)("div",{css:(0,T.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,padding:p.spacing.sm},""),children:[(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,E.Y)(_.S,{size:"sm"}),(0,E.Y)(rn,{assessmentsType:"response",assessmentsByName:(0,I.Xe)(e.responseAssessmentsByName),onUpsertAssessment:t,allowEditing:y,allowMoreThanOne:!0,options:I.PB,assessmentInfos:u})]})]}),(0,E.FD)("div",{css:(0,T.AH)({position:"sticky",backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:p.spacing.sm,zIndex:p.options.zIndexBase},""),children:[(0,E.Y)("div",{children:!y&&!c&&(0,E.FD)("div",{css:(0,T.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,display:"flex",alignItems:"center",gap:p.spacing.sm,padding:`${p.spacing.xs}px ${p.spacing.sm}px`},""),children:[(0,E.Y)(Y.CheckCircleIcon,{css:(0,T.AH)({color:p.colors.textValidationSuccess},"")}),(0,E.Y)(A.T.Hint,{children:(0,E.Y)(R.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,E.Y)(_.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:x,children:(0,E.Y)(A.B,{"aria-label":x,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,E.Y)(Y.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,E.Y)("div",{css:mn}),r.length>0&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm},""),children:[(0,E.Y)(R.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:r.length}}),(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:a,children:(0,E.Y)(R.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,E.Y)(dn,{onSave:async()=>{await s(),d(!1)},containsOverallAssessment:Boolean(v),isNextResultAvailable:Boolean(l),onClickNext:o,toBeReviewed:y,hasPendingAssessments:r.length>0,overridingExistingReview:i,onCancelOverride:()=>d(!1)})]})]}),(0,E.Y)(_.S,{size:"md"})]})},gn=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i=!1,pendingAssessments:r=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,E.Y)(pn,{evaluationResult:e,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:r,isReadOnly:c,assessmentInfos:u}),t&&(0,E.FD)(E.FK,{children:[(0,E.Y)(cn,{}),(0,E.Y)(pn,{evaluationResult:t,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:r,isReadOnly:!0,assessmentInfos:u})]})]})},vn=({requestId:e,onClose:t,trace:s})=>{const{theme:o}=(0,A.u)(),a=(0,E.Y)(A.T.Title,{level:2,withoutMargins:!0,children:e});return(0,E.Y)(Y.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||t()},children:(0,E.Y)(Y.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:a,expandContentToFullHeight:!0,children:(()=>{const e=s.data.spans.length>0;return(0,n.isNil)(s)||!e?(0,E.FD)(E.FK,{children:[(0,E.Y)(_.S,{size:"lg"}),(0,E.Y)(Y.Empty,{description:null,title:(0,E.Y)(R.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,E.Y)("div",{css:(0,T.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,E.Y)(D.ModelTraceExplorer,{modelTrace:s})})})()})})};var fn={name:"1d3w5wq",styles:"width:100%"};const hn=({experimentId:e,runDisplayName:t,evaluationResult:s,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:a,getTrace:l})=>{var i,r;const d=(0,R.tz)(),{theme:c}=(0,A.u)(),[u,m]=(0,g.useState)(null),p=null===(i=s.traceInfo)||void 0===i||null===(r=i.trace_metadata)||void 0===r?void 0:r["databricks.tracingserver.dropped_spans_size_bytes"];let v;if(!(0,n.isNil)(p)){const e=2,t=(0,Lt.SF)(Number(p),e);v=`${t.value} ${t.unit}`}return(0,E.FD)("div",{css:fn,children:[(0,E.FD)("div",{css:(0,T.AH)({width:"100%",paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,E.Y)(A.T.Title,{level:4,children:t}),s.requestId&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&l&&(0,E.Y)(Te,{experimentId:e,selectedTraces:[s],traceInfos:void 0}),(0,E.Y)(_.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:p?`The trace spans were not stored due to their large size: ${v}`:void 0,side:"left",children:(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>m(s.requestId),loading:a.isLoading,disabled:!(0,n.isNil)(p),children:(0,E.Y)(R.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,n.isNil)(a.data)?(0,E.Y)(E.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,E.Y)(vn,{onClose:()=>{m(null)},requestId:u,trace:a.data}))]}),(0,E.Y)(_.S,{size:"md"})]})},yn=({experimentId:e,runDisplayName:t,otherRunDisplayName:s,evaluationResult:n,otherEvaluationResult:o,exportToEvalsInstanceEnabled:a=!1,traceQueryResult:l,compareToTraceQueryResult:i})=>{const{theme:r}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",gap:r.spacing.sm},""),children:[(0,E.Y)(hn,{experimentId:e,runDisplayName:t,evaluationResult:n,exportToEvalsInstanceEnabled:a,traceQueryResult:l}),s&&o&&(0,E.FD)(E.FK,{children:[(0,E.Y)(cn,{}),(0,E.Y)(hn,{experimentId:e,runDisplayName:s,evaluationResult:o,exportToEvalsInstanceEnabled:a,traceQueryResult:i})]})]})};var xn={name:"1739oy8",styles:"z-index:1"};const bn=({copyText:e,showLabel:t=!0,componentId:s,...n})=>{const[o,a]=(0,g.useState)(!1);return(0,E.Y)(Y.LegacyTooltip,{title:(0,E.Y)(R.sA,{id:"X+boXI",defaultMessage:"Copied"}),dangerouslySetAntdProps:{visible:o},children:(0,E.Y)(A.B,{componentId:null!==s&&void 0!==s?s:"mlflow.shared.copy_button",type:"primary",onClick:()=>{navigator.clipboard.writeText(e),a(!0),setTimeout((()=>{a(!1)}),3e3)},onMouseLeave:()=>{a(!1)},css:xn,children:t?(0,E.Y)(R.sA,{id:"1Iq+NW",defaultMessage:"Copy"}):void 0,...n})})},wn=({value:e})=>{const t=(0,g.useMemo)((()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}return null}),[e]);return(0,E.Y)("div",{css:(0,T.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:t?"monospace":void 0},""),children:t||String(e)})};var In={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Sn={name:"1nko30q",styles:"margin-bottom:0 !important"},Tn={name:"49aokf",styles:"display:contents"};const An=({fieldName:e,title:t,value:s,showCopyIcon:o})=>{const{theme:a}=(0,A.u)(),{makeHTML:l}=(0,Qs.N)(),i=(0,g.useMemo)((()=>(0,n.isString)(s)?l(s):null),[s,l]),r=(0,g.useMemo)((()=>(0,n.isString)(s)?null:(0,I.ng)(s)),[s]);return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,flex:1,border:`1px solid ${a.colors.border}`,padding:a.spacing.md,borderRadius:a.general.borderRadiusBase,marginBottom:a.spacing.md},""),children:[(0,E.FD)("div",{css:In,children:[(0,E.Y)(A.T.Text,{bold:!0,children:t}),o&&(0,E.Y)(bn,{copyText:(0,I.ng)(s),showLabel:!1,type:"tertiary",icon:(0,E.Y)(Y.CopyIcon,{})})]}),(0,E.Y)(A.T.Paragraph,{css:Sn,children:(0,n.isString)(s)?(0,E.Y)("span",{css:Tn,dangerouslySetInnerHTML:{__html:null!==i&&void 0!==i?i:""}}):e===I.UN&&Array.isArray(s)?(0,E.Y)("ul",{children:s.map(((e,t)=>(0,E.Y)("li",{children:(0,E.Y)(wn,{value:e},t)},t)))}):(0,E.Y)(wn,{value:r})})]})},Yn=({evaluationResult:e})=>{const{theme:t}=(0,A.u)(),{inputs:s}=e,n=Object.entries(s),o=0===n.length;return(0,E.FD)("div",{css:(0,T.AH)({width:"100%",paddingLeft:t.spacing.md,paddingRight:t.spacing.md},""),children:[(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:n.length}})}),(0,E.Y)(_.S,{size:"sm"}),o&&(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)(R.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),n.map((([e,t])=>(0,E.Y)(An,{fieldName:e,title:e,value:t},e)))]})},Cn=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:s}=(0,A.u)(),n=(null===e||void 0===e?void 0:e.inputsId)===(null===t||void 0===t?void 0:t.inputsId);return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",gap:s.spacing.sm},""),children:[e&&(0,E.Y)(Yn,{evaluationResult:e}),!n&&t&&(0,E.Y)(Yn,{evaluationResult:t})]})};var _n={name:"82a6rk",styles:"flex:1"},Rn={name:"82a6rk",styles:"flex:1"};const En=({evaluationResult:e})=>{const{theme:t}=(0,A.u)(),{outputs:s,targets:n}=e,o=Object.entries(s).filter((([,e])=>!(0,I.Wp)(e))),a=Object.entries(n).filter((([,e])=>!(0,I.Wp)(e))),l=0===o.length&&0===a.length;return(0,E.FD)("div",{css:(0,T.AH)({paddingLeft:t.spacing.md,paddingRight:t.spacing.md,width:"100%"},""),children:[(0,E.Y)(A.T.Text,{bold:!0,children:(0,E.Y)(R.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,E.Y)(_.S,{size:"sm"}),l&&(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)(R.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:t.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,E.Y)("div",{css:_n,children:o.map((([e,t])=>{const s=I.eB[e],n=s?(0,E.Y)(R.sA,{...s}):e;return(0,E.Y)(An,{fieldName:e,title:n,value:t,showCopyIcon:!0},e)}))}),a.length>0&&(0,E.Y)("div",{css:Rn,children:a.map((([e,t])=>{const s=I.Au[e],n=s?(0,E.Y)(R.sA,{...s}):e;return(0,E.Y)(An,{fieldName:e,title:n,value:t,showCopyIcon:!0},e)}))})]})]})},Nn=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:s}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",gap:s.spacing.sm},""),children:[e&&(0,E.Y)(En,{evaluationResult:e}),t&&(0,E.FD)(E.FK,{children:[(0,E.Y)(cn,{}),(0,E.Y)(En,{evaluationResult:t})]})]})},Mn=({assessment:e,chunkRelevanceAssessmentInfo:t})=>{const{theme:s}=(0,A.u)();return e||t?(0,E.Y)("div",{css:(0,T.AH)({paddingLeft:s.spacing.sm,paddingRight:s.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:t?(0,p.x2)(s,t,e):"",borderRadius:s.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,E.Y)(E.FK,{children:(0,I.w_)(e)?(0,E.Y)(Y.UserIcon,{}):(0,E.Y)(Y.SparkleDoubleIcon,{})}):(0,E.Y)(Y.QuestionMarkIcon,{})}):(0,E.Y)(E.FK,{})};function kn(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}}var Fn={name:"s5xdrg",styles:"display:flex;align-items:center"};const Dn=({chunk:e,index:t})=>(0,E.FD)("div",{css:Fn,children:[(0,E.FD)(Y.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",t+1]}),kn(e.docUrl)?(0,E.Y)(A.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,E.Y)(A.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var On={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},Hn={name:"49aokf",styles:"display:contents"};const Vn=({evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:s=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:l})=>{const{theme:i}=(0,A.u)(),r=(0,R.tz)(),[d,c]=(0,g.useState)(0),{makeHTML:u}=(0,Qs.N)(),m=(0,g.useMemo)((()=>!(0,n.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:function(e,t){var s,o;if((0,n.isNil)(t))return;let a="doc_uri";const l=t.info.tags;if(null!==l&&void 0!==l&&l.retrievers){const e=fe(l.retrievers);"object"===typeof e&&e.length>0&&(a=e[0].doc_uri)}const i=t.data.spans.filter((e=>{var t,s;return(null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"])&&fe(null===(s=e.attributes)||void 0===s?void 0:s["mlflow.spanType"])===D.ModelTraceSpanType.RETRIEVER}));if(0===i.length)return[];const r=null===(s=i.at(-1))||void 0===s||null===(o=s.attributes)||void 0===o?void 0:o["mlflow.spanOutputs"];if(!r)return[];const d=fe(r);return Array.isArray(d)?d.map(((t,s)=>{var n;return{docUrl:null===(n=t.metadata)||void 0===n?void 0:n[a],content:t.page_content,retrievalAssessmentsByName:Se(e,s)}})):[]}(e.responseAssessmentsByName,l.data)),[e.responseAssessmentsByName,e.retrievalChunks,l.data]),p=(0,g.useMemo)((()=>{var e;return u(null===m||void 0===m||null===(e=m[d])||void 0===e?void 0:e.content)}),[m,d,u]),v=0===(m||[]).length,f=!o&&(!(0,I.vP)(e)||s),h=null===m||void 0===m?void 0:m[d],y=r.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,E.FD)("div",{css:(0,T.AH)({paddingLeft:i.spacing.md,paddingRight:i.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":y,children:[(0,E.Y)(A.T.Text,{bold:!0,children:y}),(0,n.isNil)(m)&&l.isFetching?(0,E.Y)(Y.TableSkeleton,{lines:3}):v?(0,E.Y)(A.T.Text,{children:(0,E.Y)("i",{children:(0,E.Y)(R.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,E.FD)("div",{css:(0,T.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:i.spacing.sm,border:`1px solid ${i.colors.border}`,borderRadius:i.general.borderRadiusBase},""),children:[(0,E.FD)("div",{css:(0,T.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:i.spacing.sm,borderRight:`1px solid ${i.colors.border}`},""),role:"listbox",children:[v&&(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)(R.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(m||[]).map(((e,t)=>{var s,o;const l=a.find((e=>e.name===I._1.CHUNK_RELEVANCE));return(0,E.FD)("div",{role:"option","aria-label":null===(s=e.content)||void 0===s?void 0:s.slice(0,255),"aria-selected":t===d,css:(0,T.AH)({backgroundColor:t===d?i.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:i.colors.actionIconBackgroundHover},padding:`${i.spacing.sm}px ${i.spacing.md}px`,overflow:"hidden",display:"flex",gap:i.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(t)},children:[(0,E.Y)(Mn,{chunkRelevanceAssessmentInfo:l,assessment:(0,n.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[I._1.CHUNK_RELEVANCE])}),(0,E.Y)(A.T.Text,{ellipsis:!0,css:(0,T.AH)({flex:1,lineHeight:i.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,t].join("-"))}))]}),h&&(0,E.FD)("div",{css:On,children:[(0,E.FD)("div",{css:(0,T.AH)({padding:i.spacing.md,borderBottom:`1px solid ${i.colors.border}`},""),children:[(0,E.Y)(Dn,{chunk:h,index:d}),(0,E.Y)(_.S,{size:"md"}),(0,E.Y)(rn,{assessmentsType:"retrieval",assessmentsByName:(0,I.Xe)(h.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[I.bz.CHUNK_INDEX]=d,t(e)},allowEditing:f,allowMoreThanOne:!0,options:I.ER,inputs:[d],assessmentInfos:a})]}),(0,E.Y)("div",{css:(0,T.AH)({padding:i.spacing.md,overflow:"auto"},""),children:(0,E.Y)(A.T.Paragraph,{children:(0,E.Y)("span",{css:Hn,dangerouslySetInnerHTML:{__html:null!==p&&void 0!==p?p:""}})})})]})]})]})},Ln=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:s,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:l,compareToTraceQueryResult:i})=>{const{theme:r}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",gap:r.spacing.sm},""),children:[e&&(0,E.Y)(Vn,{evaluationResult:e,onUpsertAssessment:s,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:l}),t&&(0,E.FD)(E.FK,{children:[(0,E.Y)(cn,{}),(0,E.Y)(Vn,{evaluationResult:t,onUpsertAssessment:s,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:i})]})]})};var Bn={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const $n=({evaluationResult:e})=>{const{theme:t}=(0,A.u)();return(0,E.Y)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,overflow:"hidden"},""),children:(0,E.Y)(A.T.Title,{level:2,withoutMargins:!0,css:Bn,children:(0,I.sw)(e)})})},Un=({experimentId:e,evaluationResult:t,otherEvaluationResult:s,onSavePendingAssessments:o,onClickNext:a,runDisplayName:l,compareToRunDisplayName:i,isNextAvailable:r=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p})=>{(0,R.tz)();const{pendingAssessments:v,draftEvaluationResult:f,upsertAssessment:h,resetPendingAssessments:y}=(e=>{const[t,s]=(0,g.useReducer)(((e,t)=>{switch(t.type){case"resetPendingAssessments":return[];case"upsertAssessment":const s=e.find((e=>e.name===t.payload.name&&(0,I.Pp)(e)===(0,I.Pp)(t.payload)));return s?e.map((e=>e===s?""===(0,I.Zh)(e)&&t.payload.stringValue?{...t.payload,stringValue:"",name:t.payload.stringValue}:t.payload:e)):[t.payload,...e]}}),[]),o=(0,g.useMemo)((()=>{if(!e)return[];const s=t.find(I.hG);return s?[s,...e.overallAssessments]:e.overallAssessments}),[e,t]),a=(0,g.useMemo)((()=>{if(!e)return{};const s=(0,n.uniq)([...Object.keys(e.responseAssessmentsByName),...t.filter((e=>!(0,I.hG)(e)&&!(0,I.II)(e))).map((e=>e.name))]);return Object.fromEntries(s.map((s=>{const n=t.filter((e=>e.name===s));return[s,[...n,...e.responseAssessmentsByName[s]||[]]]})))}),[e,t]),l=(0,g.useMemo)((()=>{var s;const o=t.filter(I.II);return null===(s=e.retrievalChunks)||void 0===s?void 0:s.map(((e,t)=>{var s;const a=o.filter((e=>{var s;return(null===(s=e.metadata)||void 0===s?void 0:s[I.bz.CHUNK_INDEX])===t})),l=(0,n.flatMap)(null!==(s=e.retrievalAssessmentsByName)&&void 0!==s?s:{}),i=(0,n.groupBy)([...a,...l],"name");return Object.keys(i).forEach((e=>{i[e]=(0,n.orderBy)(i[e],"timestamp","desc")})),{...e,retrievalAssessmentsByName:i}}))}),[t,e]),i=(0,g.useMemo)((()=>({...e,overallAssessments:o,responseAssessmentsByName:a,retrievalChunks:l})),[e,o,a,l]),r=(0,g.useCallback)((e=>s({type:"upsertAssessment",payload:e})),[]),d=(0,g.useCallback)((()=>s({type:"resetPendingAssessments"})),[]);return{pendingAssessments:t,draftEvaluationResult:i,upsertAssessment:r,resetPendingAssessments:d}})(t),[x,b]=(v.length,(0,g.useState)(!1)),w=Boolean(t.errorCode),S=Boolean(t.errorMessage),T=w||S,[C,N]=(0,g.useState)(!1);return(0,E.FD)(E.FK,{children:[T?(0,E.FD)(E.FK,{children:[(0,E.Y)(Y.Alert,{action:S&&(0,E.Y)(A.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${C?"less":"more"}_button`,onClick:()=>N((e=>!e)),children:C?(0,E.Y)(R.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,E.Y)(R.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:w?`${t.errorCode}`:"UNKNOWN_ERROR",description:C&&`${t.errorMessage}`,type:"error"}),(0,E.Y)(_.S,{size:"md"})]}):null,(0,E.Y)(yn,{experimentId:e,runDisplayName:l,otherRunDisplayName:i,evaluationResult:t,otherEvaluationResult:s,exportToEvalsInstanceEnabled:c,traceQueryResult:m,compareToTraceQueryResult:p}),(0,E.Y)(gn,{evaluationResult:f,otherEvaluationResult:s,onUpsertAssessment:h,onClickNext:a,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(t,v)),y()},isNextAvailable:r,overridingExistingReview:x,setOverridingExistingReview:b,pendingAssessments:v,onResetPendingAssessments:y,isReadOnly:d,assessmentInfos:u}),(0,E.Y)(Cn,{evaluationResult:t,otherEvaluationResult:s}),(0,E.Y)(Nn,{evaluationResult:t,otherEvaluationResult:s}),(0,E.Y)(Ln,{evaluationResult:f,otherEvaluationResult:s,onUpsertAssessment:h,overridingExistingReview:x,isReadOnly:d,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p}),(0,E.Y)(_.S,{size:"lg"})]})};var zn={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},Pn={name:"1tc6xju",styles:"flex:1;overflow:auto"};const jn=({experimentId:e,evaluation:t,otherEvaluation:s,className:n,runUuid:o,isReadOnly:a=!1,selectNextEval:l,isNextAvailable:i,runDisplayName:r,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p,saveAssessmentsQuery:v})=>{const{theme:f}=(0,A.u)(),h=(0,g.useCallback)((async(e,t)=>{if(!e||a||!o||!v)return;const s=t.slice();if((0,I.ik)(e,t)){const t=(0,I.YZ)(e);t&&s.unshift(t)}return v.savePendingAssessments(o,e.evaluationId,s)}),[o,a,v]),y=(0,g.useRef)(null);return(0,g.useEffect)((()=>{var e;null===(e=y.current)||void 0===e||e.scrollTo(0,0)}),[t.evaluationId]),(0,E.FD)("div",{css:zn,className:n,children:[(0,E.Y)("div",{css:Pn,ref:y,children:(0,E.Y)(Un,{experimentId:e,evaluationResult:t,otherEvaluationResult:s,onSavePendingAssessments:h,onClickNext:l,isNextAvailable:i,isReadOnly:a||!o,runDisplayName:r,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p},t.evaluationId)}),(null===v||void 0===v?void 0:v.isSaving)&&(0,E.Y)("div",{css:(0,T.AH)({inset:0,position:"absolute",backgroundColor:f.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:f.options.zIndexBase+1},""),children:(0,E.Y)(A.S,{size:"large",inheritColor:!0,css:(0,T.AH)({color:f.colors.backgroundPrimary},"")})})]})},qn=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=!1)&&e}},Kn=(0,g.createContext)(qn()),Wn=({config:e={},children:t})=>{const s=qn(),o=(0,n.merge)({},s,e);return(0,E.Y)(Kn.Provider,{value:o,children:t})};function Qn(e,t){return(0,Be.I)({queryKey:["getTrace",t],queryFn:()=>e&&t?e(t):Promise.resolve(void 0),enabled:!(0,n.isNil)(e)&&!(0,n.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})}var Gn={name:"inxa61",styles:"flex:1;overflow:hidden"};const Jn=g.memo((({experimentId:e,runUuid:t,evaluations:s,selectedEvaluationId:o,onChangeEvaluationId:a,runDisplayName:l,otherRunDisplayName:i,exportToEvalsInstanceEnabled:r=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var m,p,v,f,h,y,x,b,w;const{theme:I,classNamePrefix:S}=(0,A.u)(),C=(0,g.useCallback)((()=>{a(void 0)}),[a]),R=(0,g.useCallback)((e=>{var t,s;return(null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)===o||(null===(s=e.otherRunValue)||void 0===s?void 0:s.evaluationId)===o}),[o]),N=(0,g.useMemo)((()=>s?(null===s||void 0===s?void 0:s.findIndex(R))-1:void 0),[s,R]),M=(0,g.useMemo)((()=>void 0!==N&&N>=0),[N]),k=(0,g.useMemo)((()=>s?(null===s||void 0===s?void 0:s.findIndex(R))+1:void 0),[s,R]),F=(0,g.useMemo)((()=>void 0!==k&&k<s.length),[k,s]),D=(0,g.useCallback)((()=>{var e,t,n,o;if(null===s||void 0===N)return;const l=(null===(e=s[N])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(n=s[N])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(l)}),[s,N,a]),O=(0,g.useCallback)((()=>{var e,t,n,o;if(null===s||void 0===k)return;const l=(null===(e=s[k])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(n=s[k])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(l)}),[s,k,a]),H=(0,g.useMemo)((()=>null===s||void 0===s?void 0:s.find(R)),[s,R]),V=(0,g.useMemo)((()=>k&&s?null===s||void 0===s?void 0:s[k]:void 0),[s,k]),L=(0,g.useMemo)((()=>N&&s?null===s||void 0===s?void 0:s[N]:void 0),[s,N]),B=(0,g.useContext)(Kn)||qn(),$=Qn(c,null===H||void 0===H||null===(m=H.currentRunValue)||void 0===m||null===(p=m.traceInfo)||void 0===p?void 0:p.trace_id),U=Qn(c,null===H||void 0===H||null===(v=H.otherRunValue)||void 0===v||null===(f=v.traceInfo)||void 0===f?void 0:f.trace_id);Qn(c,null===V||void 0===V||null===(h=V.currentRunValue)||void 0===h||null===(y=h.traceInfo)||void 0===y?void 0:y.trace_id),Qn(c,null===L||void 0===L||null===(x=L.currentRunValue)||void 0===x||null===(b=x.traceInfo)||void 0===b?void 0:b.trace_id);const z=Boolean(null===H||void 0===H?void 0:H.currentRunValue)!==Boolean(null===H||void 0===H?void 0:H.otherRunValue),P=o===(null===H||void 0===H||null===(w=H.currentRunValue)||void 0===w?void 0:w.evaluationId)?$:U;return(0,n.isNil)(H)?(0,E.Y)(E.FK,{}):(0,E.FD)("div",{onKeyDown:e=>{"ArrowLeft"===e.key?D():"ArrowRight"===e.key&&O()},children:[(0,E.FD)(_.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:H.currentRunValue?(0,E.Y)($n,{evaluationResult:H.currentRunValue}):H.otherRunValue?(0,E.Y)($n,{evaluationResult:H.otherRunValue}):null,onCancel:C,size:"wide",verticalSizing:"maxed_out",css:(0,T.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${S}-modal-body`]:{flex:1,paddingTop:0},[`& .${S}-modal-header`]:{paddingBottom:I.spacing.sm}},""),footer:null,children:[P.isFetching&&(0,E.Y)(Y.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:I.colors.backgroundPrimary}}),z&&!(0,n.isNil)(P.data)?(0,E.Y)("div",{css:(0,T.AH)({height:"100%",marginLeft:-I.spacing.lg,marginRight:-I.spacing.lg},""),children:(0,E.Y)(Zn,{traceData:P.data})}):H.currentRunValue&&(0,E.Y)(jn,{experimentId:e,evaluation:H.currentRunValue,otherEvaluation:H.otherRunValue,selectNextEval:O,isNextAvailable:F,css:Gn,runUuid:t,isReadOnly:!B.enableRunEvaluationWriteFeatures,runDisplayName:l,compareToRunDisplayName:i,exportToEvalsInstanceEnabled:r,assessmentInfos:d,traceQueryResult:$,compareToTraceQueryResult:U,saveAssessmentsQuery:u})]}),(0,E.Y)("div",{css:(0,T.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,E.Y)("div",{css:(0,T.AH)({backgroundColor:I.colors.backgroundPrimary,borderRadius:I.legacyBorders.borderRadiusMd,marginRight:I.spacing.sm},""),children:(0,E.Y)(A.B,{disabled:!M,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,E.Y)(A.n,{}),onClick:()=>D()})})}),(0,E.Y)("div",{css:(0,T.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,E.Y)("div",{css:(0,T.AH)({backgroundColor:I.colors.backgroundPrimary,borderRadius:I.legacyBorders.borderRadiusMd,marginLeft:I.spacing.sm},""),children:(0,E.Y)(A.B,{disabled:!F,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,E.Y)(A.o,{}),onClick:()=>O()})})})]})})),Zn=({traceData:e})=>(0,E.Y)(D.ModelTraceExplorer,{modelTrace:e}),Xn=g.memo((({experimentId:e,selectedColumns:t,evaluations:s,selectedEvaluationId:o,selectedAssessmentInfos:a,assessmentInfos:l,assessmentFilters:i,tableSort:r,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:m,compareToRunUuid:p,compareToRunDisplayName:v,rowSelection:f,setRowSelection:h,exportToEvalsInstanceEnabled:y=!1,getTrace:x,toggleAssessmentFilter:b,saveAssessmentsQuery:w,disableAssessmentTooltips:I,onTraceTagsEdit:S,enableRowSelection:_,enableGrouping:M=!1,allColumns:k})=>{const F=(0,R.tz)(),{theme:D}=(0,A.u)(),[O,L]=(0,g.useState)(!1),B=!(0,n.isNil)(p),U=t.filter((e=>e.type===H.INPUT)),{columns:z}=(0,g.useMemo)((()=>{if(!M){const s=t.map((t=>bs(t,{evaluationInputs:U,isComparing:B,theme:D,intl:F,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:S})));return{columns:ke(s,t)}}const s=new Map;Me(t,B).forEach((t=>{const n=t.group||V.INFO;s.has(n)||s.set(n,[]),(s.get(n)||[]).push(bs(t,{evaluationInputs:U,isComparing:B,theme:D,intl:F,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:S}))}));const n=Array.from(s.entries()).map((([e,t])=>({header:Ws,meta:{groupId:e,visibleCount:t.length,totalCount:k.filter((t=>t.group===e)).length,enableGrouping:M},id:`${e}-group`,columns:t})));return{columns:n}}),[t,U,B,d,D,F,e,S,M,k]),{setTable:j,setSelectedRowIds:q}=g.useContext(N),K=(0,He.N4)({data:s,columns:z,getCoreRowModel:(0,Ve.HT)(),getSortedRowModel:(0,Ve.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:_,enableMultiSort:!0,state:{rowSelection:f},meta:{getRunColor:c},onRowSelectionChange:h,getRowId:e=>{return(null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||"";var t}}),W=void 0!==f&&K.getIsAllRowsSelected(),Q=K.getIsSomeRowsSelected();(0,g.useEffect)((()=>(j(K),()=>j(void 0))),[K,j]),(0,g.useEffect)((()=>{_&&q(K.getSelectedRowModel().rows.map((e=>e.id)))}),[K,f,q,_]);const G=F.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),J=(0,E.Y)(Y.Empty,{description:G,image:(0,E.Y)(C.S,{})});(0,g.useEffect)((()=>{r&&!se.includes(r.key)?r.key===$?K.setSorting([{id:r.key,desc:!r.asc},{id:P,desc:!1}]):K.setSorting([{id:r.key,desc:!r.asc}]):K.setSorting([])}),[r,K]);const{rows:Z}=K.getRowModel(),X=g.useRef(null),ee=(0,Le.Te)({count:Z.length,estimateSize:()=>120,getScrollElement:()=>X.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),te=ee.getVirtualItems(),ne=K.getHeaderGroups(),{columnSizeVars:oe,tableWidth:ae}=(0,g.useMemo)((()=>{const e={};ne.forEach((t=>{t.headers.forEach((t=>{e[`--header-${(0,Lt.Mr)(t.column.id)}-size`]=t.getSize()+"px"}))}));let t=0;if(Z.length>0){Z[0].getVisibleCells().forEach((s=>{e[`--col-${(0,Lt.Mr)(s.column.id)}-size`]=s.column.getSize()+"px",t+=s.column.getSize()}))}return{columnSizeVars:e,tableWidth:t+"px"}}),[ne,Z]),le=(0,g.useMemo)((()=>{const e={};for(const t of a)e[t.name]=(0,Vt.pY)(t,s,i);return e}),[a,s,i]);return(0,E.FD)(E.FK,{children:[(0,E.Y)("div",{className:"container",ref:X,css:(0,T.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:ae},""),children:(0,E.FD)(Y.Table,{css:(0,T.AH)({width:"100%",...oe},""),empty:0===K.getRowModel().rows.length?J:void 0,someRowsSelected:_?Q||W:void 0,children:[(0,E.Y)(Ks,{headerGroups:K.getHeaderGroups(),enableRowSelection:_,enableGrouping:M,selectedAssessmentInfos:a,assessmentNameToAggregates:le,assessmentFilters:i,toggleAssessmentFilter:b,runDisplayName:m,compareToRunUuid:p,compareToRunDisplayName:v,disableAssessmentTooltips:I,collapsedHeader:O,setCollapsedHeader:L,isComparing:B,allRowSelected:W,someRowSelected:Q,toggleAllRowsSelectedHandler:K.getToggleAllRowsSelectedHandler,setColumnSizing:K.setColumnSizing}),(0,E.Y)(Is,{rows:Z,isComparing:B,enableRowSelection:_,virtualItems:te,virtualizerTotalSize:ee.getTotalSize(),virtualizerMeasureElement:ee.measureElement,rowSelectionState:f,selectedColumns:t})]})}),o&&(0,E.Y)(Jn,{experimentId:e,runUuid:u,runDisplayName:m,otherRunDisplayName:v,evaluations:Z.map((e=>e.original)),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:y,assessmentInfos:l,getTrace:x,saveAssessmentsQuery:w})]})}));function eo({searchQuery:e,setSearchQuery:t}){const s=(0,R.tz)(),[n,o]=(0,g.useState)(e);return(0,g.useEffect)((()=>{o(e)}),[e]),(0,g.useEffect)((()=>{const e=setTimeout((()=>{t(n)}),400);return()=>clearTimeout(e)}),[n,t]),(0,E.Y)(Y.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:s.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:n,onChange:e=>o(e.target.value)})}const to="mlflow.evaluations_review.table_ui.compare_to_run_combobox",so="mlflow.evaluations_review.table_ui.filter_form",no="mlflow.evaluations_review.table_ui.column_filter_combobox",oo=({columns:e,selectedColumns:t,setSelectedColumns:s,setSelectedColumnsWithHiddenColumns:n})=>{const o=(0,R.tz)(),{theme:a}=(0,A.u)();return(0,E.FD)(Y.DialogCombobox,{componentId:no,label:"Columns",multiSelect:!0,children:[(0,E.Y)(Y.DialogComboboxCustomButtonTriggerWrapper,{children:(0,E.Y)(A.B,{endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,E.Y)(Y.DialogComboboxContent,{children:(0,E.Y)(Y.DialogComboboxOptionList,{children:e.map((e=>(0,E.Y)(Y.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>(e=>{if(n)return n([e]);s&&s((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))})(e)},e.id)))})})]})};var ao={name:"9q39xd",styles:"min-width:32px"};const lo=g.memo((({tableSort:e,columns:t=[],onChange:s,enableGrouping:n,isMetadataLoading:o,metadataError:a})=>{const l=(0,R.tz)(),{theme:i}=(0,A.u)(),[r,d]=(0,g.useState)(!1),c=(0,g.useMemo)((()=>{const e=[],s=l.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(n){const s=Me(t);for(const t of s)if(t.type===H.ASSESSMENT){const s=t.assessmentInfo.displayName;e.push({label:s,key:t.id,type:H.ASSESSMENT,group:V.ASSESSMENT})}else if(t.type===H.INPUT)e.push({label:t.label,key:t.id,type:H.INPUT,group:V.INFO});else if(t.type===H.TRACE_INFO){const s=t.id===$?l.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):t.label;te.includes(t.id)&&e.push({label:s,key:t.id,type:H.TRACE_INFO,group:V.INFO})}return e}for(const n of t.filter((e=>e.type===H.ASSESSMENT))){const t=n.assessmentInfo.displayName;e.push({label:`${s} \ufe65 ${t}`,key:n.id,type:H.ASSESSMENT})}const o=l.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const n of t.filter((e=>e.type===H.INPUT)))e.push({label:`${o} \ufe65 ${n.label}`,key:n.id,type:H.INPUT});for(const n of t.filter((e=>(e.type===H.TRACE_INFO||e.type===H.INTERNAL_MONITOR_REQUEST_TIME)&&te.includes(e.id))))e.push({label:n.label,key:n.id,type:H.TRACE_INFO});return e}),[t,l,n]),u=(0,g.useMemo)((()=>{const t=c.find((t=>t.key===(null===e||void 0===e?void 0:e.key)));let s=null===t||void 0===t?void 0:t.label;if(!s){var n;const t=null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.match(/^.+\.`(.+)`$/);t&&(s=t[1])}const o=l.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return s?`${o}: ${s}`:o}),[c,l,e]);return(0,E.FD)(Y.DropdownMenu.Root,{open:r,onOpenChange:d,modal:!1,children:[(0,E.Y)(Y.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,E.Y)(A.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,E.Y)(Y.SortAscendingIcon,{}):(0,E.Y)(Y.SortDescendingIcon,{}):(0,E.Y)(Y.SortUnsortedIcon,{}),css:ao,"aria-label":u,endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),children:u})}),(0,E.Y)(Y.DropdownMenu.Content,{minWidth:250,children:a?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,E.Y)(A.k,{}),(0,E.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,E.Y)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.lg}px`,color:i.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,E.Y)(A.S,{size:"small"})}):n?(0,E.Y)(ro,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{s(e,t),d(!1)}}):(0,E.Y)(mo,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{s(e,t),d(!1)}})})]})}));var io={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const ro=({sortOptions:e,tableSort:t,onOptionSelected:s})=>{const{theme:n}=(0,A.u)(),o=(0,g.useRef)(null),a=(0,g.useRef)(null),[l,i]=(0,g.useState)(""),r=(0,g.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(l.toLowerCase())))),[e,l]),d=(0,g.useMemo)((()=>{const e={};return r.forEach((t=>{var s;const n=null!==(s=t.group)&&void 0!==s?s:V.INFO;e[n]||(e[n]=[]),e[n].push(t)})),e}),[r]),c=(0,g.useCallback)((n=>{var o;const a=e.find((e=>e.key===n));a&&s(a,null===(o=null===t||void 0===t?void 0:t.asc)||void 0===o||o)}),[s,e,null===t||void 0===t?void 0:t.asc]),u=(0,g.useCallback)((n=>{var o;const a=null!==(o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key))))&&void 0!==o?o:e[0];s(a,n)}),[s,e,null===t||void 0===t?void 0:t.key]);return(0,g.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}))}),[]),(0,E.FD)(E.FK,{children:[(0,E.FD)("div",{css:(0,T.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px`,display:"flex",gap:n.spacing.xs},""),children:[(0,E.Y)(C.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,E.Y)(C.S,{}),placeholder:"Search",value:l,onChange:e=>i(e.target.value),type:"search",onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(t=a.current)||void 0===t||t.focus(),e.preventDefault())}}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,E.Y)(Y.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,E.Y)(Y.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,E.Y)(Y.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,E.Y)(Y.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,E.FD)("div",{css:(0,T.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${n.spacing.sm}px`},""),children:[Object.entries(d).map((([e,s],n)=>(0,E.Y)(g.Fragment,{children:(0,E.FD)(Y.DropdownMenu.Group,{children:[(0,E.Y)(Y.DropdownMenu.Label,{children:e===V.INFO?"Attributes":L[e]}),s.map(((e,s)=>(0,E.FD)(Y.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===t||void 0===t?void 0:t.key),onClick:()=>c(e.key),ref:0===n&&0===s?a:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,E.Y)(Y.DropdownMenu.ItemIndicator,{}),(0,E.Y)("span",{css:io,children:e.label})]},e.key)))]})},e))),0===r.length&&(0,E.Y)(Y.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,E.Y)(R.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var co={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},uo={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const mo=({sortOptions:e,tableSort:t,onOptionSelected:s})=>{const{theme:n}=(0,A.u)(),o=(0,g.useRef)(null),[a,l]=(0,g.useState)(""),i=(0,g.useRef)(null),r=(0,g.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))),[e,a]),d=(0,g.useCallback)((n=>{const o=e.find((e=>e.key===n));s(o,(null===t||void 0===t?void 0:t.asc)||!0)}),[s,t,e]),c=(0,g.useCallback)((n=>{const o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key)));s(o||e[0],n)}),[s,e,t]);return(0,g.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}))}),[]),(0,E.FD)(E.FK,{children:[(0,E.FD)("div",{css:(0,T.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px ${n.spacing.sm}px`,width:"100%",display:"flex",gap:n.spacing.xs},""),children:[(0,E.Y)(C.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,E.Y)(C.S,{}),value:a,type:"search",onChange:e=>l(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=i.current)||void 0===t||t.focus()}}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,E.Y)(Y.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,E.Y)(Y.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,E.Y)(Y.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,E.Y)(Y.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,E.FD)(Y.DropdownMenu.Group,{css:co,children:[r.map(((e,s)=>(0,E.FD)(Y.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===t||void 0===t?void 0:t.key),"data-testid":`sort-select-${e.label}`,ref:0===s?i:void 0,children:[(0,E.Y)(Y.DropdownMenu.ItemIndicator,{}),(0,E.Y)("span",{css:uo,children:e.label})]},e.key))),!r.length&&(0,E.Y)(Y.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,E.Y)(R.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},po=({backgroundColor:e,icon:t,children:s})=>{const{theme:n}=(0,A.u)();return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:n.spacing.xs,borderRadius:n.borders.borderRadiusMd,color:n.colors.textSecondary,backgroundColor:e||n.colors.backgroundSecondary,fontSize:n.typography.fontSizeSm},""),children:[t||null,s?(0,E.Y)("span",{children:s}):null]})},go="selectedEvaluationId",vo=()=>{var e;const[t,s]=f(),n=null!==(e=t.get(go))&&void 0!==e?e:void 0,o=(0,g.useCallback)((e=>{s((t=>void 0===e?(t.delete(go),t):(t.set(go,e),t)))}),[s]);return[n,o]},fo="searchQuery";function ho(e,t,s,o,a){return e.filter((e=>function(e,t,s,o){const a=null===e||void 0===e?void 0:e.currentRunValue,l=null===e||void 0===e?void 0:e.otherRunValue;let i=!0;for(const m of t){var r,d;const e=m.assessmentName,t=m.filterValue,p=m.run,g=p===s?a:p===o?l:void 0;if(void 0===g)continue;const v=e===I._1.OVERALL_ASSESSMENT?null===(r=g.overallAssessments)||void 0===r?void 0:r[0]:null===(d=g.responseAssessmentsByName[e])||void 0===d?void 0:d[0];if("rca"===m.filterType){var c,u;const t=(null===g||void 0===g||null===(c=g.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===e;i=i&&t}else{let e=v?(0,I.Zh)(v):void 0;(0,n.isNil)(e)&&(e=void 0),i=i&&e===t}}return i}(e,t,o,a))).filter((e=>{var t,o;if((0,n.isNil)(s)||""===s)return!0;const a=s.toLowerCase(),l=Object.values((null===(t=e.currentRunValue)||void 0===t?void 0:t.inputs)||{}).some((e=>JSON.stringify(e).toLowerCase().includes(a))),i=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===a;return l||i}))}var yo={name:"1ykowef",styles:"margin-bottom:0"},xo={name:"f3vz0n",styles:"font-weight:500"},bo={name:"k4cowf",styles:"display:flex;flex:1;overflow-y:hidden"};const wo=e=>{const{totalRowCount:t,sampledInfo:s}=e,o=(0,R.tz)();return s?s.maxAllowedCount?t>=s.maxAllowedCount?(0,E.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t}),children:(0,E.Y)(A.W,{color:"warning"})}):null:s.logCountLoading||(0,n.isNil)(s.sampledCount)||(0,n.isNil)(s.totalCount)?(0,E.Y)(A.S,{}):(0,E.Y)(po,{children:(0,E.FD)(_.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:s.sampledCount,totalCount:s.totalCount,percentage:(0,Lt.$h)(s.sampledCount/s.totalCount)}),children:["Sampled ",(0,Lt.$h)(s.sampledCount/s.totalCount),"%"]})}):null},Io="__any_value__";var So={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const To=g.memo((({assessmentName:e,assessmentInfo:t,assessmentLabel:s,assessmentFilter:n,updateAssessmentFilter:o,removeAssessmentFilter:a,run:l})=>{const i=(0,R.tz)(),{theme:r}=(0,A.u)(),d=n?w(n.filterValue):Io;return(0,E.Y)("div",{css:So,children:(0,E.FD)(Y.SegmentedControlGroup,{name:"size-story",value:d,onChange:s=>{if(s.target.value===Io)return void a(e,l);const n=b(t,s.target.value);o(e,n,l)},size:"middle",componentId:`mlflow.evaluations_review.table_ui.filter_control_${e}`,children:[(0,E.Y)(Y.SegmentedControlButton,{value:Io,children:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center",color:r.colors.textPrimary},""),children:i.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(t.uniqueValues.values()).map((e=>{const{content:s,icon:n}=(0,I.uU)(i,r,t,e);return(0,E.Y)(Y.SegmentedControlButton,{value:w(e),children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center",color:r.colors.textPrimary},""),children:[s,n]})},w(e))}))]})})})),Ao=function({experimentId:e,currentEvaluationResults:t,compareToEvaluationResults:s,currentRunDisplayName:n,runUuid:o,compareToRunUuid:a,compareToRunDisplayName:l,compareToRunLoading:i,sampledInfo:r,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:m,defaultSortOption:p,disableAssessmentTooltips:v,onTraceTagsEdit:h,traceActions:x,initialSelectedColumns:S}){const{theme:_}=(0,A.u)(),N=(0,R.tz)(),M=Ie(t),k=Ie(s||[]),F=Object.keys(null!==x&&void 0!==x?x:{}).length>0,[D,O]=vo(),V=(0,g.useMemo)((()=>Oe(M,k)),[M,k]),[L,B]=(()=>{var e;const[t,s]=f();return[null!==(e=t.get(fo))&&void 0!==e?e:"",(0,g.useCallback)((e=>{s((t=>void 0===e||""===e?(t.delete(fo),t):(t.set(fo,e),t)))}),[s])]})(),$=(0,g.useMemo)((()=>(0,Vt.II)(N,M,k)),[N,M,k]),U=le(N,M,$,o),[z,P]=(e=>{const[t,s]=f();return[(0,g.useMemo)((()=>{var s;return(null!==(s=t.getAll(y))&&void 0!==s?s:[]).reduce(((t,s)=>{const[n,o,a,l]=s.split("::"),i=null===e||void 0===e?void 0:e.find((e=>e.name===o));if(i){const e=b(i,a);t.push({run:n,assessmentName:o,filterValue:e,filterType:""===l?void 0:l})}return t}),[])}),[e,t]),(0,g.useCallback)(((e,t=!1)=>{s((t=>(t.delete(y),e&&e.forEach((e=>{t.append(y,[e.run,e.assessmentName,w(e.filterValue),e.filterType].join("::"))})),t)),{replace:t})}),[s])]})(U.map((e=>e.assessmentInfo)).filter((e=>void 0!==e))),j=(0,g.useMemo)((()=>""===L&&0===z.length?V:ho(V,z,L,n,l)),[V,L,z,n,l]),[q,K]=(0,g.useState)(U),W=(0,g.useMemo)((()=>{const e=q.filter((e=>e.type===H.ASSESSMENT)).map((e=>e.assessmentInfo));return(0,Vt.aE)(e)}),[q]),Q=U.find((e=>e.type===H.ASSESSMENT&&e.id===I._1.OVERALL_ASSESSMENT)),G=p||(Q?{key:Q.id,type:H.ASSESSMENT,asc:!0}:void 0),[J,Z]=(0,g.useState)(G),X=(0,g.useCallback)(((e,t)=>z.find((s=>s.assessmentName===e&&s.run===t))),[z]),ee=(0,g.useCallback)(((e,t)=>{P(z.filter((s=>s.assessmentName!==e||s.run!==t)))}),[z,P]),te=(0,g.useCallback)(((e,t,s,n)=>{const o=z.find((t=>t.assessmentName===e&&t.run===s));P(void 0===o?[...z,{assessmentName:e,filterValue:t,filterType:n,run:s}]:z.map((s=>s.assessmentName===e?{...s,filterValue:t,filterType:n}:s)))}),[z,P]),se=(0,g.useCallback)(((e,t,s,n)=>{const o=z.find((t=>t.assessmentName===e&&t.run===s));void 0===o?P([...z,{assessmentName:e,filterValue:t,filterType:n,run:s}]):o.filterValue===t&&o.filterType===n?P(z.filter((t=>t.assessmentName!==e||t.run!==s))):P(z.map((o=>o.assessmentName===e&&o.run===s?{assessmentName:e,filterValue:t,filterType:n,run:s}:o)))}),[z,P]),ne=(0,g.useCallback)((()=>{P([])}),[P]),oe=z.length>0,[ae,ie]=(0,g.useState)({}),re=(0,g.useMemo)((()=>{const e=Object.keys(ae).filter((e=>ae[e]));return j.filter((t=>t.currentRunValue&&e.includes(t.currentRunValue.evaluationId))).map((e=>e.currentRunValue)).filter((e=>void 0!==e))}),[ae,j]),de={enableRunEvaluationWriteFeatures:m},ce=M.length;return i?(0,E.Y)(Y.LegacySkeleton,{}):(0,E.Y)(Wn,{config:de,children:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"row",gap:_.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:_.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flex:1,flexDirection:"column",gap:_.spacing.xs,overflow:"hidden"},""),children:[(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${_.spacing.xs}px 0px`},""),children:[(0,E.FD)(Y.TableFilterLayout,{css:yo,children:[(0,E.Y)(eo,{searchQuery:L,setSearchQuery:B}),(0,E.FD)(Y.DialogCombobox,{componentId:so,label:"Filters",value:Array.from(z).map((e=>e.assessmentName)),multiSelect:!0,children:[(0,E.Y)(Y.DialogComboboxCustomButtonTriggerWrapper,{children:(0,E.Y)(A.B,{endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,T.AH)({border:oe?`1px solid ${_.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:oe?`${_.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:_.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.FilterIcon,{}),N.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:oe?` (${z.length})`:""}),z.length>0&&(0,E.Y)(C.X,{css:(0,T.AH)({fontSize:12,cursor:"pointer",color:_.colors.grey400,"&:hover":{color:_.colors.grey600}},""),onClick:e=>{ne(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,E.Y)(Y.DialogComboboxContent,{children:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",padding:`${_.spacing.sm}px ${_.spacing.sm}px`,gap:_.spacing.md},""),children:W.filter((e=>"numeric"!==e.dtype)).map((e=>(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:_.spacing.sm},""),children:[(0,E.Y)("div",{css:xo,children:e.displayName}),n&&(0,E.Y)(To,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:X(e.name,n),updateAssessmentFilter:te,removeAssessmentFilter:ee,run:n}),a&&l&&(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:_.spacing.xs},""),children:[(0,E.Y)(A.T.Hint,{children:l}),(0,E.Y)(To,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:X(e.name,l),updateAssessmentFilter:te,removeAssessmentFilter:ee,run:l})]})]},e.name)))})})]}),(0,E.Y)(lo,{tableSort:J,columns:U,onChange:(e,t)=>{Z({key:e.key,type:e.type,asc:t})}}),(0,E.Y)(oo,{columns:U,selectedColumns:q,setSelectedColumns:K}),(0,E.Y)(Te,{experimentId:e,selectedTraces:re,setRowSelection:ie,traceActions:x,traceInfos:void 0})]}),(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:_.spacing.sm},""),children:[(0,E.Y)(wo,{totalRowCount:ce,sampledInfo:r}),(0,E.Y)(A.T.Hint,{children:N.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:V.length,numFilteredEvals:j.length})})]})]}),(0,E.Y)("div",{css:(0,T.AH)({display:"flex",gap:_.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,E.Y)("div",{css:bo,children:(0,E.Y)(Xn,{experimentId:e,selectedColumns:q,allColumns:U,evaluations:j,selectedEvaluationId:D,selectedAssessmentInfos:W,assessmentInfos:$,assessmentFilters:z,onChangeEvaluationId:O,tableSort:J,runUuid:o,compareToRunUuid:a,runDisplayName:n,compareToRunDisplayName:l,enableRowSelection:F,rowSelection:F?ae:void 0,setRowSelection:F?ie:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:se,saveAssessmentsQuery:u,disableAssessmentTooltips:v,onTraceTagsEdit:h})})})]})})})})},Yo=async({queryKey:[,{experimentId:e}]})=>We("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),Co=(e,t=!1)=>{var s;const{data:n,error:o,isLoading:a,isFetching:l}=(0,Be.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:Yo,enabled:!t,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:a,isFetching:l,runInfos:null===n||void 0===n||null===(s=n.runs)||void 0===s?void 0:s.map((e=>{var t,s;return{runUuid:null===(t=e.info)||void 0===t?void 0:t.run_uuid,runName:null===(s=e.info)||void 0===s?void 0:s.run_name}}))}};var _o=s(60062);const Ro=(e,t)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:t}],Eo=async({queryKey:[,{runUuid:e,artifactFile:t}]})=>{const s=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:t})].join("?");return We(s,"GET").then((e=>({...e,filename:t})))},No=[o.Assessments,o.Evaluations,o.Metrics],Mo=({runUuid:e,artifacts:t=No},{disabled:s=!1}={})=>{const o=!s&&No.some((e=>t.includes(e))),a=(0,_o.E)({queries:No.map((n=>({queryFn:Eo,queryKey:Ro(e,n),enabled:!s&&t.includes(n),refetchOnWindowFocus:!1})))}),d=a.some((e=>e.isLoading)),c=a.some((e=>e.isFetching)),p=a.find((e=>e.error)),[v,f,h]=a.map((e=>e.data)),y=(0,g.useMemo)((()=>m(v)),[v]),x=(0,g.useMemo)((()=>m(f)),[f]),b=(0,g.useMemo)((()=>m(h)),[h]),w=(0,g.useMemo)((()=>{if(x)return function(e,t,s){const o=(t||[]).reduce(((e,t)=>{e[t.evaluation_id]||(e[t.evaluation_id]={});const{key:s,value:n,timestamp:o}=t;return e[t.evaluation_id][s]={key:s,value:n,timestamp:o},e}),{}),a=(s||[]).reduce(((e,t)=>{var s,o,a,l;return e[t.evaluation_id]||(e[t.evaluation_id]=[]),e[t.evaluation_id].push({booleanValue:(0,n.isNil)(t.boolean_value)?t.boolean_value:Boolean(t.boolean_value),numericValue:(0,n.isNil)(t.numeric_value)?t.numeric_value:Number(t.numeric_value),stringValue:(0,n.isNil)(t.string_value)?t.string_value:String(t.string_value),metadata:t.metadata||{},...t.error_code&&{errorCode:t.error_code},...t.error_message&&{errorMessage:t.error_message},name:t.name,rationale:t.rationale||null,source:{metadata:null!==(s=null===(o=t.source)||void 0===o?void 0:o.metadata)&&void 0!==s?s:{},sourceId:null===(a=t.source)||void 0===a?void 0:a.source_id,sourceType:null===(l=t.source)||void 0===l?void 0:l.source_type},timestamp:t.timestamp}),e}),{});return e.map((e=>{var t,s;const d=(0,n.orderBy)(a[e.evaluation_id]||[],"timestamp","desc"),c=d.filter(i).map((e=>{var t,s,o,a;const l=null===(t=e.rationale)||void 0===t?void 0:t.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),i=l?null===(s=l[1])||void 0===s?void 0:s.trim():void 0,r=l?null===(o=l[2])||void 0===o?void 0:o.trim():void 0,d=l?null===(a=l[3])||void 0===a?void 0:a.trim():void 0;return e.rationale=r||e.rationale,{...e,rootCauseAssessment:(0,n.isNil)(i)?void 0:{assessmentName:i,suggestedActions:d}}}));0===c.length&&c.push({name:l.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=d.filter(r),p=(0,n.difference)(d,c,m),g=(0,n.groupBy)(p,"name");return Object.keys(g).forEach((e=>{g[e]=(0,n.orderBy)(g[e],"timestamp","desc")})),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(t=e.outputs)&&void 0!==t?t:{},targets:null!==(s=e.targets)&&void 0!==s?s:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:c,responseAssessmentsByName:g,metrics:o[e.evaluation_id]||{},retrievalChunks:u(e.outputs,e.targets,m)}}))}(x,b,y)}),[y,x,b]);return{requestError:p,isLoading:d&&o,isFetching:c&&o,data:w}},ko="searchMlflowTraces",Fo=({queryClient:e})=>{e.invalidateQueries({queryKey:[ko]})},Do=({experimentId:e,runUuid:t,timeRange:s,otherRunUuid:n,filterByLoggedModelId:o,loggedModelId:a,sqlWarehouseId:l,disabled:i,networkFilters:r})=>{const d=(0,R.tz)(),c=Vo(t,s,r,o),{data:u,isLoading:m,error:p}=Ho({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:c,loggedModelId:a,sqlWarehouseId:l,enabled:!i}),v=Vo(n,s),{data:f,isLoading:h,error:y}=Ho({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:v,enabled:!i&&Boolean(n),loggedModelId:a,sqlWarehouseId:l}),x=(0,g.useMemo)((()=>!u||m||p||!u.length?[]:u.map((e=>we(e)))),[u,m,p]),b=(0,g.useMemo)((()=>{const e=h&&Boolean(n);return!f||e||y||!f.length?[]:f.map((e=>we(e)))}),[f,h,y,n]),w=(0,g.useMemo)((()=>(0,Vt.II)(d,x||[],b||[])),[d,x,b]),I=(0,g.useMemo)((()=>{const e=new Map;return null===u||void 0===u||u.forEach((t=>{const s=t.trace_metadata;if(s){const n=s[Ge.sourceNameTag];n&&!e.has(n)&&e.set(n,{value:n,renderValue:()=>(0,E.Y)(dt,{traceInfo:t,isComparing:!1,disableLinks:!0})})}})),{source:Array.from(e.values()).sort(((e,t)=>e.value.localeCompare(t.value)))}}),[u]),S=le(d,x||[],w,t,void 0,!0);return(0,g.useMemo)((()=>({assessmentInfos:w,allColumns:S,evaluatedTraces:x,otherEvaluatedTraces:b,totalCount:x.length,isLoading:m&&!i,error:p,isEmpty:0===x.length,tableFilterOptions:I})),[w,S,m,p,x,b,I,i])},Oo=({experimentId:e,currentRunDisplayName:t,runUuid:s,timeRange:n,searchQuery:o,filters:a,disabled:l,pageSize:i,limit:r,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:m})=>{const{networkFilters:p,clientFilters:v}=(e=>e.reduce(((e,t)=>(t.column===V.ASSESSMENT?e.clientFilters.push(t):e.networkFilters.push(t),e)),{networkFilters:[],clientFilters:[]}))(a||[]),f=Vo(s,n,p,d),h=Lo(c),{data:y,isLoading:x,isFetching:b,error:w,refetch:I}=Ho({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:f,enabled:!l,pageSize:i,limit:r,orderBy:h,loggedModelId:u,sqlWarehouseId:m}),S=(0,g.useMemo)((()=>{if(y)return y.map((e=>({currentRunValue:we(e),otherRunValue:void 0})))}),[y]),T=(0,g.useMemo)((()=>{if(!S)return;if(""===o&&0===(null===v||void 0===v?void 0:v.length))return S.reduce(((e,t)=>{var s;return null!==(s=t.currentRunValue)&&void 0!==s&&s.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[]);const e=v.map((e=>({assessmentName:e.key||"",filterValue:e.value,run:t||""})));return ho(S,e||[],o,t,void 0).reduce(((e,t)=>{var s;return null!==(s=t.currentRunValue)&&void 0!==s&&s.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[])}),[S,v,o,t]);return l?{data:[],isLoading:!1,isFetching:!1}:{data:T,isLoading:x,isFetching:b,error:w||void 0,refetchMlflowTraces:I}},Ho=({locations:e,filter:t,pageSize:s,limit:o,orderBy:a,loggedModelId:l,sqlWarehouseId:i,enabled:r,...d})=>(0,Be.I)({staleTime:1/0,cacheTime:1/0,enabled:r,queryKey:[ko,{experimentIds:(e||[]).map((e=>{var t;return null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id})),filter:t,orderBy:a,loggedModelId:l,sqlWarehouseId:i}],queryFn:async({signal:r})=>{let d,c=[];const u=s||500,m=o||F();for(;c.length<m;){const s={locations:e,filter:t,max_results:u,order_by:a};l&&i&&(s.model_id=l,s.sql_warehouse_id=i),d&&(s.page_token=d);const o=await Ke("ajax-api/3.0/mlflow/traces/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:r});if(!o.ok)throw(0,qe.Jg)(o);const m=await o.json(),p=m.traces;if((0,n.isNil)(p)||(c=c.concat(p)),d=m.next_page_token,!d)break}return c},...d}),Vo=(e,t,s,n)=>{const o=[];if(e&&o.push(`request_metadata."mlflow.sourceRun" = '${e}'`),t){const e="attributes.timestamp_ms";t.startTime&&o.push(`${e} > ${t.startTime}`),t.endTime&&o.push(`${e} < ${t.endTime}`)}if(n&&o.push(`request_metadata."mlflow.modelId" = '${n}'`),s&&s.forEach((e=>{switch(e.column){case V.TAG:if(e.key){const t="tags",s=e.key.includes(".")||e.key.includes(" ")?`${t}.\`${e.key}\``:`${t}.${e.key}`;o.push(`${s} ${e.operator} '${e.value}'`)}break;case j:const t="attributes.execution_time_ms";o.push(`${t} ${e.operator} ${e.value}`);break;case q:const s="attributes.status";o.push(`${s} = '${e.value}'`);break;case B:o.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case J:o.push(`request_metadata."mlflow.sourceRun" = '${e.value}'`);break;case Z:o.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case Q:o.push(`attributes.name ${e.operator} '${e.value}'`);break;case K:o.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;default:e.column.startsWith(ee)&&o.push(`request_metadata.${ce(e.column)} ${e.operator} '${e.value}'`)}})),o.length>0)return o.join(" AND ")},Lo=e=>{if(e)switch(e.key){case j:return["execution_time "+(e.asc?"ASC":"DESC")];case P:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var Bo=s(884);var $o={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},Uo={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const zo=({id:e,item:t,options:s,query:n,onChange:o,placeholder:a,width:l,canSearchCustomValue:i})=>{const{theme:r}=(0,A.u)(),[d,c]=(0,g.useState)(""),u=(0,g.useMemo)((()=>{var e,t;return null!==(e=null!==(t=null===n||void 0===n?void 0:n.data)&&void 0!==t?t:s)&&void 0!==e?e:[]}),[null===n||void 0===n?void 0:n.data,s]),m=(0,g.useMemo)((()=>u.map((e=>e.value))),[u]);return(0,E.FD)(Y.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==t&&void 0!==t&&t.value?[t.value]:[],id:e,children:[(0,E.Y)(Y.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:a,renderDisplayedValue:()=>{var e;return null!==(e=null===t||void 0===t?void 0:t.renderValue())&&void 0!==e?e:""},width:l,allowClear:!1}),(0,E.Y)(Y.DialogComboboxContent,{width:l,style:{zIndex:r.options.zIndexBase+100},loading:null===n||void 0===n?void 0:n.isLoading,children:(0,E.Y)(Y.DialogComboboxOptionList,{children:(0,E.FD)(Y.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map((e=>(0,E.Y)(Y.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===t||void 0===t?void 0:t.value),css:$o,children:e.renderValue()},e.value))),i&&d&&!m.includes(d)?(0,E.FD)(Y.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===t||void 0===t?void 0:t.value),css:Uo,children:['Use "',d,'"']},d):null]})})})]})};var Po={name:"833hqy",styles:"width:200px"};const jo=({index:e,tableFilter:t,assessmentInfos:s,onChange:n,experimentId:o,tableFilterOptions:a})=>{const l=(0,R.tz)(),{theme:i}=(0,A.u)(),r=`filter-value-${e}`,[d,c]=(0,g.useState)(t.value),u=(0,g.useCallback)((()=>{d!==t.value&&n({...t,value:d},e)}),[t,e,n,d]),m=Co(o),p=(0,g.useMemo)((()=>{var e,t;return{data:null===(e=m.runInfos)||void 0===e||null===(t=e.filter((e=>e.runUuid&&e.runName)))||void 0===t?void 0:t.map((e=>({value:e.runUuid,renderValue:()=>e.runName}))),isLoading:m.isLoading}}),[m]),v=((e,t=!1)=>{const s=["EXPERIMENT_MODEL_VERSIONS",e],{data:n,isLoading:o,error:a}=(0,Be.I)({queryKey:s,queryFn:async()=>We("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!t,refetchOnMount:!1,retry:!1});return{data:null===n||void 0===n?void 0:n.models,isLoading:o,error:a||void 0}})(o),f=(0,g.useMemo)((()=>{var e;return{data:null===(e=v.data)||void 0===e?void 0:e.map((e=>({value:e.info.model_id,renderValue:()=>e.info.name}))),isLoading:v.isLoading}}),[v]),h=[{value:"IN_PROGRESS",renderValue:()=>l.formatMessage(ct.IN_PROGRESS)},{value:"OK",renderValue:()=>l.formatMessage(ct.OK)},{value:"ERROR",renderValue:()=>l.formatMessage(ct.ERROR)}];var y,b;if(t.column===J)return(0,E.Y)(zo,{id:r,item:null===(y=p.data)||void 0===y?void 0:y.find((e=>e.value===t.value)),query:p,onChange:s=>{n({...t,value:s},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(t.column===Z)return(0,E.Y)(zo,{id:r,item:null===(b=f.data)||void 0===b?void 0:b.find((e=>e.value===t.value)),query:f,onChange:s=>{n({...t,value:s},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(t.column===V.ASSESSMENT){const o=s.find((e=>e.name===t.key));if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const s=Array.from(o.uniqueValues.values()).map((e=>({value:w(e),renderValue:()=>(0,I.uU)(l,i,o,e).content})));return(0,E.Y)(zo,{id:r,item:s.find((e=>e.value===w(t.value))),options:s,onChange:s=>{n({...t,value:x(s)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(t.column===q)return(0,E.Y)(zo,{id:r,item:h.find((e=>e.value===t.value)),options:h,onChange:s=>{n({...t,value:s},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(t.column===K){const s=a.source;return(0,E.Y)(zo,{id:r,item:s.find((e=>e.value===t.value)),options:s,onChange:s=>{n({...t,value:s},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}return(0,E.Y)(C.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:r,placeholder:t.column===j?"Time in milliseconds":"Value",type:t.column===j?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:Po,disabled:t.column===V.ASSESSMENT})};const qo=[j,q,Q,B,J,Z,K];var Ko={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Wo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Qo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Go={name:"833hqy",styles:"width:200px"},Jo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Zo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Xo={name:"1duj7gx",styles:"align-self:flex-end"};const ea=({tableFilter:e,index:t,onChange:s,onDelete:n,assessmentInfos:o,experimentId:a,tableFilterOptions:l,allColumns:i})=>{const{column:r,operator:d,key:c}=e,{theme:u}=(0,A.u)(),m=(0,g.useMemo)((()=>o.filter((e=>"numeric"!==e.dtype)).map((e=>({value:e.name,renderValue:()=>e.displayName})))),[o]),p=(0,g.useMemo)((()=>{const e=i.filter((e=>qo.includes(e.id)||e.id.startsWith(ee))).map((e=>({value:e.id,renderValue:()=>e.label})));return e.push({value:V.TAG,renderValue:()=>L[V.TAG]},{value:V.ASSESSMENT,renderValue:()=>L[V.ASSESSMENT]}),e}),[i]);return(0,E.Y)(E.FK,{children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,E.FD)("div",{css:Ko,children:[(0,E.Y)(Y.FormUI.Label,{htmlFor:`filter-column-${t}`,children:(0,E.Y)(R.sA,{id:"7HLhyL",defaultMessage:"Column"})}),(0,E.Y)(zo,{id:`filter-column-${t}`,item:p.find((e=>e.value===r)),options:p,onChange:e=>{e!==r&&s({column:e,operator:O.EQUALS,value:""},t)},placeholder:"Select column",width:160,canSearchCustomValue:!1})]}),r===V.ASSESSMENT&&(0,E.FD)("div",{css:Wo,children:[(0,E.Y)(Y.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,E.Y)(R.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,E.Y)(zo,{id:`filter-key-${t}`,item:m.find((e=>e.value===c)),options:m,onChange:n=>{s({...e,key:n},t)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),r===V.TAG&&(0,E.FD)("div",{css:Qo,children:[(0,E.Y)(Y.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,E.Y)(R.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,E.Y)(C.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+t,type:"text",css:Go,placeholder:r===V.TAG?"Key":"Name",value:c,onChange:n=>{s({...e,key:n.target.value},t)}})]}),(0,E.FD)("div",{css:Jo,children:[(0,E.Y)(Y.FormUI.Label,{htmlFor:`filter-operator-${t}`,children:(0,E.Y)(R.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(0,E.Y)(Y.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+t,placeholder:"Select",width:100,contentProps:{style:{zIndex:u.options.zIndexBase+100}},value:""===r||r===j?d:"=",disabled:""!==r&&r!==j,onChange:n=>{s({...e,operator:n.target.value},t)},children:Object.values(O).map((e=>(0,E.Y)(Y.SimpleSelectOption,{value:e,children:e},e)))})]}),(0,E.FD)("div",{css:Zo,children:[(0,E.Y)(Y.FormUI.Label,{htmlFor:`filter-value-${t}`,children:(0,E.Y)(R.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,E.Y)(jo,{index:t,tableFilter:e,assessmentInfos:o,onChange:s,experimentId:a,tableFilterOptions:l})]}),(0,E.Y)("div",{css:Xo,children:(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,E.Y)(Y.CloseSmallIcon,{}),onClick:n})})]})})};const ta=({filters:e,setFilters:t,assessmentInfos:s,experimentId:n,tableFilterOptions:o,allColumns:a,isMetadataLoading:l,metadataError:i})=>{const r=(0,R.tz)(),{theme:d}=(0,A.u)(),c=e.length>0,u=(0,g.useCallback)((()=>{t([])}),[t]);return(0,E.FD)(A.aw.Root,{componentId:so,children:[(0,E.Y)(A.aw.Trigger,{asChild:!0,children:(0,E.Y)(A.B,{endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,T.AH)({border:c?`1px solid ${d.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:c?`${d.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.FilterIcon,{}),r.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:c?` (${e.length})`:""}),c&&(0,E.Y)(C.X,{css:(0,T.AH)({fontSize:12,cursor:"pointer",color:d.colors.grey400,"&:hover":{color:d.colors.grey600}},""),onClick:()=>{u()}})]})})}),(0,E.Y)(A.aw.Content,{align:"start",css:(0,T.AH)({padding:d.spacing.md},""),children:i?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,E.Y)(A.k,{}),(0,E.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):l?(0,E.Y)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,E.Y)(A.S,{size:"small"})}):(0,E.Y)(oa,{filters:e,assessmentInfos:s,setFilters:t,experimentId:n,tableFilterOptions:o,allColumns:a})})]})};var sa={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},na={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const oa=({filters:e,assessmentInfos:t,setFilters:s,experimentId:n,tableFilterOptions:o,allColumns:a})=>{const{theme:l}=(0,A.u)(),i=(e=>(0,Bo.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:O.EQUALS,value:""}]}}))(e),{setValue:r,watch:d}=i,c=d("filters");return(0,E.Y)(Bo.Op,{...i,children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:l.spacing.lg,overflow:"auto"},""),children:[(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:c.map(((e,s)=>(0,E.Y)(ea,{tableFilter:e,index:s,onChange:e=>{c[s]=e,r("filters",c)},onDelete:()=>{const e=[...c];e.splice(s,1),0===e.length&&e.push({column:"",operator:O.EQUALS,value:""}),r("filters",e)},assessmentInfos:t,experimentId:n,tableFilterOptions:o,allColumns:a},e.column+e.operator+e.value+s)))}),(0,E.Y)("div",{children:(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,E.Y)(Y.PlusIcon,{}),onClick:()=>{r("filters",[...c,{column:"",operator:O.EQUALS,value:""}])},children:(0,E.Y)(R.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,E.Y)("div",{css:sa,children:(0,E.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>s(c),css:na,children:(0,E.Y)(R.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},aa=e=>e===V.INFO?"Attributes":L[e],la=({columns:e=[],selectedColumns:t=[],toggleColumns:s,setSelectedColumns:n,isMetadataLoading:o=!1,metadataError:a})=>{const l=(0,R.tz)(),{theme:i}=(0,A.u)(),[r,d]=(0,g.useState)(""),c=(0,g.useMemo)((()=>{const t=Me(e),s={};return t.forEach((e=>{var t;const n=null!==(t=e.group)&&void 0!==t?t:V.INFO;s[n]||(s[n]=[]),s[n].push(e)})),s}),[e]),u=(0,g.useMemo)((()=>{if(!r.trim())return c;const e=r.trim().toLowerCase(),t={};return Object.entries(c).forEach((([s,n])=>{const o=aa(s).toLowerCase().includes(e),a=n.filter((t=>t.label.toLowerCase().includes(e)));(o||a.length)&&(t[s]=o?n:a)})),t}),[c,r]);return(0,E.FD)(Y.DialogCombobox,{componentId:no,label:"Columns",multiSelect:!0,children:[(0,E.Y)(Y.DialogComboboxCustomButtonTriggerWrapper,{children:(0,E.Y)(A.B,{endIcon:(0,E.Y)(Y.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,E.FD)("div",{css:(0,T.AH)({display:"flex",gap:i.spacing.sm,alignItems:"center"},""),children:[(0,E.Y)(Y.ColumnsIcon,{}),l.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,E.Y)(Y.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!a,children:a?(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,E.Y)(A.k,{}),(0,E.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,E.Y)(Y.DialogComboboxOptionList,{children:(0,E.Y)(Y.DialogComboboxOptionListSearch,{controlledValue:r,setControlledValue:d,children:Object.entries(u).map((([e,o])=>(0,E.FD)(g.Fragment,{children:[(0,E.Y)(Y.DialogComboboxSectionHeader,{children:aa(e)}),(0,E.Y)(Y.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every((e=>t.some((t=>t.id===e.id)))),onChange:()=>(e=>{if(e.every((e=>t.some((t=>t.id===e.id))))){const s=t.filter((t=>!e.some((e=>e.id===t.id))));n(s)}else{const s=[...t];e.forEach((e=>{s.some((t=>t.id===e.id))||s.push(e)})),n(s)}})(o),children:l.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:aa(e)})}),o.map((e=>(0,E.Y)(Y.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>s([e]),children:e.label},e.id)))]},e)))})})})]})};var ia={name:"1ykowef",styles:"margin-bottom:0"};const ra=g.memo((e=>{const{searchQuery:t,setSearchQuery:s,filters:n,setFilters:o,tableSort:a,setTableSort:l,selectedColumns:i,toggleColumns:r,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:m,tableFilterOptions:p,traceActions:v,allColumns:f,countInfo:h,isMetadataLoading:y,metadataError:x}=e,{theme:b}=(0,A.u)(),w=(0,g.useCallback)(((e,t)=>{l({key:e.key,type:e.type,asc:t})}),[l]);return(0,E.FD)("div",{css:(0,T.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",paddingBottom:`${b.spacing.xs}px`},""),children:[(0,E.FD)(Y.TableFilterLayout,{css:ia,children:[(0,E.Y)(eo,{searchQuery:t,setSearchQuery:s}),(0,E.Y)(ta,{filters:n,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:p,allColumns:f,isMetadataLoading:y,metadataError:x}),(0,E.Y)(lo,{tableSort:a,columns:i,onChange:w,enableGrouping:!0,isMetadataLoading:y,metadataError:x}),(0,E.Y)(la,{columns:f,selectedColumns:i,toggleColumns:r,setSelectedColumns:d,isMetadataLoading:y,metadataError:x}),v&&(0,E.Y)(Te,{experimentId:u,traceActions:v,traceInfos:m})]}),(0,E.Y)(da,{countInfo:h})]})})),da=e=>{const{countInfo:t}=e,s=(0,R.tz)(),{theme:o}=(0,A.u)();return t.logCountLoading||(0,n.isNil)(t.currentCount)?(0,E.Y)(A.S,{size:"small"}):(0,E.FD)("div",{css:(0,T.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[t.currentCount>=t.maxAllowedCount&&(0,E.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:s.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t.maxAllowedCount}),children:(0,E.Y)(A.W,{color:"warning"})}),(0,E.Y)(A.T.Hint,{children:s.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:t.currentCount>=t.maxAllowedCount?t.maxAllowedCount:t.currentCount,numEvals:t.totalCount>=t.maxAllowedCount?`${t.maxAllowedCount}+`:t.totalCount})})]})};var ca={name:"1is47tc",styles:"flex:1;overflow-y:hidden"};const ua=g.memo((e=>{const{experimentId:t,currentTraceInfoV3:s,compareToTraceInfoV3:n,currentRunDisplayName:o,runUuid:a,compareToRunUuid:l,compareToRunDisplayName:i,setFilters:r,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:m,getTrace:p,onTraceTagsEdit:v,allColumns:f,getRunColor:h,enableRowSelection:y=!0}=e,{theme:x}=(0,A.u)(),b=(0,g.useMemo)((()=>Ie(s.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[s]),w=(0,g.useMemo)((()=>Ie((n||[]).map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[n]),[I,S]=(0,g.useState)({}),Y=(0,g.useCallback)(((e,t,s)=>{const n=d.find((t=>t.column===V.ASSESSMENT&&t.key===e));void 0===n?r([...d,{column:V.ASSESSMENT,key:e,operator:O.EQUALS,value:t}]):n.value===t?r(d.filter((t=>!(t.column===V.ASSESSMENT&&t.key===e)))):r(d.map((s=>s.column===V.ASSESSMENT&&s.key===e?{column:V.ASSESSMENT,key:e,operator:O.EQUALS,value:t}:s)))}),[d,r]),C=(0,g.useMemo)((()=>d.filter((e=>e.column===V.ASSESSMENT)).map((e=>({assessmentName:e.key||"",filterValue:e.value,run:o||""})))),[d,o]),[_,R]=vo(),N=(0,g.useMemo)((()=>{const e=c.filter((e=>e.type===H.ASSESSMENT)).map((e=>e.assessmentInfo));return(0,Vt.aE)(e)}),[c]),M=(0,g.useMemo)((()=>Oe(b,w)),[b,w]),k=(0,g.useMemo)((()=>b.flatMap((e=>{var t,s;return null!==(t=null===e||void 0===e||null===(s=e.traceInfo)||void 0===s?void 0:s.assessments)&&void 0!==t?t:[]}))),[b]);return(0,E.Y)("div",{css:(0,T.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,E.Y)("div",{css:(0,T.AH)({display:"flex",gap:x.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,E.Y)("div",{css:ca,children:(0,E.Y)(D.AssessmentSchemaContextProvider,{assessments:k,children:(0,E.Y)(Xn,{experimentId:t,selectedColumns:c,allColumns:f,evaluations:M,selectedEvaluationId:_,selectedAssessmentInfos:N,assessmentInfos:m,assessmentFilters:C,onChangeEvaluationId:R,getRunColor:h,runUuid:a,compareToRunUuid:l,runDisplayName:o,compareToRunDisplayName:i,enableRowSelection:y,rowSelection:I,setRowSelection:S,toggleAssessmentFilter:Y,tableSort:u,getTrace:p,onTraceTagsEdit:v,enableGrouping:!0})})})})})})),ma="filter",pa=()=>{const[e,t]=f();return[(0,g.useMemo)((()=>{var t;return(null!==(t=e.getAll(ma))&&void 0!==t?t:[]).reduce(((e,t)=>{const[s,n,o,a]=t.split("::");if(!s||!n||!o)return e;const l=n;let i=o;return s===V.ASSESSMENT&&(i=x(o)),e.push({column:s,key:a,operator:l,value:i}),e}),[])}),[e]),(0,g.useCallback)(((e,s=!1)=>{t((t=>(t.delete(ma),e&&e.forEach((e=>{let s=e.value;e.column===V.ASSESSMENT&&(s=w(e.value)),t.append(ma,[e.column,e.operator,s,e.key].join("::"))})),t)),{replace:s})}),[t])]};var ga=s(93846);const va=(e,t)=>t.filter((t=>!e.includes(t))).map((e=>e.id)),fa=(e,t)=>{let s=((e,t)=>t.filter((t=>!e.includes(t.id))))(e,t);if(s.length>10){const e=s.filter((e=>e.type===H.ASSESSMENT)),t=s.filter((e=>e.type!==H.ASSESSMENT)),n=s.length-10,o=Math.max(0,e.length-n);s=[...t,...e.slice(0,o)]}return va(s,t)},ha=(e,t,s,n)=>{const[o,a]=(0,ga.Mj)({key:`genaiTracesUIState-columns-${e}-${n}`,version:1,initialValue:void 0}),l=(0,g.useMemo)((()=>((e,t)=>fa(t?va(t(e),e):[Q,K,j,q],e))(t,s)),[t,s]);return{hiddenColumns:(0,g.useMemo)((()=>{const e=new Set(l);return null!==o&&void 0!==o&&o.columnOverrides?(Object.entries(o.columnOverrides).forEach((([t,s])=>{s?e.delete(t):e.add(t)})),[...e]):l}),[o,l]),toggleColumns:(0,g.useCallback)((e=>{e.length&&a((t=>{var s;const n=null!==(s=null===t||void 0===t?void 0:t.columnOverrides)&&void 0!==s?s:{},o={...n};let a=!1;return e.forEach((e=>{const t=e.id in n?!n[e.id]:l.includes(e.id);o[e.id]!==t&&(o[e.id]=t,a=!0)})),a?{...t,columnOverrides:o}:t}))}),[a,l])}},ya=(e,t,s,o)=>{const{hiddenColumns:a,toggleColumns:l}=ha(e,t,s,o),i=(0,g.useMemo)((()=>t.filter((e=>!a.includes(e.id)))),[t,a]),r=(0,g.useCallback)((e=>{if((0,n.isNil)(e))return;const s=new Set(e.map((e=>e.id))),o=[];t.forEach((e=>{!a.includes(e.id)!==s.has(e.id)&&o.push(e)})),o.length&&l(o)}),[t,a,l]);return{selectedColumns:i,toggleColumns:l,setSelectedColumns:r}}},93846:function(e,t,s){s.d(t,{Mj:function(){return i.Mj},Ub:function(){return a},wY:function(){return l}});var n=s(46709),o=s(69103);function a(e){return function(e){return(0,o.useSyncExternalStore)(n.useCallback((t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)})),[e]),(()=>e.matches))}(n.useMemo((()=>window.matchMedia(e)),[e]))}function l({ref:e,debounceTimeMs:t}){const s=(0,n.useRef)({width:-1,height:-1}),o=(0,n.useRef)(),[a,l]=(0,n.useState)(null),i=(0,n.useCallback)((e=>{if(0===e.length)return;const n=e[0].contentRect;if(-1===s.current.width)return s.current={width:n.width,height:n.height},void l(s.current);if(n.width!==s.current.width||n.height!==s.current.height){if(s.current.width=n.width,s.current.height=n.height,!t)return void l({...s.current});clearTimeout(o.current),o.current=setTimeout((()=>{l({...s.current})}),t)}}),[t]),r=(0,n.useRef)();return r.current||(r.current=new ResizeObserver(i)),(0,n.useEffect)((()=>{const t="function"===typeof e?e():e.current;if(t){const e=r.current;return e.observe(t),()=>e.unobserve(t)}})),a}var i=s(53637)}}]);