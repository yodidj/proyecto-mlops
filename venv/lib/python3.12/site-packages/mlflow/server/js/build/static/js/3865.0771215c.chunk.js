"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[3865],{777:function(e,s,t){t.d(s,{S:function(){return u}});var n=t(68248),a=t(76118),i=t(27757),r=t(79081),o=t(74060),l=t(73408);var d={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},c={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const p=({objectKey:e,value:s})=>{const{theme:t}=(0,i.u)(),p=(0,a.isString)(s)?s:JSON.stringify(s);return(0,l.Y)(r.T,{content:p,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,l.Y)(o.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:d,children:(0,l.FD)(i.T.Text,{css:c,children:[e&&(0,l.FD)(i.T.Text,{bold:!0,css:(0,n.AH)({marginRight:t.spacing.xs},""),children:[e,":"]}),p]})})})},u=({parsedValue:e,singleLine:s=!1})=>{const{theme:t}=(0,i.u)();return(0,a.isNil)(e)?null:Array.isArray(e)?s?(0,l.Y)(p,{value:e}):(0,l.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,s)=>(0,l.Y)(p,{value:e},s)))}):(0,a.isObject)(e)?s?(0,l.Y)(p,{value:e}):(0,l.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:Object.entries(e).map((([e,s])=>(0,l.Y)(p,{objectKey:e,value:s},e)))}):(0,l.Y)(p,{value:e})}},5169:function(e,s,t){t.d(s,{a:function(){return Dt}});var n=t(68248),a=t(46709),i=t(89949),r=t(27757),o=t(74060),l=t(42747);var d=t(86125),c=t(76118),p=t.n(c),u=t(25637),m=t(93846),h=t(73408);var g={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},f={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},v={name:"kjqqaz",styles:"width:0;position:relative"};var x=(0,a.forwardRef)((({initialRatio:e,paneWidth:s,setPaneWidth:t,leftChild:i,leftMinWidth:o,rightChild:l,rightMinWidth:d},p)=>{var x;const[b,y]=(0,a.useState)(!1),Y=(0,a.useRef)(null),S=null===(x=(0,m.wY)({ref:Y}))||void 0===x?void 0:x.width,T=(null!==S&&void 0!==S?S:1/0)-d,w=(0,a.useRef)(e),{theme:A}=(0,r.u)(),M=(0,a.useCallback)((e=>{S&&(w.current=e/S)}),[S]);return(0,a.useImperativeHandle)(p,(()=>({updateRatio:M}))),(0,a.useLayoutEffect)((()=>{S&&t((0,c.clamp)(S*w.current,o,T))}),[S,T,o,d,t]),(0,h.FD)("div",{ref:Y,css:f,children:[b&&(0,h.Y)(n.mL,{styles:g}),(0,h.Y)(u.ResizableBox,{axis:"x",width:s,css:(0,n.AH)({display:"flex",flex:`0 0 ${s}px`},""),handle:(0,h.Y)("div",{css:v,children:(0,h.Y)("div",{css:(0,n.AH)({position:"relative",width:A.spacing.sm,marginLeft:-A.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:s})=>{const n=(0,c.clamp)(s.width,o,T);t(n),S&&(w.current=n/S)},onResizeStart:()=>y(!0),onResizeStop:()=>y(!1),minConstraints:[o,1/0],maxConstraints:[T,1/0],children:i}),l]})})),b=t(27556),y=t(66916);var Y={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var S=({searchFilter:e,setSearchFilter:s,matchData:t,handleNextSearchMatch:i,handlePreviousSearchMatch:l})=>{const[d,c]=(0,a.useState)(e),p=(0,b.YQ)(s,350),{theme:u}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:u.spacing.sm},""),children:[(0,h.Y)(y.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:d,onClear:()=>{s(""),c("")},onChange:e=>{c(e.target.value),p(e.target.value.toLowerCase())},prefix:(0,h.Y)(y.S,{}),css:Y}),t.match&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",marginLeft:u.spacing.xs,marginRight:u.spacing.sm,alignItems:"center"},""),children:[(0,h.FD)(r.T.Text,{css:(0,n.AH)({whiteSpace:"nowrap",marginRight:u.spacing.sm},""),children:[t.currentMatchIndex+1," / ",t.totalMatches]}),(0,h.Y)(r.B,{"data-testid":"prev-search-match",icon:(0,h.Y)(o.ChevronUpIcon,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,h.Y)(r.B,{"data-testid":"next-search-match",icon:(0,h.Y)(o.ChevronDownIcon,{}),onClick:i,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const T=1/0,w=5,A=3,M=1,k=e=>{const s=[],t=e=>{var n;e&&(s.push(e),null===(n=e.children)||void 0===n||n.forEach(t))};return e.forEach(t),s},D=(e,s=1/0)=>{const t={},n=(e,a)=>{var i;!e||a>s||(t[e.key]=e,null===(i=e.children)||void 0===i||i.forEach((e=>n(e,a+1))))};return e.forEach(n,0),t},I=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},C=(e,s)=>{var t;return e.key===s?0:(null!==(t=e.children)&&void 0!==t?t:[]).findIndex((e=>C(e,s)>-1))},F=e=>{var s;if(!e.children||0===(null===(s=e.children)||void 0===s?void 0:s.length))return 0;const t=e.children.map(F);return Math.max(...t)+1},H=(0,a.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),R=()=>(0,a.useContext)(H),N=({modelTrace:e,initialActiveView:s,selectedSpanIdOnRender:t,assessmentsPaneEnabled:n,children:i})=>{var r,o,l;const p=(0,a.useMemo)((()=>(0,d.jW)(e)),[e]),u=(0,a.useMemo)((()=>p?D([p]):{}),[p]),m=(0,d.f7)(p,t),g=null!==(r=null!==m&&void 0!==m?m:p)&&void 0!==r?r:void 0,f=(null!==(o=null===g||void 0===g||null===(l=g.assessments)||void 0===l?void 0:l.length)&&void 0!==o?o:0)>0,v=!(0,c.isNil)(null===p||void 0===p?void 0:p.inputs)||!(0,c.isNil)(null===p||void 0===p?void 0:p.outputs),[x,b]=(0,a.useState)(null!==s&&void 0!==s?s:v?"summary":"detail"),[y,Y]=(0,a.useState)(g),S=(0,d.pQ)(y),[T,w]=(0,a.useState)(S),[A,M]=(0,a.useState)(!1),[k,I]=(0,a.useState)(f);(0,a.useEffect)((()=>{const e=(0,d.pQ)(y);w(e)}),[y]);const C=(0,a.useMemo)((()=>({rootNode:p,nodeMap:u,activeView:x,setActiveView:b,activeTab:T,setActiveTab:w,selectedNode:y,setSelectedNode:Y,showTimelineTreeGantt:A,setShowTimelineTreeGantt:M,assessmentsPaneExpanded:k,setAssessmentsPaneExpanded:I,assessmentsPaneEnabled:n})),[x,u,T,p,y,A,M,k,I,n]);return(0,h.Y)(H.Provider,{value:C,children:i})},E=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},B=({treeNode:e,selectedNode:s,setSelectedNode:t,setActiveTab:n,setExpandedKeys:i,modelTraceInfo:r})=>{var o;const[l,p]=(0,a.useState)(""),[u,m]=(0,a.useState)((()=>(e=>{const s={};e&&(0,c.compact)(k([e]).map((e=>e.type))).forEach((e=>{s[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:s}})(e))),[h,g]=(0,a.useState)(0),{filteredTreeNodes:f,matches:v}=(0,a.useMemo)((()=>(0,c.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,d.vL)(e,l,u)),[null===e||void 0===e?void 0:e.key,l,u,r]),x=(0,a.useMemo)((()=>D(f)),[f]),b=(0,a.useCallback)((e=>{if(e>=v.length||e<0)return;g(e);const s=v[e];t(s.span),n(E(s));const a=((e,s)=>{const t=new Set;let n=e;for(;n&&n.parentId;)t.add(n.parentId),n=s[n.parentId];return t})(s.span,x);i((e=>new Set([...e,...a])))}),[v,t,n,x,i]),y=(0,a.useCallback)((()=>{b(h+1)}),[h,b]),Y=(0,a.useCallback)((()=>{b(h-1)}),[h,b]);return(0,a.useLayoutEffect)((()=>{if(0!==f.length)if(0!==v.length)g(0),t(v[0].span),n(E(v[0]));else{var e;const a=null!==(e=null===s||void 0===s?void 0:s.key)&&void 0!==e?e:"";if(a in x)t(x[a]);else{const e=f[0];t(e),n(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,v,t]),{matchData:{match:null!==(o=v[h])&&void 0!==o?o:null,totalMatches:v.length,currentMatchIndex:h},searchFilter:l.toLowerCase().trim(),setSearchFilter:p,spanFilterState:u,setSpanFilterState:m,filteredTreeNodes:f,handleNextSearchMatch:y,handlePreviousSearchMatch:Y}};var z=t(94664),K=t(45547),j=t(21636);const L=({title:e,searchFilter:s,isActiveMatch:t})=>{const{theme:i}=(0,r.u)(),o=(0,a.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),l=e.toLowerCase();if(!l.includes(s))return(0,h.Y)("div",{children:e});const d=l.indexOf(s),c=d+s.length,p=t?i.colors[j.k]:i.colors[j.B];return(0,h.FD)("div",{children:[e.slice(0,d),(0,h.Y)("span",{ref:t?o:null,css:(0,n.AH)({backgroundColor:p,scrollMarginTop:50},""),children:e.slice(d,c)}),e.slice(c)]})};function O(e,s){return s||(e?z.cC.MARKDOWN:z.cC.JSON)}function $(e){switch(e){case z.cC.JSON:return"JSON";case z.cC.TEXT:return"Text";case z.cC.MARKDOWN:return"Markdown";case z.cC.PYTHON:return"Python"}}var _={name:"bjn8wh",styles:"position:relative"},V={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},P={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},W={name:"2fp7nl",styles:"height:min-content;margin:0"};function J({title:e,tokens:s,data:t,searchFilter:i="",activeMatch:l=null,containsActiveMatch:d=!1,initialRenderMode:p}){var u;const m=(0,a.useMemo)((()=>JSON.parse(t)),[t]),g=(0,c.isString)(m),{theme:f}=(0,r.u)(),[v,x]=(0,a.useState)(O(g,p)),b=d&&null!==(u=null===l||void 0===l?void 0:l.isKeyMatch)&&void 0!==u&&u,y=g&&!i;return(0,a.useEffect)((()=>{x(O(g,p))}),[g,p]),(0,h.Y)("div",{css:_,children:(0,h.FD)("div",{css:(0,n.AH)({borderRadius:f.borders.borderRadiusSm,border:`1px solid ${f.colors.border}`,overflow:"hidden"},""),children:[(e||y)&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:f.spacing.sm},""),children:[(0,h.Y)(r.T.Title,{css:V,level:4,color:"secondary",withoutMargins:!0,children:(0,h.Y)(L,{title:e,searchFilter:i,isActiveMatch:b})}),(0,h.Y)("div",{css:P,children:y&&(0,h.FD)(o.DropdownMenu.Root,{children:[(0,h.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:W,children:(0,h.FD)("div",{css:(0,n.AH)({paddingLeft:f.spacing.xs,marginRight:f.spacing.xs,cursor:"pointer"},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:$(v)}),(0,h.Y)(o.ChevronDownIcon,{})]})})}),(0,h.FD)(o.DropdownMenu.Content,{children:[(0,h.Y)(o.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:v,onValueChange:e=>x(e),children:Object.values(z.cC).map((e=>e===z.cC.PYTHON?null:(0,h.FD)(o.DropdownMenu.RadioItem,{value:e,children:[(0,h.Y)(o.DropdownMenu.ItemIndicator,{}),$(e)]},e)))}),(0,h.Y)(o.DropdownMenu.Arrow,{})]})]})})]}),(0,h.Y)(K.w,{data:t,searchFilter:i,activeMatch:l,containsActiveMatch:d,renderMode:v})]})})}function U({activeSpan:e,searchFilter:s,activeMatch:t}){const{theme:a}=(0,r.u)(),{attributes:i}=e,d=(0,c.keys)(i).length>0,p=!(0,c.isNil)(t)&&t.span.key===e.key;return!d||(0,c.isNil)(i)?(0,h.Y)("div",{css:(0,n.AH)({marginTop:a.spacing.md},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,padding:a.spacing.md},""),children:Object.entries(i).map((([e,n])=>(0,h.Y)(J,{title:e,data:JSON.stringify(n,null,2),searchFilter:s,activeMatch:t,containsActiveMatch:p&&"attributes"===t.section&&t.key===e},e)))})}function G({paramName:e,paramProperties:s,isRequired:t}){const{theme:a}=(0,r.u)(),{type:i,description:o,enum:d}=s,c=i||o||d,p=c?{borderTopLeftRadius:a.borders.borderRadiusMd,borderTopRightRadius:a.borders.borderRadiusMd,borderBottom:`1px solid ${a.colors.border}`}:{borderRadius:a.borders.borderRadiusMd};return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:a.borders.borderRadiusMd,border:`1px solid ${a.colors.border}`},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:a.colors.backgroundSecondary,padding:`${a.spacing.sm}px ${a.spacing.md}px`,gap:a.spacing.sm,...p},""),children:[(0,h.Y)(r.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),t&&(0,h.Y)(r.T.Text,{withoutMargins:!0,color:"error",children:(0,h.Y)(l.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),c&&(0,h.FD)("div",{css:(0,n.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:a.spacing.md,padding:`${a.spacing.sm}px ${a.spacing.md}px`},""),children:[i&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,h.Y)(l.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,h.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:i})]}),o&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,h.Y)(l.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,h.Y)(r.T.Text,{withoutMargins:!0,children:o})]}),d&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,h.Y)(l.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,flexWrap:"wrap"},""),children:d.map((e=>(0,h.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function q({tool:e}){var s,t,i;const{theme:l}=(0,r.u)(),[d,c]=(0,a.useState)(!1),p=e.function.description,u=null===(s=e.function.parameters)||void 0===s?void 0:s.properties,m=null!==(t=null===(i=e.function.parameters)||void 0===i?void 0:i.required)&&void 0!==t?t:[],g=p||u,f=g?{":hover":{backgroundColor:l.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:l.borders.borderRadiusMd,border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,h.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm,alignItems:"center",borderBottom:g&&d?`1px solid ${l.colors.border}`:"none",padding:l.spacing.sm,...f},""),onClick:()=>c(!d),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[g&&(d?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{})),(0,h.Y)(r.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),g&&d&&(0,h.FD)("div",{css:(0,n.AH)({padding:l.spacing.sm},""),children:[p&&(0,h.Y)(r.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:l.spacing.sm,padding:`0px ${l.spacing.xs}px`},children:e.function.description}),u&&(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:Object.keys(u).map((e=>(0,h.Y)(G,{paramName:e,paramProperties:u[e],isRequired:m.includes(e)},e)))})]})]})}var X=t(61072);function Q({messages:e}){const{theme:s}=(0,r.u)();return(0,c.isNil)(e)?null:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:e.map(((e,s)=>(0,h.Y)(X.X,{message:e},s)))})}var Z={name:"1d3w5wq",styles:"width:100%"};const ee=({sectionKey:e,title:s,children:t,withBorder:i=!1,className:l})=>{const[d,c]=(0,a.useState)(!0),{theme:p}=(0,r.u)();return(0,h.FD)("div",{className:l,css:(0,n.AH)({display:"flex",flexDirection:"column",borderRadius:p.borders.borderRadiusMd},""),children:[(0,h.FD)("div",{css:(0,n.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:p.spacing.xs,padding:i?p.spacing.sm:0,background:i?p.colors.backgroundSecondary:void 0,borderTopLeftRadius:p.borders.borderRadiusMd,borderTopRightRadius:p.borders.borderRadiusMd,borderBottomLeftRadius:d?0:p.borders.borderRadiusMd,borderBottomRightRadius:d?0:p.borders.borderRadiusMd,border:i?`1px solid ${p.colors.border}`:void 0,marginBottom:i?0:p.spacing.sm},""),children:[(0,h.Y)(r.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:d?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}),onClick:()=>c(!d)}),(0,h.Y)(r.T.Title,{withoutMargins:!0,level:4,css:Z,children:s})]}),d&&(0,h.Y)("div",{css:(0,n.AH)({border:i?`1px solid ${p.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:i?p.borders.borderRadiusMd:void 0,borderBottomRightRadius:i?p.borders.borderRadiusMd:void 0,padding:i?p.spacing.sm:0},""),children:t})]})};function se({chatMessages:e,chatTools:s}){const{theme:t}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({overflowY:"auto",padding:t.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[s&&(0,h.Y)(ee,{css:(0,n.AH)({marginBottom:t.spacing.sm},""),title:(0,h.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:s.map((e=>(0,h.Y)(q,{tool:e},e.function.name)))})}),(0,h.Y)(ee,{title:(0,h.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,h.Y)(Q,{messages:e})})]})}var te={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},ne={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function ae({activeSpan:e,className:s,searchFilter:t,activeMatch:i}){const{theme:o}=(0,r.u)(),p=(0,a.useMemo)((()=>(0,d.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),u=(0,a.useMemo)((()=>(0,d.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,c.isNil)(e))return null;const m=p.length>0,g=u.length>0,f=!(0,c.isNil)(i)&&i.span.key===e.key;return(0,h.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,h.Y)(ee,{withBorder:!0,css:(0,n.AH)({marginBottom:o.spacing.sm},""),sectionKey:"input",title:(0,h.Y)("div",{css:te,children:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:p.map((({key:e,value:s},n)=>(0,h.Y)(J,{title:e,data:s,searchFilter:t,activeMatch:i,containsActiveMatch:f&&"inputs"===i.section&&i.key===e},e||n)))})}),g&&(0,h.Y)(ee,{withBorder:!0,sectionKey:"output",title:(0,h.Y)("div",{css:ne,children:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:u.map((({key:e,value:s})=>(0,h.Y)(J,{title:e,data:s,searchFilter:t,activeMatch:i,containsActiveMatch:f&&"outputs"===i.section&&i.key===e},e)))})})]})}var ie=t(73879),re=t(79081);const oe=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},le=({itemKey:e,itemValue:s,charLimit:t=18,maxWidth:a=150,className:i})=>{const{shouldTruncateKey:l,shouldTruncateValue:d}=function(e,s,t){const n=e.length+s.length,a=e.length>s.length,i=a?s.length:e.length;return n<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(e,s,t);return(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${s}`,children:(0,h.Y)(o.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:i,children:(0,h.FD)("span",{css:(0,n.AH)({maxWidth:a,display:"inline-flex"},""),children:[(0,h.Y)(r.T.Text,{bold:!0,css:oe(l),size:"sm",children:e}),":\xa0",(0,h.Y)(r.T.Text,{css:oe(d),size:"sm",children:s})]})})})};var de={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function ce({text:e,metadataTags:s,setExpanded:t,logDocumentClick:a}){const{theme:i}=(0,r.u)();return(0,h.FD)("div",{css:de,children:[(0,h.Y)("div",{role:"button",onClick:()=>{t(!1),null===a||void 0===a||a("collapse")},css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${i.spacing.sm}px ${i.spacing.md}px`,height:i.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:(0,h.Y)(o.FileDocumentIcon,{})}),(0,h.Y)("div",{css:(0,n.AH)({padding:i.spacing.md,paddingBottom:0},""),children:(0,h.Y)(ie.V,{children:e})}),(0,h.Y)("div",{css:(0,n.AH)({padding:i.spacing.md,paddingTop:0},""),children:s.map((({key:e,value:s})=>(0,h.Y)(le,{itemKey:e,itemValue:s},e)))}),(0,h.Y)(r.B,{css:(0,n.AH)({width:"100%",padding:i.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,h.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>t(!1),children:(0,h.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var pe={name:"ti75j2",styles:"margin:0"},ue={name:"1r5gb7q",styles:"display:inline-block"},me={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function he({text:e,metadataTags:s,setExpanded:t,logDocumentClick:a}){const{theme:i}=(0,r.u)();return(0,h.FD)("div",{role:"button",onClick:()=>{t(!0),null===a||void 0===a||a("expand")},css:(0,n.AH)({display:"flex",flexDirection:"row",padding:`${i.spacing.sm}px ${i.spacing.md}px`,gap:i.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,h.Y)(o.FileDocumentIcon,{}),(0,h.Y)(r.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[s.length>0?(0,h.Y)(le,{css:pe,itemKey:s[0].key,itemValue:s[0].value}):null,s.length>1?(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:s.slice(1).map((({key:e,value:s})=>(0,h.Y)("span",{css:ue,children:`${e}: ${s}`},e))),children:(0,h.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:me,children:["+",s.length-1]})}):null]})]})}function ge({text:e,metadata:s}){const[t,n]=(0,a.useState)(!1),i=(0,d.g_)(s);return t?(0,h.Y)(ce,{text:e,metadataTags:i,setExpanded:n}):(0,h.Y)(he,{text:e,metadataTags:i,setExpanded:n})}var fe={name:"s5xdrg",styles:"display:flex;align-items:center"},ve={name:"s5xdrg",styles:"display:flex;align-items:center"};function xe({shouldRenderMarkdown:e,setShouldRenderMarkdown:s}){const{theme:t}=(0,r.u)();return(0,h.FD)(o.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{s(e.target.value)},children:[(0,h.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,h.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,h.Y)("div",{css:fe,children:(0,h.Y)(o.TextBoxIcon,{css:(0,n.AH)({fontSize:t.typography.fontSizeLg},"")})})})}),(0,h.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,h.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,h.Y)("div",{css:ve,children:(0,h.Y)(o.MIcon,{css:(0,n.AH)({fontSize:t.typography.fontSizeLg},"")})})})})]})}var be={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function ye({activeSpan:e,className:s,searchFilter:t,activeMatch:i}){const{theme:p}=(0,r.u)(),[u,m]=(0,a.useState)(!0),g=(0,a.useMemo)((()=>(0,d.g_)(e.inputs)),[e]),f=e.outputs,v=g.length>0,x=!(0,c.isNil)(i)&&i.span.key===e.key,b=x&&"outputs"===i.section;return(0,h.FD)("div",{className:s,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,h.Y)(ee,{sectionKey:"input",css:(0,n.AH)({marginBottom:p.spacing.sm},""),title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:g.map((({key:e,value:s},n)=>(0,h.Y)(J,{title:e,data:s,searchFilter:t,activeMatch:i,containsActiveMatch:x&&"inputs"===i.section&&i.key===e},e||n)))})}),(0,h.Y)(ee,{sectionKey:"output",title:(0,h.FD)("div",{css:be,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,h.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,h.Y)(o.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!b&&(0,h.Y)(xe,{shouldRenderMarkdown:u,setShouldRenderMarkdown:m})]}),children:u&&!b?(0,h.Y)("div",{css:(0,n.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.legacyBorders.borderRadiusMd},""),children:f.map(((e,s)=>(0,h.Y)("div",{css:(0,n.AH)({borderBottom:s!==f.length-1?`1px solid ${p.colors.border}`:""},""),children:(0,h.Y)(ge,{text:e.page_content,metadata:e.metadata},s)},s)))}):(0,h.Y)("div",{css:(0,n.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.legacyBorders.borderRadiusMd,padding:p.spacing.md},""),children:(0,h.Y)(J,{title:"",data:JSON.stringify(f,null,2),searchFilter:t,activeMatch:i,containsActiveMatch:x&&"outputs"===i.section})})})]})}function Ye({activeSpan:e,className:s,searchFilter:t,activeMatch:a}){const{theme:i}=(0,r.u)();return!(0,c.isNil)(e)&&(0,d.vl)(e)?(0,h.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:i.spacing.md},""),className:s,"data-testid":"model-trace-explorer-content-tab",children:(0,h.Y)(ye,{activeSpan:e,className:s,searchFilter:t,activeMatch:a})}):(0,h.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:i.spacing.md},""),className:s,"data-testid":"model-trace-explorer-content-tab",children:(0,h.Y)(ae,{activeSpan:e,className:s,searchFilter:t,activeMatch:a})})}function Se({activeSpan:e,searchFilter:s,activeMatch:t}){const{theme:a}=(0,r.u)(),{events:i}=e,p=!(0,c.isNil)(t)&&t.span.key===e.key;return Array.isArray(i)&&0!==i.length?(0,h.Y)("div",{css:(0,n.AH)({padding:a.spacing.md},""),children:i.map(((e,i)=>{const l=e.attributes,c="exception"===e.name?(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:a.spacing.sm},""),color:"danger"}),(0,h.Y)(r.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,h.Y)(ee,{sectionKey:e.name,title:c,withBorder:!0,children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:Object.keys(l).map((n=>{const a=(0,d.Q0)(e.name,i,n);return(0,h.Y)(J,{title:n,data:JSON.stringify(l[n],null,2),searchFilter:s,activeMatch:t,containsActiveMatch:p&&"events"===t.section&&t.key===a,initialRenderMode:z.cC.TEXT},a)}))})},`${e.name}-${i}`):null}))}):(0,h.Y)("div",{css:(0,n.AH)({marginTop:a.spacing.md},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}function Te({count:e}){const{theme:s}=(0,r.u)();return(0,h.Y)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:s.typography.fontSizeBase,height:s.typography.fontSizeBase,backgroundColor:s.colors.actionDangerPrimaryBackgroundDefault,padding:s.spacing.xs,marginLeft:s.spacing.xs,boxSizing:"border-box"},""),children:(0,h.Y)("span",{css:(0,n.AH)({color:s.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var we={name:"4zleql",styles:"display:block"},Ae={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const Me=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:s,assessmentsPaneEnabled:t}=R();return(0,h.Y)(o.SegmentedControlGroup,{css:we,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,h.Y)(o.SegmentedControlButton,{value:!0,disabled:!t,icon:(0,h.Y)(o.GavelIcon,{}),onClick:()=>null===s||void 0===s?void 0:s(!e),css:Ae,children:!e&&(0,h.Y)(l.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var ke=t(44666),De=t(57248);const Ie=({name:e,setName:s,nameError:t,setNameError:n,handleChangeSchema:i})=>{const{schemas:r}=(0,De.a)(),d=(0,l.tz)(),c=r.map((e=>{var s;return null!==(s=e.name)&&void 0!==s?s:""})),[p,u]=(0,a.useState)(null),[m,g]=(0,a.useState)(r),f=(0,a.useMemo)((()=>{const s=[...m];if(e&&!c.includes(e)){const t=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);s.unshift(t)}return s}),[e,m,c]),v=(0,a.useCallback)((e=>{u(e),i(e),n(null)}),[i,n]),x=(0,o.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:r,items:f,setItems:g,multiSelect:!1,setInputValue:e=>{s(e),n(null)},itemToString:e=>{var s;return null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""},matcher:(e,s)=>{var t,n;return null!==(t=null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(s.toLowerCase()))&&void 0!==t&&t},formValue:p,formOnChange:v,preventUnsetOnBlur:!0});return(0,h.FD)(o.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,h.Y)(o.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:d.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:t?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),t&&(0,h.Y)(o.FormUI.Message,{type:"error",message:t}),(0,h.Y)(o.TypeaheadComboboxMenu,{comboboxState:x,children:f.map(((e,s)=>{var t,n,a;return(0,h.Y)(o.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""}`,item:e,index:s,comboboxState:x,children:null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:""},`assessment-name-typeahead-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`)}))})]})},Ce=250,Fe=(e,s=new Date)=>{const t=Math.max(0,Math.floor((s.getTime()-e)/1e3));let n=Math.floor(t/31536e3);return n>=1?(0,h.Y)(l.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(t/2592e3),n>=1?(0,h.Y)(l.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(t/86400),n>=1?(0,h.Y)(l.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(t/3600),n>=1?(0,h.Y)(l.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(t/60),n>=1?(0,h.Y)(l.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,h.Y)(l.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:t}})))))},He=({formValue:e,dataType:s,isFeedback:t})=>t?{feedback:{value:e}}:"json"===s?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var Re={name:"t152af",styles:"margin-top:8px;color:red"};var Ne={name:"t152af",styles:"margin-top:8px;color:red"};var Ee={name:"t152af",styles:"margin-top:8px;color:red"};var Be=t(39595),ze=t(61060),Ke=t(36476);const je=fetch;function Le(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}const Oe=async(e,s="GET",t)=>{const n=await je(e,{method:s,body:Le(t),headers:t?{"Content-Type":"application/json"}:{}});if(!n.ok){const e=(0,Ke.a$)(n);if(e){try{const s=(await n.json()).message;e.message=null!==s&&void 0!==s?s:e.message}catch{}throw e}}return n.json()},$e=({payload:e})=>Oe(`/ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`,"POST",e),_e={json:({value:e,valueError:s,setValue:t,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(y.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{t(e.target.value),n(null)},validationState:s?"error":void 0,disabled:a}),s&&(0,h.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:s,type:"error"})]}),string:({value:e,valueError:s,setValue:t,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(y.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{t(e.target.value),n(null)},disabled:a,allowClear:!0}),s&&(0,h.Y)("div",{css:Ee,children:s})]}),boolean:({value:e,valueError:s,setValue:t,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.FD)(o.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:a,onChange:e=>{t(e.target.value),n(null)},children:[(0,h.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,h.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),s&&(0,h.Y)("div",{css:Re,children:s})]}),number:({value:e,valueError:s,setValue:t,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(y.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{t(e.target.value?Number(e.target.value):""),n(null)},type:"number",disabled:a,allowClear:!0}),s&&(0,h.Y)("div",{css:Ne,children:s})]})},Ve=(0,a.forwardRef)((({assessmentName:e,spanId:s,traceId:t,setExpanded:i},p)=>{var u;const{theme:m}=(0,r.u)(),[g,f]=(0,a.useState)(""),[v,x]=(0,a.useState)("feedback"),[b,Y]=(0,a.useState)("boolean"),[S,T]=(0,a.useState)(!0),[w,A]=(0,a.useState)(""),[M,k]=(0,a.useState)(null),[D,I]=(0,a.useState)(null),C=!(0,c.isNil)(e),F=null!==(u=_e[b])&&void 0!==u?u:_e.string,{createAssessmentMutation:H,isLoading:R}=(({traceId:e,onSuccess:s,onError:t,onSettled:n})=>{const a=(0,l.tz)(),i=(0,Be.jE)(),{mutate:r,isLoading:o}=(0,ze.n)({mutationFn:e=>$e({payload:e}),onSuccess:()=>{i.invalidateQueries({queryKey:[d.BS,e]}),null===s||void 0===s||s()},onError:e=>{(0,d.ij)(a.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===t||void 0===t||t(e)},onSettled:()=>{null===n||void 0===n||n()}});return{createAssessmentMutation:r,isLoading:o}})({traceId:t,onSettled:()=>{i(!1)}}),N=(0,a.useCallback)((async()=>{var n;if("json"===b)try{JSON.parse(S)}catch(r){return void I((0,h.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!C&&""===g)return void k((0,h.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const a=He({formValue:S,dataType:b,isFeedback:"feedback"===v}),i={assessment:{assessment_name:C?e:g,trace_id:t,source:{source_type:"HUMAN",source_id:null!==(n=(0,ke.w)())&&void 0!==n?n:""},span_id:s,rationale:w,...a}};H(i)}),[b,S,v,C,e,g,t,s,w,H]),E=(0,a.useCallback)((e=>{if(!e)return f(""),x("feedback"),Y("boolean"),T(!0),A(""),void I(null);switch(f(e.name),x(e.assessmentType),Y(e.dataType),e.dataType){case"string":case"json":T("");break;case"number":T(0);break;case"boolean":T(!0)}}),[]);return(0,h.FD)("div",{ref:p,css:(0,n.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs,marginTop:m.spacing.sm,border:`1px solid ${m.colors.border}`,padding:m.spacing.sm,borderRadius:m.borders.borderRadiusSm},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:v,disabled:R,onChange:e=>{x(e.target.value),"feedback"===e.target.value&&"json"===b&&Y("string")},children:[(0,h.Y)(o.SimpleSelectOption,{value:"feedback",children:(0,h.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,h.Y)(o.SimpleSelectOption,{value:"expectation",children:(0,h.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),C?(0,h.Y)(r.T.Text,{children:e}):(0,h.Y)(Ie,{name:g,setName:f,handleChangeSchema:E,nameError:M,setNameError:k}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:b,disabled:R,onChange:e=>{Y(e.target.value),I(null)},children:["expectation"===v&&(0,h.Y)(o.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(o.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(o.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,h.Y)(F,{value:S,valueError:D,setValue:T,setValueError:I,isSubmitting:R}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,h.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:R,onKeyDown:e=>e.stopPropagation(),onChange:e=>A(e.target.value)}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:m.spacing.xs},""),children:[(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:R,onClick:()=>i(!1),children:(0,h.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,h.Y)(r.B,{css:(0,n.AH)({marginLeft:m.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:N,loading:R,children:(0,h.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})})),Pe=({title:e,assessmentName:s,spanId:t,traceId:n})=>{const[i,l]=(0,a.useState)(!1),d=(0,a.useRef)(null);return(0,a.useEffect)((()=>{i&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"start"})}),[i]),(0,h.FD)("div",{children:[(0,h.Y)(r.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,h.Y)(o.PlusIcon,{}),onClick:()=>l(!0),children:e}),i&&(0,h.Y)(Ve,{ref:d,assessmentName:s,spanId:t,traceId:n,setExpanded:l})]})},We=({assessment:e,setIsEditing:s,setShowDeleteModal:t})=>{var n;const a="feedback"in e,i=((null!==(n=(0,ke.w)())&&void 0!==n?n:"")===e.source.source_id||a&&"HUMAN"!==e.source.source_type)&&s;return(0,h.FD)(o.DropdownMenu.Root,{children:[(0,h.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,h.Y)(o.OverflowIcon,{}),size:"small"})}),(0,h.FD)(o.DropdownMenu.Content,{minWidth:100,children:[i&&(0,h.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===s||void 0===s?void 0:s(!0),children:[(0,h.Y)(o.DropdownMenu.IconWrapper,{children:(0,h.Y)(o.PencilIcon,{})}),(0,h.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,h.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>t(!0),children:[(0,h.Y)(o.DropdownMenu.IconWrapper,{children:(0,h.Y)(o.TrashIcon,{})}),(0,h.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},Je=({assessment:e,isModalVisible:s,setIsModalVisible:t})=>{const n=(0,l.tz)(),i=(0,Be.jE)(),{mutate:r,isLoading:o}=(0,ze.n)({mutationFn:()=>(({traceId:e,assessmentId:s})=>Oe(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${s}`,"DELETE"))({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{i.invalidateQueries({queryKey:[d.BS,e.trace_id]})},onError:e=>{(0,d.ij)(n.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{t(!1)}}),c=(0,a.useCallback)((()=>{r()}),[r]);return(0,h.Y)(re.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:s,onOk:c,okButtonProps:{danger:!0,loading:o},okText:(0,h.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{t(!1)},cancelText:(0,h.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,h.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,h.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var Ue=t(33145);const Ge=({assessment:e,onSuccess:s,onError:t,onSettled:n})=>{const a=(0,l.tz)(),i=(0,Be.jE)(),{mutate:r,isLoading:o}=(0,ze.n)({mutationFn:s=>(({traceId:e,assessmentId:s,payload:t})=>Oe(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${s}`,"PATCH",t))({traceId:e.trace_id,assessmentId:e.assessment_id,payload:s}),onError:e=>{(0,d.ij)(a.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===t||void 0===t||t(e)},onSuccess:()=>{i.invalidateQueries({queryKey:[d.BS,e.trace_id]}),null===s||void 0===s||s()},onSettled:()=>{null===n||void 0===n||n()}});return{updateAssessmentMutation:r,isLoading:o}},qe=({assessment:e,onSuccess:s,onSettled:t,onCancel:i})=>{var p;const u="feedback"in e,m=(0,Ue.e)(e),g=((e,s)=>{if("string"===typeof e){if(""===e)return"boolean";if(s)return"string";try{return JSON.parse(e),"json"}catch(t){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(m,u),f=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(m),v=null!==(p=(0,ke.w)())&&void 0!==p?p:"",{theme:x}=(0,r.u)(),[b,Y]=(0,a.useState)(g),[S,T]=(0,a.useState)(f),[w,A]=(0,a.useState)(e.rationale),[M,k]=(0,a.useState)(null),{updateAssessmentMutation:D,isLoading:I}=Ge({assessment:e,onSuccess:s,onSettled:t}),{overrideAssessmentMutation:C,isLoading:F}=(({traceId:e,onSuccess:s,onError:t,onSettled:n})=>{const a=(0,l.tz)(),i=(0,Be.jE)(),{mutate:r,isLoading:o}=(0,ze.n)({mutationFn:({oldAssessment:e,value:s,rationale:t})=>{var n;const a={...e,...s,rationale:t,source:{source_id:null!==(n=(0,ke.w)())&&void 0!==n?n:"",source_type:"HUMAN"},overrides:e.assessment_id},i={assessment:(0,c.omit)(a,"assessment_id","create_time","last_update_time","overriddenAssessments")};return $e({payload:i})},onError:e=>{(0,d.ij)(a.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===t||void 0===t||t(e)},onSuccess:()=>{i.invalidateQueries({queryKey:[d.BS,e]}),null===s||void 0===s||s()},onSettled:()=>{null===n||void 0===n||n()}});return{overrideAssessmentMutation:r,isLoading:o}})({traceId:e.trace_id,onSuccess:s,onSettled:t}),H=I||F,R=(0,a.useCallback)((async()=>{if("json"===b)try{JSON.parse(S)}catch(t){return void k((0,h.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const s=He({formValue:S,dataType:b,isFeedback:u});if(v!==e.source.source_id&&u)C({oldAssessment:e,value:s,...w?{rationale:w}:{}});else{const e={assessment:{...s,rationale:w},update_mask:(u?"feedback":"expectation")+",rationale"};D(e)}}),[b,S,u,v,e,w,D,C]);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs,marginTop:x.spacing.sm,border:`1px solid ${x.colors.border}`,padding:x.spacing.sm,borderRadius:x.borders.borderRadiusSm},""),children:[(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:b,disabled:H,onChange:e=>{Y(e.target.value),k(null)},children:[!u&&(0,h.Y)(o.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(o.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(o.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===b&&(0,h.FD)(h.FK,{children:[(0,h.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value),k(null)},validationState:M?"error":void 0,disabled:H}),M&&(0,h.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===b&&(0,h.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value),k(null)},disabled:H,allowClear:!0}),"boolean"===b&&(0,h.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:S,disabled:H,onChange:e=>{T(e.target.value),k(null)},children:[(0,h.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,h.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===b&&(0,h.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value?Number(e.target.value):""),k(null)},type:"number",disabled:H,allowClear:!0}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,h.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>A(e.target.value)}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:x.spacing.xs},""),children:[(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:H,onClick:i,children:(0,h.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,h.Y)(r.B,{css:(0,n.AH)({marginLeft:x.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:R,loading:H,children:(0,h.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var Xe=t(777),Qe=t(51847);const Ze=({node:e})=>{var s;const{theme:t}=(0,r.u)(),{setSelectedNode:a,setActiveView:i,setShowTimelineTreeGantt:o}=R(),l=(0,d.N7)(e)>0;return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",marginRight:t.spacing.xs,gap:t.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?t.colors.actionDangerDefaultTextDefault:t.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{a(e),i("detail"),o(!1)},children:[(0,h.Y)(Qe.P,{hasException:l,type:(0,d.tC)(null!==(s=e.type)&&void 0!==s?s:z.UG.UNKNOWN)}),(0,h.Y)(r.T.Text,{color:l?"error":"primary",css:(0,n.AH)({marginLeft:t.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};var es={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},ss={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const ts=({expectation:e})=>{const{theme:s}=(0,r.u)(),[t,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(!1),{nodeMap:c,activeView:p}=R(),u=e.span_id?c[e.span_id]:null,m="summary"===p&&u,g=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(s){return e.serialized_value.value}})(e.expectation);return(0,h.FD)("div",{css:(0,n.AH)({padding:s.spacing.sm+s.spacing.xs,paddingTop:s.spacing.sm,border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:[(0,h.FD)("div",{css:es,children:[(0,h.Y)(r.T.Text,{bold:!0,css:ss,children:e.assessment_name}),(0,h.Y)(We,{assessment:e,setIsEditing:i,setShowDeleteModal:d}),(0,h.Y)(Je,{assessment:e,isModalVisible:o,setIsModalVisible:d})]}),t?(0,h.Y)(qe,{assessment:e,onSuccess:()=>i(!1),onCancel:()=>i(!1)}):(0,h.Y)(Xe.S,{parsedValue:g}),m&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(Ze,{node:u})]})]})};var ns={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const as=({jsonValue:e})=>{const{theme:s}=(0,r.u)();if(!e||'""'===e)return null;let t;try{t=JSON.parse(e)}catch(d){t=e}let a="default",i=JSON.stringify(t,null,2);return"yes"===t?(a="lime",i=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:s.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===t?(a="coral",i=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:s.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof t?i=t:null===t?(a="coral",i=(0,h.FD)(h.FK,{children:[(0,h.Y)(r.k,{css:(0,n.AH)({marginRight:s.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===t?(a="lime",i=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:s.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===t&&(a="coral",i=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:s.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:i,children:(0,h.Y)(o.Tag,{css:(0,n.AH)({display:"inline-flex",maxWidth:"100%",minWidth:s.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:a,children:(0,h.Y)("span",{css:ns,children:i})})})},is=({source:e})=>{const{theme:s}=(0,r.u)();return(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,h.Y)("span",{css:(0,n.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:s.spacing.sm,minWidth:s.spacing.md},""),children:(0,h.Y)(r.T.Text,{children:(0,h.Y)("span",{css:(0,n.AH)({color:s.colors.blue500},""),children:e.source_id})})})})};var rs={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const os=({renderConnector:e=!0,assessment:s,setIsEditing:t})=>{const{theme:i}=(0,r.u)(),[l,d]=(0,a.useState)(!1),c=(e=>{switch(e.source_type){case"HUMAN":return o.UserIcon;case"LLM_JUDGE":return o.SparkleIcon;default:return o.CodeIcon}})(s.source);return(0,h.FD)("div",{css:rs,children:[e&&(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:-1,top:0,width:10,height:i.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:i.borders.borderRadiusMd,borderBottom:`1px solid ${i.colors.border}`,borderLeft:`1px solid ${i.colors.border}`},"")}),(0,h.Y)(c,{size:i.typography.fontSizeSm,css:(0,n.AH)({padding:2,backgroundColor:i.colors.actionIconBackgroundHover,borderRadius:i.borders.borderRadiusFull},"")}),(0,h.Y)(is,{source:s.source}),(0,h.FD)("div",{css:(0,n.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:i.spacing.xs},""),children:[s.last_update_time&&(0,h.Y)(r.T.Text,{color:"secondary",size:"sm",css:(0,n.AH)({marginLeft:i.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:Fe(new Date(s.last_update_time))}),(0,h.Y)(We,{assessment:s,setIsEditing:t,setShowDeleteModal:d}),(0,h.Y)(Je,{assessment:s,isModalVisible:l,setIsModalVisible:d})]})]})},ls=({error:e})=>{const{theme:s}=(0,r.u)(),[t,i]=(0,a.useState)(!1);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs},""),children:[(0,h.Y)(o.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs},""),children:[(0,h.Y)("span",{children:e.error_message}),e.stack_trace&&(0,h.Y)(r.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>i(!0),children:(0,h.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,h.Y)(re.d,{title:(0,h.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:t,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>i(!1),children:(0,h.Y)(J,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:z.cC.TEXT})})]})};var ds={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const cs=({feedback:e})=>{const{theme:s}=(0,r.u)(),t=e.feedback.value;return(0,h.FD)("div",{css:ds,children:[(0,h.Y)(os,{renderConnector:!1,assessment:e}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs,marginLeft:10,paddingLeft:s.spacing.md,paddingTop:s.spacing.sm,paddingBottom:s.spacing.md,paddingRight:s.spacing.lg,borderLeft:`1px solid ${s.colors.border}`},""),children:[(0,c.isNil)(e.feedback.error)?(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.Y)("div",{children:(0,h.Y)(as,{jsonValue:JSON.stringify(t)})})]}):(0,h.Y)(ls,{error:e.feedback.error}),e.rationale&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",css:(0,n.AH)({marginTop:s.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)(ie.V,{children:e.rationale})]})]})]})},ps=({isModalVisible:e,setIsModalVisible:s,feedback:t})=>{const n=(0,a.useMemo)((()=>(e=>{const s=new Set,t=[];let n=e;for(;n&&!s.has(n.assessment_id);)s.add(n.assessment_id),t.push(n),n=n.overriddenAssessment;return t})(t)),[t]);return(0,h.Y)(re.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{s(!1)},title:(0,h.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:n.map((e=>"feedback"in e?(0,h.Y)(cs,{feedback:e},e.assessment_id):null))})};var us={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},ms={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"};const hs=({feedback:e})=>{const[s,t]=(0,a.useState)(!1),{theme:i}=(0,r.u)(),{nodeMap:o,activeView:d}=R(),p=e.feedback.value,u=e.span_id?o[e.span_id]:null,m="summary"===d&&u;return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginLeft:i.spacing.lg},""),children:[!(0,c.isNil)(e.feedback.error)&&(0,h.Y)(ls,{error:e.feedback.error}),m&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(Ze,{node:u})]}),(0,c.isNil)(e.feedback.error)&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,h.Y)(as,{jsonValue:JSON.stringify(p)}),e.overriddenAssessment&&(0,h.FD)(h.FK,{children:[(0,h.Y)("span",{onClick:()=>t(!0),children:(0,h.Y)(r.T.Text,{css:us,color:"secondary",children:(0,h.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,h.Y)(ps,{isModalVisible:s,setIsModalVisible:t,feedback:e})]})]})]}),e.rationale&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,h.Y)(r.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)("div",{css:ms,children:(0,h.Y)(ie.V,{children:e.rationale})})]})]})},gs=({feedback:e})=>{const{theme:s}=(0,r.u)(),[t,i]=(0,a.useState)(!1);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.xs,paddingLeft:s.spacing.lg/2,marginLeft:s.spacing.lg/2,paddingTop:s.spacing.sm,paddingBottom:s.spacing.sm,borderLeft:`1px solid ${s.colors.border}`,position:"relative"},""),children:[(0,h.Y)(os,{assessment:e,setIsEditing:i}),t?(0,h.Y)(qe,{assessment:e,onSuccess:()=>i(!1),onCancel:()=>i(!1)}):(0,h.Y)(hs,{feedback:e})]})};const fs=e=>{const s={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,h.Y)(o.UserIcon,{css:s});case"LLM_JUDGE":return(0,h.Y)(o.SparkleIcon,{css:s});case"CODE":return(0,h.Y)(o.CodeIcon,{css:s});default:return null}};var vs={name:"ti75j2",styles:"margin:0"};const xs=({feedbacks:e})=>{const{theme:s}=(0,r.u)();if(e.length<2)return null;const t=(0,c.countBy)(e,(e=>e.source.source_type));return(0,h.Y)("div",{css:(0,n.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center",marginLeft:s.spacing.xs},""),children:Object.entries(t).map((([e,t])=>(0,h.Y)(o.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:vs,children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[fs(e),(0,h.Y)(r.T.Text,{children:t})]})},e)))})};var bs={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ys={name:"ozd7xs",styles:"flex-shrink:0"},Ys={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Ss=({jsonValue:e,feedbacks:s})=>{const{theme:t}=(0,r.u)(),[i,l]=(0,a.useState)(!1);return(0,h.FD)("div",{css:bs,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center"},""),children:[(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:ys,size:"small",icon:i?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}),onClick:()=>l(!i)}),(0,h.Y)(as,{jsonValue:e}),(0,h.Y)(xs,{feedbacks:s})]}),i&&(0,h.Y)("div",{css:Ys,children:s.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,h.Y)(gs,{feedback:e},e.assessment_id)))})]})};var Ts={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},ws={name:"ozd7xs",styles:"flex-shrink:0"};const As=({name:e,valuesMap:s,traceId:t,activeSpanId:i})=>{const{theme:l}=(0,r.u)(),d=(e=>{const s=e.split("/");return 1===s.length?e:2===s.length?s[1]:s.slice(2).join("/")})(e),[p,u]=(0,a.useState)(!1),m=Object.values(s).flat().some((e=>!(0,c.isNil)(e.feedback.error)));return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},""),children:[(0,h.Y)(r.T.Text,{bold:!0,css:Ts,children:d}),m&&(0,h.Y)(r.k,{css:ws,color:"danger"})]}),(0,h.Y)(re.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,n.AH)({flexShrink:0,marginRight:-l.spacing.xs},""),size:"small",icon:(0,h.Y)(o.PlusIcon,{}),onClick:()=>u(!0)})})]}),Object.entries(s).map((([e,s])=>(0,h.Y)(Ss,{jsonValue:e,feedbacks:s},e))),p&&(0,h.Y)(Ve,{assessmentName:e,spanId:i,traceId:t,setExpanded:u})]})};var Ms={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const ks=({assessments:e,traceId:s,activeSpanId:t})=>{const{theme:i}=(0,r.u)(),{setAssessmentsPaneExpanded:o}=R(),[d,p]=(0,a.useMemo)((()=>(0,c.partition)(e,(e=>"feedback"in e))),[e]),u=(0,a.useMemo)((()=>(e=>{const s={};return e.forEach((e=>{if(!1===e.valid)return;let t=null;""!==e.feedback.value&&(t=JSON.stringify(e.feedback.value));const{assessment_name:n}=e;s[n]||(s[n]={});const a=s[n];(0,c.isNil)(t)||(a[t]||(a[t]=[]),a[t].push(e))})),Object.entries(s).toSorted((([e],[s])=>e.localeCompare(s)))})(d)),[d]),m=p.toSorted(((e,s)=>e.assessment_name.localeCompare(s.assessment_name)));return(0,h.FD)("div",{"data-testid":"assessments-pane",css:(0,n.AH)({display:"flex",flexDirection:"column",padding:i.spacing.sm,paddingTop:i.spacing.xs,height:"100%",borderLeft:`1px solid ${i.colors.border}`,overflowY:"scroll",minWidth:Ce,width:"100%",boxSizing:"border-box"},""),children:[(0,h.FD)("div",{css:Ms,children:[(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginBottom:i.spacing.sm},""),bold:!0,children:(0,h.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),o&&(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,h.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,h.Y)(r.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,h.Y)(r.C,{}),onClick:()=>o(!1)})})]}),u.map((([e,n])=>(0,h.Y)(As,{name:e,valuesMap:n,traceId:s,activeSpanId:t},e))),m.length>0&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.T.Text,{color:"secondary",css:(0,n.AH)({marginBottom:i.spacing.sm},""),children:(0,h.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginBottom:i.spacing.sm},""),children:m.map((e=>(0,h.Y)(ts,{expectation:e},e.assessment_id)))})]}),(0,h.Y)(Pe,{title:(0,h.Y)(l.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:t,traceId:s})]})};function Ds({activeSpan:e,searchFilter:s,activeMatch:t,activeTab:i,setActiveTab:p}){const{theme:u}=(0,r.u)(),[m,g]=(0,a.useState)(500),f={flex:1,marginTop:-u.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:b}=R();if((0,c.isNil)(e))return(0,h.Y)(o.Empty,{description:"Please select a span to view more information"});const y=(0,d.N7)(e),Y=y>0,S=!(0,c.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,c.isNil)(null===e||void 0===e?void 0:e.outputs),T=(0,h.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${u.colors.border}`,minWidth:200,position:"relative"},""),value:i,onValueChange:e=>p(e),children:[(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",right:v?u.spacing.xs:u.spacing.md,top:u.spacing.xs},""),children:(0,h.Y)(Me,{})}),(0,h.FD)(o.Tabs.List,{css:(0,n.AH)({padding:0,paddingLeft:u.spacing.md,paddingRight:u.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,h.Y)(o.Tabs.Trigger,{value:"chat",children:(0,h.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),S&&(0,h.Y)(o.Tabs.Trigger,{value:"content",children:(0,h.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,h.Y)(o.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,h.FD)(o.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,h.Y)(Te,{count:y})]})]}),e.chatMessages&&(0,h.Y)(o.Tabs.Content,{css:f,value:"chat",children:(0,h.Y)(se,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,h.Y)(o.Tabs.Content,{css:f,value:"content",children:(0,h.Y)(Ye,{activeSpan:e,searchFilter:s,activeMatch:t})}),(0,h.Y)(o.Tabs.Content,{css:f,value:"attributes",children:(0,h.Y)(U,{activeSpan:e,searchFilter:s,activeMatch:t})}),(0,h.Y)(o.Tabs.Content,{css:f,value:"events",children:(0,h.Y)(Se,{activeSpan:e,searchFilter:s,activeMatch:t})})]});return b&&v?(0,h.Y)(x,{initialRatio:.7,paneWidth:m,setPaneWidth:g,leftChild:T,leftMinWidth:250,rightChild:(0,h.Y)(ks,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:Ce}):T}const Is=a.memo(Ds),Cs=({spanFilterState:e,setSpanFilterState:s})=>{const{theme:t}=(0,r.u)();return(0,h.FD)(r.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,h.Y)(r.aw.Trigger,{asChild:!0,children:(0,h.Y)(r.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,h.Y)(o.FilterIcon,{}),size:"small",children:(0,h.Y)(l.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,h.Y)(r.aw.Content,{align:"start",children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingBottom:t.spacing.xs},""),children:[(0,h.Y)(r.T.Text,{bold:!0,children:(0,h.Y)(l.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,h.Y)(r.T.Text,{color:"secondary",children:(0,h.Y)(l.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([a,i])=>{const l=(0,h.Y)(Qe.P,{type:(0,d.tC)(a)});return(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${a}-${!i}`,style:{width:"100%"},isChecked:i,onChange:()=>s({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[a]:!i}}),children:[l,(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginLeft:t.spacing.xs},""),children:(0,d.LS)(a)})]},a)})),(0,h.Y)(r.T.Text,{color:"secondary",children:(0,h.Y)(l.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>s({...e,showParents:!e.showParents}),children:[(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginRight:t.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,h.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,h.Y)(l.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>s({...e,showExceptions:!e.showExceptions}),children:[(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginRight:t.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,h.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,h.Y)(l.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},Fs=({showTimelineInfo:e,setShowTimelineInfo:s,spanFilterState:t,setSpanFilterState:a})=>{const{theme:i}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({padding:`${i.spacing.xs}px ${i.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${i.colors.border}`,boxSizing:"border-box",paddingLeft:i.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,h.Y)(r.T.Text,{bold:!0,children:(0,h.Y)(l.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[(0,h.Y)(Cs,{spanFilterState:t,setSpanFilterState:a}),(0,h.FD)(o.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{s(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,h.Y)(o.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,h.Y)(l.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,h.Y)(o.ListBorderIcon,{})}),value:!1}),(0,h.Y)(o.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,h.Y)(l.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,h.Y)(o.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},Hs=({active:e})=>{const{theme:s}=(0,r.u)(),t=e?s.colors.blue500:s.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:"100%",bottom:0,width:9,height:s.spacing.md,boxSizing:"border-box",borderTopRightRadius:s.borders.borderRadiusMd,borderTop:`1px solid ${t}`,borderRight:`1px solid ${t}`,zIndex:M},"")})},Rs=({active:e})=>{const{theme:s}=(0,r.u)(),t=e?s.colors.blue500:s.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:"50%",top:0,width:8,height:s.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:s.borders.borderRadiusMd,borderBottom:`1px solid ${t}`,borderLeft:`1px solid ${t}`,zIndex:e?A:M},"")})},Ns=({active:e})=>{const{theme:s}=(0,r.u)(),t=e?s.colors.blue500:s.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",width:8,left:"50%",height:32,borderLeft:`1px solid ${t}`,boxSizing:"border-box",zIndex:e?A:M},"")})},Es=({isActiveSpan:e,isInActiveChain:s,linesToRender:t,hasChildren:a,isExpanded:i})=>0===t.length?(0,h.Y)("div",{css:(0,n.AH)({width:0,height:32,boxSizing:"border-box",position:"relative"},""),children:a&&(0,h.Y)(Hs,{active:s&&!e})}):(0,h.Y)(h.FK,{children:t.map((({shouldRender:r,isActive:o},l)=>(0,h.FD)("div",{css:(0,n.AH)({width:16,height:32,boxSizing:"border-box",position:"relative"},""),children:[r&&(0,h.Y)(Ns,{active:o}),l===t.length-1&&(0,h.FD)(h.FK,{children:[(0,h.Y)(Rs,{active:s}),a&&i&&(0,h.Y)(Hs,{active:s&&!e})]})]},l)))});var Bs={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const zs=({span:e,children:s})=>{var t;const{theme:a}=(0,r.u)(),i=(0,d.tC)(null!==(t=e.type)&&void 0!==t?t:z.UG.UNKNOWN),o=a.isDarkMode?a.colors.grey800:a.colors.grey100,c=a.isDarkMode?a.colors.grey500:a.colors.grey350;return(0,h.Y)(re.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,h.FD)("div",{css:Bs,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:a.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,h.Y)(Qe.P,{type:i,isInTooltip:!0}),(0,h.Y)("span",{css:(0,n.AH)({color:o},""),children:e.title}),(0,h.Y)("span",{css:(0,n.AH)({marginLeft:a.spacing.xs,color:c,fontSize:a.typography.fontSizeSm},""),children:I(e.end-e.start)})]}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",color:o},""),children:[(0,h.Y)(l.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",I(e.start)," | ",(0,h.Y)(l.sA,{id:"q90jVU",defaultMessage:"End:"})," ",I(e.end)]})]}),side:"right",maxWidth:700,children:s})};var Ks={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},js={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const Ls=({node:e,selectedKey:s,expandedKeys:t,setExpandedKeys:a,traceStartTime:i,traceEndTime:l,onSelect:c,linesToRender:p})=>{var u,m;const g=t.has(e.key),{theme:f}=(0,r.u)(),v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,{setAssessmentsPaneExpanded:x}=R(),b=s===e.key,y=C(e,String(s)),Y=y>-1,S=(0,d.N7)(e)>0,T=b?f.colors.actionDefaultBackgroundHover:"transparent";return(0,h.FD)(h.FK,{children:[(0,h.Y)(zs,{span:e,children:(0,h.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:T,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===c||void 0===c||c(e)},children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,h.FD)("div",{css:Ks,children:[v?(0,h.Y)(r.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:g?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}),onClick:s=>{s.stopPropagation();const n=new Set(t);g?n.delete(e.key):n.add(e.key),a(n)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,h.Y)("div",{css:(0,n.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,h.Y)(Es,{isActiveSpan:b,isInActiveChain:Y,linesToRender:p,hasChildren:v,isExpanded:g}),(0,h.Y)("span",{css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${y>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:A},""),children:e.icon}),(0,h.Y)(r.T.Text,{color:S?"error":"primary",css:js,children:e.title}),e.assessments.length>0&&(0,h.FD)(o.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,n.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===x||void 0===x?void 0:x(!0),children:[(0,h.Y)(o.GavelIcon,{}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),g&&(null===(m=e.children)||void 0===m?void 0:m.map(((n,r)=>{var o,d;return(0,h.Y)(Ls,{node:n,expandedKeys:t,setExpandedKeys:a,selectedKey:s,traceStartTime:i,traceEndTime:l,onSelect:c,linesToRender:p.concat({shouldRender:r<(null!==(o=null===(d=e.children)||void 0===d?void 0:d.length)&&void 0!==o?o:0)-1,isActive:r<y})},n.key)})))]})};var Os={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const $s=({node:e,selectedKey:s,leftOffset:t,width:i,onSelect:l,expandedKeys:d,setExpandedKeys:c})=>{var p;const{theme:u}=(0,r.u)(),m=(0,a.useRef)(null),g=(0,a.useRef)(null),f=s===e.key?u.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,x=d.has(e.key);return(0,a.useLayoutEffect)((()=>{if(!m.current||!g.current)return;Math.max(m.current.offsetWidth,g.current.offsetWidth)<i-u.spacing.sm?(m.current.style.display="inline",g.current.style.display="none"):(m.current.style.display="none",g.current.style.display="inline")}),[u.spacing.sm,i]),(0,h.Y)(zs,{span:e,children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:u.spacing.xs,paddingRight:u.spacing.sm,paddingTop:u.spacing.xs,paddingBottom:u.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:u.colors.actionDefaultBackgroundHover},":active":{backgroundColor:u.colors.actionDefaultBackgroundPress},zIndex:A},""),onClick:()=>null===l||void 0===l?void 0:l(e),children:[v?(0,h.Y)(r.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:u.spacing.xs},""),icon:x?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}),onClick:s=>{s.stopPropagation();const t=new Set(d);x?t.delete(e.key):t.add(e.key),c(t)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,h.Y)("div",{css:(0,n.AH)({width:24,marginRight:u.spacing.xs},"")}),(0,h.Y)("div",{css:(0,n.AH)({width:t,flexShrink:0},"")}),(0,h.Y)("div",{css:(0,n.AH)({position:"relative",width:i,height:u.typography.lineHeightBase,backgroundColor:u.colors.blue600,borderRadius:u.borders.borderRadiusSm,flexShrink:0},""),children:(0,h.Y)(r.T.Text,{children:(0,h.Y)("span",{ref:m,css:(0,n.AH)({marginLeft:u.spacing.xs,color:u.colors.white,display:"none"},""),children:e.title})})}),(0,h.FD)("div",{css:Os,children:[(0,h.Y)(r.T.Text,{children:(0,h.Y)("span",{ref:g,css:(0,n.AH)({marginLeft:u.spacing.xs,color:u.colors.textPrimary},""),children:e.title})}),(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginLeft:u.spacing.xs},""),color:"secondary",children:I(e.end-e.start)})]})]},e.key)})};var _s={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},Vs={name:"bjn8wh",styles:"position:relative"},Ps={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const Ws=({nodes:e,selectedKey:s,onSelect:t,traceStartTime:i,traceEndTime:o,expandedKeys:l,setExpandedKeys:d})=>{var c,p;const{theme:u}=(0,r.u)(),g=(0,a.useRef)(null),f=null!==(c=null===(p=(0,m.wY)({ref:g}))||void 0===p?void 0:p.width)&&void 0!==c?c:0,v=(0,a.useMemo)((()=>function(e,s,t,n=60){const a=s-e;if(a<=0||t<=0)return[];const i=Math.floor(t/n);if(i<1)return[];const r=a/i,o=Math.pow(10,Math.floor(Math.log10(r))),l=r/o;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*o,p=s+2*c,u=[];for(let m=Math.ceil(e/c)*c;m<=p;m+=c)u.push(Number(m.toFixed(10)));return u}(i,o,f)),[o,i,f]),x=Math.min(...v),b=(v[v.length-1]+v[v.length-2])/2,y=v.slice(0,-1),Y=e=>function(e,s,t,n){return(e-s)/(t-s)*n}(e,x,b,f);return(0,h.FD)("div",{css:_s,children:[(0,h.Y)("div",{ref:g,css:(0,n.AH)({display:"flex",width:"100%",flexDirection:"row",height:u.typography.lineHeightBase,paddingLeft:32,paddingRight:u.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:u.colors.backgroundPrimary,zIndex:w},""),children:(0,h.Y)("div",{"data-testid":"time-marker-area",css:Vs,children:y.map((e=>(0,h.Y)(r.T.Text,{css:(0,n.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:I(e)},e)))})}),(0,h.Y)("div",{css:(0,n.AH)({flex:1,pointerEvents:"none",zIndex:M},""),children:(0,h.Y)("div",{css:Ps,children:y.map((e=>(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${u.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const n=Y(e.start),a=Y(e.end)-n;return(0,h.Y)($s,{selectedKey:s,onSelect:t,node:e,leftOffset:n,width:a,expandedKeys:l,setExpandedKeys:d},e.key)}))]})};var Js={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},Us={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},Gs={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},qs={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const Xs=({rootNodes:e,selectedNode:s,setSelectedNode:t,traceStartTime:i,traceEndTime:o,expandedKeys:d,setExpandedKeys:c,spanFilterState:p,setSpanFilterState:u,className:m})=>{const{theme:g}=(0,r.u)(),f=(0,a.useCallback)((e=>{null===t||void 0===t||t(e)}),[t]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:x}=R(),b=(0,a.useMemo)((()=>((e,s)=>{const t=[],n=e=>{var a;e&&(t.push(e),s.has(e.key)&&(null===(a=e.children)||void 0===a||a.forEach(n)))};return e.forEach(n),t})(e,d)),[e,d]),y=(0,a.useMemo)((()=>{var t;return(0,h.Y)("div",{css:Js,children:v?(0,h.Y)(Ws,{nodes:b,selectedKey:null!==(t=null===s||void 0===s?void 0:s.key)&&void 0!==t?t:"",onSelect:f,traceStartTime:i,traceEndTime:o,expandedKeys:d,setExpandedKeys:c}):e.map((e=>{var t;return(0,h.Y)(Ls,{node:e,expandedKeys:d,setExpandedKeys:c,selectedKey:null!==(t=null===s||void 0===s?void 0:s.key)&&void 0!==t?t:"",traceStartTime:i,traceEndTime:o,onSelect:f,linesToRender:[]},e.key)}))})}),[v,b,null===s||void 0===s?void 0:s.key,f,i,o,e,d,c]);return(0,h.Y)("div",{css:(0,n.AH)({height:"100%",borderRadius:g.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:m,children:(0,h.Y)("div",{css:Us,children:(0,h.FD)("div",{css:Gs,children:[(0,h.Y)(Fs,{showTimelineInfo:v,setShowTimelineInfo:x,spanFilterState:p,setSpanFilterState:u}),e.length>0?(0,h.Y)("div",{css:qs,children:y}):(0,h.Y)("div",{css:(0,n.AH)({flex:1,display:"flex",justifyContent:"center",padding:g.spacing.md,paddingTop:g.spacing.lg},""),children:(0,h.Y)(l.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Qs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Zs={name:"82a6rk",styles:"flex:1"};const et=({modelTrace:e,className:s,selectedSpanId:t,onSelectSpan:i})=>{var o,l;const{theme:d}=(0,r.u)(),p=window.innerWidth<=768?.33:.25,u=(0,a.useRef)(null),[m,g]=(0,a.useState)(500),{rootNode:f,selectedNode:v,setSelectedNode:b,activeTab:y,setActiveTab:Y}=R(),{expandedKeys:w,setExpandedKeys:A}=((e={})=>{const[s,t]=(0,a.useState)((()=>{if(e.rootNodes){const s=(0,c.values)(D(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(s)}return new Set}));return{expandedKeys:s,setExpandedKeys:t}})({rootNodes:f?[f]:[],initialExpandDepth:T}),{matchData:M,searchFilter:k,setSearchFilter:I,spanFilterState:C,setSpanFilterState:H,filteredTreeNodes:N,handleNextSearchMatch:E,handlePreviousSearchMatch:z}=B({treeNode:f,selectedNode:v,setSelectedNode:b,setActiveTab:Y,setExpandedKeys:A,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,a.useLayoutEffect)((()=>{const e=(0,c.values)(D(N,T)).map((e=>e.key));A(new Set(e))}),[N,A]);const K=(0,a.useMemo)((()=>{const e=16*Math.max(...N.map(F))+7*d.spacing.lg;return Math.max(275,e)}),[N,d.spacing.lg]);return(0,h.FD)("div",{css:Qs,className:s,children:[(0,h.Y)("div",{css:(0,n.AH)({padding:d.spacing.xs,borderBottom:`1px solid ${d.colors.border}`},""),children:(0,h.Y)(S,{searchFilter:k,setSearchFilter:I,matchData:M,handleNextSearchMatch:E,handlePreviousSearchMatch:z})}),(0,h.Y)(x,{ref:u,initialRatio:p,paneWidth:m,setPaneWidth:g,leftChild:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:K},""),children:(0,h.Y)(Xs,{rootNodes:N,selectedNode:v,traceStartTime:null!==(o=null===f||void 0===f?void 0:f.start)&&void 0!==o?o:0,traceEndTime:null!==(l=null===f||void 0===f?void 0:f.end)&&void 0!==l?l:0,setSelectedNode:e=>{b(e),(0,c.isString)(null===e||void 0===e?void 0:e.key)&&(null===i||void 0===i||i(null===e||void 0===e?void 0:e.key))},css:Zs,expandedKeys:w,setExpandedKeys:A,spanFilterState:C,setSpanFilterState:H})}),leftMinWidth:K,rightChild:(0,h.Y)(Is,{activeSpan:v,searchFilter:k,activeMatch:M.match,activeTab:y,setActiveTab:Y}),rightMinWidth:500})]})},st=()=>(0,h.Y)(o.Empty,{title:(0,h.Y)(l.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,h.Y)(l.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,h.Y)(r.k,{})});var tt=t(49708);const nt=({traceId:e,setModelTrace:s,setAssessmentsPaneEnabled:t,enabled:n=!0})=>{const a=[d.BS,e];return(0,tt.I)({queryKey:a,queryFn:()=>(({traceId:e})=>Oe(`/ajax-api/3.0/mlflow/traces/${e}`))({traceId:e}),onSuccess:e=>{s((s=>{var t,n;return{data:s.data,info:null!==(t=null===e||void 0===e||null===(n=e.trace)||void 0===n?void 0:n.trace_info)&&void 0!==t?t:{}}})),t(!0)},onError:()=>{t(!1)},enabled:n})},at=({title:e,tools:s})=>{const{theme:t}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,padding:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusSm},""),children:[e&&(0,h.Y)(r.T.Text,{css:(0,n.AH)({marginLeft:t.spacing.xs},""),bold:!0,children:e}),s.map((e=>(0,h.Y)(q,{tool:e},e.function.name)))]})},it=({title:e,documents:s})=>{const{theme:t}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({backgroundColor:t.colors.backgroundPrimary,borderRadius:t.borders.borderRadiusSm,border:`1px solid ${t.colors.border}`},""),children:[e&&(0,h.Y)("div",{css:(0,n.AH)({padding:`${t.spacing.xs}px ${t.spacing.sm}px`,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,h.Y)(r.T.Text,{bold:!0,children:e})}),s.map(((e,a)=>(0,h.Y)("div",{css:(0,n.AH)({borderBottom:a!==s.length-1?`1px solid ${t.colors.border}`:""},""),children:(0,h.Y)(ge,{text:e.page_content,metadata:e.metadata},a)},a)))]})},rt=({title:e,value:s})=>{const{theme:t}=(0,r.u)(),[i,d]=(0,a.useState)(!1),c=s.length>400,p=!i&&s.length>400?s.slice(0,400)+"...":s,u=c?{":hover":{backgroundColor:t.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,h.FD)("div",{css:(0,n.AH)({border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusSm},""),children:[e&&(0,h.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${t.spacing.sm}px ${t.spacing.sm+t.spacing.xs}px`,...u},""),onClick:()=>d(!i),children:[(0,h.Y)(r.T.Text,{bold:!0,children:e}),c&&(i?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}))]}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingLeft:t.spacing.sm+t.spacing.xs,paddingRight:t.spacing.sm+t.spacing.xs,paddingTop:e?0:t.spacing.sm,paddingBottom:t.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,h.Y)(ie.V,{children:p}),c&&(0,h.Y)(r.T.Link,{onClick:()=>d(!i),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:i?(0,h.Y)(l.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,h.Y)(l.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},ot=({title:e,data:s,renderMode:t})=>{const n=(0,a.useMemo)((()=>{try{return JSON.parse(s)}catch(e){return s}}),[s]),i=(0,c.isString)(n),r=(0,d.Hq)(n),o=Array.isArray(n)&&n.length>0&&(0,c.every)(n,d.PC),l=Array.isArray(n)&&n.length>0&&(0,c.every)(n,d.W0);return"json"===t?(0,h.Y)(J,{title:e,data:s,initialRenderMode:z.cC.JSON}):"text"===t?(0,h.Y)(J,{title:e,data:s,initialRenderMode:z.cC.TEXT}):i?(0,h.Y)(rt,{title:e,value:n}):r&&r.length>0?(0,h.Y)(Q,{messages:r}):o?(0,h.Y)(at,{title:e,tools:n}):l?(0,h.Y)(it,{title:e,documents:n}):(0,h.Y)(J,{title:e,data:s})},lt=({node:e})=>{var s;const{theme:t}=(0,r.u)(),a=(0,d.bn)(e),i=!e.parentId,l=a[0];return l?(0,h.Y)(ee,{css:(0,n.AH)({marginBottom:i?t.spacing.sm:0},""),withBorder:i,sectionKey:l.name,title:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm},""),children:[(0,h.Y)(o.XCircleIcon,{color:"danger"}),(0,h.Y)(r.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingBottom:t.spacing.sm,paddingLeft:i?0:t.spacing.lg},""),children:Object.entries(null!==(s=l.attributes)&&void 0!==s?s:{}).map((([e,s])=>(0,h.Y)(ot,{title:e,data:JSON.stringify(s,null,2),renderMode:"text"},e)))})},l.name):null};var dt={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},ct={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},pt={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const ut=({node:e,renderMode:s})=>{const{theme:t}=(0,r.u)(),[i,c]=(0,a.useState)(!1),p=(0,a.useMemo)((()=>(0,d.g_)(e.inputs)),[e]),u=(0,a.useMemo)((()=>(0,d.g_)(e.outputs)),[e]),m=(0,d.bn)(e).length>0,g=p.length>0,f=u.length>0,{setSelectedNode:v,setActiveView:x,setShowTimelineTreeGantt:b}=R();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,h.Y)("div",{css:(0,n.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,h.Y)(r.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:t.spacing.xs},""),icon:i?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(r.o,{}),onClick:()=>c(!i),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,h.Y)("div",{css:(0,n.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${t.colors.border}`,width:12},""),children:(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`2px solid ${t.colors.border}`,borderLeft:`2px solid ${t.colors.border}`},"")})}),(0,h.FD)("div",{css:dt,children:[(0,h.FD)("div",{css:ct,children:[(0,h.Y)(r.T.Text,{color:"secondary",css:(0,n.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,h.Y)(l.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,h.Y)(Ze,{node:e})}})}),(0,h.Y)("span",{onClick:()=>{v(e),x("detail"),b(!0)},children:(0,h.Y)(r.T.Text,{css:pt,color:"secondary",children:I(e.end-e.start)})})]}),i&&(0,h.FD)("div",{children:[m&&(0,h.Y)(lt,{node:e}),g&&(0,h.Y)(ee,{sectionKey:"input",title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingLeft:t.spacing.lg,marginBottom:f?0:t.spacing.sm},""),children:p.map((({key:e,value:t},n)=>(0,h.Y)(ot,{title:e,data:t,renderMode:s},e||n)))})}),f&&(0,h.Y)(ee,{sectionKey:"output",title:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingLeft:t.spacing.lg,marginBottom:t.spacing.sm},""),children:u.map((({key:e,value:t})=>(0,h.Y)(ot,{title:e,data:t,renderMode:s},e)))})})]})]})]})},mt=({rootNode:e,intermediateNodes:s})=>{const{theme:t}=(0,r.u)(),[i,c]=(0,a.useState)("default"),p=e.inputs,u=e.outputs,m=(0,d.bn)(e),g=s.length>0,f=m.length>0,v=(0,d.g_)(p),x=(0,d.g_)(u);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:t.spacing.md,paddingTop:t.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:t.spacing.sm},""),children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:t.spacing.sm},""),children:[(0,h.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:i,size:"small",onChange:e=>c(e.target.value),children:[(0,h.Y)(o.SegmentedControlButton,{value:"default",children:(0,h.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,h.Y)(o.SegmentedControlButton,{value:"json",children:(0,h.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,h.Y)(Me,{})]})}),f&&(0,h.Y)(lt,{node:e}),(0,h.Y)(ee,{withBorder:!0,title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,n.AH)({marginBottom:g?0:t.spacing.md},""),sectionKey:"summary-inputs",children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:v.map((({key:e,value:s},t)=>(0,h.Y)(ot,{title:e,data:s,renderMode:i},e||t)))})}),g&&s.map((e=>(0,h.Y)(ut,{node:e,renderMode:i},e.key))),(0,h.Y)(ee,{withBorder:!0,title:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:x.map((({key:e,value:s},t)=>(0,h.Y)(ot,{title:e,data:s,renderMode:i},e||t)))})})]})},ht=e=>{var s;return!!e.parentId&&([z.UG.AGENT,z.UG.RETRIEVER,z.UG.CHAT_MODEL,z.UG.TOOL,z.UG.LLM].includes(null!==(s=e.type)&&void 0!==s?s:z.UG.UNKNOWN)||(0,d.N7)(e)>0)},gt=({modelTrace:e})=>{const{theme:s}=(0,r.u)(),[t,i]=(0,a.useState)(500),{rootNode:d,nodeMap:c,assessmentsPaneEnabled:p,assessmentsPaneExpanded:u}=R(),m=(0,a.useMemo)((()=>Object.values(c).flatMap((e=>e.assessments))),[c]),g=(0,a.useMemo)((()=>{if(!d)return[];return k([d]).filter(ht)}),[d]);return d?p&&u?(0,h.Y)(x,{initialRatio:.75,paneWidth:t,setPaneWidth:i,leftChild:(0,h.Y)(mt,{rootNode:d,intermediateNodes:g}),rightChild:(0,h.Y)(ks,{assessments:m,traceId:d.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:Ce}):(0,h.Y)(mt,{rootNode:d,intermediateNodes:g}):(0,h.Y)("div",{css:(0,n.AH)({marginTop:s.spacing.lg},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})})};var ft=t(7655),vt=t(40724);var xt={name:"e0dnmk",styles:"cursor:pointer"};const bt=({label:e,value:s,icon:t,tagKey:a,color:i="teal",getTruncatedLabel:l,getComponentId:d,onCopy:c})=>{const{theme:p}=(0,r.u)();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,h.Y)(r.T.Text,{size:"md",color:"secondary",children:e}),(0,h.Y)(re.T,{componentId:d(a),content:s,maxWidth:400,children:(0,h.Y)(o.Tag,{componentId:d(a),color:i,onClick:()=>{navigator.clipboard.writeText(s),c()},css:xt,children:(0,h.FD)("span",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:p.spacing.xs},""),children:[t&&(0,h.Y)("span",{children:t}),(0,h.Y)("span",{children:l(s)})]})})})]})};var yt={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},Yt={name:"e0dnmk",styles:"cursor:pointer"};const St=({modelTrace:e})=>{var s;(0,ft.A)();const{theme:t}=(0,r.u)(),[i,l]=(0,a.useState)(!1),{rootNode:c}=R(),u=Object.entries(null!==(s=e.info.tags)&&void 0!==s?s:{}).filter((([e])=>{return!(s=e).startsWith("mlflow.")&&!s.startsWith("_mlflow_");var s})),m=(0,d.MF)(e),g=(0,a.useMemo)((()=>{var s,t,n;return(e=>{try{return JSON.parse(e)}catch(s){return}})(null!==(s=null===(t=e.info)||void 0===t||null===(n=t.trace_metadata)||void 0===n?void 0:n["mlflow.trace.tokenUsage"])&&void 0!==s?s:"{}")}),[e.info]),f=(0,a.useMemo)((()=>null===g||void 0===g?void 0:g.total_tokens),[g]),v=(0,a.useMemo)((()=>{if(c)return I(c.end-c.start)}),[c]),x=(0,a.useCallback)((e=>`mlflow.model_trace_explorer.header_details.tag-${e}`),[]),b=e=>((e,s)=>{const t=p().truncate(e,{length:s});return p().takeWhile(t,(e=>"\n"!==e)).join("")})(e,40),Y=(0,a.useCallback)((()=>{l(!0),setTimeout((()=>l(!1)),2e3)}),[]);return(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:t.spacing.md,flexWrap:"wrap"},""),children:[m&&(0,h.Y)(bt,{label:(0,h.Y)(vt.A,{id:"imKpxw",defaultMessage:"ID"}),value:m,tagKey:m,color:"pink",getTruncatedLabel:b,getComponentId:x,onCopy:Y}),f&&(0,h.Y)(bt,{label:(0,h.Y)(vt.A,{id:"zp4MBw",defaultMessage:"Token count"}),value:f.toString(),tagKey:"token-count",color:"default",getTruncatedLabel:b,getComponentId:x,onCopy:Y}),v&&(0,h.Y)(bt,{label:(0,h.Y)(vt.A,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,h.Y)(y.C,{css:yt}),value:v,tagKey:"latency",color:"default",getTruncatedLabel:b,getComponentId:x,onCopy:Y}),u.length>0&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:t.spacing.sm},""),children:[(0,h.Y)(r.T.Text,{size:"md",color:"secondary",children:(0,h.Y)(vt.A,{id:"7KPJii",defaultMessage:"Tags"})}),(0,h.Y)(o.Overflow,{noMargin:!0,children:u.map((([e,s])=>{const t=`${e}-${s}`,n=`${e}: ${s}`;return(0,h.Y)(re.T,{componentId:x(t),content:n,children:(0,h.Y)(o.Tag,{componentId:x(t),color:"teal",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),Y()},css:Yt,children:b(`${e}: ${s}`)})},e)}))})]})]}),i&&(0,h.FD)(o.Notification.Provider,{children:[(0,h.Y)(o.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,h.Y)(o.Notification.Title,{children:(0,h.Y)(vt.A,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,h.Y)(o.Notification.Viewport,{})]})]})};var Tt={name:"lve99z",styles:"& > div:nth-of-type(2){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},wt={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},At={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Mt=({modelTrace:e,className:s,selectedSpanId:t,onSelectSpan:a})=>{const{theme:i}=(0,r.u)(),{activeView:d,setActiveView:c}=R();return(0,h.FD)(o.Tabs.Root,{componentId:"model-trace-explorer",value:d,onValueChange:e=>c(e),css:Tt,children:[(0,h.Y)("div",{css:(0,n.AH)({paddingLeft:i.spacing.md,paddingBottom:i.spacing.sm},""),children:(0,h.Y)(St,{modelTrace:e})}),(0,h.FD)(o.Tabs.List,{css:(0,n.AH)({paddingLeft:i.spacing.md,flexShrink:0},""),children:[(0,h.Y)(o.Tabs.Trigger,{value:"summary",children:(0,h.Y)(l.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,h.Y)(o.Tabs.Trigger,{value:"detail",children:(0,h.Y)(l.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,h.Y)(o.Tabs.Content,{value:"summary",css:wt,children:(0,h.Y)(gt,{modelTrace:e})}),(0,h.Y)(o.Tabs.Content,{value:"detail",css:At,children:(0,h.Y)(et,{modelTrace:e,className:s,selectedSpanId:t,onSelectSpan:a})})]})},kt=({children:e})=>(0,h.Y)(i.tH,{fallbackRender:st,children:e}),Dt=({modelTrace:e,className:s,initialActiveView:t,selectedSpanId:n,onSelectSpan:i})=>{var r;const[o,l]=(0,a.useState)(e),[c,p]=(0,a.useState)(!1),u=(0,d.MF)(e),[m,g]=(r=(0,d.ob)(e),(0,a.useState)(u.startsWith("tr-")));return nt({traceId:u,setModelTrace:l,setAssessmentsPaneEnabled:g,enabled:u.startsWith("tr-")}),(0,a.useEffect)((()=>{l(e)}),[u]),(0,h.Y)(kt,{traceId:u,children:(0,h.Y)(N,{modelTrace:o,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:m,children:(0,h.Y)(Mt,{modelTrace:o,className:s,selectedSpanId:n,onSelectSpan:i})})})}},15929:function(e,s,t){t.d(s,{F:function(){return d}});var n=t(68248),a=t(27757),i=t(74060),r=t(73408);var o={name:"15currb",styles:"display:flex;height:100%"},l={name:"82a6rk",styles:"flex:1"};const d=({label:e})=>{const{theme:s}=(0,a.u)();return(0,r.FD)("div",{css:o,children:[(0,r.FD)("div",{css:l,children:[(0,r.Y)("div",{css:(0,n.AH)({padding:s.spacing.sm,borderBottom:`1px solid ${s.colors.border}`},""),children:(0,r.Y)(i.TitleSkeleton,{label:e})}),(0,r.FD)("div",{css:(0,n.AH)({borderRadius:s.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,r.Y)("div",{css:(0,n.AH)({flex:1,padding:s.spacing.sm,borderRight:`1px solid ${s.colors.border}`},""),children:(0,r.Y)(i.TableSkeleton,{lines:5})}),(0,r.Y)("div",{css:(0,n.AH)({flex:2,padding:s.spacing.sm},""),children:(0,r.Y)(i.TableSkeleton,{lines:5})})]})]}),(0,r.Y)("div",{css:(0,n.AH)({padding:s.spacing.md,overflowY:"auto",flex:1},""),children:(0,r.Y)(i.TableSkeleton,{lines:12})})]})}},33145:function(e,s,t){t.d(s,{e:function(){return n}});const n=e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value},44666:function(e,s,t){t.d(s,{w:function(){return n}});const n=()=>"User"},57248:function(e,s,t){t.d(s,{I:function(){return l},a:function(){return d}});var n=t(46709),a=t(76118),i=t(33145);var r=t(73408);const o=(0,n.createContext)({schemas:[]}),l=({children:e,assessments:s})=>{const t=(0,n.useMemo)((()=>(e=>{const s={},t={};for(const n of e){if(s[n.assessment_name])continue;const e=(0,i.e)(n);if((0,a.isNil)(e)){t[n.assessment_name]={name:n.assessment_name,assessmentType:"feedback"in n?"feedback":"expectation",dataType:"boolean"};continue}const r="expectation"in n&&"serialized_value"in n.expectation;let o;switch(typeof e){case"string":o=r?"json":"string";break;case"boolean":default:o="boolean";break;case"number":o="number"}s[n.assessment_name]={name:n.assessment_name,assessmentType:"feedback"in n?"feedback":"expectation",dataType:o}}for(const[n,a]of Object.entries(t))n in s||(s[n]=a);return Object.values(s)})(s)),[s]),l=(0,n.useMemo)((()=>({schemas:t})),[t]);return(0,r.Y)(o.Provider,{value:l,children:e})},d=()=>(0,n.useContext)(o)}}]);