"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1573],{11573:function(e,t,n){n.d(t,{n:function(){return Na}});var a=n(68248),o=n(27757),r=n(74060),s=n(46709),i=n(24523),l=n(5690),d=n(44105),c=n(40724),u=n(10536),p=n(80042),m=n(91105),g=n(60284),h=n(73408);const f=s.memo((({experiments:e})=>{const t=(0,s.useMemo)((()=>(0,h.Y)(c.A,{id:"Dhn7Mb",defaultMessage:"Displaying Runs from {numExperiments} Experiments",values:{numExperiments:e.length}})),[e.length]),n=(0,s.useMemo)((()=>[(0,h.Y)(m.N_,{to:g.Ay.experimentsObservatoryRoute,"data-testid":"experiment-observatory-link",children:(0,h.Y)(c.A,{id:"XBtNVo",defaultMessage:"Experiments"})},g.Ay.experimentsObservatoryRoute)]),[]);return(0,h.Y)(u.z,{title:t,breadcrumbs:n,children:(0,h.Y)(p.z,{})})}));var v=n(56530),_=n(90142);var y=n(94721),x=n(71206),b=n(84561),w=n(16389);class C extends s.Component{constructor(e){super(e),this.handleSubmit=this.handleSubmit.bind(this)}handleSubmit(){const e=[];return this.props.selectedRunIds.forEach((t=>{e.push(this.props.restoreRunApi(t))})),Promise.all(e).catch((e=>{let t="While restoring an experiment run, an error occurred.";e.textJson&&"RESOURCE_LIMIT_EXCEEDED"===e.textJson.error_code&&(t=t+" "+e.textJson.message),this.props.openErrorModal(t)})).then((()=>{var e,t;null===(e=(t=this.props).onSuccess)||void 0===e||e.call(t)}))}render(){const e=this.props.selectedRunIds.length;return(0,h.Y)(b.u,{isOpen:this.props.isOpen,onClose:this.props.onClose,handleSubmit:this.handleSubmit,title:`Restore Experiment ${w.A.pluralize("Run",e)}`,helpText:`${e} experiment ${w.A.pluralize("run",e)} will be restored.`,confirmButtonText:"Restore"})}}const Y={restoreRunApi:l.iz,openErrorModal:l.Yi};var I=(0,v.Ng)(null,Y)(C);const A=({showDeleteRunModal:e,showRestoreRunModal:t,showRenameRunModal:n,runsSelected:a,onCloseDeleteRunModal:o,onCloseRestoreRunModal:r,onCloseRenameRunModal:s,renamedRunName:i,refreshRuns:l})=>{const d=Object.entries(a).filter((([,e])=>e)).map((([e])=>e));return(0,h.FD)(h.FK,{children:[(0,h.Y)(y.A,{isOpen:e,onClose:o,selectedRunIds:d,onSuccess:()=>{l()}}),(0,h.Y)(I,{isOpen:t,onClose:r,selectedRunIds:d,onSuccess:()=>{l()}}),(0,h.Y)(x.j,{runUuid:d[0],onClose:s,runName:i,isOpen:n,onSuccess:()=>{l()}})]})};var k=n(181),M=n(79081),D=n(66916);var S={name:"82a6rk",styles:"flex:1"},R={name:"82a6rk",styles:"flex:1"};const T=({isOpen:e,setIsOpen:t,selectedRunsExistingTagKeys:n,addNewTag:i})=>{const{theme:l}=(0,o.u)(),[d,u]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),g=""===d||/^[^,.:/=\-\s]+$/.test(d),f=n.includes(d),v=g&&!f,_=d.length>0&&p.length>0&&v;return(0,h.Y)(M.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactionsaddnewtagmodal.tsx_34",title:(0,h.Y)(c.A,{id:"VGJhVI",defaultMessage:"Add New Tag"}),visible:e,onCancel:()=>t(!1),onOk:()=>{_&&(i({key:d,value:p}),t(!1),u(""),m(""))},okText:(0,h.Y)(c.A,{id:"oU/SPm",defaultMessage:"Add"}),cancelText:(0,h.Y)(c.A,{id:"urvfNd",defaultMessage:"Cancel"}),okButtonProps:{disabled:!_},children:(0,h.Y)("form",{css:(0,a.AH)({display:"flex",alignItems:"flex-end",gap:l.spacing.md},""),children:(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:l.spacing.md,flex:1},""),children:[(0,h.FD)("div",{css:S,children:[(0,h.Y)(r.FormUI.Label,{htmlFor:"key",children:(0,h.Y)(c.A,{id:"FYxQgz",defaultMessage:"Key"})}),(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactionsaddnewtagmodal.tsx_51",value:d,onChange:e=>u(e.target.value),validationState:v?void 0:"warning","data-testid":"add-new-tag-key-input"}),!g&&(0,h.Y)(r.FormUI.Hint,{children:(0,h.Y)(c.A,{id:"Sb0Z4Z",defaultMessage:", . : / - = and blank spaces are not allowed"})}),f&&(0,h.Y)(r.FormUI.Hint,{children:(0,h.Y)(c.A,{id:"xBoybr",defaultMessage:"Tag key already exists on one or more of the selected runs. Please choose a different key."})})]}),(0,h.FD)("div",{css:R,children:[(0,h.Y)(r.FormUI.Label,{htmlFor:"value",children:(0,h.Y)(c.A,{id:"OQsEJv",defaultMessage:"Value"})}),(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactionsaddnewtagmodal.tsx_78",value:p,onChange:e=>m(e.target.value),"data-testid":"add-new-tag-value-input"})]})]})})})};var E=n(76118),L=n(77153);const F=e=>`${e.key}: ${e.value}`,B=e=>{const[t,...n]=e.split(": ");return{key:t,value:n.join(": ")}},P=({runInfos:e,runsSelected:t,tagsList:n,refreshRuns:i})=>{const{theme:d}=(0,o.u)(),[u,p]=(0,s.useState)({}),[m,g]=(0,s.useState)(!1),[f,_]=(0,s.useState)(!1),[y,x]=(0,s.useState)(!1),{allSelectedTags:b,allNotSelectedTags:C,indeterminateTags:Y,allTags:I}=((e,t,n)=>{const a=e.flatMap(((e,a)=>{if(t[e.runUuid]){const e=n[a];return[Object.keys(e).filter(k.oD).map((t=>F(e[t])))]}return[]})),o=n.flatMap((e=>Object.keys(e).filter(k.oD).map((t=>F(e[t]))))),r=o.filter((e=>a.every((t=>t.includes(e))))),s=o.filter((e=>a.every((t=>!t.includes(e))))),i=o.filter((e=>!r.includes(e)&&a.some((t=>t.includes(e)))));return{allSelectedTags:r,allNotSelectedTags:s,indeterminateTags:i,allTags:o}})(e,t,n),A=e=>{p((()=>{const t={...u};return I.forEach((e=>{b.includes(e)?t[e]=!0:C.includes(e)?t[e]=!1:Y.includes(e)&&(t[e]=void 0)})),void 0!==e&&(t[F(e)]=!0),t})),_(!0)},M=e=>{p((t=>({...t,[e]:!t[e]})))},D=(0,v.wA)();return(0,h.FD)(h.FK,{children:[(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactionsselecttags.tsx_162",open:f,label:"Add tags",id:"runs-tag-multiselect",multiSelect:!0,children:[(0,h.Y)(r.DialogComboboxTrigger,{onClick:()=>{f?_(!1):A()},"data-testid":"runs-tag-multiselect-trigger"}),(0,h.FD)(r.DialogComboboxContent,{matchTriggerWidth:!0,children:[(0,h.Y)(r.DialogComboboxOptionList,{children:Object.keys(u).map((e=>{const t=void 0===u[e];return(0,h.Y)(r.DialogComboboxOptionListCheckboxItem,{value:e,onChange:M,checked:u[e],indeterminate:t},e)}))}),(0,h.Y)(r.DialogComboboxFooter,{children:(0,h.FD)("div",{css:(0,a.AH)({display:"flex",justifyContent:"flex-end",gap:d.spacing.sm},""),children:[(0,h.Y)(o.B,{componentId:"mlflow.experiment_page.runs.add_new_tag",onClick:()=>{g(!0),_(!1)},icon:(0,h.Y)(r.PlusIcon,{}),"data-testid":"runs-add-new-tag-button",children:(0,h.Y)(c.A,{id:"2zy+D5",defaultMessage:"Add new tag"})}),(0,h.Y)(o.B,{type:"primary",componentId:"mlflow.experiment_page.runs.add_tags",onClick:()=>{x(!0);e.flatMap(((e,n)=>t[e.runUuid]?[n]:[])).forEach((t=>{const a=e[t].runUuid,o=Object.values(n[t]).filter((e=>(0,k.oD)(e.key))),r=Object.keys(u).filter((e=>void 0===u[e]?o.map((e=>F(e))).includes(e):u[e])).map((e=>B(e)));D((0,l.hD)(a,o,r)).then((()=>{i()})).catch((e=>{const t=e instanceof L.s?e.getMessageField():e.message;w.A.displayGlobalErrorNotification(t)})).finally((()=>{x(!1),_(!1)}))}))},disabled:0===Object.keys(u).length,loading:y,children:(0,h.Y)(c.A,{id:"dl0TeT",defaultMessage:"Save"})})]})})]})]}),(0,h.Y)(T,{isOpen:m,setIsOpen:g,selectedRunsExistingTagKeys:(0,E.uniq)(b.concat(Y).map((e=>B(e).key))),addNewTag:e=>{A(e)}})]})},O=({children:e})=>(0,h.Y)(h.FK,{children:e}),U=s.memo((({viewState:e,runsData:t,searchFacetsState:n,refreshRuns:a})=>{const{runsSelected:r}=e,{runInfos:i,tagsList:l}=t,{lifecycleFilter:u}=n,p=(0,m.Zp)(),{theme:f}=(0,o.u)(),[v,_]=(0,s.useState)(!1),[y,x]=(0,s.useState)(!1),[b,w]=(0,s.useState)(!1),[C,Y]=(0,s.useState)(""),I=(0,s.useCallback)((()=>{const e=Object.keys(r),t=i.find((t=>t.runUuid===e[0]));t&&(Y(t.runName),w(!0))}),[i,r]),k=(0,s.useCallback)((()=>{const e=Object.keys(r),t=i.filter((({runUuid:t})=>e.includes(t))).map((({experimentId:e})=>e));p(g.Ay.getCompareRunPageRoute(e,[...new Set(t)].sort()))}),[p,i,r]),M=(0,s.useCallback)((()=>_(!0)),[]),D=(0,s.useCallback)((()=>x(!0)),[]),S=(0,s.useCallback)((()=>_(!1)),[]),R=(0,s.useCallback)((()=>x(!1)),[]),T=(0,s.useCallback)((()=>w(!1)),[]),E=Object.values(e.runsSelected).filter(Boolean).length,L=E>0,F=1===E,B=E>1;return(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:N.controlBar,children:[(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_110","data-testid":"run-rename-button",onClick:I,disabled:!F,children:(0,h.Y)(c.A,{id:"oWPgX7",defaultMessage:"Rename"})}),u===d.gy.ACTIVE?(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_117","data-testid":"runs-delete-button",disabled:!L,onClick:M,danger:!0,children:(0,h.Y)(c.A,{id:"3Rb4sG",defaultMessage:"Delete"})}):null,u===d.gy.DELETED?(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_126","data-testid":"runs-restore-button",disabled:!L,onClick:D,children:(0,h.Y)(c.A,{id:"Potju2",defaultMessage:"Restore"})}):null,(0,h.Y)("div",{css:N.buttonSeparator}),(0,h.Y)(O,{children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsactions.tsx_136","data-testid":"runs-compare-button",disabled:!B,onClick:k,children:(0,h.Y)(c.A,{id:"RaGnOQ",defaultMessage:"Compare"})})}),(0,h.Y)("div",{css:N.buttonSeparator}),(0,h.Y)(P,{runsSelected:r,runInfos:i,tagsList:l,refreshRuns:a})]}),(0,h.Y)(A,{runsSelected:r,onCloseRenameRunModal:T,onCloseDeleteRunModal:S,onCloseRestoreRunModal:R,showDeleteRunModal:v,showRestoreRunModal:y,showRenameRunModal:b,renamedRunName:C,refreshRuns:a})]})})),N={buttonSeparator:e=>({borderLeft:`1px solid ${e.colors.border}`,marginLeft:e.spacing.xs,marginRight:e.spacing.xs,height:"100%"}),controlBar:e=>({display:"flex",gap:e.spacing.sm,alignItems:"center"})};var H=n(31655),V=n(7655),K=n(68044),G=n(55840),j=n(8740),z=n(5581),q=n(30676),$=n(91701);var W={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"};const J=({isOpen:e,closeModal:t,experimentId:n})=>{const{theme:s}=(0,o.u)(),i=s.isDarkMode?"duotoneDark":"light",l=`\nimport mlflow\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_diabetes\nfrom sklearn.ensemble import RandomForestRegressor\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${n}")\n\nmlflow.autolog()\ndb = load_diabetes()\n\nX_train, X_test, y_train, y_test = train_test_split(db.data, db.target)\n\n# Create and train models.\nrf = RandomForestRegressor(n_estimators=100, max_depth=6, max_features=3)\nrf.fit(X_train, y_train)\n\n# Use the model to make predictions on the test dataset.\npredictions = rf.predict(X_test)\n`.trimStart(),d=`\nimport mlflow\nimport openai\nimport os\nimport pandas as pd\n\n# you must set the OPENAI_API_KEY environment variable\nassert (\n  "OPENAI_API_KEY" in os.environ\n), "Please set the OPENAI_API_KEY environment variable."\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${n}")\n\nsystem_prompt = (\n  "The following is a conversation with an AI assistant."\n  + "The assistant is helpful and very friendly."\n)\n\n# start a run\nmlflow.start_run()\nmlflow.log_param("system_prompt", system_prompt)\n\n# Create a question answering model using prompt engineering\n# with OpenAI. Log the model to MLflow Tracking\nlogged_model = mlflow.openai.log_model(\n    model="gpt-4o-mini",\n    task=openai.chat.completions,\n    artifact_path="model",\n    messages=[\n        {"role": "system", "content": system_prompt},\n        {"role": "user", "content": "{question}"},\n    ],\n)\n\n# Evaluate the model on some example questions\nquestions = pd.DataFrame(\n    {\n        "question": [\n            "How do you create a run with MLflow?",\n            "How do you log a model with MLflow?",\n            "What is the capital of France?",\n        ]\n    }\n)\nmlflow.evaluate(\n    model=logged_model.model_uri,\n    model_type="question-answering",\n    data=questions,\n)\nmlflow.end_run()\n`.trimStart(),u=18*(Math.min(...[l,d].map((e=>e.split("\n").length)))+1);return(0,h.Y)(M.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_createnotebookrunmodal.tsx_111",visible:e,onCancel:t,onOk:t,footer:(0,h.Y)("div",{css:(0,a.AH)({display:"flex",gap:s.spacing.sm,justifyContent:"flex-end"},""),children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_createnotebookrunmodal.tsx_117",onClick:t,type:"primary",children:(0,h.Y)(c.A,{id:"ttyLD4",defaultMessage:"Okay"})})}),title:(0,h.FD)("div",{children:[(0,h.Y)(o.T.Title,{level:2,css:(0,a.AH)({marginTop:s.spacing.sm,marginBottom:s.spacing.xs},""),children:(0,h.Y)(c.A,{id:"iF1UfU",defaultMessage:"New run using notebook"})}),(0,h.Y)(o.T.Hint,{css:W,children:"Run this code snippet in a notebook or locally, to create an experiment run"})]}),children:(0,h.FD)(r.LegacyTabs,{children:[(0,h.Y)(r.LegacyTabPane,{tab:(0,h.Y)(c.A,{id:"71dHIO",defaultMessage:"Classical ML"}),children:(0,h.Y)(q.z7,{style:{padding:"5px",height:u},language:"python",theme:i,actions:(0,h.Y)("div",{style:{marginTop:s.spacing.sm,marginRight:s.spacing.md},children:(0,h.Y)($.i,{copyText:l,showLabel:!1,icon:(0,h.Y)(r.CopyIcon,{})})}),children:l})},"classical-ml"),(0,h.Y)(r.LegacyTabPane,{tab:(0,h.Y)(c.A,{id:"xBVMQz",defaultMessage:"LLM"}),children:(0,h.Y)(q.z7,{style:{padding:"5px",height:u},language:"python",theme:i,actions:(0,h.Y)("div",{style:{marginTop:s.spacing.sm,marginRight:s.spacing.md},children:(0,h.Y)($.i,{copyText:d,showLabel:!1,icon:(0,h.Y)(r.CopyIcon,{})})}),children:d})},"llm")]})})};var Q=n(36439),X=n(59930),Z=n.n(X),ee=n(12803),te=n(28126);class ne extends L.s{getGatewayErrorMessage(){var e,t,n,a;return(null===(e=this.textJson)||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)||(null===(n=this.textJson)||void 0===n?void 0:n.message)||(null===(a=this.textJson)||void 0===a?void 0:a.toString())||this.text}}var ae;class oe{static createEvaluationTextPayload(e,t){switch(t){case te.W8.LLM_V1_COMPLETIONS:return{prompt:e};case te.W8.LLM_V1_CHAT:return{messages:[{content:e,role:"user"}]};case te.W8.LLM_V1_EMBEDDINGS:throw new Error(`Unsupported served LLM model task "${t}"!`);default:throw new Error(`Unknown served LLM model task "${t}"!`)}}}ae=oe,oe.queryMLflowDeploymentEndpointRoute=async(e,t)=>{Z()(e.mlflowDeployment,"Trying to call a MLflow deployment route without a deployment_url");const{inputText:n}=t,a={...ae.createEvaluationTextPayload(n,e.task),...t.parameters};return ee.x.gatewayProxyPost({gateway_path:e.mlflowDeployment.endpoint_url.substring(1),json_data:a})},oe.queryModelGatewayRoute=async(e,t)=>{if("mlflow_deployment_endpoint"===e.type){Z()(e.mlflowDeployment,"Trying to call a serving endpoint route without an endpoint");return((e,t)=>{if(t===te.W8.LLM_V1_COMPLETIONS){var n,a;const t=e,o=null===(n=t.choices)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.text,{usage:r}=t;if(o&&r)return{text:o,metadata:{total_tokens:r.total_tokens,output_tokens:r.completion_tokens,input_tokens:r.prompt_tokens}}}if(t===te.W8.LLM_V1_CHAT){var o,r,s;const t=e,n=null===(o=t.choices)||void 0===o||null===(r=o[0])||void 0===r||null===(s=r.message)||void 0===s?void 0:s.content,{usage:a}=t;if(n&&a)return{text:n,metadata:{total_tokens:a.total_tokens,output_tokens:a.completion_tokens,input_tokens:a.prompt_tokens}}}throw new Error(`Unrecognizable AI gateway response metadata "${e.usage}"!`)})(await ae.queryMLflowDeploymentEndpointRoute(e,t),e.task)}throw new Error("Unknown route type")};var re=n(22131),se=n(92584),ie=n(77680);const le=[{type:"slider",name:"temperature",string:(0,ie.zR)({id:"Jrri/Y",defaultMessage:"Temperature"}),helpString:(0,ie.zR)({id:"5yWkFd",defaultMessage:"Increase or decrease the confidence level of the language model."}),max:1,min:0,step:.01},{type:"input",name:"max_tokens",string:(0,ie.zR)({id:"qR3llD",defaultMessage:"Max tokens"}),helpString:(0,ie.zR)({id:"cEwSR8",defaultMessage:"Maximum number of language tokens returned from evaluation."}),max:65536,min:1,step:1},{type:"list",name:"stop",string:(0,ie.zR)({id:"FAfPOl",defaultMessage:"Stop Sequences"}),helpString:(0,ie.zR)({id:"J2XCE/",defaultMessage:"Specify sequences that signal the model to stop generating text."})}],de={temperature:.01,max_tokens:100},ce=()=>{const[e,t]=(0,s.useState)(de),n=(0,s.useCallback)(((e,n)=>{t((t=>({...t,[e]:n})))}),[]);return{parameterDefinitions:le,parameters:e,updateParameter:n}};var ue=n(27476);var pe={name:"1d3w5wq",styles:"width:100%"};const me=({parameterValue:e,updateParameter:t,disabled:n})=>{const[i,l]=(0,s.useState)(""),{theme:d}=(0,o.u)();return(0,E.isArray)(e)?(0,h.FD)(h.FK,{children:[(0,h.Y)("div",{css:(0,a.AH)({marginTop:d.spacing.xs,marginBottom:d.spacing.sm},""),children:e.map(((n,a)=>(0,h.Y)(r.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptparameters.tsx_28",closable:!0,onClose:()=>{t(e.filter((e=>e!==n)))},children:n},a)))}),(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptparameters.tsx_39",allowClear:!0,css:pe,disabled:n,onChange:e=>l(e.target.value),value:i,onKeyDown:n=>{"Enter"===n.key&&i.trim()&&(t((0,E.uniq)([...e,i])),l(""))}})]}):null};var ge={name:"151f7v8",styles:"span{font-weight:normal;}"};const he=({disabled:e=!1,parameters:t,updateParameter:n})=>{const{parameterDefinitions:s}=ce(),{theme:i}=(0,o.u)();return(0,h.FD)("div",{css:(0,a.AH)({marginBottom:i.spacing.lg},""),children:[(0,h.Y)(r.FormUI.Label,{css:(0,a.AH)({marginBottom:i.spacing.md},""),children:(0,h.Y)(c.A,{id:"KADUUT",defaultMessage:"Model parameters"})}),s.map((o=>{var s;return(0,h.Y)("div",{css:(0,a.AH)({marginBottom:i.spacing.md},""),children:(0,h.FD)(h.FK,{children:[(0,h.FD)(r.FormUI.Label,{htmlFor:o.name,css:ge,children:[(0,h.Y)(c.A,{...o.string}),(0,h.Y)(r.LegacyTooltip,{title:(0,h.Y)(c.A,{...o.helpString}),placement:"right",children:(0,h.Y)(M.I,{css:(0,a.AH)({marginLeft:i.spacing.sm,verticalAlign:"text-top",color:i.colors.textSecondary},"")})})]}),(0,h.Y)(r.FormUI.Hint,{}),"temperature"===o.name&&(0,h.Y)(ue.o,{"data-testid":o.name,disabled:e,max:o.max,min:o.min,step:o.step,value:t[o.name]||0,onChange:e=>n(o.name,e)}),"input"===o.type&&(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptparameters.tsx_107","data-testid":o.name,type:"number",disabled:e,max:o.max,min:o.min,step:o.step,value:t[o.name]||0,onChange:e=>n(o.name,parseInt(e.target.value,10))}),"list"===o.type&&(0,h.Y)(me,{parameterValue:null!==(s=t[o.name])&&void 0!==s?s:[],disabled:e,updateParameter:e=>n(o.name,e)})]})},o.name)}))]})},fe=" }}",ve="new_variable",_e=()=>{const[e,t]=(0,s.useState)(se.KH),n=(0,s.useRef)(),a=(0,s.useCallback)((()=>{t((e=>{const t=((e=[])=>{if(!e.includes(ve))return ve;const t=(0,E.max)(e.map((e=>{var t;return parseInt((null===(t=e.match(/new_variable_(\d+)/))||void 0===t?void 0:t[1])||"1",10)})))||1;return`${ve}_${t+1}`})((0,se.rl)(e)),a=`${e} {{ ${t}${fe}`;return requestAnimationFrame((()=>{const e=n.current;e&&(e.focus(),e.setSelectionRange(a.length-t.length-3,a.length-3))})),a}))}),[t]);return{savePromptTemplateInputRef:(0,s.useCallback)((e=>{var t;n.current=null===e||void 0===e||null===(t=e.resizableTextArea)||void 0===t?void 0:t.textArea}),[]),handleAddVariableToTemplate:a,promptTemplate:e,updatePromptTemplate:t}},ye=(0,ie.zR)({id:"lM0z8k",defaultMessage:"The following variable names contain spaces which is disallowed: {invalidNames}"}),xe=({violations:e})=>{const{namesWithSpaces:t}=e,{formatMessage:n}=(0,V.A)();return(0,h.Y)(h.FK,{children:t.length>0&&(0,h.Y)(o.T.Text,{color:"warning",size:"sm","aria-label":n(ye,{invalidNames:t.join(", ")}),children:(0,h.Y)(c.A,{...ye,values:{invalidNames:(0,h.Y)(h.FK,{children:t.map((e=>(0,h.Y)("code",{children:e},e)))})}})})})},be=[{prompt:["You are a marketing consultant for a technology company. Develop a marketing strategy report for {{ company_name }} aiming to {{ company_goal }}"],variables:[{name:"company_name",value:"XYZ Company"},{name:"company_goal",value:"Increase top-line revenue"}]},{prompt:['You are a helpful and friendly customer support chatbot. Answer the users question "{{ user_question }}" clearly, based on the following documentation: {{ documentation }}'],variables:[{name:"user_question",value:"Is MLflow open source?"},{name:"documentation",value:"MLflow is an open source platform for managing the end-to-end machine learning lifecycle."}]},{prompt:['Summarize the given text "{{ text }}" into a concise and coherent summary, capturing the main ideas and key points. Make sure that the summary does not exceed {{ word_count }} words.'],variables:[{name:"text",value:"Although C. septempunctata larvae and adults mainly eat aphids, they also feed on Thysanoptera, Aleyrodidae, on the larvae of Psyllidae and Cicadellidae, and on eggs and larvae of some beetles and butterflies. There are one or two generations per year. Adults overwinter in ground litter in parks, gardens and forest edges and under tree bark and rocks. C. septempunctata has a broad ecological range, generally living wherever there are aphids for it to eat. This includes, amongst other biotopes, meadows, fields, Pontic\u2013Caspian steppe, parkland, gardens, Western European broadleaf forests and mixed forests. In the United Kingdom, there are fears that the seven-spot ladybird is being outcompeted for food by the harlequin ladybird. An adult seven-spot ladybird may reach a body length of 7.6\u201312.7 mm (0.3\u20130.5 in). Their distinctive spots and conspicuous colours warn of their toxicity, making them unappealing to predators. The species can secrete a fluid from joints in their legs which gives them a foul taste. A threatened ladybird may both play dead and secrete the unappetising substance to protect itself. The seven-spot ladybird synthesizes the toxic alkaloids, N-oxide coccinelline and its free base precoccinelline; depending on sex and diet, the spot size and coloration can provide some indication of how toxic the individual insect is to potential predators."},{name:"word_count",value:"75"}]},{prompt:["Generate a list of ten titles for my book. The book is about {{ topic }}. Each title should be between {{ word_range }} words long.","### Examples of great titles ###","{{ examples }}"],variables:[{name:"topic",value:"my journey as an adventurer who has lived an unconventional life, meeting many different personalities and finally finding peace in gardening."},{name:"word_range",value:"two to five"},{name:"examples",value:'"Long walk to freedom", "Wishful drinking", "I know why the caged bird sings"'}]},{prompt:["Generate a SQL query from a user\u2019s question, using the information from the table.","Question: {{ user_question }}","Table Information: {{ table_information }}"],variables:[{name:"user_question",value:"Which product generated the most sales this month?"},{name:"table_information",value:"CREATE TABLE Sales (SaleID INT PRIMARY KEY, ProductID INT, SaleDate DATE, CustomerID INT, QuantitySold INT, UnitPrice DECIMAL(10, 2));"}]}],{TextArea:we}=D.I,Ce=({isOpen:e,closeExamples:t,closeModal:n,updatePromptTemplate:s,updateInputVariableValue:i})=>{const{theme:l}=(0,o.u)();return(0,h.Y)(M.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_42",verticalSizing:"maxed_out",visible:e,onCancel:n,title:(0,h.Y)("div",{children:(0,h.FD)(o.T.Title,{level:2,css:(0,a.AH)({marginTop:l.spacing.sm,marginBottom:l.spacing.xs},""),children:[(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_48",css:(0,a.AH)({marginRight:l.spacing.sm,marginBottom:l.spacing.sm},""),icon:(0,h.Y)(r.ArrowLeftIcon,{}),onClick:t}),(0,h.Y)(c.A,{id:"KzC+38",defaultMessage:"Prompt template examples"})]})}),dangerouslySetAntdProps:{width:1200},children:be.map((e=>(0,h.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"column",gap:l.spacing.md},""),children:[(0,h.FD)("div",{css:(0,a.AH)({boxSizing:"border-box",border:`1px solid ${l.colors.actionDefaultBorderDefault}`,borderRadius:l.legacyBorders.borderRadiusMd,background:l.colors.backgroundPrimary,padding:l.spacing.md,margin:0,overflow:"hidden",display:"flex",flexDirection:"column",gap:`${l.spacing.xs}px`},""),children:[(0,h.FD)(o.T.Title,{level:4,children:[(0,h.Y)(c.A,{id:"GDzD7I",defaultMessage:"Prompt Template"}),(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_90",type:"tertiary",size:"small",style:{float:"right"},onClick:()=>(e=>{s(e.prompt.join("\n")),e.variables.forEach((({name:e,value:t})=>{i(e,t)})),t()})(e),children:(0,h.Y)(c.A,{id:"Np53PR",defaultMessage:"Try this template"})})]}),e.prompt.map((e=>(0,h.Y)(o.T.Paragraph,{children:e},e))),(0,h.Y)("div",{css:(0,a.AH)({marginTop:l.spacing.xs,marginBottom:l.spacing.xs,borderTop:`1px solid ${l.colors.border}`,opacity:.5},"")}),e.variables.map((({name:e,value:t})=>(0,h.FD)("div",{children:[(0,h.Y)(o.T.Title,{level:4,children:e}),(0,h.Y)(o.T.Paragraph,{children:t})]},e)))]}),(0,h.Y)(M.S,{})]},e.prompt.join("\n"))))})};const{TextArea:Ye}=D.I;var Ie={name:"1ll9bqd",styles:"cursor:default"};const Ae=({evaluationMetadata:e,isEvaluating:t,isOutputDirty:n,evaluationOutput:i,evaluationError:l,evaluateButtonTooltip:d,disabled:u,onEvaluateClick:p,onCancelClick:m})=>{const{theme:g}=(0,o.u)(),f=(0,s.useMemo)((()=>e?t?null:(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:g.spacing.xs,alignItems:"center"},""),children:[se.Ef in e&&(0,h.FD)(o.T.Hint,{size:"sm",children:[Math.round(Number(e[se.Ef]))," ms","MLFLOW_total_tokens"in e?",":""]}),se.jC in e&&(0,h.Y)(o.T.Hint,{size:"sm",children:(0,h.Y)(c.A,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:e[se.jC]}})})]}):null),[e,t,g]);return(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,a.AH)({marginBottom:g.spacing.md},""),children:[(0,h.Y)(r.LegacyTooltip,{title:d,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_85","data-testid":"button-evaluate",icon:(0,h.Y)(r.PlayIcon,{}),onClick:p,disabled:u,loading:t,children:(0,h.Y)(c.A,{id:"72uGpl",defaultMessage:"Evaluate"})})}),t&&(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_99","data-testid":"button-cancel",icon:(0,h.Y)(r.StopIcon,{}),onClick:m,css:(0,a.AH)({marginLeft:g.spacing.sm},""),children:(0,h.Y)(c.A,{id:"CTEh+b",defaultMessage:"Cancel"})})]}),(0,h.FD)(r.FormUI.Label,{children:[(0,h.Y)(c.A,{id:"ydoHrJ",defaultMessage:"Output"}),n&&(0,h.Y)(r.LegacyTooltip,{title:(0,h.Y)(c.A,{id:"gc+GrI",defaultMessage:"Model, input data or prompt have changed since last evaluation of the output"}),children:(0,h.Y)(o.W,{css:(0,a.AH)({marginLeft:g.spacing.xs},"")})})]}),(0,h.Y)(r.FormUI.Hint,{children:(0,h.Y)(c.A,{id:"JtQQMn",defaultMessage:"This is the output generated by the LLM using the prompt template and input values defined above."})}),!l&&t&&(0,h.Y)("div",{css:(0,a.AH)({marginTop:g.spacing.sm},""),children:(0,h.Y)(r.TableSkeleton,{lines:5})}),!t&&(0,h.Y)(Ye,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_144",rows:5,css:Ie,"data-testid":"prompt-output",value:i,readOnly:!0}),!t&&l&&(0,h.Y)(r.FormUI.Message,{message:l,type:"error"}),(0,h.Y)("div",{css:(0,a.AH)({marginTop:g.spacing.sm},""),children:f})]})};var ke=n(32667),Me=n(38232),De=n(43233);const Se=({routeName:e,routeType:t,compiledPrompt:n,inputValues:a,parameters:o,outputColumn:r,rowKey:s,run:i})=>(({routeName:e,routeType:t,compiledPrompt:n,inputValues:a,parameters:o,outputColumn:r,rowKey:s,run:i})=>async(r,l)=>{const{modelGateway:d}=l();d.modelGatewayRoutesLoading.loading||0!==Object.keys(d.modelGatewayRoutes).length||await r(Re());const c=l().modelGateway.modelGatewayRoutes[`${t}:${e}`];if(!c){const t=`MLflow deployment endpoint ${e} does not exist anymore!`;throw w.A.logErrorAndNotifyUser(t),new Error(t)}const u={inputText:n,parameters:o};return r({type:"EVALUATE_PROMPT_TABLE_VALUE",payload:oe.queryModelGatewayRoute(c,u),meta:{inputValues:a,run:i,compiledPrompt:n,rowKey:s,startTime:performance.now()}})})({...{routeName:e,compiledPrompt:n,inputValues:a,parameters:o,outputColumn:r,rowKey:s,run:i},routeType:t}),Re=()=>async e=>e({type:"SEARCH_MLFLOW_DEPLOYMENTS_MODEL_ROUTES",payload:ee.x.gatewayProxyGet({gateway_path:"api/2.0/endpoints/"}),meta:{id:(0,De.yk)()}}),Te=e=>e instanceof ne?e.getGatewayErrorMessage():e instanceof L.s?e.getMessageField():e.message;const{TextArea:Ee}=D.I;var Le={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"},Fe={name:"t691yx",styles:"display:grid;grid-template-columns:300px 1fr;gap:48px"},Be={name:"1d3w5wq",styles:"width:100%"},Pe={name:"1eoy87d",styles:"display:flex;justify-content:space-between"};const Oe=({isOpen:e,closeModal:t,runBeingDuplicated:n,visibleRuns:i=[],refreshRuns:d})=>{const[u]=(0,G.z)(),{theme:p}=(0,o.u)(),{parameters:m,updateParameter:g}=ce(),[,f]=(0,ke.an)(),[_,y]=(0,s.useState)(""),[x,b]=(0,s.useState)(""),[C,Y]=(0,s.useState)(!1),[I,A]=(0,s.useState)(!1),[k,S]=(0,s.useState)(null),[R,T]=(0,s.useState)(""),[L,F]=(0,s.useState)({}),[B,P]=(0,s.useState)(!1),[O,U]=(0,s.useState)(!1),N=(0,s.useRef)(null),H=(0,v.wA)();(0,s.useEffect)((()=>{H(Re()).catch((e=>{w.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[H]);const K=(0,V.A)(),{updateInputVariables:j,inputVariables:z,inputVariableValues:q,updateInputVariableValue:$,inputVariableNameViolations:W,clearInputVariableValues:J}=(()=>{const[e,t]=(0,s.useState)((0,se.rl)("")),[n,a]=(0,s.useState)({namesWithSpaces:[]}),[o,r]=(0,s.useState)(se.kU),i=(0,s.useCallback)((()=>r({})),[]),l=(0,s.useMemo)((()=>(0,E.debounce)((e=>{t((t=>{const n=(0,se.rl)(e);return(0,E.isEqual)(n,t)?t:n})),a((0,se.Eb)(e))}),250)),[]),d=(0,s.useCallback)(((e,t)=>{r((n=>({...n,[e]:t})))}),[]),c=(0,s.useMemo)((()=>(0,E.fromPairs)(Object.entries(o).filter((([t])=>e.includes(t))))),[o,e]);return{updateInputVariables:l,inputVariables:e,inputVariableValues:c,updateInputVariableValue:d,inputVariableNameViolations:n,clearInputVariableValues:i}})(),{handleAddVariableToTemplate:Q,savePromptTemplateInputRef:X,promptTemplate:Z,updatePromptTemplate:ee}=_e();(0,s.useEffect)((()=>{e&&!n&&b((0,re.Lr)())}),[e,n]),(0,s.useEffect)((()=>{j(Z)}),[Z,j]),(0,s.useEffect)((()=>{if(n){const{promptTemplate:e,routeName:t,parameters:a}=(0,se.vC)(n);(0,se.xP)(n),e&&ee(e),a.temperature&&g("temperature",a.temperature),a.max_tokens&&g("max_tokens",a.max_tokens),t&&y(t),T(""),P(!1);const o=(0,re.gK)(n.runName,(0,E.compact)(i.map((({runName:e})=>e))));b(o),J()}}),[n,J,g,ee,i]);const te=(0,v.d4)((({modelGateway:e})=>e.modelGatewayRoutes)),ne=(0,s.useMemo)((()=>(0,E.sortBy)(Object.values(te),"name")),[te]),ae=(0,v.d4)((({modelGateway:e})=>e.modelGatewayRoutesLoading.loading));(0,s.useEffect)((()=>{R&&P(!0)}),[q,Z,m,_]);const ie=(0,s.useCallback)((()=>{const e=te[_],t=Math.random().toString(36);if(N.current=t,!e)throw new Error("No model route found!");S(null),A(!0);const n=(0,se.TG)(Z,q),a=performance.now();oe.queryModelGatewayRoute(e,{inputText:n,parameters:m}).then((e=>{if(N.current===t){const{text:n,metadata:o}=e,r=performance.now()-a;T(n);const s={...o,latency:r},i=Object.entries(s).reduce(((e,[t,n])=>({...e,[`MLFLOW_${t}`]:n})),{});F(i),P(!1),A(!1),N.current===t&&(N.current=null)}})).catch((e=>{const n=Te(e),a=K.formatMessage({id:"nyHcAz",defaultMessage:'MLflow deployment returned the following error: "{errorMessage}"'},{errorMessage:n});w.A.displayGlobalErrorNotification(a),A(!1),S(a),N.current===t&&(N.current=null)}))}),[q,te,m,Z,_,K]),le=(0,s.useCallback)((()=>{N.current&&(A(!1),N.current=null)}),[A]),de=K.formatMessage({id:"AyceYA",defaultMessage:"Served LLM model"}),ue=K.formatMessage({id:"pTDM+x",defaultMessage:"Select LLM model endpoint"}),pe=Z.trim().length>0,me=(0,s.useMemo)((()=>z.every((e=>{var t;return null===(t=q[e])||void 0===t?void 0:t.trim()}))),[z,q]),ge=x.trim().length>0,fe=_&&pe&&me,ve=Boolean(_&&pe&&me&&R&&!B&&z.length>0&&ge&&!k),ye=(0,s.useMemo)((()=>_?pe?me?R?B?K.formatMessage({id:"/K6wBr",defaultMessage:"Input data or prompt template have changed since last evaluation of the output"}):0===z.length?K.formatMessage({id:"z+0t/R",defaultMessage:"You need to define at least one input variable"}):ge?null:K.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"}):K.formatMessage({id:"gUhc5g",defaultMessage:"You need to evaluate the resulting output first"}):K.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):K.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):K.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[me,z.length,K,B,R,pe,_,ge]),be=(0,s.useMemo)((()=>_?pe?me?null:K.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):K.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):K.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[me,K,pe,_]);if(e&&O)return(0,h.Y)(Ce,{isOpen:e&&O,closeExamples:()=>U(!1),closeModal:t,updatePromptTemplate:ee,updateInputVariableValue:$});return(0,h.FD)(M.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_541",verticalSizing:"maxed_out",visible:e,onCancel:t,onOk:t,footer:(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:p.spacing.sm,justifyContent:"flex-end"},""),children:[(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_589",onClick:t,children:(0,h.Y)(c.A,{id:"mqTFL+",defaultMessage:"Cancel"})}),(0,h.Y)(r.LegacyTooltip,{title:ye,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_596",onClick:()=>{var e,n;Y(!0);const a=null===(e=te[_])||void 0===e?void 0:e.name,o={...m,route_type:null===(n=te[_])||void 0===n?void 0:n.type},r=(0,se.TG)(Z,q);H((0,l.$v)({experimentId:u,promptTemplate:Z,modelInput:r,modelParameters:o,modelRouteName:a,promptParameters:q,modelOutput:R,runName:x,modelOutputParameters:L})).then((()=>{d(),t(),Y(!1),f("ARTIFACT")})).catch((e=>{w.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e),Y(!1)}))},"data-testid":"button-create-run",type:"primary",disabled:!ve,children:(0,h.Y)(c.A,{id:"8Uwpjw",defaultMessage:"Create run"})})})]}),title:(0,h.FD)("div",{children:[(0,h.Y)(o.T.Title,{level:2,css:(0,a.AH)({marginTop:p.spacing.sm,marginBottom:p.spacing.xs},""),children:(0,h.Y)(c.A,{id:"sLhmy7",defaultMessage:"New run"})}),(0,h.Y)(o.T.Hint,{css:Le,children:"Create a new run using a large-language model by giving it a prompt template and model parameters"})]}),dangerouslySetAntdProps:{width:1200},children:[(0,h.FD)("div",{css:Fe,children:[(0,h.FD)("div",{children:[(0,h.Y)(r.FormUI.Label,{htmlFor:"selected_model",css:(0,a.AH)({marginBottom:p.spacing.sm},""),children:de}),(0,h.Y)("div",{css:(0,a.AH)({marginBottom:p.spacing.lg,display:"flex",alignItems:"center"},""),children:(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_597",label:de,modal:!1,value:_?[(we=_,we.includes(":")?we.split(":")[1]:we)]:void 0,children:[(0,h.Y)(r.DialogComboboxTrigger,{id:"selected_model",css:Be,allowClear:!1,placeholder:ue,withInlineLabel:!1}),(0,h.Y)(r.DialogComboboxContent,{loading:ae,maxHeight:400,matchTriggerWidth:!0,children:!ae&&(0,h.Y)(r.DialogComboboxOptionList,{children:(0,h.Y)(r.DialogComboboxOptionListSearch,{autoFocus:!0,children:ne.map((e=>(0,h.FD)(r.DialogComboboxOptionListSelectItem,{value:e.key,onChange:e=>{y(e)},checked:_===e.key,children:[e.name,e.mlflowDeployment&&(0,h.Y)(r.DialogComboboxHintRow,{children:e.mlflowDeployment.model.name})]},e.key)))})})})]})}),_&&(0,h.Y)(he,{parameters:m,updateParameter:g}),(0,h.Y)("div",{css:Ue.formItem,children:(0,h.FD)(h.FK,{children:[(0,h.FD)(r.FormUI.Label,{htmlFor:"new_run_name",children:[(0,h.Y)(c.A,{id:"Zqj4VA",defaultMessage:"New run name"}),!x.trim()&&(0,h.Y)(r.FormUI.Message,{type:"error",message:K.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"})})]}),(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_638",id:"new_run_name","data-testid":"run-name-input",required:!0,value:x,onChange:e=>b(e.target.value)})]})})]}),(0,h.FD)("div",{children:[(0,h.FD)("div",{css:Ue.formItem,children:[(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:Pe,children:[(0,h.Y)(r.FormUI.Label,{htmlFor:"prompt_template",children:(0,h.Y)(c.A,{id:"uBTAtY",defaultMessage:"Prompt Template"})}),(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_695",onClick:()=>U(!0),style:{marginLeft:"auto"},size:"small",children:(0,h.Y)(c.A,{id:"13vJft",defaultMessage:"View Examples"})})]}),(0,h.Y)(r.FormUI.Hint,{children:(0,h.Y)(c.A,{id:"gC2Kxm",defaultMessage:"Give instructions to the model. Use '{{ }}' or the \"Add new variable\" button to add variables to your prompt."})})]}),(0,h.Y)(Ee,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_678",id:"prompt_template",autoSize:{minRows:3},"data-testid":"prompt-template-input",value:Z,onChange:e=>ee(e.target.value),ref:X}),(0,h.Y)(xe,{violations:W})]}),z.map((e=>(0,h.Y)("div",{css:Ue.formItem,children:(0,h.FD)(h.FK,{children:[(0,h.Y)(r.FormUI.Label,{htmlFor:e,children:(0,h.Y)("span",{children:e})}),(0,h.Y)(Ee,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_694",id:e,autoSize:!0,value:q[e]?q[e]:"",onChange:t=>$(e,t.target.value)})]})},e))),(0,h.Y)("div",{css:(0,a.AH)({marginBottom:2*p.spacing.md},""),children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_736",icon:(0,h.Y)(r.PlusIcon,{}),onClick:Q,children:(0,h.Y)(c.A,{id:"71hvMu",defaultMessage:"Add new variable"})})}),(0,h.Y)(Ae,{evaluateButtonTooltip:be,evaluationMetadata:L,evaluationOutput:R,disabled:!fe,isEvaluating:I,isOutputDirty:B,onCancelClick:le,onEvaluateClick:ie,evaluationError:k})]})]}),C&&(0,h.Y)("div",{css:(0,a.AH)({inset:0,backgroundColor:p.colors.overlayOverlay,position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},""),children:(0,h.Y)(o.S,{})})]});var we},Ue={formItem:{marginBottom:16}},Ne=s.createContext({createNewRun:()=>{}}),He=({children:e,visibleRuns:t,refreshRuns:n})=>{const[a,o]=(0,s.useState)(!1),[r,i]=(0,s.useState)(null),l=(0,s.useMemo)((()=>({createNewRun:e=>{o(!0),i(e||null)}})),[]);return(0,h.FD)(Ne.Provider,{value:l,children:[e,(0,H.Ii)()&&(0,h.Y)(Oe,{visibleRuns:t,isOpen:a,closeModal:()=>o(!1),runBeingDuplicated:r,refreshRuns:n})]})},Ve=()=>(0,s.useContext)(Ne);var Ke=n(3248),Ge=n(46441),je=n(52572);const ze=s.memo((({searchFacetsState:e,experimentId:t,runsData:n,viewState:i,updateViewState:l,onDownloadCsv:u,requestError:p,additionalControls:m,refreshRuns:g,viewMaximized:f,autoRefreshEnabled:y=!1,hideEmptyCharts:x=!1,areRunsGrouped:b=!1})=>{const w=(0,Ke.Px)(),[C,Y]=(0,ke.an)(),I=(0,je.e)(),A=(0,G.z)().length>1,{startTime:k,lifecycleFilter:D,datasetsFilter:S,searchFilter:R}=e,T=C,E=(0,V.A)(),{createNewRun:L}=Ve(),[F,B]=(0,s.useState)(!1),{theme:P}=(0,o.u)(),O=(0,s.useMemo)((()=>(0,_.XU)(E)),[E]),U=D===d.gy.ACTIVE?E.formatMessage({id:"0pdAuV",defaultMessage:"Active"}):E.formatMessage({id:"yJpGwW",defaultMessage:"Deleted"}),N=E.formatMessage({id:"+fb25b",defaultMessage:"Time created"}),q=void 0===T||"ARTIFACT"===T,$=(0,v.d4)((e=>e.entities.datasetsByExperimentId[t])),W=void 0!==$;return(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:P.spacing.sm,justifyContent:"space-between",[P.responsive.mediaQueries.xs]:{flexDirection:"column"}},""),children:[(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:P.spacing.sm,alignItems:"center",flexWrap:"wrap"},""),children:[(0,h.FD)(r.SegmentedControlGroup,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_184",name:"runs-view-mode",value:C,onChange:({target:e})=>{const{value:t}=e;C!==t&&Y(t)},children:[(0,h.Y)(r.SegmentedControlButton,{value:"TABLE",icon:(0,h.Y)(M.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_201",content:E.formatMessage({id:"AxyQXa",defaultMessage:"Table view"}),children:(0,h.Y)(M.L,{})})}),(0,h.Y)(r.SegmentedControlButton,{value:"CHART",icon:(0,h.Y)(M.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_211",content:E.formatMessage({id:"Q6oN2U",defaultMessage:"Chart view"}),children:(0,h.Y)(r.ChartLineIcon,{})})}),(0,h.Y)(r.SegmentedControlButton,{value:"ARTIFACT",disabled:b,icon:(0,h.Y)(M.T,{componentId:"mlflow.experiment_page.mode.artifact",content:b?E.formatMessage({id:"YOp3/x",defaultMessage:"Unavailable when runs are grouped"}):E.formatMessage({id:"LTbwXS",defaultMessage:"Artifact evaluation"}),children:(0,h.Y)(r.TableIcon,{})})})]}),(0,h.Y)(j.D,{runsData:n,searchFilter:R,onSearchFilterChange:e=>{w({searchFilter:e})},onClear:()=>{w((0,Ge.G)())},requestError:p}),(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_217",label:N,value:"ALL"!==k?[O[k]]:[],children:[(0,h.Y)(r.DialogComboboxTrigger,{allowClear:"ALL"!==k,onClear:()=>{w({startTime:"ALL"})},"data-testid":"start-time-select-dropdown"}),(0,h.Y)(r.DialogComboboxContent,{children:(0,h.Y)(r.DialogComboboxOptionList,{children:Object.keys(O).map((e=>(0,h.Y)(r.DialogComboboxOptionListSelectItem,{checked:e===k,title:O[e],"data-testid":`start-time-select-${e}`,value:e,onChange:()=>{w({startTime:e})},children:O[e]},e)))})})]}),(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_248",label:E.formatMessage({id:"iLFoPb",defaultMessage:"State"}),value:[U],children:[(0,h.Y)(r.DialogComboboxTrigger,{allowClear:!1,"data-testid":"lifecycle-filter"}),(0,h.Y)(r.DialogComboboxContent,{children:(0,h.FD)(r.DialogComboboxOptionList,{children:[(0,h.Y)(r.DialogComboboxOptionListSelectItem,{checked:D===d.gy.ACTIVE,"data-testid":"active-runs-menu-item",value:d.gy.ACTIVE,onChange:()=>{w({lifecycleFilter:d.gy.ACTIVE})},children:(0,h.Y)(c.A,{id:"0pdAuV",defaultMessage:"Active"})},d.gy.ACTIVE),(0,h.Y)(r.DialogComboboxOptionListSelectItem,{checked:D===d.gy.DELETED,"data-testid":"deleted-runs-menu-item",value:d.gy.DELETED,onChange:()=>{w({lifecycleFilter:d.gy.DELETED})},children:(0,h.Y)(c.A,{id:"yJpGwW",defaultMessage:"Deleted"})},d.gy.DELETED)]})})]}),(0,h.Y)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_289",label:E.formatMessage({id:"IZ95jb",defaultMessage:"Datasets"}),value:S.map((e=>e.name)),multiSelect:!0,children:(0,h.FD)(r.LegacyTooltip,{title:!W&&(0,h.Y)(c.A,{id:"v8UFxB",defaultMessage:"No datasets were recorded for this experiment's runs."}),children:[(0,h.Y)(r.DialogComboboxTrigger,{allowClear:!0,onClear:()=>w({datasetsFilter:[]}),"data-testid":"datasets-select-dropdown",showTagAfterValueCount:1,disabled:!W}),W&&(0,h.Y)(r.DialogComboboxContent,{maxHeight:600,children:(0,h.Y)(r.DialogComboboxOptionList,{children:(0,h.Y)(r.DialogComboboxOptionListSearch,{children:$.map((e=>(0,h.FD)(r.DialogComboboxOptionListCheckboxItem,{checked:S.some((t=>(0,z.R)(t,e))),title:e.name,"data-testid":`dataset-dropdown-${e.name}`,value:e.name,onChange:()=>(e=>{const t=S.some((t=>(0,z.R)(t,e)))?S.filter((t=>!(0,z.R)(t,e))):[...S,e];w({datasetsFilter:t})})(e),children:[e.name," (",e.digest,")"," ",e.context&&(0,h.Y)(r.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_329",css:(0,a.AH)({textTransform:"capitalize",marginRight:P.spacing.xs},""),children:e.context})]},e.name+e.digest+e.context)))})})})]})}),m]}),(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:P.spacing.sm,alignItems:"flex-start"},""),children:[(0,h.FD)(r.DropdownMenu.Root,{modal:!1,children:[(0,h.Y)(r.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_338",icon:(0,h.Y)(r.OverflowIcon,{}),"aria-label":E.formatMessage({id:"E5gbt5",defaultMessage:"More options"})})}),(0,h.FD)(r.DropdownMenu.Content,{children:[(0,h.FD)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_362",className:"csv-button",onClick:u,children:[(0,h.Y)(r.DropdownMenu.IconWrapper,{children:(0,h.Y)(r.DownloadIcon,{})}),`Download ${n.runInfos.length} runs`]}),(0,h.Y)(r.DropdownMenu.Separator,{}),(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_382",checked:x,onClick:()=>I((e=>({...e,hideEmptyCharts:!e.hideEmptyCharts}))),children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),(0,h.Y)(c.A,{id:"lZPbxb",defaultMessage:"Hide charts with no data"})]}),(0,h.Y)(r.DropdownMenu.Separator,{}),(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_402",checked:y,onClick:()=>I((e=>({...e,autoRefreshEnabled:!e.autoRefreshEnabled}))),children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),(0,h.Y)(c.A,{id:"YamyaP",defaultMessage:"Auto-refresh"})]})]})]}),(0,h.Y)(J,{isOpen:F,closeModal:()=>B(!1),experimentId:t}),q&&(0,h.Y)(r.LegacyTooltip,{title:E.formatMessage({id:"eZOxx1",defaultMessage:"Toggle the preview sidepane"}),useAsLabel:!0,children:(0,h.Y)(K.k,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_403",pressed:i.previewPaneVisible,icon:(0,h.Y)(r.SidebarIcon,{}),onClick:()=>l({previewPaneVisible:!i.previewPaneVisible})})}),!A&&(0,h.FD)(r.DropdownMenu.Root,{children:[(0,h.Y)(r.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_415",icon:(0,h.Y)(r.PlusIcon,{}),children:(0,h.Y)(c.A,{id:"PEYesH",defaultMessage:"New run"})})}),(0,h.FD)(r.DropdownMenu.Content,{children:[(0,H.Ii)()&&(0,h.FD)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_461",onSelect:()=>L(),children:[" ",(0,h.Y)(c.A,{id:"UmwZQv",defaultMessage:"using Prompt Engineering"}),(0,h.Y)(Q.W,{})]}),(0,h.FD)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrolsfilters.tsx_469",onSelect:()=>B(!0),children:[" ",(0,h.Y)(c.A,{id:"vNRmQa",defaultMessage:"using Notebook"})]})]})]})]})]})}));var qe=n(86575);const $e="GROUP",We=(0,_.GF)($e,d.RO.ATTRIBUTES),Je=(0,_.GF)($e,d.RO.PARAMS),Qe=(0,_.GF)($e,d.RO.METRICS),Xe=(0,_.GF)($e,d.RO.TAGS),Ze=(e,t)=>e.filter((e=>e.toLowerCase().includes(t.toLowerCase()))),et=(e,t)=>{if(!t)return e;const n=e.toLowerCase().indexOf(t.toLowerCase()),a=e.substring(0,n),o=e.substring(n,n+t.length),r=e.substring(n+t.length);return n>-1?(0,h.FD)("span",{children:[a,(0,h.Y)("strong",{children:o}),r]}):e},tt=s.memo((({runsData:e,columnSelectorVisible:t,onChangeColumnSelectorVisible:n,selectedColumns:i})=>{const l=(0,je.e)(),u=(0,G.z)(),[p,m]=(0,s.useState)(""),{theme:g}=(0,o.u)(),f=(0,s.useRef)(null),v=(0,s.useRef)(null),y=(0,s.useRef)(null),x=(0,s.useMemo)((()=>(e=>{const t=[d.qo.USER,d.qo.SOURCE,d.qo.VERSION,d.qo.MODELS,d.qo.DESCRIPTION];return e&&t.unshift(d.qo.EXPERIMENT_NAME),t.unshift(d.qo.DATASET),t})(u.length>1)),[u.length]),b=(0,s.useCallback)((e=>l((t=>{const n=e(t.selectedColumns),a=Array.from(new Set(n));return{...t,selectedColumns:a}}))),[l]),C=(0,s.useMemo)((()=>w.A.getVisibleTagKeyList(e.tagsList)),[e]),Y=(0,s.useMemo)((()=>({[d.RO.ATTRIBUTES]:x.map((e=>(0,_.GF)(d.RO.ATTRIBUTES,e))),[d.RO.PARAMS]:e.paramKeyList.map((e=>(0,_.GF)(d.RO.PARAMS,e))),[d.RO.METRICS]:e.metricKeyList.map((e=>(0,_.GF)(d.RO.METRICS,e))),[d.RO.TAGS]:C.map((e=>(0,_.GF)(d.RO.TAGS,e)))})),[e,x,C]),I=(0,s.useMemo)((()=>{const t=[],n=Ze(x,p),a=Ze(e.paramKeyList,p),o=Ze(e.metricKeyList,p),r=Ze(C,p);return n.length&&t.push({key:We,title:"Attributes",children:n.map((e=>({key:(0,_.GF)(d.RO.ATTRIBUTES,e),title:et(e,p)})))}),o.length&&t.push({key:Qe,title:`Metrics (${o.length})`,children:o.map((e=>{var t;const n=qe.g[e];return{key:(0,_.GF)(d.RO.METRICS,e),title:et(null!==(t=null===n||void 0===n?void 0:n.displayName)&&void 0!==t?t:e,p)}}))}),a.length&&t.push({key:Je,title:`Parameters (${a.length})`,children:a.map((e=>({key:(0,_.GF)(d.RO.PARAMS,e),title:et(e,p)})))}),r.length&&t.push({key:Xe,title:`Tags (${r.length})`,children:r.map((e=>({key:(0,_.GF)(d.RO.TAGS,e),title:e})))}),t}),[x,p,e,C]),A=(0,s.useCallback)(((e,t)=>{b(e?e=>e.filter((e=>!t.includes(e))):e=>[...e,...t])}),[b]),k=(0,s.useCallback)(((e,t)=>{b(t?t=>t.filter((t=>t!==e)):t=>[...t,e])}),[b]);(0,s.useEffect)((()=>{t&&(m(""),requestAnimationFrame((()=>{var e,t;null===v||void 0===v||null===(e=v.current)||void 0===e||e.scrollTo(0,0),null===(t=f.current)||void 0===t||t.focus({preventScroll:!0}),y.current&&y.current.scrollIntoView({block:"nearest",behavior:"smooth"})})))}),[t]);const M=(0,s.useCallback)(((e,{node:{key:t,checked:n}})=>{if((0,_.tG)(t.toString(),$e)){const e=(0,_.dz)(t.toString(),$e),a=Y[e];a&&A(n,Ze(a,p))}else k(t.toString(),n)}),[Y,A,k,p]),S=(0,s.useCallback)((e=>{if("ArrowDown"===e.key){const e=(null===(t=v.current)||void 0===t?void 0:t.querySelector('[role="tree"] input'))||null;e&&e.focus()}var t}),[]),R=(0,h.FD)("div",{css:(0,a.AH)({backgroundColor:g.colors.backgroundPrimary,width:400,border:"1px solid",borderColor:g.colors.border,[g.responsive.mediaQueries.xs]:{width:"100vw"}},""),onKeyDown:e=>{var t;"Escape"===e.key&&(n(!1),null===(t=y.current)||void 0===t||t.focus())},children:[(0,h.Y)("div",{css:e=>({padding:e.spacing.md}),children:(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscolumnselector.tsx_300",value:p,prefix:(0,h.Y)(D.S,{}),placeholder:"Search columns",allowClear:!0,ref:f,onChange:e=>{m(e.target.value)},onKeyDown:S})}),(0,h.Y)("div",{ref:v,css:(0,a.AH)({maxHeight:480,overflowY:"scroll",overflowX:"hidden",paddingBottom:g.spacing.md,"span[title]":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},[g.responsive.mediaQueries.xs]:{maxHeight:"calc(100vh - 100px)"}},""),children:(0,h.Y)(r.Tree,{"data-testid":"column-selector-tree",mode:"checkable",dangerouslySetAntdProps:{checkedKeys:i,onCheck:M},defaultExpandedKeys:[We,Je,Qe,Xe],treeData:I})})]});return(0,h.Y)(r.Dropdown,{overlay:R,placement:"bottomLeft",trigger:["click"],visible:t,onVisibleChange:n,children:(0,h.FD)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscolumnselector.tsx_315",ref:y,style:{display:"flex",alignItems:"center"},"data-testid":"column-selection-dropdown",icon:(0,h.Y)(r.ColumnsIcon,{}),children:[(0,h.Y)(c.A,{id:"ny+fBZ",defaultMessage:"Columns"})," ",(0,h.Y)(r.ChevronDownIcon,{})]})})}));var nt=n(18585),at=n(1475);const ot=(0,ie.YK)({minimum:{id:"iT8ODo",defaultMessage:"Minimum"},maximum:{id:"au61Yy",defaultMessage:"Maximum"},average:{id:"/LfvdB",defaultMessage:"Average"},attributes:{id:"cy9EfG",defaultMessage:"Attributes"},tags:{id:"LEiN8m",defaultMessage:"Tags"},params:{id:"i9OADf",defaultMessage:"Params"},dataset:{id:"RtKhwd",defaultMessage:"Dataset"},noParams:{id:"Q73eXs",defaultMessage:"No params"},noTags:{id:"jHWRLw",defaultMessage:"No tags"},aggregationTooltip:{id:"fKx4kG",defaultMessage:"Aggregation: {value}"},noResults:{id:"aaVp/T",defaultMessage:"No results"}});var rt={name:"9q39xd",styles:"min-width:32px"},st={name:"o5v4ro",styles:"max-height:400px;overflow-y:scroll"};const it=({runsData:e,onChange:t,groupBy:n,useGroupedValuesInCharts:i,onUseGroupedValuesInChartsChange:l})=>{const d=(0,V.A)(),u=(0,s.useRef)(null),p=(0,s.useRef)(null),m=(0,s.useRef)(null),g=(0,s.useRef)(null),f=d.formatMessage(ot.minimum),v=d.formatMessage(ot.maximum),_=d.formatMessage(ot.average),y=d.formatMessage(ot.dataset),x=(0,s.useMemo)((()=>(0,E.uniq)((0,E.values)(e.tagsList).flatMap((e=>(0,E.keys)(e).filter((e=>!e.startsWith(k.nt))))))),[e.tagsList]),{aggregateFunction:b=at.it.Average,groupByKeys:w=[]}=n||{},C={min:f,max:v,average:_}[b],{theme:Y}=(0,o.u)(),[I,A]=(0,s.useState)("");(0,s.useEffect)((()=>{requestAnimationFrame((()=>{g.current.focus()}))}),[]);const M=x.filter((e=>e.toLowerCase().includes(I.toLowerCase()))),S=e.paramKeyList.filter((e=>e.toLowerCase().includes(I.toLowerCase()))),R=(0,s.useMemo)((()=>!(0,E.isEmpty)((0,E.compact)(e.datasetsList))),[e.datasetsList])&&y.toLowerCase().includes(I.toLowerCase()),T=M.length>0||S.length>0||R,L=(0,s.useCallback)(((e,n,a)=>{if(a){const a=[...w];a.some((t=>t.mode===e&&t.groupByData===n))||a.push({mode:e,groupByData:n}),t({aggregateFunction:b,groupByKeys:a})}else{const a=w.filter((t=>!(t.mode===e&&t.groupByData===n)));if(!a.length)return void t(null);t({aggregateFunction:b,groupByKeys:a})}}),[b,w,t]);return(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:Y.spacing.xs,padding:Y.spacing.sm},""),children:[(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_191",value:I,onChange:e=>A(e.target.value),prefix:(0,h.Y)(D.S,{}),placeholder:"Search",autoFocus:!0,ref:g,onKeyDown:e=>{if("ArrowDown"!==e.key&&"Tab"!==e.key)"Escape"!==e.key&&e.stopPropagation();else{const e=u.current||p.current||m.current;null===e||void 0===e||e.focus()}}}),(0,h.FD)(r.DropdownMenu.Root,{children:[(0,h.Y)(r.LegacyTooltip,{placement:"right",title:(0,h.Y)(c.A,{...ot.aggregationTooltip,values:{value:C||b}}),children:(0,h.Y)(r.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_168",icon:(0,h.Y)(r.GearIcon,{}),css:rt,"aria-label":"Change aggregation function"})})}),(0,h.FD)(r.DropdownMenu.Content,{align:"start",side:"right",children:[(0,H.Bh)()&&(0,h.FD)(h.FK,{children:[(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_233",disabled:!w.length,checked:i,onCheckedChange:l,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),"Use grouping from the runs table in charts"]}),(0,h.Y)(r.DropdownMenu.Separator,{})]}),(0,h.FD)(r.DropdownMenu.RadioGroup,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_244",value:b,onValueChange:e=>{if((0,E.values)(at.it).includes(e)){const a=e,o={...n,aggregateFunction:a};t(o)}},children:[(0,h.FD)(r.DropdownMenu.RadioItem,{disabled:!w.length,value:at.it.Min,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),f]},at.it.Min),(0,h.FD)(r.DropdownMenu.RadioItem,{disabled:!w.length,value:at.it.Max,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),v]},at.it.Max),(0,h.FD)(r.DropdownMenu.RadioItem,{disabled:!w.length,value:at.it.Average,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),_]},at.it.Average)]})]})]})]}),(0,h.FD)(r.DropdownMenu.Group,{css:st,children:[R&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.DropdownMenu.Label,{children:(0,h.Y)(c.A,{...ot.attributes})}),y.toLowerCase().includes(I.toLowerCase())&&(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_280",checked:(0,nt.sd)(n,at.uq.Dataset,"dataset"),ref:u,onCheckedChange:e=>L(at.uq.Dataset,"dataset",e),children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),y]},(0,nt._p)(at.uq.Dataset,"dataset",b)),(0,h.Y)(r.DropdownMenu.Separator,{})]}),M.length>0&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.DropdownMenu.Label,{children:(0,h.Y)(c.A,{...ot.tags})}),M.map(((e,t)=>{const a=(0,nt._p)(at.uq.Tag,e,b);return(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_302",checked:(0,nt.sd)(n,at.uq.Tag,e),ref:0===t?p:void 0,onCheckedChange:t=>L(at.uq.Tag,e,t),children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),e]},a)})),!x.length&&(0,h.FD)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_314",disabled:!0,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{})," ",(0,h.Y)(c.A,{...ot.noTags})]}),(0,h.Y)(r.DropdownMenu.Separator,{})]}),S.length>0&&(0,h.FD)(h.FK,{children:[(0,h.Y)(r.DropdownMenu.Label,{children:(0,h.Y)(c.A,{...ot.params})}),S.map(((e,t)=>{const a=(0,nt._p)(at.uq.Param,e,b);return(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_330",checked:(0,nt.sd)(n,at.uq.Param,e),ref:0===t?m:void 0,onCheckedChange:t=>L(at.uq.Param,e,t),children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),e]},a)})),!e.paramKeyList.length&&(0,h.Y)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_342",disabled:!0,children:(0,h.Y)(c.A,{...ot.noParams})})]}),!T&&(0,h.Y)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_349",disabled:!0,children:(0,h.Y)(c.A,{...ot.noResults})})]})]})};var lt={name:"taqmwb",styles:"margin-left:4px;margin-right:0"};const dt=s.memo((({runsData:e,groupBy:t,isLoading:n,onChange:s,useGroupedValuesInCharts:i,onUseGroupedValuesInChartsChange:l})=>{const{theme:d}=(0,o.u)(),u=(0,nt.Zp)(t)||{aggregateFunction:at.it.Average,groupByKeys:[]},p=u&&!(0,E.isEmpty)(u.groupByKeys);return(0,h.FD)(r.DropdownMenu.Root,{modal:!1,children:[(0,h.Y)(r.DropdownMenu.Trigger,{asChild:!0,children:(0,h.FD)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_306",icon:(0,h.Y)(r.ListBorderIcon,{}),style:{display:"flex",alignItems:"center"},"data-testid":"column-selection-dropdown",endIcon:(0,h.Y)(r.ChevronDownIcon,{}),children:[p?(0,h.Y)(c.A,{id:"AFI74W",defaultMessage:"Group by: {value}",values:{value:u.groupByKeys[0].groupByData}}):(0,h.Y)(c.A,{id:"fjM/KK",defaultMessage:"Group by"}),u.groupByKeys.length>1&&(0,h.FD)(r.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_426",css:lt,children:["+",u.groupByKeys.length-1]}),t&&(0,h.Y)(D.X,{"aria-hidden":"false",css:(0,a.AH)({color:d.colors.textPlaceholder,fontSize:d.typography.fontSizeSm,marginLeft:d.spacing.sm,":hover":{color:d.colors.actionTertiaryTextHover}},""),role:"button",onClick:()=>{s(null)},onPointerDownCapture:e=>{e.stopPropagation()}})]})}),(0,h.Y)(r.DropdownMenu.Content,{children:n?(0,h.Y)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunsgroupbyselector.tsx_436",children:(0,h.Y)(o.S,{})}):(0,h.Y)(it,{groupBy:u,onChange:s,runsData:e,onUseGroupedValuesInChartsChange:l,useGroupedValuesInCharts:i})})]})}));var ct=n(63908);var ut={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},pt={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const mt=({sortOptions:e,orderByKey:t,orderByAsc:n,onOptionSelected:i})=>{const{theme:l}=(0,o.u)(),d=(0,Ke.Px)(),u=(0,je.e)(),p=(0,s.useRef)(null),[m,g]=(0,s.useState)(""),f=(0,s.useRef)(null),v=(0,s.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(m.toLowerCase())))),[e,m]),_=e=>{d({orderByAsc:e}),i()};return(0,s.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=p.current)||void 0===e||e.focus()}))}),[]),(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,a.AH)({padding:`${l.spacing.sm}px ${l.spacing.lg/2}px ${l.spacing.sm}px`,width:"100%",display:"flex",gap:l.spacing.xs},""),children:[(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_97",prefix:(0,h.Y)(D.S,{}),value:m,type:"search",onChange:e=>g(e.target.value),placeholder:"Search",autoFocus:!0,ref:p,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=f.current)||void 0===t||t.focus()}}),(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:l.spacing.xs},""),children:[(0,h.Y)(K.k,{pressed:!n,icon:(0,h.Y)(r.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_select_v2.sort_desc",onClick:()=>_(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,h.Y)(K.k,{pressed:n,icon:(0,h.Y)(r.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_select_v2.sort_asc",onClick:()=>_(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,h.FD)(r.DropdownMenu.Group,{css:ut,children:[v.map(((e,n)=>(0,h.FD)(r.DropdownMenu.CheckboxItem,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_137",onClick:()=>(e=>{d({orderByKey:e}),u((t=>t.selectedColumns.includes(e)?t:{...t,selectedColumns:[...t.selectedColumns,e]})),i()})(e.value),checked:e.value===t,"data-testid":`sort-select-${e.label}`,ref:0===n?f:void 0,children:[(0,h.Y)(r.DropdownMenu.ItemIndicator,{}),(0,h.Y)("span",{css:pt,children:(0,ct.fx)(e.label,50)})]},e.value))),!v.length&&(0,h.Y)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,h.Y)(c.A,{id:"EkUD0b",defaultMessage:"No results"})})]})]})};var gt={name:"9q39xd",styles:"min-width:32px"};const ht=s.memo((({metricKeys:e,paramKeys:t,orderByAsc:n,orderByKey:a})=>{const i=(0,V.A)(),[l,c]=(0,s.useState)(!1),{theme:u}=(0,o.u)(),p=(0,s.useMemo)((()=>Object.keys(d.Eg).map((e=>({label:d.Eg[e],value:d.T8[e]})))),[]),m=(0,s.useMemo)((()=>e.map((e=>{var t,n;const a=(0,_.GF)(d.RO.METRICS,e);return{label:null!==(t=null===(n=qe.g[e])||void 0===n?void 0:n.displayName)&&void 0!==t?t:e,value:a}}))),[e]),g=(0,s.useMemo)((()=>t.map((e=>({label:e,value:`${(0,_.GF)(d.RO.PARAMS,e)}`})))),[t]),f=(0,s.useMemo)((()=>[...p,...m,...g]),[p,m,g]),v=(0,s.useMemo)((()=>{const e=f.find((e=>e.value===a));let t=null===e||void 0===e?void 0:e.label;if(!t){const e=a.match(/^.+\.`(.+)`$/);e&&(t=e[1])}return`${i.formatMessage({id:"sKaamx",defaultMessage:"Sort"})}: ${t}`}),[f,i,a]);return(0,h.FD)(r.DropdownMenu.Root,{open:l,onOpenChange:c,modal:!1,children:[(0,h.Y)(r.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,h.Y)(o.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:n?(0,h.Y)(r.SortAscendingIcon,{}):(0,h.Y)(r.SortDescendingIcon,{}),css:gt,"aria-label":v,endIcon:(0,h.Y)(r.ChevronDownIcon,{}),children:v})}),(0,h.Y)(r.DropdownMenu.Content,{minWidth:250,children:(0,h.Y)(mt,{sortOptions:f,orderByKey:a,orderByAsc:n,onOptionSelected:()=>c(!1)})})]})})),ft=s.memo((({runsData:e,viewState:t,updateViewState:n,searchFacetsState:i,experimentId:l,requestError:u,expandRows:p,updateExpandRows:m,refreshRuns:g,uiState:f,isLoading:v,isComparingExperiments:y})=>{var x;const[b,C]=(0,ke.an)(),{paramKeyList:Y,metricKeyList:I,tagsList:A}=e,{orderByAsc:k,orderByKey:M}=i,D=(0,je.e)(),S="TABLE"!==b,R="ARTIFACT"===b,{theme:T}=(0,o.u)(),E=Y,L=I,F=w.A.getVisibleTagKeyList(A),B=(0,s.useCallback)((()=>(0,_.D1)(e,F,E,L)),[L,E,F,e]),P=(((e,t)=>{(0,s.useMemo)((()=>{let n=[];const a=[d.mh,d.KU];return n=[...Object.keys(d.Eg).reduce(((e,t)=>{const n=d.Eg[t];return a.forEach((a=>{e.push({label:n,value:d.T8[t]+d.KE+a,order:a})})),e}),[]),...e.reduce(((e,t)=>(a.forEach((n=>{e.push({label:t,value:`${(0,_.GF)(d.RO.METRICS,t)}${d.KE}${n}`,order:n})})),e)),[]),...t.reduce(((e,t)=>(a.forEach((n=>{e.push({label:t,value:`${(0,_.GF)(d.RO.PARAMS,t)}${d.KE}${n}`,order:n})})),e)),[])],n}),[e,t])})(L,E),Object.values(t.runsSelected).filter(Boolean).length),O=P>1||1===P||P>0,N=!R,H=(0,s.useCallback)((e=>n({columnSelectorVisible:e})),[n]),V=(0,s.useCallback)((()=>m(!p)),[p,m]),K=(0,s.useMemo)((()=>e.datasetsList.some((e=>(null===e||void 0===e?void 0:e.length)>1))),[e]);return(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:T.spacing.sm,flexDirection:"column",marginBottom:T.spacing.sm},""),children:[O&&(0,h.Y)(U,{runsData:e,searchFacetsState:i,viewState:t,refreshRuns:g}),!O&&(0,h.Y)(ze,{onDownloadCsv:B,searchFacetsState:i,experimentId:l,viewState:t,updateViewState:n,runsData:e,requestError:u,refreshRuns:g,viewMaximized:f.viewMaximized,autoRefreshEnabled:f.autoRefreshEnabled,hideEmptyCharts:f.hideEmptyCharts,areRunsGrouped:Boolean(f.groupBy),additionalControls:(0,h.FD)(h.FK,{children:[(0,h.Y)(ht,{orderByAsc:k,orderByKey:M,metricKeys:L,paramKeys:E}),!S&&(0,h.Y)(tt,{columnSelectorVisible:t.columnSelectorVisible,onChangeColumnSelectorVisible:H,runsData:e,selectedColumns:f.selectedColumns}),!S&&K&&(0,h.Y)(r.ToggleButton,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunscontrols.tsx_175",onClick:V,children:(0,h.Y)(c.A,{id:"mRc7MY",defaultMessage:"Expand rows"})}),N&&(0,h.Y)(dt,{groupBy:f.groupBy,onChange:e=>{D((t=>({...t,groupBy:e})))},runsData:e,isLoading:v,useGroupedValuesInCharts:null===(x=f.useGroupedValuesInCharts)||void 0===x||x,onUseGroupedValuesInChartsChange:e=>{D((t=>({...t,useGroupedValuesInCharts:e})))}})]})})]})}));var vt=n(88625);class _t{constructor(){this.runsSelected={},this.hiddenChildRunsSelected={},this.columnSelectorVisible=!1,this.previewPaneVisible=!1,this.artifactViewState={selectedTables:[],groupByCols:[],outputColumn:"",intersectingOnly:!1}}}var yt=n(11591);const xt="FETCHED_RUN_NOTIFICATION_KEY",bt=e=>{const{formatMessage:t}=(0,V.A)(),n=(0,s.useCallback)(((e,n)=>e===n?t({id:"KJbYrw",defaultMessage:"Loaded {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{childRuns:n}):t({id:"ziIhFQ",defaultMessage:"Loaded {allRuns} {allRuns, plural, =1 {run} other {runs}}, including {childRuns} child {childRuns, plural, =1 {run} other {runs}}"},{allRuns:e,childRuns:n})),[t]);return(0,s.useCallback)(((t,a)=>{if(Array.isArray(t)){const{allRuns:o,childRuns:r}=((e,t=[])=>{const n=e.filter((e=>!t.some((t=>t.runUuid===e.info.runUuid)))),a=n.filter((e=>{var t;const n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.tags;return Array.isArray(n)&&n.some((e=>e.key===_.Ol&&Boolean(e.value)))}));return{allRuns:n.length,childRuns:a.length}})(t,a);if(r<1)return;e.close(xt),e.info({message:n(o,r),duration:3,placement:"bottomRight",key:xt})}}),[e,n])};var wt=n(48292),Ct=n(41629),Yt=n(57670);const It=s.createContext({getMissingParams:()=>[],pendingDataLoading:{},getEvaluableRowCount:()=>0,evaluateCell:()=>{},evaluateAllClick:()=>{},runColumnsBeingEvaluated:[],canEvaluateInRunColumn:()=>!1,toggleExpandedHeader:()=>{},isHeaderExpanded:!1}),At=({tableData:e,outputColumn:t,children:n})=>{const a=(0,V.A)(),[o,r]=(0,s.useState)(!1),i=(0,s.useCallback)((()=>r((e=>!e))),[]),l=(0,s.useCallback)(((t,n)=>{if(!(0,se.o1)(t))return null;const a=e.find((e=>e.key===n));if(!a)return null;const{promptTemplate:o}=(0,se.vC)(t);if(!o)return null;return(0,se.rl)(o).filter((e=>!a.groupByCellValues[e]))}),[e]),d=(0,v.wA)(),{startEvaluatingRunColumn:c,stopEvaluatingRunColumn:u,runColumnsBeingEvaluated:p}=((e,t)=>{const n=(0,s.useRef)(e),a=(0,s.useRef)([]),o=(0,V.A)();(0,s.useEffect)((()=>{n.current=e}),[e]);const[r,i]=(0,s.useState)([]);(0,s.useEffect)((()=>{a.current=r}),[r]);const l=(0,v.wA)(),d=(0,s.useCallback)((e=>{const r=n.current,{parameters:s,promptTemplate:c,routeName:u,routeType:p}=(0,se.vC)(e);if(!c)return;const m=(0,se.rl)(c),g=r.find((t=>!t.cellValues[e.runUuid]&&((e,t)=>0===t.filter((t=>!e.groupByCellValues[t])).length)(t,m)));if(!g)return void i((t=>t.filter((t=>t!==e.runUuid))));const h=g.key,f=g.groupByCellValues;if(!c)return;const v=(0,se.TG)(c,f);u&&l(Se({routeName:u,routeType:p,compiledPrompt:v,inputValues:f,outputColumn:t,rowKey:h,parameters:s,run:e})).then((()=>{a.current.includes(e.runUuid)&&d(e)})).catch((t=>{const n=Te(t),a=o.formatMessage({id:"jI22Qu",defaultMessage:'Gateway returned the following error: "{errorMessage}"'},{errorMessage:n});w.A.logErrorAndNotifyUser(a),i((t=>t.filter((t=>t!==e.runUuid))))}))}),[l,t,o]),c=(0,s.useCallback)((e=>{i((t=>[...t,e.runUuid])),d(e)}),[d]),u=(0,s.useCallback)((e=>{i((t=>t.filter((t=>t!==e.runUuid))))}),[]);return{runColumnsBeingEvaluated:r,startEvaluatingRunColumn:c,stopEvaluatingRunColumn:u}})(e,t),m=(0,v.d4)((({evaluationData:e})=>e.evaluationPendingDataLoadingByRunUuid)),g=(0,s.useCallback)((e=>t===se.hR&&(0,se.o1)(e)),[t]),f=(0,s.useCallback)((t=>e.filter((e=>{if(e.cellValues[t.runUuid])return!1;const n=l(t,e.key);return 0===(null===n||void 0===n?void 0:n.length)})).length),[e,l]),_=(0,s.useCallback)((e=>{p.includes(e.runUuid)?u(e):c(e)}),[p,c,u]),y=(0,s.useCallback)(((n,o)=>{const r=e.find((({key:e})=>e===o));if(!r)return;const s=r.groupByCellValues,{parameters:i,promptTemplate:l,routeName:c,routeType:u}=(0,se.vC)(n);if(!l)return;const p=(0,se.TG)(l,s);if(c){d((()=>Se({routeName:c,routeType:u,compiledPrompt:p,inputValues:s,outputColumn:t,rowKey:o,parameters:i,run:n}))()).catch((e=>{const t=Te(e),n=a.formatMessage({id:"nyHcAz",defaultMessage:'MLflow deployment returned the following error: "{errorMessage}"'},{errorMessage:t});w.A.logErrorAndNotifyUser(n)}))}}),[e,d,t,a]),x=(0,s.useMemo)((()=>({getMissingParams:l,getEvaluableRowCount:f,evaluateCell:y,evaluateAllClick:_,pendingDataLoading:m,canEvaluateInRunColumn:g,runColumnsBeingEvaluated:p,isHeaderExpanded:o,toggleExpandedHeader:i})),[l,f,_,y,m,g,p,o,i]);return(0,h.Y)(It.Provider,{value:x,children:n})},kt=()=>(0,s.useContext)(It);var Mt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Dt={name:"lyel5l",styles:"font-size:0"},St={name:"1hetg88",styles:"max-width:300px"};const Rt=({run:e})=>{const{theme:t}=(0,o.u)(),{isHeaderExpanded:n}=kt(),r=(0,se.vC)(e),s=(0,v.d4)((({modelGateway:e})=>{const t=`${r.routeType}:${r.routeName}`;return r.routeName?e.modelGatewayRoutes[t]:null}));if(!(0,se.o1)(e)||!r)return null;const{parameters:i,promptTemplate:l,routeName:d}=r,{stop:u=[]}=i;return(0,h.FD)("div",{css:(0,a.AH)({marginTop:t.spacing.xs,flex:1,display:"flex",flexDirection:"column",gap:t.spacing.sm,overflowX:"hidden",width:"100%"},""),children:[s&&"mlflowDeployment"in s&&s.mlflowDeployment&&(0,h.Y)(o.T.Hint,{children:s.mlflowDeployment.name}),n&&(0,h.FD)(h.FK,{children:[(0,h.Y)(o.T.Hint,{children:(0,h.Y)(c.A,{id:"HGBit9",defaultMessage:"Temperature: {temperature}",values:i})}),(0,h.Y)(o.T.Hint,{children:(0,h.Y)(c.A,{id:"6K04VZ",defaultMessage:"Max. tokens: {max_tokens}",values:i})}),u.length?(0,h.Y)(o.T.Hint,{css:Mt,children:(0,h.Y)(c.A,{id:"iC2Owx",defaultMessage:"Stop sequences: {stopSequences}",values:{stopSequences:null===u||void 0===u?void 0:u.join(", ")}})}):null,(0,h.Y)("div",{css:Dt,children:(0,h.FD)(o.aw.Root,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadermodelindicator.tsx_107",children:[(0,h.Y)(o.aw.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadermodelindicator.tsx_115",type:"link",size:"small",css:(0,a.AH)({fontSize:t.typography.fontSizeSm},""),children:(0,h.Y)(c.A,{id:"XX8+x1",defaultMessage:"View prompt template"})})}),(0,h.FD)(o.aw.Content,{css:St,children:[(0,h.Y)(o.aw.Arrow,{}),l]})]})})]})]})};var Tt=n(39606);var Et={name:"1iwgvlm",styles:"flex-shrink:1;flex-grow:1;overflow:hidden"},Lt={name:"1kd7iwj",styles:"flex-shrink:0;flex-grow:1;display:flex;align-items:flex-end"};const Ft=({run:e,onDatasetSelected:t})=>{var n;const{theme:r}=(0,o.u)(),i=(0,s.useCallback)((n=>t(n,e)),[t,e]);return(null===(n=e.datasets)||void 0===n?void 0:n.length)<1?null:(0,h.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs,overflow:"hidden"},""),children:[(0,h.Y)("div",{css:Et,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_37",type:"link",onClick:()=>i(e.datasets[0]),children:(0,h.Y)(Tt.E,{datasetWithTags:e.datasets[0],displayTextAsLink:!0,css:(0,a.AH)({marginTop:r.spacing.xs/2,marginBottom:r.spacing.xs/2},"")})})}),e.datasets.length>1&&(0,h.Y)("div",{css:Lt,children:(0,h.FD)(o.aw.Root,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_51",modal:!1,children:[(0,h.Y)(o.aw.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_49",size:"small",style:{borderRadius:"8px",width:"40px"},children:(0,h.FD)(o.T.Text,{color:"secondary",children:["+",e.datasets.length-1]})})}),(0,h.Y)(o.aw.Content,{align:"start",children:e.datasets.slice(1).filter(Boolean).map((e=>(0,h.Y)("div",{css:(0,a.AH)({height:r.general.heightSm,display:"flex",alignItems:"center"},""),children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheaderdatasetindicator.tsx_66",type:"link",onClick:()=>i(e),children:(0,h.Y)(Tt.E,{datasetWithTags:e,displayTextAsLink:!0})})},`${e.dataset.name}-${e.dataset.digest}`)))})]})})]})};var Bt={name:"1on1b16",styles:"width:100%;height:100%;display:flex;flex-direction:column"};const Pt=({children:e,className:t,groupHeaderContent:n=null})=>{const{theme:r}=(0,o.u)();return(0,h.FD)("div",{css:Bt,children:[(0,h.Y)("div",{css:(0,a.AH)({width:"100%",flexBasis:40,display:"flex",alignItems:"center",padding:r.spacing.sm,borderBottom:`1px solid ${r.colors.borderDecorative}`},""),className:"header-group-cell",children:n}),(0,h.Y)("div",{css:(0,a.AH)({width:"100%",flex:1,display:"flex",justifyContent:"flex-start",alignItems:"flex-start",padding:r.spacing.xs,borderRight:`1px solid ${r.colors.borderDecorative}`},""),className:t,children:e})]})};var Ot=n(49620),Ut=n(67063);var Nt={name:"8xhv84",styles:"width:100%;display:flex"},Ht={name:"ozd7xs",styles:"flex-shrink:0"},Vt={name:"82a6rk",styles:"flex:1"};const Kt=({run:e,onHideRun:t,onDuplicateRun:n,onDatasetSelected:i,groupHeaderContent:l=null})=>{const{theme:d}=(0,o.u)(),{getEvaluableRowCount:u,evaluateAllClick:p,runColumnsBeingEvaluated:f,canEvaluateInRunColumn:v}=kt(),_=(0,V.A)(),y=u(e),x=(0,Ot.LE)(),b=y>0,w=f.includes(e.runUuid),C=(0,s.useMemo)((()=>b?b&&!w?_.formatMessage({id:"2gmOVq",defaultMessage:"Process {evaluableRowCount} rows without evaluation output"},{evaluableRowCount:y}):null:_.formatMessage({id:"7m2B5x",defaultMessage:"There are no evaluable rows within this column"})),[y,b,w,_]);return(0,h.FD)(Pt,{css:(0,a.AH)({justifyContent:"flex-start",padding:d.spacing.sm,paddingBottom:0,paddingTop:d.spacing.sm,flexDirection:"column",gap:d.spacing.xs/2,overflow:"hidden"},""),groupHeaderContent:l,children:[(0,h.FD)("div",{css:Nt,children:[(0,h.FD)("span",{css:(0,a.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,h.Y)(Ut.E,{color:x(e.runUuid)}),(0,h.Y)(m.N_,{to:g.Ay.getRunPageRoute(e.experimentId||"",e.runUuid),target:"_blank",children:e.runName})]}),(0,h.Y)("div",{css:(0,a.AH)({flexBasis:d.spacing.sm,flexShrink:0},"")}),(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_112",onClick:()=>t(e.runUuid),size:"small",icon:(0,h.Y)(r.VisibleIcon,{}),css:Ht}),(0,h.Y)("div",{css:Vt}),(0,H.Ii)()&&v(e)&&(0,h.FD)(h.FK,{children:[(0,h.Y)("div",{css:(0,a.AH)({flexBasis:d.spacing.sm},"")}),(0,h.Y)(r.LegacyTooltip,{title:C,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_118",disabled:!b,size:"small",onClick:()=>p(e),icon:w?(0,h.Y)(r.StopIcon,{}):(0,h.Y)(r.PlayIcon,{}),children:w?(0,h.Y)(c.A,{id:"plw4Kp",defaultMessage:"Stop evaluating"}):(0,h.Y)(c.A,{id:"JnIbS3",defaultMessage:"Evaluate all"})})})]}),(0,h.Y)("div",{css:(0,a.AH)({flexBasis:d.spacing.sm},"")}),(0,H.Ii)()&&(0,se.o1)(e)&&(0,h.FD)(r.DropdownMenu.Root,{modal:!1,children:[(0,h.Y)(r.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_143",size:"small",icon:(0,h.Y)(r.OverflowIcon,{})})}),(0,h.Y)(r.DropdownMenu.Content,{children:(0,h.Y)(r.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationrunheadercellrenderer.tsx_150",onClick:()=>n(e),children:(0,h.Y)(c.A,{id:"1YGQOY",defaultMessage:"Duplicate run"})})})]})]}),(0,H.Ii)()&&(0,se.o1)(e)?(0,h.Y)(Rt,{run:e}):(0,h.Y)(Ft,{run:e,onDatasetSelected:i})]})},Gt=({disabled:e,isLoading:t,run:n,rowKey:a})=>{const s=(0,se.o1)(n),{evaluateCell:i,getMissingParams:l}=kt(),d=n&&l(n,a)||null;return d&&d.length>0?(0,h.Y)(r.LegacyTooltip,{title:(0,h.Y)(c.A,{id:"yAuDRt",defaultMessage:'Evaluation is not possible because values for the following inputs cannot be determined: {missingParamList}. Add input columns to the "group by" settings or use "Add row" button to define new parameter set.',values:{missingParamList:(0,h.Y)("code",{children:d.join(", ")})}}),children:(0,h.Y)(M.I,{})}):s?(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcellevaluatebutton.tsx_59",loading:t,disabled:e,size:"small",onMouseDownCapture:e=>e.stopPropagation(),onClickCapture:e=>{e.stopPropagation(),i(n,a)},icon:(0,h.Y)(r.PlayIcon,{}),children:(0,h.Y)(h.FK,{children:"Evaluate"})}):(0,h.Y)(r.LegacyTooltip,{title:(0,h.Y)(c.A,{id:"MhtxHm",defaultMessage:"You cannot evaluate this cell, this run was not created using served LLM model route"}),children:(0,h.Y)(M.I,{})})};var jt=n(90460);const zt=s.memo((({text:e,highlight:t})=>{const{theme:n}=(0,o.u)();if(!t)return(0,h.Y)(h.FK,{children:e});const r=e.split(new RegExp(`(${t})`,"gi"));return(0,h.Y)(h.FK,{children:r.map(((e,o)=>(0,h.Y)(s.Fragment,{children:e.toLowerCase()===t.toLowerCase()?(0,h.Y)("span",{css:(0,a.AH)({backgroundColor:n.colors.yellow200},""),children:e}):e},o)))})}));var qt={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},$t={name:"52b6nu",styles:"display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:7"},Wt={name:"1jwcxx3",styles:"font-style:italic"};const Jt=({value:e,context:t,isGroupByColumn:n,run:i,data:l})=>{var d,u;const{theme:p}=(0,o.u)(),{pendingDataLoading:m,canEvaluateInRunColumn:g}=kt(),f=(0,v.d4)((({modelGateway:{modelGatewayRoutesLoading:e,modelGatewayRoutesLoadingLegacy:t}})=>e.loading)),_=i&&(null===(d=m[i.runUuid])||void 0===d?void 0:d[null===l||void 0===l?void 0:l.key]),y=i&&(null===(u=l.outputMetadataByRunUuid)||void 0===u?void 0:u[i.runUuid])||null,x=null!==y&&void 0!==y&&y.isPending||l.isPendingInputRow?p.colors.backgroundSecondary:p.colors.backgroundPrimary,b=s.useMemo((()=>{try{return JSON.parse(e)}catch(t){return null}}),[e]);return(0,h.FD)("div",{css:(0,a.AH)({height:"100%",whiteSpace:"normal",padding:p.spacing.sm,overflow:"hidden",position:"relative",cursor:"pointer",backgroundColor:x,"&:hover":{backgroundColor:p.colors.actionDefaultBackgroundHover}},""),children:[_?(0,h.Y)(r.TableSkeleton,{lines:3}):(0,h.Y)(h.FK,{children:e?b?(0,h.Y)(jt.y,{json:JSON.stringify(b,null,2)}):(0,h.Y)("span",{css:$t,children:n&&t.highlightedText?(0,h.Y)(zt,{text:e,highlight:t.highlightedText}):"string"===typeof e?e.substring(0,512):"object"!==typeof e&&e}):(0,h.Y)(o.T.Text,{color:"info",css:qt,children:(0,h.Y)(c.A,{id:"aQxQIF",defaultMessage:"(empty)"})})}),(0,H.Ii)()&&i&&g(i)&&(0,h.FD)("div",{css:(0,a.AH)({position:"absolute",left:8,bottom:8,right:8,display:"flex",gap:p.spacing.sm,alignItems:"center",justifyContent:"space-between"},""),children:[(0,h.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:p.spacing.xs},""),children:[!e&&(0,h.Y)(Gt,{disabled:_,isLoading:f,run:i,rowKey:l.key}),((null===y||void 0===y?void 0:y.isPending)||l.isPendingInputRow)&&(0,h.Y)(o.T.Hint,{size:"sm",css:Wt,children:(0,h.Y)(c.A,{id:"2fvQaF",defaultMessage:"Unsaved"})})]}),y&&!_&&(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:p.spacing.xs,alignItems:"center"},""),children:[y.evaluationTime&&(0,h.FD)(o.T.Hint,{size:"sm",children:[Math.round(y.evaluationTime)," ms",y.totalTokens?",":""]}),y.totalTokens&&(0,h.Y)(o.T.Hint,{size:"sm",children:(0,h.Y)(c.A,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:y.totalTokens}})})]})]})]})},Qt={initialWidthGroupBy:200,initialWidthOutput:360,maxWidth:500,minWidth:140};var Xt={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Zt=({displayName:e})=>{const{theme:t}=(0,o.u)();return(0,h.Y)(Pt,{css:(0,a.AH)({justifyContent:"flex-start",padding:t.spacing.sm},""),children:(0,h.Y)(r.LegacyTooltip,{title:(0,E.truncate)(e,{length:250}),children:(0,h.Y)(o.T.Text,{bold:!0,css:Xt,children:e})})})};var en={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const tn={svg:{width:20,height:20}},nn=()=>{const{toggleExpandedHeader:e,isHeaderExpanded:t}=kt();return(0,h.Y)(Pt,{children:(0,h.Y)(r.LegacyTooltip,{placement:"right",title:(0,h.Y)(c.A,{id:"lDGQGa",defaultMessage:"Toggle detailed view"}),children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationtableactionscolumnrenderer.tsx_22",icon:t?(0,h.Y)(r.ChevronDownIcon,{css:tn}):(0,h.Y)(o.o,{css:tn}),onClick:e})})})},an=({onAddNewInputs:e,displayAddNewInputsButton:t})=>{const{theme:n}=(0,o.u)();return t?(0,h.Y)("div",{css:(0,a.AH)({width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:n.spacing.xs},""),children:(0,h.Y)(r.LegacyTooltip,{placement:"right",title:(0,h.Y)(c.A,{id:"PNfcez",defaultMessage:"Add row"}),children:(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationtableactionscellrenderer.tsx_37",icon:(0,h.Y)(r.PlusIcon,{}),onClick:e})})}):null};var on=n(53868);var rn={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},sn={name:"pdi3j6",styles:"display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:7;width:100%;height:100%"};const ln=({value:e})=>{const{theme:t}=(0,o.u)(),n=t.colors.backgroundPrimary;return(0,h.Y)("div",{css:(0,a.AH)({height:"100%",whiteSpace:"normal",padding:t.spacing.sm,overflow:"hidden",position:"relative",cursor:"pointer",backgroundColor:n,"&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:e&&e.url&&e.compressed_url?(0,h.Y)("span",{css:sn,children:(0,h.Y)(on.TV,{imageUrl:e.url,compressedImageUrl:e.compressed_url})}):(0,h.Y)(o.T.Text,{color:"info",css:rn,children:(0,h.Y)(c.A,{id:"aQxQIF",defaultMessage:"(empty)"})})})};var dn={name:"3ytxc3",styles:"height:100%;overflow:hidden"};const cn=({resultList:e,visibleRuns:t,groupByColumns:n,onCellClick:r,onHideRun:i,onDatasetSelected:l,highlightedText:d="",isPreviewPaneVisible:u,outputColumnName:p,isImageColumn:m})=>{const[g,f]=(0,s.useState)([]),[_,y]=(0,s.useState)(null),x=(0,v.d4)((({evaluationData:e})=>e.evaluationPendingDataByRunUuid)),b=(0,s.useRef)(null),{isHeaderExpanded:w}=kt(),{createNewRun:C}=Ve(),Y=(0,s.useCallback)((e=>{null===_||void 0===_||_.refreshHeader(),i(e)}),[_,i]),I=(0,s.useCallback)((e=>{null===_||void 0===_||_.refreshHeader(),C(e)}),[C,_]);(0,s.useEffect)((()=>{_&&!u&&_.clearFocusedCell()}),[_,u]),(0,s.useEffect)((()=>{if(!_)return;const e=_.getRenderedNodes();_.refreshCells({force:!0,rowNodes:e})}),[_,x,d]);const{showAddNewInputsModal:A,AddNewInputsModal:k}=(()=>{const[e,t]=(0,s.useState)(!1),[n,r]=(0,s.useState)([]),[i,l]=(0,s.useState)({}),d=(0,s.useMemo)((()=>n.every((({inputName:e})=>i[e]))),[i,n]),[u,p]=(0,s.useState)((async()=>{})),m=(0,s.useCallback)(((e,t)=>{l((n=>({...n,[e]:t})))}),[]),g=(0,s.useCallback)(((e,n)=>{const a=e.filter(se.o1).map((e=>({runName:e.runName,params:(0,se.xP)(e)}))),o=(0,E.uniq)(a.map((({params:e})=>e)).flat()).map((e=>({inputName:e,runNames:(0,E.compact)(a.filter((t=>t.params.includes(e))).map((({runName:e})=>e)))})));t(!0),r(o),l({}),p((()=>n))}),[]),{theme:f}=(0,o.u)();return{showAddNewInputsModal:g,AddNewInputsModal:(0,h.Y)(M.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationaddnewinputsmodal.tsx_57",title:(0,h.Y)(c.A,{id:"JnidmZ",defaultMessage:"Add row"}),okButtonProps:{disabled:!d},okText:(0,h.Y)(c.A,{id:"eeLqSn",defaultMessage:"Submit"}),cancelText:(0,h.Y)(c.A,{id:"jwALGI",defaultMessage:"Cancel"}),onOk:()=>{u(i),t(!1)},visible:e,onCancel:()=>t(!1),children:n.map((({inputName:e,runNames:t})=>(0,h.FD)("div",{css:(0,a.AH)({marginBottom:f.spacing.md},""),children:[(0,h.Y)(o.T.Text,{bold:!0,children:e}),(0,h.Y)(o.T.Hint,{css:en,children:(0,h.Y)(c.A,{id:"s35HDG",defaultMessage:"Used by {runNames} {hasMore, select, true {and other runs} other {}}",values:{runNames:t.slice(0,5).join(", "),hasMore:t.length>5}})}),(0,h.Y)("div",{css:(0,a.AH)({marginTop:f.spacing.sm},""),children:(0,h.Y)(D.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationaddnewinputsmodal.tsx_99",value:i[e],onChange:t=>m(e,t.target.value)})})]},e)))})}})(),S=(0,v.wA)(),R=(0,s.useCallback)((()=>{var e;const t=null===(e=b.current)||void 0===e?void 0:e.querySelector(".ag-body-viewport");t?t.scrollTo({top:0,behavior:"smooth"}):null===_||void 0===_||_.ensureIndexVisible(0,"top")}),[_]),T=(0,s.useMemo)((()=>t.map(se.xP).flat().length>0),[t]),L=(0,s.useCallback)((()=>{A(t,(e=>{S({type:"EVALUATE_ADD_INPUT_VALUES",payload:e,meta:{}}),R()}))}),[R,A,S,t]),{theme:F}=(0,o.u)(),B=(0,V.A)(),P=(0,s.useCallback)((({value:e,colDef:t,column:n})=>{const a=B.formatMessage({id:"aQxQIF",defaultMessage:"(empty)"});return null===r||void 0===r?void 0:r(e||a,t.headerName||n.getId())}),[B,r]),O=(0,s.useMemo)((()=>(0,h.Y)(o.T.Text,{bold:!0,children:p})),[p]);return(0,s.useEffect)((()=>{const e=[],{initialWidthGroupBy:a,initialWidthOutput:o,maxWidth:r,minWidth:s}=Qt;(0,H.Ii)()&&t.some((e=>(0,se.o1)(e)))&&e.push({resizable:!1,pinned:!0,width:40,headerComponent:"ActionsColumnRenderer",cellRendererSelector:({rowIndex:e})=>0===e?{component:"ActionsCellRenderer",params:{displayAddNewInputsButton:T,onAddNewInputs:L}}:void 0,cellClass:"leading-column-cell"}),n.forEach(((t,o)=>{const i=o===n.length-1;e.push({resizable:!0,initialWidth:a,minWidth:s,maxWidth:r,headerName:t,valueGetter:({data:e})=>e.groupByCellValues[t],suppressMovable:!0,cellRenderer:"TextRendererCellRenderer",headerClass:i?"last-group-by-header-cell":void 0,cellRendererParams:{isGroupByColumn:!0},headerComponent:"GroupHeaderCellRenderer",headerComponentParams:{displayAddNewInputsButton:T,onAddNewInputs:L},colId:t,onCellClicked:P})})),t.forEach(((t,n)=>{const a=0===n;e.push({resizable:!0,initialWidth:o,minWidth:s,maxWidth:r,headerName:t.runName,colId:t.runUuid,valueGetter:({data:e})=>e.cellValues[t.runUuid],suppressMovable:!0,cellRenderer:m?"ImageRendererCellRenderer":"TextRendererCellRenderer",cellRendererParams:{run:t},headerComponent:"RunHeaderCellRenderer",headerComponentParams:{run:t,onDuplicateRun:I,onHideRun:Y,onDatasetSelected:l,groupHeaderContent:a?O:null},onCellClicked:P})})),f(e)}),[t,n,Y,I,l,L,T,P,O,m]),(0,s.useEffect)((()=>{if(!_)return;const e=t.some((e=>{var t;return(0,se.o1)(e)||(null===(t=e.datasets)||void 0===t?void 0:t.length)>0}));_.setHeaderHeight(((e=!1,t=!1)=>t?40+(e?175:62):80)(w,e))}),[_,w,t]),(0,h.FD)("div",{css:dn,ref:b,children:[(0,h.Y)(Yt.p,{css:un(F),context:{highlightedText:d},rowHeight:190,onGridReady:({api:e})=>y(e),getRowId:({data:e})=>e.key,suppressHorizontalScroll:!1,columnDefs:g,rowData:e,components:{TextRendererCellRenderer:Jt,GroupHeaderCellRenderer:Zt,RunHeaderCellRenderer:Kt,ActionsColumnRenderer:nn,ActionsCellRenderer:an,ImageRendererCellRenderer:ln}}),k]})},un=e=>({".ag-row:not(.ag-row-first), .ag-body-viewport":{borderTop:`1px solid ${e.colors.borderDecorative}`},".ag-row-last":{borderBottom:`1px solid ${e.colors.borderDecorative}`},".ag-cell, .last-group-by-header-cell .header-group-cell":{borderRight:`1px solid ${e.colors.borderDecorative}`},".ag-cell-focus:not(.leading-column-cell)::after":{content:'""',position:"absolute",inset:0,boxShadow:`inset 0 0 0px 2px ${e.colors.blue300}`,pointerEvents:"none"}});var pn=n(65765);const mn=(e,t)=>{const n=t.map((t=>{const n=e[t];return[t,(0,E.isString)(n)?n:JSON.stringify(n)]}));return{key:n.map((([,e])=>String(e))).join("."),groupByValues:(0,E.fromPairs)(n)}};var gn=n(26765);var hn=n(30167);const fn=()=>{var e;return/mac/i.test(null===(e=window.navigator.userAgentData)||void 0===e?void 0:e.platform)||/mac/i.test(window.navigator.platform)},vn=fn()?"metaKey":"ctrlKey",_n=(e,t={},n)=>{const{altOrOptKey:a=!1,ctrlOrCmdKey:o=!1,shiftKey:r=!1}=t;return(0,s.useEffect)((()=>{const t=t=>{if((!o||t[vn])&&(!a||t.altKey)&&(!r||t.shiftKey)&&t.key===e){n()&&t.preventDefault()}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)}),[e,n,o,a,r]),{isMacKeyboard:fn}},yn=()=>{const{evaluationPendingDataByRunUuid:e,evaluationArtifactsBeingUploaded:t,evaluationDraftInputValues:n}=(0,v.d4)((({evaluationData:e})=>e)),[r,i]=(0,s.useState)(!1),u=(0,v.wA)(),p=(0,s.useCallback)((()=>{u({type:"DISCARD_PENDING_EVALUATION_DATA"})}),[u]),m=Object.values(e).flat().length,g=n.length,f=Object.values(t).filter((e=>Object.values(e).some((e=>e)))).length;(0,s.useEffect)((()=>{0===m&&i(!1)}),[m]);const _=(0,s.useCallback)((()=>(0===m||r||(i(!0),u((async(e,t)=>{const{evaluationPendingDataByRunUuid:n,evaluationArtifactsByRunUuid:a}=t().evaluationData,o=Object.keys(n),r=(0,E.fromPairs)(Object.entries(a).filter((([e,t])=>o.includes(e)&&t[d.AH])).map((([e,t])=>[e,t[d.AH]]))),s=o.map((e=>{const t=r[e];if(!t)throw new Error(`Cannot find existing prompt engineering artifact for run ${e}`);const a=n[e].map((({entryData:e,evaluationTime:n,totalTokens:a})=>t.columns.map((t=>t===se.Ef?n.toString():t===se.jC&&a?a.toString():e[t]||"")))),o=(0,E.cloneDeep)(r[e].rawArtifactFile);return null===o||void 0===o||o.data.unshift(...a),{runUuid:e,updatedArtifactFile:o}})).map((({runUuid:t,updatedArtifactFile:n})=>e((0,l.Of)(t,d.AH,n)).then((()=>{const e=(0,Me.G4)(d.AH,n);return{runUuid:t,newEvaluationTable:e}}))));return e({type:"WRITE_BACK_EVALUATION_ARTIFACTS",payload:Promise.all(s),meta:{runUuidsToUpdate:o,artifactPath:d.AH}})})).catch((e=>{w.A.logErrorAndNotifyUser(e)}))),!0)),[u,m,r]),{isMacKeyboard:y}=_n("s",{ctrlOrCmdKey:!0},_),{theme:x}=(0,o.u)(),b=g>0&&0===m,C=m>0||b?(0,h.FD)("div",{css:(0,a.AH)({backgroundColor:x.colors.backgroundPrimary,border:`1px solid ${x.colors.border}`,padding:x.spacing.md,marginBottom:x.spacing.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},""),children:[b?(0,h.Y)(c.A,{id:"EPcEi9",defaultMessage:"You have added rows with new input values, but you still need to evaluate the new data in order to save it."}):r?(0,h.Y)(o.T.Text,{children:(0,h.Y)(c.A,{id:"NGsTf/",defaultMessage:"Synchronizing artifacts for {runsBeingSynchronizedCount} runs...",values:{runsBeingSynchronizedCount:(0,h.Y)("strong",{children:f})}})}):(0,h.Y)(o.T.Text,{children:(0,h.Y)(c.A,{id:"BWpQZ7",defaultMessage:'You have <strong>{unsyncedDataEntriesCount}</strong> unsaved evaluated {unsyncedDataEntriesCount, plural, =1 {value} other {values}}. Click "Save" button or press {keyCombination} keys to synchronize the artifact data.',values:{strong:e=>(0,h.Y)("strong",{children:e}),unsyncedDataEntriesCount:m,keyCombination:y()?"\u2318CMD+S":"CTRL+S"}})}),(0,h.FD)("div",{css:(0,a.AH)({display:"flex",gap:x.spacing.sm},""),children:[(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationartifactwriteback.tsx_102",disabled:r,onClick:p,children:(0,h.Y)(c.A,{id:"kNTkr+",defaultMessage:"Discard"})})," ",m>0&&(0,h.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_hooks_useevaluationartifactwriteback.tsx_110",loading:r,type:"primary",onClick:_,children:(0,h.Y)(c.A,{id:"nhqO2Z",defaultMessage:"Save"})})]})]}):null;return{isSyncingArtifacts:r,EvaluationSyncStatusElement:C}},xn=({noEvalTablesLogged:e,userDeselectedAllColumns:t,areRunsSelected:n,areTablesSelected:a})=>!a||!n||t||e,bn=({noEvalTablesLogged:e,userDeselectedAllColumns:t,areRunsSelected:n})=>{const[a,s]=n?e?[(0,h.Y)(c.A,{id:"sguNEF",defaultMessage:"No evaluation tables logged"}),(0,h.Y)(c.A,{id:"j7cj5r",defaultMessage:"Please log at least one table artifact containing evaluation data. <link>Learn more</link>.",values:{link:e=>(0,h.Y)(o.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationartifactviewemptystate.tsx_48",openInNewTab:!0,href:"https://mlflow.org/docs/latest/python_api/mlflow.html?highlight=log_table#mlflow.log_table",target:"_blank",rel:"noopener noreferrer",children:e})}})]:t?[(0,h.Y)(c.A,{id:"owr9l2",defaultMessage:"No group by columns selected"}),(0,h.Y)(c.A,{id:"lJQEW4",defaultMessage:'Using controls above, select at least one "group by" column.'})]:[(0,h.Y)(c.A,{id:"ZvJTXB",defaultMessage:"No tables selected"}),(0,h.Y)(c.A,{id:"18/UVG",defaultMessage:"Using controls above, select at least one artifact containing table."})]:[(0,h.Y)(c.A,{id:"BFzsMn",defaultMessage:"No runs selected"}),(0,h.Y)(c.A,{id:"nPWZsh",defaultMessage:"Make sure that at least one experiment run is visible and available to compare"})];return(0,h.Y)(r.Empty,{title:a,description:s})};var wn=n(29944),Cn=n(34931);var Yn={name:"1hetg88",styles:"max-width:300px"},In={name:"111arwn",styles:"width:300px;min-width:300px"},An={name:"1hetg88",styles:"max-width:300px"},kn={name:"1hetg88",styles:"max-width:300px"},Mn={name:"1ichkjj",styles:"height:100%;display:flex;justify-content:center;align-items:center"};const Dn=({comparedRuns:e,onDatasetSelected:t,viewState:n,updateViewState:i})=>{const u=(0,V.A)(),{theme:p}=(0,o.u)(),m=((0,je.e)(),(0,s.useMemo)((()=>e.filter((({hidden:e})=>!e)).slice(0,10)),[e])),{selectedTables:g,groupByCols:f,outputColumn:_,setSelectedTables:y,setGroupByCols:x,setOutputColumn:b}=((e,t)=>{const{artifactViewState:n={}}=e,[a,o]=(0,s.useState)(n.selectedTables||[]),[r,i]=(0,s.useState)(n.groupByCols||[]),[l,d]=(0,s.useState)(n.outputColumn||"");return(0,s.useEffect)((()=>t({artifactViewState:{selectedTables:a,groupByCols:r,outputColumn:l}})),[t,a,r,l]),{selectedTables:a,groupByCols:r,outputColumn:l,setSelectedTables:o,setGroupByCols:i,setOutputColumn:d}})(n,i),[C,Y]=(0,s.useState)(!1),[I,A]=(0,s.useState)(""),[k,S]=(0,s.useState)(""),[R,T]=(0,s.useState)(!1),{isSyncingArtifacts:L,EvaluationSyncStatusElement:F}=yn(),B=(0,v.wA)();(0,s.useEffect)((()=>{(0,H.Ii)()&&B(Re()).catch((e=>{w.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[B]);const P=(0,s.useCallback)((e=>y((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))),[y]),O=(0,s.useCallback)((e=>x((t=>{const n=t.includes(e)?t.filter((t=>t!==e)):[...t,e];return T(0===n.length),n}))),[x]),U=(0,s.useMemo)((()=>m.map((({runUuid:e})=>e))),[m]),{evaluationArtifactsByRunUuid:N,evaluationPendingDataByRunUuid:K,evaluationDraftInputValues:G}=(0,v.d4)((({evaluationData:e})=>e)),{tables:j,tablesByRun:z,noEvalTablesLogged:q}=($=m,(0,s.useMemo)((()=>{const e=(0,E.fromPairs)($.map((e=>{const t=e.tags?(0,gn.T)(e.tags):[];return[e.runUuid,t]})).filter((([,e])=>e.length>0))),t=Array.from(new Set(Object.values(e).flat())),n=t.filter((t=>$.every((({runUuid:n})=>{var a;return null===(a=e[n])||void 0===a?void 0:a.includes(t)})))),a=0===t.length;return{tables:t,tablesByRun:e,tablesIntersection:n,noEvalTablesLogged:a}}),[$]));var $;(0,s.useEffect)((()=>{j.length>0&&0===g.length&&y([j[0]])}),[j,y,g.length]);const W=(0,v.d4)((({evaluationData:e,modelGateway:t})=>t.modelGatewayRoutesLoading.loading||U.some((t=>g.some((n=>{var a;return null===(a=e.evaluationArtifactsLoadingByRunUuid[t])||void 0===a?void 0:a[n]})))))),{columns:J,imageColumns:Q}=(X=N,Z=U,ee=g,(0,s.useMemo)((()=>{if(0===ee.length||0===Z.length)return{columns:[],columnsIntersection:[],imageColumns:[]};const e=Z.map((e=>Object.values(X[e]||{}).filter((({path:e})=>ee.includes(e))))).flat(),t=e.filter((({path:e})=>ee.includes(e))).map((({columns:e,entries:t})=>e.map((e=>{const n=String(e);if(t.length>0){const a=t[0][e];return"object"===typeof a&&"image"===(null===a||void 0===a?void 0:a.type)?{name:n,type:"image"}:{name:n,type:"text"}}return{name:n,type:"text"}})))).flat(),n=Array.from(new Set(t.filter((e=>"text"===e.type)).map((e=>e.name)))),a=Array.from(new Set(t.filter((e=>"image"===e.type)).map((e=>e.name)))),o=n.filter((t=>e.every((({columns:e})=>e.includes(t)))));return{columns:n,columnsIntersection:o,imageColumns:a}}),[Z,X,ee]));var X,Z,ee;const te=Q.includes(_),ne=((e,t,n,a,o,r,i)=>(0,s.useMemo)((()=>{const s=[],l={},c={},u=[];for(const e of n){const t=r.map((t=>[t,e[t]])),n=t.map((([,e])=>e)).join(".");c[n]=(0,E.fromPairs)(t),u.push(n)}const p={},m=a.map((t=>[t,Object.values(e[t]||{}).filter((({path:e})=>o.includes(e))).map((({entries:e})=>e)).flat()]));for(const[e,t]of m)for(const n of t){const{key:t,groupByValues:a}=mn(n,r);if(Object.values(a).every((e=>!e)))continue;c[t]||(c[t]=a),(n[se.Ef]||n[se.jC])&&(p[t]||(p[t]={}),p[t][e]||(p[t][e]={isPending:!1,evaluationTime:parseFloat(n[se.Ef]),totalTokens:n[se.jC]?parseInt(n[se.jC],10):void 0})),l[t]||(l[t]={});const o=l[t];o[e]=o[e]||n[i]}for(const[e,n]of Object.entries(t))for(const t of n){const{entryData:n,...a}=t,{key:o,groupByValues:s}=mn(n,r);if(Object.values(s).every((e=>!e)))continue;c[o]||(c[o]=s,u.push(o)),p[o]||(p[o]={}),p[o][e]=a,l[o]||(l[o]={});const d=l[o];d[e]=n[i]||d[e]}const g=(0,E.sortBy)(Object.entries(c),(([e])=>!u.includes(e)));for(const[e,t]of g){const n=s.find((({key:t})=>e===t));if(n&&l[e])n.cellValues=l[e],n.outputMetadataByRunUuid=p[e];else{const n=l[e];Object.keys(n||{}).forEach((e=>{if(null!==n[e]&&"object"===typeof n[e])try{const{type:t,filepath:a,compressed_filepath:o}=n[e];t===d.Oe?n[e]={url:(0,pn.To)(a,e),compressed_url:(0,pn.To)(o,e)}:n[e]=JSON.stringify(n[e])}catch{n[e]=""}else(0,E.isNil)(n[e])||(0,E.isString)(n[e])||(n[e]=JSON.stringify(n[e]))})),s.push({key:e,groupByCellValues:t,cellValues:l[e]||{},outputMetadataByRunUuid:p[e],isPendingInputRow:u.includes(e)})}}return s}),[a,e,r,n,o,i,t]))(N,K,G,U,g,f,_),ae=(0,s.useMemo)((()=>{const e=m.filter(se.o1).map(se.xP).flat();if(!e.length)return null;return Array.from(new Set(e)).filter((e=>J.includes(e)))}),[m,J]);(0,s.useEffect)((()=>{m.every(se.o1)&&x([])}),[x,m]),(0,s.useEffect)((()=>{if(g.length)for(const e of m){if(!e)continue;const t=(z[e.runUuid]||[]).filter((e=>g.includes(e)));for(const n of t)B((0,l.sT)(e.runUuid,n,!1)).catch((e=>{e instanceof Me.ap?w.A.displayGlobalErrorNotification(e.message):w.A.logErrorAndNotifyUser(e.message||e)}))}}),[m,B,g,z]);const oe=g.length>0,re=m.length>0,ie=!W&&oe&&re,le=(0,s.useMemo)((()=>{if(!k.trim())return ne;const e=new RegExp(k,"i");return ne.filter((({groupByCellValues:t})=>Object.values(t).some((t=>null===t||void 0===t?void 0:t.match(e)))))}),[ne,k]),de=(0,wn.v)(e),ce=(0,s.useCallback)((e=>{de(Cn.oy.CUSTOM,e)}),[de]);(0,s.useEffect)((()=>{if(W||R)return;const e=f.length<1,t=f.some((e=>!J.includes(e))),n=J[0],a=ae||(n?[n]:null);(e||t)&&a&&x(a)}),[W,R,f,_,J,x,ae]);const ue=(0,s.useMemo)((()=>J.filter((e=>!e.startsWith("MLFLOW_")))),[J]),pe=(0,s.useMemo)((()=>[...J,...Q].filter((e=>!f.includes(e)&&!e.startsWith("MLFLOW_")))),[J,Q,f]);(0,s.useEffect)((()=>{if(f.includes(_)||!_){const e=pe.includes(se.hR)?se.hR:pe[0];b(e||"")}}),[f,_,pe,b]),(0,s.useEffect)((()=>{Y(!0);const e=setTimeout((()=>S(I)),250);return()=>clearTimeout(e)}),[I]),(0,s.useEffect)((()=>{Y(!1)}),[k]),(0,s.useEffect)((()=>{if(!pe.includes(_)){const e=pe.includes(se.hR)?se.hR:pe[0];b(e||"")}}),[_,pe,b]),(0,s.useEffect)((()=>{g.some((e=>!j.includes(e)))&&y([])}),[g,j,y]);const[me,ge]=(0,s.useState)(null),he=(0,s.useCallback)(((e,t)=>{ge({value:e,header:t}),i({previewPaneVisible:!0})}),[i]);return(0,h.FD)("div",{css:(0,a.AH)({flex:1,borderTop:`1px solid ${p.colors.border}`,borderLeft:`1px solid ${p.colors.border}`,marginLeft:-1,zIndex:1,height:"100%",display:"grid",gridTemplateColumns:n.previewPaneVisible?"1fr auto":"1fr",overflow:"hidden"},""),children:[(0,h.FD)("div",{css:(0,a.AH)({paddingLeft:p.spacing.sm,paddingTop:p.spacing.sm,height:"100%",display:"grid",gridTemplateRows:"auto auto 1fr",overflow:"hidden",rowGap:p.spacing.sm,backgroundColor:p.colors.backgroundSecondary},""),children:[(0,h.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm,overflow:"hidden",height:p.general.heightSm},""),children:[(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationartifactcompareview.tsx_358",label:(0,h.Y)(c.A,{id:"syyEiR",defaultMessage:"Table"}),multiSelect:!0,value:g,children:[(0,h.Y)(r.DialogComboboxTrigger,{css:(0,a.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},""),"data-testid":"dropdown-tables",onClear:()=>y([]),disabled:L||!re||q}),(0,h.Y)(r.DialogComboboxContent,{css:Yn,children:(0,h.Y)(r.DialogComboboxOptionList,{children:j.map((e=>(0,h.Y)(r.DialogComboboxOptionListCheckboxItem,{value:e,onChange:P,checked:g.includes(e),"data-testid":"dropdown-tables-option",children:e},e)))})})]}),(0,h.Y)(r.LegacyTooltip,{title:(0,h.Y)(c.A,{id:"VZRc73",defaultMessage:"Using the list of logged table artifacts, select at least one to start comparing results."}),children:(0,h.Y)(M.I,{})})]}),W?(0,h.Y)(r.LegacySkeleton,{}):(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,a.AH)({display:"flex",columnGap:p.spacing.sm,alignItems:"center",overflow:"hidden",height:p.general.heightSm},""),children:[(0,h.Y)(D.I,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationartifactcompareview.tsx_414",prefix:(0,h.Y)(D.S,{}),suffix:C&&(0,h.Y)(o.S,{size:"small"}),css:In,onChange:e=>A(e.target.value),value:I,placeholder:u.formatMessage({id:"3D2Znf",defaultMessage:"Filter by {columnNames}"},{columnNames:f.join(", ")}),allowClear:!0,disabled:!ie||L}),(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationartifactcompareview.tsx_433",value:f,multiSelect:!0,label:(0,h.Y)(c.A,{id:"fWm1UC",defaultMessage:"Group by"}),children:[(0,h.Y)(r.DialogComboboxTrigger,{disabled:!ie||L,allowClear:!1,showTagAfterValueCount:1,css:(0,a.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},""),"aria-label":'Select "group by" columns'}),(0,h.Y)(r.DialogComboboxContent,{css:An,children:(0,h.Y)(r.DialogComboboxOptionList,{children:ue.map((e=>(0,h.Y)(r.DialogComboboxOptionListCheckboxItem,{value:e,onChange:O,checked:f.includes(e),children:e},e)))})})]}),(0,h.FD)(r.DialogCombobox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationartifactcompareview.tsx_465",value:[_],label:(0,h.Y)(c.A,{id:"ZqGzZd",defaultMessage:"Compare"}),children:[(0,h.Y)(r.DialogComboboxTrigger,{disabled:!ie||L,allowClear:!1,css:(0,a.AH)({maxWidth:300,backgroundColor:p.colors.backgroundPrimary},"")}),(0,h.Y)(r.DialogComboboxContent,{css:kn,children:(0,h.Y)(r.DialogComboboxOptionList,{children:pe.map((e=>(0,h.Y)(r.DialogComboboxOptionListSelectItem,{value:e,onChange:()=>b(e),checked:_===e,children:e},e)))})})]})]}),xn({areRunsSelected:re,areTablesSelected:oe,noEvalTablesLogged:q,userDeselectedAllColumns:R})?(0,h.Y)("div",{css:Mn,children:(0,h.Y)(bn,{areRunsSelected:re,areTablesSelected:oe,noEvalTablesLogged:q,userDeselectedAllColumns:R})}):(0,h.Y)("div",{css:(0,a.AH)({position:"relative",zIndex:1,overflowY:"hidden",height:"100%",backgroundColor:p.colors.backgroundPrimary},""),children:(0,h.Y)(At,{tableData:ne,outputColumn:_,children:(0,h.Y)(cn,{visibleRuns:m,groupByColumns:f,resultList:le,onCellClick:te?void 0:he,onHideRun:ce,onDatasetSelected:t,highlightedText:k.trim(),isPreviewPaneVisible:n.previewPaneVisible,outputColumnName:_,isImageColumn:te})})}),F]})]}),n.previewPaneVisible&&(0,h.Y)(hn.V,{content:null!==me&&void 0!==me&&me.value?(0,h.Y)(jt.f,{json:me.value}):null,copyText:(null===me||void 0===me?void 0:me.value)||"",headerText:null===me||void 0===me?void 0:me.header,onClose:()=>i({previewPaneVisible:!1}),empty:(0,h.Y)(r.Empty,{description:(0,h.Y)(c.A,{id:"lTngfr",defaultMessage:"Select a cell to display preview"})})})]})},Sn=e=>{const{theme:t}=(0,o.u)();return e.disabled?(0,h.Y)("div",{css:(0,a.AH)({flex:1,backgroundColor:t.colors.backgroundSecondary,height:"100%",borderTop:`1px solid ${t.colors.border}`,borderLeft:`1px solid ${t.colors.border}`,paddingTop:t.spacing.lg,marginLeft:-1,zIndex:1,display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,h.Y)(r.Empty,{title:(0,h.Y)(c.A,{id:"2gxV/O",defaultMessage:"Evaluation not available when grouping is enabled"}),description:(0,h.Y)(c.A,{id:"kdTxC2",defaultMessage:"Disable run grouping in order to access the evaluation view"}),image:(0,h.Y)("div",{})})}):(0,h.Y)(Dn,{...e})};var Rn=n(86133),Tn=n(55600),En=n(53274),Ln=n(94119),Fn=n(35286),Bn=n(51120),Pn=n(95379),On=n(57864),Un=n(47946),Nn=n(67901),Hn=n(29757),Vn=n(6564),Kn=n(77684);const Gn=(e,t,n,a,o,r)=>{var s,i;return{uuid:e.runUuid,displayName:(null===(s=e.runInfo)||void 0===s?void 0:s.runName)||e.runUuid,runInfo:e.runInfo,metrics:t[e.runUuid]||{},params:n[e.runUuid]||{},tags:a[e.runUuid]||{},images:o[e.runUuid]||{},color:r,pinned:e.pinned,pinnable:e.pinnable,metricsHistory:{},belongsToGroup:null===(i=e.runDateAndNestInfo)||void 0===i?void 0:i.belongsToGroup,hidden:e.hidden}},jn=({isLoading:e,comparedRuns:t,metricKeyList:n,paramKeyList:r,experimentTags:i,compareRunCharts:l,compareRunSections:c,groupBy:u,autoRefreshEnabled:p,hideEmptyCharts:m,globalLineChartConfig:g,chartsSearchFilter:f,minWidth:_})=>{const y=(0,je.e)(),x=(0,Ot.LE)(),b=(0,Pn.g_)(),{paramsByRunUuid:w,latestMetricsByRunUuid:C,tagsByRunUuid:Y,imagesByRunUuid:I}=(0,v.d4)((e=>({paramsByRunUuid:e.entities.paramsByRunUuid,latestMetricsByRunUuid:e.entities.latestMetricsByRunUuid,tagsByRunUuid:e.entities.tagsByRunUuid,imagesByRunUuid:e.entities.imagesByRunUuid}))),{theme:A}=(0,o.u)(),[k,M]=(0,s.useState)(!1),[D,S]=(0,s.useState)(null),[R,T]=(0,s.useState)(""),{formatMessage:L}=(0,V.A)(),F=(0,s.useMemo)((()=>(0,nt.Zp)(u)),[u]),[B,P]=(0,s.useState)(void 0),O=(0,s.useCallback)((e=>{S(e)}),[]);(0,s.useEffect)((()=>{k||e||M(!0)}),[k,e]);const U=(0,s.useMemo)((()=>{const e=i[d.S0],t=i[d.Q4];return(null===e||void 0===e?void 0:e.value)||(null===t||void 0===t?void 0:t.value)||n[0]||""}),[i,n]),N=(0,s.useMemo)((()=>{if(!u)return t.filter((e=>e.runInfo)).map((e=>Gn(e,C,w,Y,I,x(e.runUuid))));return[...t.filter((e=>e.groupParentInfo&&!(0,nt.mC)(e.groupParentInfo))).map((e=>{var t;return((e,t)=>{var n,a,o;const r=null!==(n=e.groupParentInfo)&&void 0!==n&&n.aggregatedMetricData?(0,E.keyBy)((0,E.values)(null===(a=e.groupParentInfo)||void 0===a?void 0:a.aggregatedMetricData).map((({key:e,value:t,maxStep:n})=>({key:e,value:t,step:n,timestamp:0}))),"key"):{};return{uuid:e.rowUuid,displayName:(0,nt.QD)(e.groupParentInfo),groupParentInfo:e.groupParentInfo,metrics:r,params:(null===(o=e.groupParentInfo)||void 0===o?void 0:o.aggregatedParamData)||{},tags:{},images:{},color:t,pinned:e.pinned,pinnable:e.pinnable,metricsHistory:{},hidden:e.hidden}})(e,x(null===(t=e.groupParentInfo)||void 0===t?void 0:t.groupId))})),...t.filter((e=>{var t;return!e.groupParentInfo&&!(null!==(t=e.runDateAndNestInfo)&&void 0!==t&&t.belongsToGroup)})).map((e=>Gn(e,C,w,Y,I,x(e.runUuid))))]}),[u,t,C,w,Y,I,x]),H=N.filter((e=>!e.hidden&&e.tags[d.Cr]));(0,Un.L)({runUuids:H.map((e=>e.uuid)),runUuidsIsActive:H.map((e=>{var t;return"RUNNING"===(null===(t=e.runInfo)||void 0===t?void 0:t.status)})),enabled:!0,autoRefreshEnabled:p}),(0,s.useEffect)((()=>{if((!c||!l)&&N.length>0){const{resultChartSet:e,resultSectionSet:t}=Rn.i$.getBaseChartAndSectionConfigs({primaryMetricKey:U,runsData:N,useParallelCoordinatesChart:!0});b((n=>({...n,compareRunCharts:e,compareRunSections:t})),!0)}}),[l,c,U,N,b]),(0,s.useEffect)((()=>{b((e=>{if(!e.compareRunCharts||!e.compareRunSections)return e;const{resultChartSet:t,resultSectionSet:n,isResultUpdated:a}=Rn.i$.updateChartAndSectionConfigs({compareRunCharts:e.compareRunCharts,compareRunSections:e.compareRunSections,runsData:N,isAccordionReordered:e.isAccordionReordered});return a?{...e,compareRunCharts:t,compareRunSections:n}:e}),!0)}),[N,b]);const K=(0,s.useCallback)((e=>{y((t=>({...t,runsPinned:t.runsPinned.includes(e)?t.runsPinned.filter((t=>t!==e)):[...t.runsPinned,e]})))}),[y]),G=(0,wn.v)(t),j=(0,s.useCallback)((e=>G(Cn.oy.CUSTOM,e)),[G]),z=(0,Pn.Ez)(),q=(0,Pn.KP)(),$=(0,Pn.iO)(),W=(0,Pn.cA)(),J=(0,s.useMemo)((()=>({runs:N,onTogglePin:K,onHideRun:j})),[N,j,K]),Q=(0,s.useMemo)((()=>m?null===l||void 0===l?void 0:l.filter((e=>!e.deleted&&!(0,En.Cs)(N,e))):null===l||void 0===l?void 0:l.filter((e=>!e.deleted))),[N,l,m]);return k?(0,h.FD)("div",{css:(0,a.AH)({flex:1,borderTop:`1px solid ${A.colors.border}`,borderLeft:`1px solid ${A.colors.border}`,marginLeft:-1,position:"relative",backgroundColor:A.colors.backgroundSecondary,paddingLeft:A.spacing.md,paddingRight:A.spacing.md,paddingBottom:A.spacing.md,zIndex:1,overflowY:"auto",minWidth:_},""),"data-testid":"experiment-view-compare-runs-chart-area",children:[(0,h.FD)("div",{css:[{paddingTop:A.spacing.sm,paddingBottom:A.spacing.sm,display:"flex",gap:A.spacing.xs,position:"sticky",top:0,zIndex:Kn.K.SEARCH_BAR,backgroundColor:A.colors.backgroundSecondary,marginLeft:-A.spacing.md,marginRight:-A.spacing.md,paddingLeft:A.spacing.md,paddingRight:A.spacing.md},""],children:[(0,h.Y)(Vn.I,{chartsSearchFilter:f}),(0,h.Y)(Nn.f,{updateUIState:b,metricKeyList:n,globalLineChartConfig:g})]}),(0,h.Y)(Fn.W,{contextData:J,component:Ln.X,children:(0,h.Y)(Hn.c_,{visibleChartCards:Q,children:(0,h.Y)(Bn.J,{compareRunSections:c,compareRunCharts:Q,reorderCharts:$,insertCharts:W,chartData:N,startEditChart:O,removeChart:q,addNewChartCard:e=>t=>{S(Rn.i$.getEmptyChartCardByType(t,!1,void 0,e))},search:null!==f&&void 0!==f?f:"",groupBy:F,setFullScreenChart:P,autoRefreshEnabled:p,hideEmptyCharts:m,globalLineChartConfig:g})})}),D&&(0,h.Y)(Tn.z,{chartRunData:N,metricKeyList:n,paramKeyList:r,config:D,onSubmit:e=>{z(e),S(null)},onCancel:()=>S(null),groupBy:F,globalLineChartConfig:g}),(0,h.Y)(On._,{fullScreenChart:B,onCancel:()=>P(void 0),chartData:N,groupBy:F,tooltipContextValue:J,tooltipComponent:Ln.X,autoRefreshEnabled:p,globalLineChartConfig:g})]}):(0,h.Y)(qn,{})},zn=e=>{const t=(0,je.e)(),n=(0,s.useCallback)((e=>{t((t=>({...t,...e(t)})))}),[t]);return(0,h.Y)(Pn.oB,{updateChartsUIState:n,children:(0,h.Y)(jn,{...e})})},qn=()=>{const{theme:e}=(0,o.u)();return(0,h.Y)("div",{css:(0,a.AH)({flex:1,display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"200px",gap:e.spacing.md,borderTop:`1px solid ${e.colors.border}`,borderLeft:`1px solid ${e.colors.border}`,marginLeft:-1,backgroundColor:e.colors.backgroundSecondary,padding:e.spacing.md,zIndex:1},""),children:new Array(6).fill(null).map(((e,t)=>(0,h.Y)(r.TableSkeleton,{lines:5,seed:t.toString()},t)))})};var $n=n(61293),Wn=n(42595),Jn=n(64865),Qn=n(92550);var Xn={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const Zn=({error:e})=>{const t=null===e||void 0===e?void 0:e.message;return(0,h.Y)("div",{css:Xn,children:(0,h.Y)(r.Empty,{description:null!==t&&void 0!==t?t:(0,h.Y)(c.A,{id:"i+RyPC",defaultMessage:"Your request could not be fulfilled. Please try again."}),image:(0,h.Y)(o.W,{}),title:(0,h.Y)(c.A,{id:"2mRfvl",defaultMessage:"Request error"})})})};var ea=n(79196);var ta=n(34441);const na=()=>{const e=new Date;return e.setMilliseconds(0),e};var aa={name:"vm4aot",styles:"min-height:225px;height:100%;position:relative;display:flex"};const oa=s.memo((e=>{var t;const[n]=(0,ke.an)(),{experiments:a,runsData:o,uiState:i,searchFacetsState:l,isLoadingRuns:c,loadMoreRuns:u,moreRunsAvailable:p,requestError:m,refreshRuns:g}=e,f=a.length>1,[_,y]=(0,s.useState)(new _t),{experimentId:x}=a[0],b=(0,Ct.S)(x),[C,Y]=(0,s.useState)("true"===b.getItem("expandRows"));(0,s.useEffect)((()=>{b.setItem("expandRows",C)}),[C,b]);const{paramKeyList:I,metricKeyList:A,tagsList:k,paramsList:M,metricsList:D,runInfos:S,runUuidsMatchingFilter:R,datasetsList:T,inputsOutputsList:L}=o,F=(0,v.d4)((({entities:e})=>e.modelVersionsByRunUuid)),B=(0,s.useMemo)((()=>S.map(((e,t)=>{var n,a;return{runInfo:e,params:M[t],metrics:D[t],tags:k[t],datasets:T[t],inputs:(null===L||void 0===L||null===(n=L[t])||void 0===n?void 0:n.inputs)||{},outputs:(null===L||void 0===L||null===(a=L[t])||void 0===a?void 0:a.outputs)||{}}}))),[T,D,M,S,k,L]),{orderByKey:P,searchFilter:O}=l,{runsPinned:U,runsExpanded:N,runsHidden:V,runListHidden:K}=i,G="TABLE"!==n,j=(0,s.useCallback)((e=>y((t=>({...t,...e})))),[]),z=(0,s.useCallback)((()=>{j({columnSelectorVisible:!0})}),[j]),q=(0,s.useMemo)((()=>!P&&!O||P===d.T8.DATE),[P,O]),[$,W]=(0,s.useState)(na);(0,s.useEffect)((()=>{W(na)}),[S]);const J=(0,s.useMemo)((()=>w.A.getVisibleTagKeyList(k)),[k]),[Q,X]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)(),te=(0,s.useMemo)((()=>a.map((({experimentId:e})=>e))),[a]),ne=(0,H.ht)(),ae=(({experimentIds:e,enabled:t=!0})=>{const{data:n}=(0,Qn.e)({experimentIds:e},{enabled:t});return(0,s.useMemo)((()=>null===n||void 0===n?void 0:n.reduce(((e,t)=>{var n;const{source_run_id:a}=null!==(n=t.info)&&void 0!==n?n:{};return a?(e[a]||(e[a]=[]),e[a].push(t),e):e}),{})),[n])})({experimentIds:te,enabled:!ne}),oe=(({runData:e,enabled:t})=>{const n=(0,s.useMemo)((()=>{if(!t)return{};const n={};for(const{runInfo:t,inputs:r,outputs:s}of e){var a,o;const e=t.runUuid,i=[...(null===r||void 0===r||null===(a=r.modelInputs)||void 0===a?void 0:a.map((e=>e.modelId)))||[],...(null===s||void 0===s||null===(o=s.modelOutputs)||void 0===o?void 0:o.map((e=>e.modelId)))||[]];e&&i.length>0&&(n[e]=(0,E.uniq)(i))}return n}),[e,t]),a=(0,s.useMemo)((()=>t?(0,E.uniq)(Object.values(n).flat()):[]),[n,t]),o=(0,ea.o)({modelIds:a},{enabled:t&&a.length>0});return(0,s.useMemo)((()=>o.data?Object.entries(n).reduce(((e,[t,n])=>{var a,r;return e[t]=null!==(a=null===(r=o.data)||void 0===r?void 0:r.filter((e=>{var t;return n.includes((null===(t=e.info)||void 0===t?void 0:t.model_id)||"")})))&&void 0!==a?a:[],e}),{}):{}),[n,o.data])})({runData:B,enabled:ne}),re=ne?oe:ae,se=(0,yt.ZU)({experiments:a,paramKeyList:I,metricKeyList:A,modelVersionsByRunUuid:F,runsExpanded:N,tagKeyList:J,nestChildren:q,referenceTime:$,runData:B,runUuidsMatchingFilter:R,runsPinned:U,runsHidden:V,groupBy:i.groupBy,groupsExpanded:i.groupsExpanded,runsHiddenMode:i.runsHiddenMode,runsVisibilityMap:i.runsVisibilityMap,useGroupedValuesInCharts:i.useGroupedValuesInCharts,searchFacetsState:l,loggedModelsV3ByRunUuid:re}),[ie,le]=(0,r.useLegacyNotification)(),de=bt(ie),[ce,ue]=(0,s.useState)(295),pe=(0,s.useCallback)((()=>{p&&!c&&u().then((e=>{de(e,S)}))}),[p,c,u,S,de]),me=(0,s.useCallback)(((e,t)=>{ee({datasetWithTags:e,runData:t}),X(!0)}),[]),ge=(0,$n.$)(),he=i.autoRefreshEnabled&&ge,fe=null===(t=i.useGroupedValuesInCharts)||void 0===t||t,ve=m instanceof Error&&!c?(0,h.Y)(Zn,{error:m}):(0,h.Y)(vt.P,{experiments:a,runsData:o,searchFacetsState:l,viewState:_,isLoading:c,updateViewState:j,onAddColumnClicked:z,rowsData:se,loadMoreRunsFunc:pe,moreRunsAvailable:p,onDatasetSelected:me,expandRows:C,uiState:i,compareRunsMode:n}),_e=(0,s.useMemo)((()=>a.map((e=>e.experimentId)).sort().join(",")),[a]),{resizableMaxWidth:ye,ref:xe}=(0,ta.b)(350);return(0,h.Y)(He,{visibleRuns:se,refreshRuns:g,children:(0,h.FD)(Jn.Co,{children:[(0,h.Y)(ft,{viewState:_,updateViewState:j,runsData:o,searchFacetsState:l,experimentId:x,requestError:m,expandRows:C,updateExpandRows:Y,refreshRuns:g,uiState:i,isLoading:c,isComparingExperiments:f}),(0,h.FD)("div",{ref:xe,css:aa,children:[G?(0,h.Y)(Wn.t,{onResize:ue,runListHidden:K,width:ce,maxWidth:ye,children:ve}):ve,"CHART"===n&&(0,h.Y)(zn,{isLoading:c,comparedRuns:se,metricKeyList:o.metricKeyList,paramKeyList:o.paramKeyList,experimentTags:o.experimentTags,compareRunCharts:i.compareRunCharts,compareRunSections:i.compareRunSections,groupBy:fe?i.groupBy:null,autoRefreshEnabled:he,hideEmptyCharts:i.hideEmptyCharts,globalLineChartConfig:i.globalLineChartConfig,chartsSearchFilter:i.chartsSearchFilter,storageKey:_e,minWidth:350}),"ARTIFACT"===n&&(0,h.Y)(Sn,{comparedRuns:se,viewState:_,updateViewState:j,onDatasetSelected:me,disabled:Boolean(i.groupBy)}),le,Z&&(0,h.Y)(wt.O,{isOpen:Q,setIsOpen:X,selectedDatasetWithRun:Z,setSelectedDatasetWithRun:ee})]})]})})}));var ra=n(46665);var sa=n(58355);function ia(e){try{return sa.A.getStoreForComponent("ExperimentPage",e).loadComponentState()}catch{return w.A.logErrorAndNotifyUser(`Error: malformed persisted search state for experiment(s) ${e}`),{...(0,Cn.uY)(),...(0,Ge.G)()}}}const la=(e,t,n,a=!1)=>{const o=(0,Ke.Px)(),r=(0,s.useMemo)((()=>n?JSON.stringify(n.sort()):null),[n]);(0,s.useEffect)((()=>{if(!a&&!t){const e=r?ia(r):null,t=(0,E.pick)({...(0,Ge.G)(),...e},Ke.sO);o(t,{replace:!0})}}),[t,r,a]),(0,s.useEffect)((()=>{var n,o;t&&r&&!a&&(n={...t,...e},o=r,sa.A.getStoreForComponent("ExperimentPage",o).saveComponentState(n))}),[t,e,r,a])};var da=n(63591),ca=n(67069),ua=n(76400),pa=n(40072);const ma=(e,t)=>{const{experiments:n}=t,a=t.experimentIds||n.map((e=>e.experimentId)),o=a.length>1,r=(e.entities.runInfoOrderByUuid||[]).map((t=>e.entities.runInfosByUuid[t])).filter((({experimentId:e})=>a.includes(e))).map((({runUuid:e})=>e)),{modelVersionsByRunUuid:s,runUuidsMatchingFilter:i}=e.entities,l=((e,t,{lifecycleFilter:n=ca.gy.ACTIVE,modelVersionFilter:a=ca.EL.ALL_RUNS,datasetsFilter:o=[]})=>{const{modelVersionsByRunUuid:r}=t.entities;return e.map((e=>[(0,pa.K4)(e,t),(0,pa.jF)(e,t)])).filter((([e,t])=>n===ca.gy.ACTIVE?"active"===e.lifecycleStage:"deleted"===e.lifecycleStage)).filter((([e,t])=>a===ca.EL.ALL_RUNS||(a===ca.EL.WITH_MODEL_VERSIONS?e.runUuid in r:a===ca.EL.WTIHOUT_MODEL_VERSIONS?!(e.runUuid in r):(console.warn("Invalid input to model version filter - defaulting to showing all runs."),!0)))).filter((([e,t])=>!o||0===o.length||!!t&&t.some((e=>{const t=e.dataset.name,n=e.dataset.digest;return o.some((({name:e,digest:a})=>e===t&&a===n))})))).map((([e,t])=>e))})(r,e,t),d=new Set,c=new Set,u=l.map((t=>e.entities.runDatasetsByUuid[t.runUuid])),p=l.map((t=>e.entities.runInputsOutputsByUuid[t.runUuid])),m=l.map((t=>{const n=(0,ua.d0)(t.runUuid,e),a=Object.values(n||{}).filter((e=>e.key.trim().length>0));return a.forEach((e=>{d.add(e.key)})),a})),g=l.map((t=>{const n=Object.values((0,pa.tI)(t.runUuid,e)).filter((e=>e.key.trim().length>0));return n.forEach((e=>{c.add(e.key)})),n})),h=l.map((t=>(0,E.pickBy)((0,pa.X3)(t.runUuid,e),(e=>e.key.trim().length>0)))),f=a[0];return{modelVersionsByRunUuid:s,experimentTags:o?{}:(0,pa.xy)(f,e),runInfos:l,paramsList:g,tagsList:h,metricsList:m,runUuidsMatchingFilter:i,datasetsList:u,inputsOutputsList:p,metricKeyList:Array.from(d.values()).sort(),paramKeyList:Array.from(c.values()).sort()}};var ga=n(99213),ha=n(36476),fa=n(91113);const va=(e,t,n)=>{if(!e||!t.length)return null;return{...(0,da.TB)(t,{...e,runsPinned:n},Date.now()),requestedFacets:e}},_a=(e,t,n,a=!1)=>{const o=(0,v.wA)(),[r,i]=(0,s.useState)((()=>ya())),d=!0,c=(0,s.useMemo)((()=>n?JSON.stringify(n.sort()):null),[n]),[u,p]=(0,s.useState)(!0),[m,g]=(0,s.useState)(!0),[h,f]=(0,s.useState)(null),[_,y]=(0,s.useState)(null),x=(0,s.useRef)([]),b=(0,s.useRef)(null),C=(0,s.useRef)(null),Y=(0,s.useRef)(null);(0,s.useEffect)((()=>{a||(g(!0),i(ya()))}),[c,a]);const I=(0,s.useCallback)(((e,t,n)=>{i(ma(e,{datasetsFilter:n.datasetsFilter,lifecycleFilter:n.lifecycleFilter,modelVersionFilter:n.modelVersionFilter,experiments:[],experimentIds:t}))}),[]);(0,s.useEffect)((()=>{x.current=e.runsPinned}),[e.runsPinned]);const A=(0,s.useCallback)((e=>{const t=e=>{var t;const n=null!==(t=e instanceof L.s?(0,fa.h)(e):e)&&void 0!==t?t:e,a=n instanceof L.s?n.getMessageField():n.message;w.A.displayGlobalErrorNotification(`Failed to load model versions for runs: ${a}`)};(0,da.iH)(e||[],ga.hY,o).catch(t)}),[o,d]),k=(0,s.useCallback)(((e,t={})=>o(((n,a)=>(t.isAutoRefreshing||(p(!0),C.current=e),n((e.pageToken?l.e$:l.bn)(e)).then((async({value:n})=>{var o;return b.current=Date.now(),p(!1),g(!1),y(null),C.current&&null!==(o=t.discardResultsFn)&&void 0!==o&&o.call(t,C.current,n)||(Y.current=e,f(n.next_page_token||null),I(a(),e.experimentIds,e.requestedFacets),A(n.runs||[])),n})).catch((e=>{if(p(!1),g(!1),(0,H.Ng)()){if(e instanceof ha.ZR)return void y(e);const t=(0,fa.h)(e);if(t)return void y(t)}y(e),(0,H.Ng)()||w.A.logErrorAndNotifyUser(e)})))))),[o,I,A]);(0,s.useEffect)((()=>{if(a)return;const e=va(t,n,x.current);e&&k(e)}),[k,o,a,t,n]);const M=(0,s.useCallback)((()=>{Y.current&&k({...Y.current,pageToken:void 0})}),[k]);return(({experimentIds:e,lastFetchedTime:t,fetchRuns:n,searchFacets:a,enabled:o,cachedPinnedRuns:r,runsData:i,isLoadingRuns:d})=>{const c=(0,s.useRef)(void 0),u=(0,s.useRef)(d),p=(0,s.useRef)(o),m=(0,s.useRef)(i.runInfos);m.current=i.runInfos,u.current=d,p.current=o,(0,s.useEffect)((()=>{if(window.clearTimeout(c.current),!o||d)return;const s=async()=>{const o=Boolean(t.current),i=t.current?Date.now()-t.current:0;if(a&&o&&i>=da.t4){const t=m.current.length,o=Math.max(1,Math.ceil(t/l.Aj))*l.Aj,s={...(0,da.TB)(e,{...a,runsPinned:r.current},Date.now()),requestedFacets:a,maxResults:o};let i,d=0,c=0;const u=(e,n)=>{var a,r;return!!(c+(null!==(a=null===n||void 0===n||null===(r=n.runs)||void 0===r?void 0:r.length)&&void 0!==a?a:0)<o&&null!==n&&void 0!==n&&n.next_page_token)||!p.current||t>o||!(0,E.isEqual)(e.requestedFacets,s.requestedFacets)};for(;(0===d||i)&&!(c>=o);){d++;const e=await n({...s,pageToken:i},{isAutoRefreshing:!0,discardResultsFn:u});c+=(0,E.isArray)(null===e||void 0===e?void 0:e.runs)?e.runs.length:0,i=null===e||void 0===e?void 0:e.next_page_token}}window.clearTimeout(c.current),p.current&&(c.current=window.setTimeout(s,da.t4))};return s(),()=>{clearTimeout(c.current)}}),[e,n,a,o,r,t,d])})({experimentIds:n,fetchRuns:k,searchFacets:t,enabled:e.autoRefreshEnabled,cachedPinnedRuns:x,runsData:r,isLoadingRuns:u,lastFetchedTime:b}),{isLoadingRuns:u,moreRunsAvailable:Boolean(h),refreshRuns:M,loadMoreRuns:async()=>{const e=va(t,n,x.current);return h&&e?k({...e,pageToken:h}):[]},isInitialLoadingRuns:m,runsData:r,requestError:_}},ya=()=>({datasetsList:[],experimentTags:{},metricKeyList:[],metricsList:[],modelVersionsByRunUuid:{},paramKeyList:[],paramsList:[],runInfos:[],runUuidsMatchingFilter:[],tagsList:[],inputsOutputsList:[]}),xa=(e,t,n=!1)=>{const[a]=(0,m.ok)(),o=(0,V.A)(),r=a.get(d.ex),i=Boolean(r),l=(0,Ke.Px)(),[c,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[_,y]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(!r||!t)return;const e=t.tags.find((({key:e})=>e===`${d.o6}${r}`));if(!e)return u(null),h(null),v(`Error loading shared view state: share key ${r} does not exist`),void y(o.formatMessage({id:"s2L+xL",defaultMessage:'Error loading shared view state: share key "{viewStateShareKey}" does not exist'},{viewStateShareKey:r}));(async e=>{try{const t=await(async e=>(0,ct.ib)(e)?JSON.parse(await(0,ct.U1)(e)):JSON.parse(e))(e.value),n=(0,E.pick)(t,Ke.sO),a=(0,E.pick)(t,Cn.HC);u(n),h(a),v(null),y(null)}catch(t){u(null),h(null),v("Error loading shared view state: share key is invalid"),y(o.formatMessage({id:"Isig6r",defaultMessage:"Error loading shared view state: share key is invalid"}))}})(e)}),[t,r,o]),(0,s.useEffect)((()=>{c&&!n&&l(c,{replace:!0})}),[c,n]),(0,s.useEffect)((()=>{p&&!n&&e(p)}),[e,p,n]);const x=(0,m.Zp)();return(0,s.useEffect)((()=>{n||f&&t&&(w.A.logErrorAndNotifyUser(new Error(f)),w.A.displayGlobalErrorNotification(_,3),x(g.Ay.getExperimentPageRoute(t.experimentId),{replace:!0}))}),[f,_,t,x,n]),{isViewStateShared:i,sharedStateError:f}},ba=[(e,t,n,a)=>{if(a)return t;const o=n.runInfos.filter(((e,t)=>{var a,o;return(null===(a=n.tagsList[t])||void 0===a||null===(o=a[d.yU])||void 0===o?void 0:o.value)===d.m4})).map((({runUuid:e})=>e)),r=(0,E.compact)(n.runInfos.map((({runUuid:e},t)=>{var a;return o.includes(e)&&(null===(a=n.tagsList[t])||void 0===a?void 0:a[_.Ol].value)})));return r.length?{...t,runsExpanded:r.reduce(((e,t)=>({...e,[t]:!0})),t.runsExpanded)}:t}],wa=(0,Cn.uY)(),Ca=(e,t)=>{if(0===e.runInfos.length||0===t.length)return null;const n=t.map((e=>e.experimentId)).sort(),a=e.runInfos.map((e=>e.runUuid)).sort();return`${n.join(":")}:${a.join(":")}`};var Ya=n(17509),Ia=n(7883);var Aa={name:"1g7ixto",styles:"height:100%;display:flex;align-items:center;justify-content:center"};const ka=()=>(0,h.Y)("div",{css:Aa,children:(0,h.Y)(r.Empty,{description:(0,h.Y)(c.A,{id:"VMVNTR",defaultMessage:"Requested experiment was not found."}),image:(0,h.Y)(r.NoIcon,{}),title:(0,h.Y)(c.A,{id:"/sk75d",defaultMessage:"Experiment not found"})})});var Ma={name:"1g7ixto",styles:"height:100%;display:flex;align-items:center;justify-content:center"};const Da=()=>(0,h.Y)("div",{css:Ma,children:(0,h.Y)(r.Empty,{description:(0,h.Y)(c.A,{id:"PSFpHG",defaultMessage:"You don't have permissions to open requested experiment."}),image:(0,h.Y)(r.NoIcon,{}),title:(0,h.Y)(c.A,{id:"cIV9pX",defaultMessage:"Permission denied"})})});var Sa={name:"1wnowod",styles:"display:flex;align-items:center;justify-content:center"};const Ra=({error:e,image:t,title:n,button:a,className:s})=>(0,h.Y)("div",{css:Sa,className:s,children:(0,h.Y)(r.Empty,{description:e.message,image:null!==t&&void 0!==t?t:(0,h.Y)(o.W,{}),title:null!==n&&void 0!==n?n:(0,h.Y)(c.A,{id:"G/zTTY",defaultMessage:"Error"}),button:a})});var Ta=n(47824),Ea=n(60323),La=n(91944),Fa=n(42033),Ba=n(83432),Pa=n(56364);var Oa={name:"13udsys",styles:"height:100%"},Ua={name:"1h8i7is",styles:"overflow-y:hidden;flex-shrink:0;transition:max-height .12s"};const Na=({showHeader:e=!0})=>{var t,n,c;const u=(0,v.wA)(),{theme:p}=(0,o.u)(),[m,g,_]=(0,Ke.sR)(),[y]=(0,ke.an)(),x=(b=g,(0,v.d4)((e=>b.map((t=>e.entities.experimentsById[t])).filter(Boolean)),((e,t)=>(0,E.isEqual)(e,t))));var b;const[C]=x,{fetchExperiments:Y,isLoadingExperiment:I,requestError:A}=(()=>{const e=(0,s.useContext)(ra.Y);if(!e)throw new Error("Trying to use GetExperimentsContext actions outside of the context!");return e})(),{elementHeight:k,observeHeight:M}=(e=>{const[t,n]=(0,s.useState)(null),[a,o]=(0,s.useState)(void 0);return(0,s.useEffect)((()=>{if(!t||!window.ResizeObserver)return;const n=new ResizeObserver((([t])=>{null===e||void 0===e||e(t),t.target.scrollHeight&&o(t.target.scrollHeight)}));return n.observe(t),()=>n.disconnect()}),[t,e]),{elementHeight:a,observeHeight:n}})(),[D,S]=(0,s.useState)(!1),[R,T]=(0,s.useState)(!0),[F,B,P]=(e=>{const t=(0,s.useMemo)((()=>JSON.stringify(e.sort())),[e]),[n,a]=(0,s.useState)(null),[{uiState:o,isSeeded:r,isFirstVisit:i},l]=((0,Ke.Px)(),(0,s.useReducer)(((e,t)=>{if("UPDATE_UI_STATE"===t.type){const n="function"===typeof t.payload?t.payload(e.uiState):t.payload;return{...e,uiState:n}}return"INITIAL_UI_STATE_SEEDED"===t.type?e.isSeeded?e:{...e,isSeeded:!0}:"LOAD_NEW_EXPERIMENT"===t.type?{uiState:t.payload.uiState,isFirstVisit:t.payload.isFirstVisit,currentPersistKey:t.payload.newPersistKey,isSeeded:t.payload.isSeeded}:e}),void 0,(()=>{const e=ia(t),n=Boolean((0,E.keys)(e||{}).length),a=n?(0,E.pick)(e,Cn.HC):{};return{uiState:{...wa,...a},isSeeded:n,isFirstVisit:!n,currentPersistKey:t}}))),d=(0,s.useCallback)((e=>{l({type:"UPDATE_UI_STATE",payload:e})}),[]),c=(0,s.useCallback)(((e,t)=>{if(!i||0===e.length||0===t.runInfos.length)return;const o=Ca(t,e);n===o&&r||r&&!(0,H.kj)()||(d((n=>ba.reduce(((n,a)=>a(e,n,t,r)),{...n}))),a(o),r||l({type:"INITIAL_UI_STATE_SEEDED"}))}),[r,i,d,n]);return(0,s.useEffect)((()=>{const e=ia(t),n=(0,E.pick)(e,Cn.HC),a=Boolean((0,E.keys)(e||{}).length),o=!a;l({type:"LOAD_NEW_EXPERIMENT",payload:{uiState:{...wa,...n},isSeeded:a,isFirstVisit:o,newPersistKey:t}})}),[t]),[o,d,c]})(g),{isViewStateShared:O}=xa(B,(0,E.first)(x)),U=F.viewMaximized,{isLoadingRuns:N,loadMoreRuns:V,runsData:K,moreRunsAvailable:G,requestError:j,refreshRuns:z}=_a(F,m,g);(0,s.useEffect)((()=>{g.every((e=>x.find((t=>t.experimentId===e))))||Y(g)}),[Y,g,x]),(0,s.useEffect)((()=>{P(x,K)}),[P,x,K]),(0,s.useEffect)((()=>{const e=(0,l.wT)(g);u(e).catch((e=>{(0,H.Ng)()||w.A.logErrorAndNotifyUser(e)}))}),[u,g]);const q=g.length>1;la(F,m,g,O||_);const $=Boolean(!I&&x[0]&&K&&m),{mutate:W,isLoading:J}=(0,Fa.G)((()=>{if(!q)return u((0,l.yc)(g[0]))})),Q=(0,La.BH)(null===(t=(0,E.first)(x))||void 0===t?void 0:t.tags),X=null===(n=(0,E.first)(x))||void 0===n?void 0:n.experimentId,{inferredExperimentKind:ee,isLoading:te,dismiss:ne}=(0,Ba.F)({experimentId:X,isLoadingExperiment:I,enabled:e&&!q&&(0,H.XQ)()&&!Q,experimentTags:null===(c=(0,E.first)(x))||void 0===c?void 0:c.tags,updateExperimentKind:W});if(A instanceof ha.m_||A instanceof L.s&&A.getErrorCode()===i.tG.RESOURCE_DOES_NOT_EXIST)return(0,h.Y)(ka,{});if(A instanceof ha.i_||A instanceof L.s&&A.getErrorCode()===i.tG.PERMISSION_DENIED)return(0,h.Y)(Da,{});if(A instanceof Error)return(0,h.Y)(Ra,{css:Oa,error:A});if(!$)return(0,h.Y)(r.LegacySkeleton,{});Z()(m,"searchFacets should be initialized at this point");const ae=I||!x[0];if(ee===d.Gk.NO_INFERRED_TYPE&&(0,H.XQ)())return(0,h.Y)(Pa.T,{onConfirm:e=>{X&&W({experimentId:X,kind:e},{onSettled:ne})},onDismiss:ne});return(0,h.Y)(je.i,{setUIState:B,children:(0,h.FD)("div",{css:Ha.experimentViewWrapper,children:[ae?(0,h.Y)(r.LegacySkeleton,{title:!0,paragraph:!1,active:!0}):e?(0,h.Y)(h.FK,{children:q?(0,h.Y)(f,{experiments:x}):(0,h.FD)(h.FK,{children:[(0,h.FD)(h.FK,{children:[(0,h.Y)(Ta.i,{experiment:C,searchFacetsState:m||void 0,uiState:F,setEditing:S,experimentKindSelector:!q&&X?(0,h.Y)(Ea.f,{value:Q,inferredExperimentKind:ee,onChange:e=>W({experimentId:X,kind:e}),isUpdating:J||te,readOnly:!1},ee):null}),(0,h.Y)("div",{css:(0,a.AH)({width:"100%",borderTop:`1px solid ${p.colors.border}`,marginTop:p.spacing.sm,marginBottom:p.spacing.sm},"")})]}),(0,h.Y)("div",{style:{maxHeight:U?0:k},css:Ua,children:(0,h.Y)("div",{ref:M,children:(0,h.Y)(Ya.A,{experiment:C,setShowAddDescriptionButton:T,editing:D,setEditing:S})})})]})}):(0,h.FD)(h.FK,{children:[null,null]}),"TRACES"===y?(0,h.Y)(Ia.$,{experimentIds:g}):(0,h.Y)(oa,{isLoading:!1,experiments:x,isLoadingRuns:N,runsData:K,searchFacetsState:m,loadMoreRuns:V,moreRunsAvailable:G,requestError:j,refreshRuns:z,uiState:F})]})})},Ha={experimentViewWrapper:{height:"100%",display:"flex",flexDirection:"column"}}},34441:function(e,t,n){n.d(t,{b:function(){return o}});var a=n(46709);function o(e){const t=(0,a.useRef)(null),[n,o]=(0,a.useState)(void 0),r=(0,a.useCallback)((()=>{t.current&&o(t.current.clientWidth)}),[]);(0,a.useLayoutEffect)((()=>(r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r))),[r]);return{resizableMaxWidth:void 0===n?void 0:n-e,ref:(0,a.useCallback)((e=>{t.current=e,r()}),[r])}}},46665:function(e,t,n){n.d(t,{Y:function(){return u},Z:function(){return p}});var a=n(76118),o=n(46709),r=n(91113),s=n(31655),i=n(74264),l=n(16389),d=n(56530),c=n(73408);const u=(0,o.createContext)(null),p=({children:e,actions:t})=>{const[n,p]=(0,o.useState)([]),[m,g]=(0,o.useState)(!1),[h,f]=(0,o.useState)(null),v=(0,d.wA)(),_=(0,o.useCallback)((e=>{f(null),(()=>{const n=e.map((e=>{const n=t.getExperimentApi(e);return v(n).catch((e=>{(0,s.Ng)()||l.A.logErrorAndNotifyUser(e)})),n.meta.id}));p((e=>(0,a.isEqual)(n,e)?e:n))})()}),[t,v]),y=(0,o.useMemo)((()=>({fetchExperiments:_,isLoadingExperiment:m,requestError:h,actions:t})),[t,_,m,h]);return(0,c.Y)(u.Provider,{value:y,children:(0,c.Y)(i.Ay,{shouldOptimisticallyRender:!0,requestIds:n,children:(t,a,o)=>(g(o.some((e=>n.includes(e.id)&&e.active))),h||o.forEach((e=>{if(e.error){if((0,s.Ng)()){const t=(0,r.h)(e.error);if(t)return void f(t)}f(e.error)}})),e)})})}}}]);