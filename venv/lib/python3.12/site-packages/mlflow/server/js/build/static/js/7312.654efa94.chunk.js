"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[7312],{9695:function(e,t,s){s.d(t,{QN:function(){return u},F3:function(){return p},xH:function(){return h},BE:function(){return m}});var i=s(46709),n=s(74060),o=s(66916),r=s(40724),a=s(73408);const{Option:l,OptGroup:d}=n.LegacySelect,c="Create New Model",u=`$$$__${c}__$$$`,m="selectedModel",p="modelName";class h extends i.Component{constructor(...e){super(...e),this.state={selectedModel:null},this.handleModelSelectChange=e=>{this.setState({selectedModel:e})},this.modelNameValidator=(e,t,s)=>{const{modelByName:i}=this.props;s(i[t]?`Model "${t}" already exists.`:void 0)},this.handleFilterOption=(e,t)=>-1!==(t&&t.value||"").toLowerCase().indexOf(e.toLowerCase())}renderExplanatoryText(){const{isCopy:e}=this.props,{selectedModel:t}=this.state;if(!t||t===u)return null;const s=e?(0,a.Y)(r.A,{id:"hxMEqi",defaultMessage:"The model version will be copied to {selectedModel} as a new version.",values:{selectedModel:t}}):(0,a.Y)(r.A,{id:"zjXq2X",defaultMessage:"The model will be registered as a new version of {selectedModel}.",values:{selectedModel:t}});return(0,a.Y)("p",{className:"modal-explanatory-text",children:s})}renderModel(e){return(0,a.Y)(l,{value:e.name,children:e.name},e.name)}render(){const{modelByName:e,innerRef:t,isCopy:s}=this.props,{selectedModel:i}=this.state,r=i===u;return(0,a.FD)(n.LegacyForm,{ref:t,layout:"vertical",className:"mlflow-register-model-form",children:[(0,a.Y)(n.LegacyForm.Item,{label:s?(0,a.Y)("b",{children:"Copy to model"}):"Model",name:m,rules:[{required:!0,message:"Please select a model or create a new one."}],children:(0,a.FD)(n.LegacySelect,{dropdownClassName:"mlflow-model-select-dropdown",onChange:this.handleModelSelectChange,placeholder:"Select a model",filterOption:this.handleFilterOption,onSearch:this.props.onSearchRegisteredModels,showSearch:!0,children:[(0,a.FD)(l,{value:u,className:"mlflow-create-new-model-option",children:[(0,a.Y)("i",{className:"fa fa-plus fa-fw",style:{fontSize:13}})," ",c]}),(0,a.Y)(d,{label:"Models",children:Object.values(e).map((e=>this.renderModel(e)))})]})}),r?(0,a.Y)(n.LegacyForm.Item,{label:"Model Name",name:p,rules:[{required:!0,message:"Please input a name for the new model."},{validator:this.modelNameValidator}],children:(0,a.Y)(o.I,{componentId:"codegen_mlflow_app_src_model-registry_components_registermodelform.tsx_132",placeholder:"Input a model name"})}):null,this.renderExplanatoryText()]})}}},27023:function(e,t,s){s.r(t),s.d(t,{ModelVersionPage:function(){return ge},ModelVersionPageImpl:function(){return me},default:function(){return fe}});var i=s(46709),n=s(56530),o=s(99213),r=s(5690),a=s(61349),l=s(76118),d=s(91105),c=s(27206),u=s(90996);const m=e=>{const{TagAssignmentModal:t}=(0,u.S)({...e});return t};var p=s(74151),h=s(27757),g=s(79081),f=s(7655),v=s(40724),M=s(43233),y=s(16389),A=s(87821),Y=s(9695),I=s(73408);var S={name:"1yh8glp",styles:"margin-top:-12px"};const D=e=>{const t=(0,f.A)(),s=(0,d.Zp)(),r=(0,i.useRef)((0,M.yk)()),a=(0,i.useRef)((0,M.yk)()),{modelVersion:u}=e,[m,p]=(0,i.useState)(!1),[D,b]=(0,i.useState)(!1),R=(0,n.wA)(),_=(0,n.d4)((e=>e.entities.modelByName)),T=(0,i.useRef)(),C=()=>{p(!1),b(!1)},V=e=>{b(!1),y.A.logErrorAndNotifyUser(e)},w=(0,i.useCallback)((e=>{R((0,o.JK)((0,A.pc)(e),5))}),[R]),x=(0,i.useMemo)((()=>(0,l.debounce)(w,300)),[w]);(0,i.useEffect)((()=>{R((0,o.JK)())}),[R]),(0,i.useEffect)((()=>{m&&R((0,o.JK)())}),[R,m]);return(0,I.FD)("div",{className:"promote-model-btn-wrapper",children:[(0,I.Y)(h.B,{componentId:"codegen_mlflow_app_src_model-registry_components_promotemodelbutton.tsx_165",className:"promote-model-btn",type:"primary",onClick:()=>{p(!0)},children:(0,I.Y)(v.A,{id:"+RYBrq",defaultMessage:"Promote model"})}),(0,I.Y)(g.d,{title:(0,I.Y)(v.A,{id:"oBjwod",defaultMessage:"Promote {sourceModelName} version {sourceModelVersion}",values:{sourceModelName:u.name,sourceModelVersion:u.version}}),width:640,visible:m,onOk:()=>{T.current.validateFields().then((e=>{b(!0);const t=e[Y.BE],i="models:/"+u.name+"/"+u.version;if(t===Y.QN){const t=e[Y.F3];R((0,o.eF)(t,r.current)).then((()=>R((0,o.Ey)(t,i,u.run_id,u.tags,a.current)))).then((e=>{C();const{version:i}=e.value.model_version;s(c.fM.getModelVersionPageRoute(t,i))})).catch(V)}else R((0,o.Ey)(t,i,u.run_id,u.tags,a.current)).then((e=>{C();const{version:i}=e.value.model_version;s(c.fM.getModelVersionPageRoute(t,i))})).catch(V)}))},okText:t.formatMessage({id:"DCkSC3",defaultMessage:"Promote"}),cancelText:t.formatMessage({id:"0tU5gv",defaultMessage:"Cancel"}),confirmLoading:D,onCancel:()=>{p(!1)},centered:!0,children:(0,I.FD)(I.FK,{children:[(0,I.Y)(h.T.Paragraph,{css:S,children:(0,I.Y)(v.A,{id:"V5cjvM",defaultMessage:"Copy your MLflow models to another registered model for simple model promotion across environments. For more mature production-grade setups, we recommend setting up automated model training workflows to produce models in controlled environments. <link>Learn more</link>",values:{link:e=>(0,I.Y)(h.T.Link,{componentId:"codegen_mlflow_app_src_model-registry_components_promotemodelbutton.tsx_140",href:"https://mlflow.org/docs/latest/model-registry.html#promoting-an-mlflow-model-across-environments",openInNewTab:!0,children:e})}})}),(0,I.Y)(Y.xH,{modelByName:_,innerRef:T,onSearchRegisteredModels:x,isCopy:!0})]})})]})};var b=s(65181),R=s(68248),_=s(74060),T=s(673),C=s(884);let V=function(e){return e[e.RequestOrDirect=0]="RequestOrDirect",e[e.Approve=1]="Approve",e[e.Reject=2]="Reject",e[e.Cancel=3]="Cancel",e}({});const w=({visible:e,onCancel:t,toStage:s,allowArchivingExistingVersions:n,transitionDescription:o,onConfirm:r,mode:a=V.RequestOrDirect})=>{const{theme:l}=(0,h.u)(),d=(0,C.mN)({defaultValues:{comment:"",archiveExistingVersions:!1}});return(0,i.useEffect)((()=>{e&&d.reset()}),[d,e]),(0,I.FD)(g.d,{title:a===V.Approve?(0,I.Y)(v.A,{id:"CjBv5h",defaultMessage:"Approve pending request"}):a===V.Reject?(0,I.Y)(v.A,{id:"dzoxyA",defaultMessage:"Reject pending request"}):a===V.Cancel?(0,I.Y)(v.A,{id:"bS/iHC",defaultMessage:"Cancel pending request"}):(0,I.Y)(v.A,{id:"rxMHgr",defaultMessage:"Stage transition"}),componentId:"mlflow.model_registry.stage_transition_modal_v2",visible:e,onCancel:t,okText:(0,I.Y)(v.A,{id:"7PCvDy",defaultMessage:"OK"}),cancelText:(0,I.Y)(v.A,{id:"25VTYi",defaultMessage:"Cancel"}),onOk:r&&d.handleSubmit(r),children:[o,(0,I.Y)(g.S,{size:"sm"}),(0,I.Y)(_.FormUI.Label,{htmlFor:"mlflow.model_registry.stage_transition_modal_v2.comment",children:"Comment"}),(0,I.Y)(_.RHFControlledComponents.TextArea,{name:"comment",id:"mlflow.model_registry.stage_transition_modal_v2.comment",componentId:"mlflow.model_registry.stage_transition_modal_v2.comment",control:d.control,rows:4}),(0,I.Y)(g.S,{size:"sm"}),n&&s&&(0,I.Y)(_.RHFControlledComponents.Checkbox,{name:"archiveExistingVersions",componentId:"mlflow.model_registry.stage_transition_modal_v2.archive_existing_versions",control:d.control,children:(0,I.Y)(g.T,{componentId:"mlflow.model_registry.stage_transition_modal_v2.archive_existing_versions.tooltip",content:(0,T.gL)(s),children:(0,I.Y)("span",{css:(0,R.AH)({"[role=status]":{marginRight:l.spacing.xs}},""),children:(0,I.Y)(v.A,{id:"rAJDzz",defaultMessage:"Transition existing {currentStage} model version to {archivedStage}",values:{currentStage:(0,I.Y)("span",{css:(0,R.AH)({marginLeft:l.spacing.xs},""),children:T.$0[s]}),archivedStage:(0,I.Y)("span",{css:(0,R.AH)({marginLeft:l.spacing.xs},""),children:T.$0[T.e3.ARCHIVED]})}})})})})]})};class x extends i.Component{constructor(...e){super(...e),this.state={confirmModalVisible:!1,confirmingActivity:null,handleConfirm:void 0},this.handleMenuItemClick=e=>{const{onSelect:t}=this.props;this.setState({confirmModalVisible:!0,confirmingActivity:e,handleConfirm:t&&(s=>{if(this.setState({confirmModalVisible:!1}),s){const{archiveExistingVersions:i=!1}=s;t(e,i)}else;})})},this.handleConfirmModalCancel=()=>{this.setState({confirmModalVisible:!1})},this.getNoneCurrentStages=e=>{const t=Object.values(T.e3);return(0,l.remove)(t,(t=>t===e)),t}}getMenu(){const{currentStage:e}=this.props,t=this.getNoneCurrentStages(e);return(0,I.Y)(_.Menu,{children:t.map((e=>(0,I.FD)(_.Menu.Item,{onClick:()=>this.handleMenuItemClick({type:T.$p.APPLIED_TRANSITION,to_stage:e}),children:[(0,I.Y)(v.A,{id:"UhdPmo",defaultMessage:"Transition to"}),"\xa0\xa0\xa0",(0,I.Y)(_.ArrowRightIcon,{}),"\xa0\xa0\xa0",T.$0[e]]},`transition-to-${e}`)))})}renderConfirmModal(){const{confirmModalVisible:e,confirmingActivity:t,handleConfirm:s}=this.state;if(!t)return null;const i=t.type===T.$p.APPLIED_TRANSITION&&T.jI.includes(t.to_stage);return(0,I.Y)(w,{visible:e,toStage:t.to_stage,onConfirm:s,onCancel:this.handleConfirmModalCancel,transitionDescription:E(t),allowArchivingExistingVersions:i})}render(){const{currentStage:e}=this.props;return(0,I.FD)("span",{children:[(0,I.Y)(_.Dropdown,{overlay:this.getMenu(),trigger:["click"],className:"mlflow-stage-transition-dropdown",children:(0,I.FD)("span",{children:[T.$0[null!==e&&void 0!==e?e:T.e3.NONE],(0,I.Y)(_.ChevronDownIcon,{css:(0,R.AH)({cursor:"pointer",marginLeft:-4},"")})]})}),this.renderConfirmModal()]})}}x.defaultProps={currentStage:T.e3.NONE};const E=e=>e?(0,I.FD)("div",{children:[(0,I.Y)(v.A,{id:"ZYBoeF",defaultMessage:"Transition to"}),"\xa0\xa0\xa0",(0,I.Y)(_.ArrowRightIcon,{}),"\xa0\xa0\xa0",T.$0[e.to_stage]]}):null;var N=s(32898),k=s(24523),F=s(60284),P=s(45966),L=s(52644),q=s(71647),$=s(10536),O=s(84173);var H=s(12769),U=s(58340),B=s(31655),K=s(3469),j=s(93083);const z=e=>(0,I.Y)(v.A,{id:"4Jyn2b",defaultMessage:"Add/Edit alias for model version {version}",values:{version:e}});var G={name:"lkh5er",styles:"display:flex;flex-wrap:wrap;align-items:center"};const W=({aliases:e=[],modelEntity:t,version:s,onAliasesModified:r})=>{var a;const l=(0,n.wA)(),{EditAliasesModal:d,showEditAliasesModal:c}=(0,K.t)({aliases:null!==(a=null===t||void 0===t?void 0:t.aliases)&&void 0!==a?a:[],onSuccess:r,onSave:async(e,s,i)=>{var n;return l((0,o.mq)(null!==(n=null===t||void 0===t?void 0:t.name)&&void 0!==n?n:"",e,s,i))},getTitle:z,description:(0,I.Y)(v.A,{id:"2DNVN4",defaultMessage:"Aliases allow you to assign a mutable, named reference to a particular model version. <link>Learn more</link>",values:{link:e=>(0,I.Y)("a",{href:T.Tm,rel:"noreferrer",target:"_blank",children:e})}})}),u=(0,i.useCallback)((()=>{c(s)}),[c,s]);return(0,I.FD)(I.FK,{children:[d,e.length<1?(0,I.Y)(h.B,{componentId:"codegen_mlflow_app_src_model-registry_components_aliases_modelversionviewaliaseditor.tsx_29",size:"small",type:"link",onClick:u,title:"Add aliases",children:"Add"}):(0,I.FD)("div",{css:G,children:[e.map((e=>(0,I.Y)(j.Z,{compact:!0,value:e},e))),(0,I.Y)(h.B,{componentId:"codegen_mlflow_app_src_model-registry_components_aliases_modelversionviewaliaseditor.tsx_37",size:"small",icon:(0,I.Y)(_.PencilIcon,{}),onClick:u,title:"Edit aliases"})]})]})};var Q=s(77153);var J={name:"s5xdrg",styles:"display:flex;align-items:center"},X={name:"gc6sdx",styles:"padding-left:4px"},Z={name:"vw6wts",styles:"margin-top:8px;display:flex;justify-content:flex-end"};class ee extends i.Component{constructor(...e){super(...e),this.state={isDeleteModalVisible:!1,isDeleteModalConfirmLoading:!1,showDescriptionEditor:!1,isTagsRequestPending:!1,isTagAssignmentModalVisible:!1,isSavingTags:!1,tagSavingError:void 0},this.formRef=i.createRef(),this.sharedTaggingUIEnabled=(0,B.V0)(),this.handleDeleteConfirm=()=>{const{modelName:e="",modelVersion:t,navigate:s}=this.props,{version:i}=t;this.showConfirmLoading(),this.props.deleteModelVersionApi(e,i).then((()=>{s(c.fM.getModelPageRoute(e))})).catch((e=>{this.hideConfirmLoading(),y.A.logErrorAndNotifyUser(e)}))},this.showDeleteModal=()=>{this.setState({isDeleteModalVisible:!0})},this.hideDeleteModal=()=>{this.setState({isDeleteModalVisible:!1})},this.showConfirmLoading=()=>{this.setState({isDeleteModalConfirmLoading:!0})},this.hideConfirmLoading=()=>{this.setState({isDeleteModalConfirmLoading:!1})},this.handleCancelEditDescription=()=>{this.setState({showDescriptionEditor:!1})},this.handleSubmitEditDescription=e=>this.props.handleEditDescription(e).then((()=>{this.setState({showDescriptionEditor:!1})})),this.startEditingDescription=e=>{e.stopPropagation(),this.setState({showDescriptionEditor:!0})},this.getTags=()=>(0,l.sortBy)(y.A.getVisibleTagValues(this.props.tags).map((([e,t])=>({key:e,name:e,value:t}))),"name"),this.handleCloseTagAssignmentModal=()=>{this.setState({isTagAssignmentModalVisible:!1,tagSavingError:void 0})},this.handleEditTags=()=>{this.setState({isTagAssignmentModalVisible:!0,tagSavingError:void 0})},this.handleSaveTags=(e,t)=>{this.setState({isSavingTags:!0});const{modelName:s}=this.props,{version:i}=this.props.modelVersion,n=e.map((({key:e,value:t})=>this.props.setModelVersionTagApi(s,i,e,t))),o=t.map((({key:e})=>this.props.deleteModelVersionTagApi(s,i,e)));return Promise.all([...n,...o]).then((()=>{this.setState({isSavingTags:!1})})).catch((e=>{const t=e instanceof Q.s?e.getMessageField():e.message;this.setState({isSavingTags:!1,tagSavingError:t})}))},this.handleAddTag=e=>{const t=this.formRef.current,{modelName:s}=this.props,{version:i}=this.props.modelVersion;this.setState({isTagsRequestPending:!0}),this.props.setModelVersionTagApi(s,i,e.name,e.value).then((()=>{this.setState({isTagsRequestPending:!1}),t.resetFields()})).catch((e=>{this.setState({isTagsRequestPending:!1}),console.error(e);const t=e instanceof Q.s?e.getMessageField():e.message;y.A.displayGlobalErrorNotification(this.props.intl.formatMessage({id:"IWuVOI",defaultMessage:"Failed to add tag. Error: {userVisibleError}"},{userVisibleError:t}))}))},this.handleSaveEdit=({name:e,value:t})=>{const{modelName:s}=this.props,{version:i}=this.props.modelVersion;return this.props.setModelVersionTagApi(s,i,e,t).catch((e=>{console.error(e);const t=e instanceof Q.s?e.getMessageField():e.message;y.A.displayGlobalErrorNotification(this.props.intl.formatMessage({id:"HNLDYl",defaultMessage:"Failed to set tag. Error: {userVisibleError}"},{userVisibleError:t}))}))},this.handleDeleteTag=({name:e})=>{const{modelName:t}=this.props,{version:s}=this.props.modelVersion;return this.props.deleteModelVersionTagApi(t,s,e).catch((e=>{console.error(e);const t=e instanceof Q.s?e.getMessageField():e.message;y.A.displayGlobalErrorNotification(this.props.intl.formatMessage({id:"Ay+ZP/",defaultMessage:"Failed to delete tag. Error: {userVisibleError}"},{userVisibleError:t}))}))},this.renderAliasEditor=()=>{var e,t;const s=this.props.modelVersion.version,i=(null===(e=this.props.modelEntity)||void 0===e||null===(t=e.aliases)||void 0===t?void 0:t.filter((({version:e})=>e===s)).map((({alias:e})=>e)))||[];return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"HzGYm5",defaultMessage:"Aliases"}),children:(0,I.Y)(W,{aliases:i,version:this.props.modelVersion.version,modelEntity:this.props.modelEntity,onAliasesModified:this.props.onAliasesModified})},"description-key-aliases")}}componentDidMount(){const e=`${this.props.modelName} v${this.props.modelVersion.version} - MLflow Model`;y.A.updatePageTitle(e)}shouldHideDeleteOption(){return!1}renderStageDropdown(e){const{handleStageTransitionDropdownSelect:t}=this.props;return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"IHyeUr",defaultMessage:"Stage"}),children:e.status===T.IP.READY?(0,I.Y)(x,{currentStage:e.current_stage,permissionLevel:e.permission_level,onSelect:t}):T.$0[e.current_stage]},"description-key-stage")}renderDisabledStage(e){const t=(0,I.Y)(v.A,{id:"gIc8Lp",defaultMessage:"Stages have been deprecated in the new Model Registry UI. Learn how to migrate models <link>here</link>.",values:{link:e=>(0,I.Y)(h.T.Link,{componentId:"codegen_mlflow_app_src_model-registry_components_modelversionview.tsx_301",href:k.pG,openInNewTab:!0,children:e})}});return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"paQ2Wc",defaultMessage:"Stage (deprecated)"}),children:(0,I.FD)("div",{css:J,children:[T.QQ[e.current_stage],(0,I.Y)(_.LegacyTooltip,{title:t,placement:"bottom",children:(0,I.Y)(g.I,{css:X})})]})},"description-key-stage-disabled")}renderRegisteredTimestampDescription(e){return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"+1i81u",defaultMessage:"Registered At"}),children:y.A.formatTimestamp(e,this.props.intl)},"description-key-register")}renderCreatorDescription(e){return e&&(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"5Mzn2b",defaultMessage:"Creator"}),children:e},"description-key-creator")}renderLastModifiedDescription(e){return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"o7dzKo",defaultMessage:"Last Modified"}),children:y.A.formatTimestamp(e,this.props.intl)},"description-key-modified")}renderSourceRunDescription(){var e;return null!==(e=this.props.modelVersion)&&void 0!==e&&e.run_id?(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"+LLlvi",defaultMessage:"Source Run"}),className:"linked-run",children:this.resolveRunLink()},"description-key-source-run"):null}renderCopiedFromLink(){const{source:e}=this.props.modelVersion;if(!e||!/^models:\/[^/]+\/[^/]+$/.test(e))return null;const t=e.split("/"),s=t[1],i=t[2],n=(0,I.FD)(I.FK,{children:[(0,I.Y)(d.N_,{"data-testid":"copied-from-link",to:c.fM.getModelVersionPageRoute(s,i),children:s}),"\xa0",(0,I.Y)(v.A,{id:"1RxxTj",defaultMessage:"(Version {sourceModelVersion})",values:{sourceModelVersion:i}})]});return(0,I.Y)(N.K.Item,{label:this.props.intl.formatMessage({id:"oZReP2",defaultMessage:"Copied from"}),children:n},"description-key-copied-from")}getDescriptions(e){const{usingNextModelsUI:t}=this.props;return[this.renderRegisteredTimestampDescription(e.creation_timestamp),this.renderCreatorDescription(e.user_id),this.renderLastModifiedDescription(e.last_updated_timestamp),this.renderSourceRunDescription(),this.renderCopiedFromLink(),t?this.renderAliasEditor():this.renderStageDropdown(e),t?this.renderDisabledStage(e):null].filter((e=>null!==e))}renderMetadata(e){return(0,I.Y)(N.K,{columns:5,className:"metadata-list",children:this.getDescriptions(e)})}renderStatusAlert(){const{status:e,status_message:t}=this.props.modelVersion;if(e!==T.IP.READY){const s=T.zA[e],i=e===T.IP.FAILED_REGISTRATION?"error":"info";return(0,I.Y)(_.Alert,{type:i,className:`mlflow-status-alert mlflow-status-alert-${i}`,message:t||s,icon:T.UA[e],banner:!0})}return null}renderDescriptionEditIcon(){return(0,I.FD)(h.B,{componentId:"codegen_mlflow_app_src_model-registry_components_modelversionview.tsx_516","data-testid":"descriptionEditButton",type:"link",onClick:this.startEditingDescription,children:[(0,I.Y)(v.A,{id:"Ik96R6",defaultMessage:"Edit"})," "]})}resolveRunLink(){const{modelVersion:e,runInfo:t}=this.props;if(e.run_link)return(0,I.Y)("a",{target:"_blank",href:e.run_link,children:this.resolveRunName()});if(t){var s;let e=null;const i=null===(s=this.props.modelVersion)||void 0===s?void 0:s.source;return i&&(e=function(e,t){var s;return null===(s=e.match(new RegExp(`/${t}/artifacts/(.+)`)))||void 0===s?void 0:s[1]}(i,t.runUuid)),(0,I.Y)(d.N_,{to:F.Ay.getRunPageRoute(t.experimentId,t.runUuid,e),children:this.resolveRunName()})}return null}resolveRunName(){const{modelVersion:e,runInfo:t,runDisplayName:s}=this.props;return e.run_link?e.run_link.substr(0,37)+"...":t?s||t.runUuid:null}renderPomoteModelButton(){const{modelVersion:e,usingNextModelsUI:t,navigate:s}=this.props;return t?(0,I.Y)(D,{modelVersion:e}):null}renderTags(){return this.sharedTaggingUIEnabled?(0,I.Y)(N.K,{columns:1,"data-testid":"model-view-tags",children:(0,I.Y)(N.K.Item,{label:"Tags",children:(0,I.Y)(p.L,{tags:this.getTags(),onEdit:this.handleEditTags})})}):null}getPageHeader(e,t){const s=[{id:"delete",itemName:(0,I.Y)(v.A,{id:"4+RPaz",defaultMessage:"Delete"}),onClick:this.showDeleteModal,disabled:T.jI.includes(this.props.modelVersion.current_stage)}];return(0,I.FD)($.z,{title:e,breadcrumbs:t,children:[!this.shouldHideDeleteOption()&&(0,I.Y)($.o,{menu:s}),this.renderPomoteModelButton()]})}render(){const{modelName:e="",modelVersion:t,tags:s,schema:i}=this.props,{description:n}=t,{isDeleteModalVisible:o,isDeleteModalConfirmLoading:r,showDescriptionEditor:a,isTagsRequestPending:l}=this.state,u=(0,I.Y)(v.A,{id:"F16DNA",defaultMessage:"Version {versionNum}",values:{versionNum:t.version}}),p=[(0,I.Y)(d.N_,{to:c.fM.modelListPageRoute,children:(0,I.Y)(v.A,{id:"pl1bdY",defaultMessage:"Registered Models"})}),(0,I.Y)(d.N_,{"data-testid":"breadcrumbRegisteredModel",to:c.fM.getModelPageRoute(e),children:e})];return(0,I.FD)("div",{children:[(0,I.Y)(m,{isLoading:this.state.isSavingTags,error:this.state.tagSavingError,visible:this.state.isTagAssignmentModalVisible,initialTags:this.getTags(),componentIdPrefix:"model-version-view",onSubmit:this.handleSaveTags,onClose:this.handleCloseTagAssignmentModal}),this.getPageHeader(u,p),this.renderStatusAlert(),this.renderMetadata(t),this.renderTags(),(0,B.WX)()&&(0,I.Y)("div",{css:Z,children:(0,I.Y)(U.C,{})}),(0,I.Y)(P.i,{title:(0,I.FD)("span",{children:[(0,I.Y)(v.A,{id:"z9UqPZ",defaultMessage:"Description"})," ",a?null:this.renderDescriptionEditIcon()]}),forceOpen:a,defaultCollapsed:!n,"data-testid":"model-version-description-section",children:(0,I.Y)(L.V,{defaultMarkdown:n,onSubmit:this.handleSubmitEditDescription,onCancel:this.handleCancelEditDescription,showEditor:a})}),!this.sharedTaggingUIEnabled&&(0,I.Y)("div",{"data-testid":"tags-section",children:(0,I.Y)(P.i,{title:(0,I.Y)(v.A,{id:"TlFUsN",defaultMessage:"Tags"}),defaultCollapsed:0===y.A.getVisibleTagValues(s).length,"data-testid":"model-version-tags-section",children:(0,I.Y)(q.h,{innerRef:this.formRef,handleAddTag:this.handleAddTag,handleDeleteTag:this.handleDeleteTag,handleSaveEdit:this.handleSaveEdit,tags:s,isRequestPending:l})})}),(0,I.Y)(P.i,{title:(0,I.Y)(v.A,{id:"gUdmaJ",defaultMessage:"Schema"}),"data-testid":"model-version-schema-section",children:(0,I.Y)(b.i,{schema:i})}),(0,I.Y)(g.d,{title:this.props.intl.formatMessage({id:"98Ub01",defaultMessage:"Delete Model Version"}),visible:o,confirmLoading:r,onOk:this.handleDeleteConfirm,okText:this.props.intl.formatMessage({id:"ICtiKS",defaultMessage:"Delete"}),okType:"danger",onCancel:this.hideDeleteModal,cancelText:this.props.intl.formatMessage({id:"zMhOr3",defaultMessage:"Cancel"}),children:(0,I.Y)("span",{children:(0,I.Y)(v.A,{id:"88l+j9",defaultMessage:"Are you sure you want to delete model version {versionNum}? This cannot be undone.",values:{versionNum:t.version}})})})]})}}const te={setModelVersionTagApi:o.Id,deleteModelVersionTagApi:o.nZ},se=(0,n.Ng)(((e,t)=>{const{modelName:s}=t,{version:i}=t.modelVersion;return{tags:(0,a.hs)(s,i,e)}}),te)((0,H.p)((0,O.Ay)(ee)));var ie=s(40072),ne=s(74264),oe=s(42110),re=s(86904),ae=s(99637),le=s(54401),de=s(2560),ce=s(55570),ue=s(91113);class me extends i.Component{constructor(...e){super(...e),this.listTransitionRequestId=void 0,this.pollIntervalId=void 0,this.initGetModelVersionDetailsRequestId=(0,M.yk)(),this.getRunRequestId=(0,M.yk)(),this.updateModelVersionRequestId=(0,M.yk)(),this.transitionModelVersionStageRequestId=(0,M.yk)(),this.getModelVersionDetailsRequestId=(0,M.yk)(),this.initGetMlModelFileRequestId=(0,M.yk)(),this.state={criticalInitialRequestIds:[this.initGetModelVersionDetailsRequestId,this.initGetMlModelFileRequestId]},this.pollingRelatedRequestIds=[this.getModelVersionDetailsRequestId,this.getRunRequestId],this.hasPendingPollingRequest=()=>this.pollingRelatedRequestIds.every((e=>{const t=this.props.apis[e];return Boolean(t&&t.active)})),this.loadData=e=>{const t=[this.getModelVersionDetailAndRunInfo(e)];return Promise.all(t)},this.pollData=()=>{const{modelName:e,version:t,navigate:s}=this.props;return!this.hasPendingPollingRequest()&&y.A.isBrowserTabVisible()?this.loadData().catch((i=>{"RESOURCE_DOES_NOT_EXIST"===i.getErrorCode()?(y.A.logErrorAndNotifyUser(i),this.props.deleteModelVersionApi(e,t,void 0,!0),s(c.fM.getModelPageRoute(e))):console.error(i)})):Promise.resolve()},this.handleStageTransitionDropdownSelect=(e,t)=>{const{modelName:s,version:i}=this.props,n=e.to_stage;e.type===T.$p.APPLIED_TRANSITION&&this.props.transitionModelVersionStageApi(s,i.toString(),n,t,this.transitionModelVersionStageRequestId).then(this.loadData).catch(y.A.logErrorAndNotifyUser)},this.handleEditDescription=e=>{const{modelName:t,version:s}=this.props;return this.props.updateModelVersionApi(t,s,e,this.updateModelVersionRequestId).then(this.loadData).catch(console.error)},this.loadModelDataWithAliases=()=>{this.props.getRegisteredModelApi(this.props.modelName)}}getModelVersionDetailAndRunInfo(e){const{modelName:t,version:s}=this.props;return this.props.getModelVersionApi(t,s,!0===e?this.initGetModelVersionDetailsRequestId:this.getModelVersionDetailsRequestId).then((({value:e})=>{var t;e&&!e[(0,ae.zL)("model_version")].run_link&&null!==(t=e[(0,ae.zL)("model_version")])&&void 0!==t&&t.run_id&&this.props.getRunApi(e[(0,ae.zL)("model_version")].run_id,this.getRunRequestId)}))}getModelVersionMlModelFile(){const{modelName:e,version:t}=this.props;this.props.getModelVersionArtifactApi(e,t).then((s=>this.props.parseMlModelFile(e,t,s.value,this.initGetMlModelFileRequestId))).catch((()=>{this.setState((e=>({criticalInitialRequestIds:(0,l.without)(e.criticalInitialRequestIds,this.initGetMlModelFileRequestId)})))}))}componentDidMount(){this.loadData(!0).catch(console.error),this.loadModelDataWithAliases(),this.pollIntervalId=setInterval(this.pollData,T.Gs),this.getModelVersionMlModelFile()}componentDidUpdate(e){this.props.version===e.version&&this.props.modelName===e.modelName||(this.loadData(!0).catch(console.error),this.getModelVersionMlModelFile())}componentWillUnmount(){clearInterval(this.pollIntervalId)}render(){const{modelName:e,version:t,modelVersion:s,runInfo:i,runDisplayName:n,navigate:o,schema:r,modelEntity:a}=this.props;return(0,I.Y)(le.L,{children:(0,I.Y)(ne.Ay,{requestIds:this.state.criticalInitialRequestIds,children:(l,d,u)=>{if(d){clearInterval(this.pollIntervalId);const s=y.A.getResourceConflictError(u,this.state.criticalInitialRequestIds);if(s)return(0,I.Y)(oe.E,{statusCode:409,subMessage:s.error.getMessageField(),fallbackHomePageReactRoute:c.fM.modelListPageRoute});if(y.A.shouldRender404(u,this.state.criticalInitialRequestIds))return(0,I.Y)(oe.E,{statusCode:404,subMessage:`Model ${e} v${t} does not exist`,fallbackHomePageReactRoute:c.fM.modelListPageRoute});const i=u.filter((e=>{var t;return this.state.criticalInitialRequestIds.includes(e.id)&&(null===(t=e.error)||void 0===t?void 0:t.getErrorCode())===k.tG.PERMISSION_DENIED}));var m;if(i&&i[0])return(0,I.Y)(oe.E,{statusCode:403,subMessage:this.props.intl.formatMessage({id:"bQSJKh",defaultMessage:'Permission denied for {modelName} version {version}. Error: "{errorMsg}"'},{modelName:e,version:t,errorMsg:null===(m=i[0].error)||void 0===m?void 0:m.getMessageField()}),fallbackHomePageReactRoute:c.fM.modelListPageRoute});(0,ne.dD)(u)}else{if(l)return(0,I.Y)(re.y,{});if(s)return(0,I.Y)(se,{modelName:e,modelVersion:s,modelEntity:a,runInfo:i,runDisplayName:n,handleEditDescription:this.handleEditDescription,deleteModelVersionApi:this.props.deleteModelVersionApi,navigate:o,handleStageTransitionDropdownSelect:this.handleStageTransitionDropdownSelect,schema:r,onAliasesModified:this.loadModelDataWithAliases})}return null}})})}}const pe={getModelVersionApi:o.s5,getRegisteredModelApi:o.SY,updateModelVersionApi:o.DL,transitionModelVersionStageApi:o.tP,getModelVersionArtifactApi:o.ax,parseMlModelFile:o.qI,deleteModelVersionApi:o.TQ,getRunApi:r.aO},he=(0,de.h)((0,n.Ng)(((e,t)=>{const s=decodeURIComponent(t.params.modelName),{version:i}=t.params,n=(0,a.Af)(e,s,i),o=(0,a.SE)(e,s,i);let r=null;n&&!n.run_link&&(r=(0,ie.K4)(n&&n.run_id,e));const l=r&&(0,ie.X3)(r.runUuid,e)&&r&&y.A.getRunDisplayName(r,r.runUuid),d=e.entities.modelByName[s],{apis:c}=e;return{modelName:s,version:i,modelVersion:n,schema:o,runInfo:r,runDisplayName:l,apis:c,modelEntity:d}}),pe)((0,O.Ay)(me))),ge=(0,ce.X)(ue.A.mlflowServices.MODEL_REGISTRY,he);var fe=ge},59930:function(e){e.exports=function(e,t,s,i,n,o,r,a){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[s,i,n,o,r,a],c=0;(l=new Error(t.replace(/%s/g,(function(){return d[c++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},65181:function(e,t,s){s.d(t,{i:function(){return T}});var i=s(68248),n=s(46709),o=s(27757),r=s(74060),a=s(79081),l=s(66916),d=s(24523),c=s(7655),u=s(40724),m=s(76118),p=s(80625),h=s(73408);const{Text:g}=o.T;function f(e,t){const{type:s}=e,i=" ".repeat(2*t);if("object"===s){return`${i}{\n${Object.keys(e.properties).map((s=>{const i=e.properties[s],n=i.required?"":" (optional)",o=f(i,t+1),r=2*(t+1);return`${" ".repeat(r)}${s}: ${o.slice(r)+n}`})).join(",\n")}\n${i}}`}if("array"===s){const s=2*t;return`${i}Array(${f(e.items,t).slice(s)})`}return`${i}${s}`}var v={name:"hhyoc3",styles:"margin-left:32px"};function M({spec:e}){let t=!0;void 0!==e.required?({required:t}=e):void 0!==e.optional&&e.optional&&(t=!1);const s=t?(0,h.Y)(g,{bold:!0,children:"(required)"}):(0,h.Y)(g,{color:"secondary",children:"(optional)"}),i="name"in e?e.name:"-";return(0,h.FD)(g,{css:v,children:[i," ",s]})}function y({spec:e}){const{theme:t}=(0,o.u)(),s="tensor"===e.type?`Tensor (dtype: ${(n=e)["tensor-spec"].dtype}, shape: [${n["tensor-spec"].shape}])`:f(e,0);var n;return(0,h.Y)("pre",{css:(0,i.AH)({whiteSpace:"pre-wrap",padding:t.spacing.sm,marginTop:t.spacing.sm,marginBottom:t.spacing.sm},""),children:s})}var A={name:"1q1lx84",styles:"flex:2;align-items:center"},Y={name:"qejc9x",styles:"flex:3;align-items:center"};const I=({schemaData:e})=>{const t=(0,m.isEmpty)(e),s=(0,c.A)(),i=Boolean(e&&e.length>100),[g,f]=(0,n.useState)(""),v=(0,p.t)(g),I=(0,n.useMemo)((()=>{if(!i)return e;const t=v.toLowerCase();return null===e||void 0===e?void 0:e.filter((e=>"name"in e&&null!==e.name&&String(e.name).toLowerCase().includes(t))).slice(0,100)}),[e,v,i]);return t?(0,h.Y)(r.TableRow,{children:(0,h.Y)(r.TableCell,{children:(0,h.Y)(u.A,{id:"Wd8Tga",defaultMessage:"No schema. See <link>MLflow docs</link> for how to include input and output schema with your model.",values:{link:e=>(0,h.Y)("a",{href:d.zR,target:"_blank",rel:"noreferrer",children:e})}})})}):(0,h.FD)(h.FK,{children:[i&&(0,h.FD)(h.FK,{children:[(0,h.Y)(a.S,{}),(0,h.Y)(o.T.Hint,{children:(0,h.Y)(u.A,{id:"UYSMKb",defaultMessage:"Schema is too large to display all rows. Please search for a column name to filter the results. Currently showing {currentResults} results from {allResults} total rows.",values:{currentResults:null===I||void 0===I?void 0:I.length,allResults:null===e||void 0===e?void 0:e.length}})}),(0,h.Y)(a.S,{}),(0,h.Y)(l.I,{placeholder:s.formatMessage({id:"6BqLF2",defaultMessage:"Search for a field"}),componentId:"mlflow.schema_table.search_input",value:g,onChange:e=>f(e.target.value)}),(0,h.Y)(a.S,{})]}),null===I||void 0===I?void 0:I.map(((e,t)=>(0,h.FD)(r.TableRow,{children:[(0,h.Y)(r.TableCell,{css:A,children:(0,h.Y)(M,{spec:e})}),(0,h.Y)(r.TableCell,{css:Y,children:(0,h.Y)(y,{spec:e})})]},t)))]})};var S={name:"ddxhyk",styles:"max-width:800px"},D={name:"1189xqs",styles:"flex:2"},b={name:"15hibo9",styles:"flex:3"},R={name:"e0dnmk",styles:"cursor:pointer"},_={name:"e0dnmk",styles:"cursor:pointer"};const T=({schema:e,defaultExpandAllRows:t})=>{const{theme:s}=(0,o.u)(),[a,l]=(0,n.useState)(t),[d,c]=(0,n.useState)(t);return(0,h.FD)(r.Table,{css:S,children:[(0,h.FD)(r.TableRow,{isHeader:!0,children:[(0,h.Y)(r.TableHeader,{componentId:"mlflow.schema_table.header.name",css:D,children:(0,h.Y)(g,{bold:!0,css:(0,i.AH)({paddingLeft:s.spacing.lg+s.spacing.xs},""),children:(0,h.Y)(u.A,{id:"Nj6Ez5",defaultMessage:"Name"})})}),(0,h.Y)(r.TableHeader,{componentId:"mlflow.schema_table.header.type",css:b,children:(0,h.Y)(g,{bold:!0,children:(0,h.Y)(u.A,{id:"2f2qeb",defaultMessage:"Type"})})})]}),(0,h.FD)(h.FK,{children:[(0,h.Y)(r.TableRow,{onClick:()=>l(!a),css:R,children:(0,h.Y)(r.TableCell,{children:(0,h.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,h.Y)("div",{css:(0,i.AH)({width:s.spacing.lg,height:s.spacing.lg,display:"flex",alignItems:"center",justifyContent:"center",svg:{color:s.colors.textSecondary}},""),children:a?(0,h.Y)(r.MinusSquareIcon,{}):(0,h.Y)(r.PlusSquareIcon,{})}),(0,h.Y)(u.A,{id:"sxlGRc",defaultMessage:"Inputs ({numInputs})",values:{numInputs:e.inputs.length}})]})})}),a&&(0,h.Y)(I,{schemaData:e.inputs}),(0,h.Y)(r.TableRow,{onClick:()=>c(!d),css:_,children:(0,h.Y)(r.TableCell,{children:(0,h.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:s.spacing.xs},""),children:[(0,h.Y)("div",{css:(0,i.AH)({width:s.spacing.lg,height:s.spacing.lg,display:"flex",alignItems:"center",justifyContent:"center",svg:{color:s.colors.textSecondary}},""),children:d?(0,h.Y)(r.MinusSquareIcon,{}):(0,h.Y)(r.PlusSquareIcon,{})}),(0,h.Y)(u.A,{id:"llVQ2r",defaultMessage:"Outputs ({numOutputs})",values:{numOutputs:e.outputs.length}})]})})}),d&&(0,h.Y)(I,{schemaData:e.outputs})]})]})}},80625:function(e,t,s){s.d(t,{t:function(){return o}});var i=s(76118),n=s(46709);const o=(0,i.isFunction)(n.useDeferredValue)?n.useDeferredValue:i.identity},87821:function(e,t,s){s.d(t,{_C:function(){return a},pc:function(){return o},so:function(){return r}});var i=s(673),n=s(99213);function o(e){return e?`${i.Qs} ilike ${(0,n.GP)(e,!0)}`:""}function r({query:e=""}={}){const t=[],s=e.includes("tags.")?e:o(e);return s&&t.push(s),t.join(" AND ")}function a(e){return"searchInput"in e?e.searchInput:"nameSearchInput"in e&&"tagSearchInput"in e?o(e.nameSearchInput)+" AND "+e.tagSearchInput:"tagSearchInput"in e?e.tagSearchInput:"nameSearchInput"in e?e.nameSearchInput:""}},90996:function(e,t,s){s.d(t,{S:function(){return F}});var i=s(68248),n=s(46709),o=s(884),r=s(27757),a=s(79081),l=s(74060),d=s(40724),c=s(59930),u=s.n(c),m=s(73408);function p({children:e}){const{theme:t}=(0,r.u)();return(0,m.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e})}const h=(0,n.createContext)(null);function g({children:e,...t}){return(0,m.Y)(h.Provider,{value:t,children:e})}function f(){const e=(0,n.useContext)(h);return u()(e,"useTagAssignmentContext must be used within a TagAssignmentRoot"),e}function v({children:e,...t}){const s=(0,o.xW)(),i=(0,m.Y)(g,{...t,children:(0,m.Y)(p,{children:e})});return s?i:(u()(t.form,"Nest your component on a FormProvider or pass a form prop"),(0,m.Y)(o.Op,{...t.form,children:i}))}function M({children:e}){const{theme:t}=(0,r.u)(),s=n.Children.toArray(e);u()(s.length<=3,"TagAssignmentRow must have 3 children or less");const o=Array(3).fill(null).map(((e,i)=>{var n;return null!==(n=s[i])&&void 0!==n?n:(0,m.Y)("span",{style:{width:t.general.heightSm}},i)}));return(0,m.Y)("div",{css:(0,i.AH)({display:"grid",gridTemplateColumns:"1fr 1fr min-content",gap:t.spacing.sm},""),children:o})}function y({children:e}){return(0,m.Y)(r.T.Text,{bold:!0,children:e})}var A=s(66916);var Y={name:"82a6rk",styles:"flex:1"};const I=(0,n.forwardRef)((({errorMessage:e,...t},s)=>(0,m.FD)("div",{css:Y,children:[(0,m.Y)(A.I,{validationState:e?"error":"info",...t,ref:s}),e&&(0,m.Y)(l.FormUI.Message,{message:e,type:"error"})]})));function S({index:e,rules:t,render:s}){const{name:i,keyProperty:n,getTagsValues:r,emptyValue:a,appendIfPossible:l}=f();return(0,m.Y)(o.xI,{name:`${i}.${e}.${n}`,rules:t,render:({field:e,fieldState:t,formState:i})=>{var o;const d=e.onChange;return e.onChange=function(e){var t;d(e);const s=r();null!==s&&void 0!==s&&null!==(t=s.at(-1))&&void 0!==t&&t[n]&&l(a,{shouldFocus:!1})},s?s({field:e,fieldState:t,formState:i}):(0,m.Y)(I,{componentId:"TagAssignmentKey.Default.Input",errorMessage:null===(o=t.error)||void 0===o?void 0:o.message,...e})}})}function D({rules:e,index:t,render:s}){const{name:i,valueProperty:n}=f();return(0,m.Y)(o.xI,{rules:e,name:`${i}.${t}.${n}`,render:({field:e,fieldState:t,formState:i})=>{var n;return s?s({field:e,fieldState:t,formState:i}):(0,m.Y)(I,{componentId:"TagAssignmentValue.Default.Input",errorMessage:null===(n=t.error)||void 0===n?void 0:n.message,...e})}})}function b(e){return(0,m.Y)(r.B,{icon:(0,m.Y)(l.TrashIcon,{}),...e})}function R({index:e,...t}){const{removeOrUpdate:s}=f();return(0,m.Y)(b,{onClick:()=>s(e),...t})}var _=s(7655);function T(e,t){if(void 0!==e)return 0===e&&u()(!1,"maxLength must be greater than 0"),{maxLength:{value:e,message:t.formatMessage({id:"JW0GbU",defaultMessage:"You can set a maximum of {maxLength} values"},{maxLength:e})}}}function C({name:e,maxLength:t,emptyValue:s,defaultValues:i,loading:r,form:a,keyProperty:l,valueProperty:d}){const[c]=(0,n.useState)(s),m=(0,o.xW)(),p=Boolean(m)&&!a,h=p?m:a;u()(h,"Nest your component on a FormProvider or pass a form prop"),u()(!(i&&p),"Define defaultValues at form context level");const{setValue:g}=h,f=function({name:e,maxLength:t,emptyValue:s,form:i,keyProperty:r}){const a=(0,_.A)(),l=(0,o.xW)(),d=Boolean(l)&&!i?l:i;u()(d,"Nest your component on a FormProvider or pass a form prop");const[c]=(0,n.useState)(s),{append:m,update:p,remove:h,...g}=(0,o.jz)({name:e,control:d.control,rules:T(t,a)}),{getValues:f}=d,v=(0,n.useCallback)((()=>f(e)),[f,e]),M=(0,n.useCallback)(((e,s)=>{const i=v();t&&i&&i.length>=t||m(e,s)}),[v,t,m]),y=(0,n.useCallback)((e=>{const t=v();if(t&&e===t.length-1)return p(e,c);const s=null===t||void 0===t?void 0:t.at(-1);if(null!==s&&void 0!==s&&s[r])return h(e),void m(c,{shouldFocus:!1});h(e)}),[c,v,r,m,h,p]);return{form:d,...g,originalAppend:m,update:p,originalRemove:h,appendIfPossible:M,removeOrUpdate:y,getTagsValues:v}}({name:e,maxLength:t,emptyValue:s,form:h,keyProperty:l}),v=f.getTagsValues;return(0,n.useEffect)((()=>{if(!r){if(i){const s=[...i];return(!t||t&&s.length<t)&&s.push(c),void g(e,s)}if(p){var s;const i=null!==(s=v())&&void 0!==s?s:[];return(!t||t&&i.length<t)&&i.push(c),void g(e,i)}g(e,[c])}}),[i,g,r,t,e,c,p,v]),{...f,form:h,maxLength:t,emptyValue:s,name:e,keyProperty:l,valueProperty:d}}const V="value",w=({form:e,name:t,initialTags:s})=>{const i=(0,_.A)(),n=C({name:t,emptyValue:{key:"",value:""},keyProperty:"key",valueProperty:V,form:e,defaultValues:s});return(0,m.FD)(v,{...n,children:[(0,m.FD)(M,{children:[(0,m.Y)(y,{children:(0,m.Y)(d.A,{id:"h2SXjO",defaultMessage:"Key"})}),(0,m.Y)(y,{children:(0,m.Y)(d.A,{id:"6yjymQ",defaultMessage:"Value"})})]}),n.fields.map(((e,t)=>(0,m.FD)(M,{children:[(0,m.Y)(S,{index:t,rules:{validate:{unique:e=>{const s=n.getTagsValues();return(null===s||void 0===s?void 0:s.findIndex((t=>t.key===e)))===t||i.formatMessage({id:"sLBHQp",defaultMessage:"Key must be unique"})},required:e=>{var s;const o=n.getTagsValues();return!(null!==o&&void 0!==o&&null!==(s=o.at(t))&&void 0!==s&&s[V]&&!e)||i.formatMessage({id:"J45Atg",defaultMessage:"Key is required if value is present"})}}}}),(0,m.Y)(D,{index:t}),(0,m.Y)(R,{index:t,componentId:"endpoint-tags-section.remove-button"})]},e.id)))]})},x="key",E="value",N="tags",k={key:"",value:""},F=({componentIdPrefix:e,title:t,visible:s,initialTags:c,isLoading:u=!1,error:p,onSubmit:h,onSuccess:g,onClose:f})=>{const v=`${e}.tag-assignment-modal`,[M,y]=(0,n.useState)(!1),{theme:A}=(0,r.u)(),Y=(0,o.mN)({mode:"onChange"}),I=()=>{y(!1),Y.reset({[N]:[k]}),null===f||void 0===f||f()},S=(0,m.Y)(d.A,{id:"AGWpnl",defaultMessage:"Add tags"});return{TagAssignmentModal:(0,m.FD)(a.d,{componentId:`${v}`,title:null!==t&&void 0!==t?t:S,visible:null!==s&&void 0!==s?s:M,destroyOnClose:!0,onCancel:I,footer:(0,m.FD)(m.FK,{children:[(0,m.Y)(r.B,{componentId:`${v}.submit-button`,onClick:I,disabled:u,children:(0,m.Y)(d.A,{id:"awekbG",defaultMessage:"Cancel"})}),(0,m.Y)(r.B,{componentId:`${v}.submit-button`,type:"primary",onClick:Y.handleSubmit((e=>{var t,s;const i=e[N].filter((e=>Boolean(e[x]))),n=null!==(t=i.filter((e=>!(null!==c&&void 0!==c&&c.some((t=>t[x]===e[x]&&t[E]===e[E]))))))&&void 0!==t?t:[],o=null!==(s=null===c||void 0===c?void 0:c.filter((e=>!i.some((t=>t[x]===e[x]&&t[E]===e[E])))))&&void 0!==s?s:[];h(n,o).then((()=>{I(),null===g||void 0===g||g()}))})),loading:u,disabled:u,children:(0,m.Y)(d.A,{id:"C6ReUY",defaultMessage:"Save"})})]}),children:[p&&(0,m.Y)(l.Alert,{type:"error",message:p,componentId:`${v}.error`,closable:!1,css:(0,i.AH)({marginBottom:A.spacing.sm},"")}),(0,m.Y)(w,{name:N,form:Y,initialTags:c})]}),showTagAssignmentModal:()=>{y(!0)},hideTagAssignmentModal:I}}}}]);